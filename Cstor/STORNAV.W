&ANALYZE-SUSPEND _VERSION-NUMBER UIB_v8r12 GUI
&ANALYZE-RESUME
/* Connected Databases 
          temp-db          PROGRESS
*/
&Scoped-define WINDOW-NAME C-Win


/* Temp-Table and Buffer definitions                                    */



&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CUSTOM _DEFINITIONS C-Win 
/*------------------------------------------------------------------------

  File: 

  Description: 

  Input Parameters:
      <none>

  Output Parameters:
      <none>

  Author: 

  Created: 

------------------------------------------------------------------------*/
/*          This .W file was created with the Progress UIB.             */
/*----------------------------------------------------------------------*/

/* Create an unnamed pool to store all the widgets created 
     by this procedure. This is a good default which assures
     that this procedure's triggers and internal procedures 
     will execute in this procedure's storage, and that proper
     cleanup will occur on deletion of the procedure. */

CREATE WIDGET-POOL.

/* ***************************  Definitions  ************************** */

/* Parameters Definitions ---                                           */
/* Local Variable Definitions ---                                       */
{ALLDEF.I}
{GLOBVAR2DEL1.I}
DEFINE NEW SHARED VARIABLE klocka AS DECIMAL NO-UNDO.
DEFINE NEW SHARED VARIABLE valford AS CHARACTER NO-UNDO.
DEFINE NEW SHARED VARIABLE vallinje AS CHARACTER NO-UNDO.
DEFINE NEW SHARED VARIABLE valnat AS CHARACTER NO-UNDO. 
DEFINE NEW SHARED VARIABLE siff AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE andrakod AS CHARACTER NO-UNDO.
DEFINE NEW SHARED VARIABLE id AS LOGICAL NO-UNDO.   
DEFINE NEW SHARED VARIABLE nyttidnr AS CHARACTER NO-UNDO.
DEFINE NEW SHARED VARIABLE specvar AS LOGICAL NO-UNDO.   
DEFINE NEW SHARED VARIABLE startdatum AS DATE NO-UNDO.
DEFINE NEW SHARED VARIABLE starttid AS DECIMAL NO-UNDO.
DEFINE NEW SHARED VARIABLE totavbrott AS DECIMAL NO-UNDO.
DEFINE NEW SHARED VARIABLE lspantal AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE hspantal AS INTEGER NO-UNDO.
DEFINE SHARED VARIABLE nytid AS DECIMAL FORMAT "99.99" NO-UNDO.
DEFINE SHARED VARIABLE sekunder AS INTEGER FORMAT "-9999999" NO-UNDO.
DEFINE SHARED VARIABLE ny AS LOGICAL NO-UNDO.
DEFINE SHARED VARIABLE distvar AS INTEGER NO-UNDO.
DEFINE SHARED VARIABLE stornrid AS INTEGER NO-UNDO.
DEFINE SHARED VARIABLE forvar AS INTEGER NO-UNDO.
DEFINE SHARED VARIABLE valrec AS RECID NO-UNDO.
DEFINE SHARED VARIABLE musz AS LOGICAL NO-UNDO.   
DEFINE SHARED VARIABLE regdatum AS DATE NO-UNDO.
DEFINE SHARED VARIABLE strproch AS HANDLE NO-UNDO. /*Handle till STORHMT.P*/
DEFINE SHARED VARIABLE sistartal AS INTEGER NO-UNDO.
DEFINE VARIABLE status-ok AS LOGICAL NO-UNDO.
DEFINE VARIABLE rubrik AS CHARACTER NO-UNDO.
DEFINE VARIABLE kommandoq AS CHARACTER NO-UNDO.
DEFINE VARIABLE felvar AS INTEGER NO-UNDO.
DEFINE VARIABLE annvar AS INTEGER NO-UNDO.
DEFINE VARIABLE fransys AS INTEGER NO-UNDO.
DEFINE VARIABLE felsys AS INTEGER NO-UNDO.
DEFINE VARIABLE datum70 AS DATE NO-UNDO.
DEFINE VARIABLE datum30 AS DATE NO-UNDO.
DEFINE VARIABLE tid70 AS DECIMAL NO-UNDO.
DEFINE VARIABLE tid30 AS DECIMAL NO-UNDO.
DEFINE VARIABLE timmar100 AS DECIMAL NO-UNDO.
DEFINE VARIABLE timmar60 AS DECIMAL NO-UNDO.
DEFINE VARIABLE bortavbrott AS DECIMAL NO-UNDO.
DEFINE VARIABLE totbortfall AS DECIMAL NO-UNDO.
DEFINE VARIABLE mestbort AS INTEGER NO-UNDO.
DEFINE VARIABLE bortfallrec AS RECID NO-UNDO.
DEFINE VARIABLE divmestbort AS DECIMAL NO-UNDO.
DEFINE VARIABLE skapa AS LOGICAL NO-UNDO.
DEFINE VARIABLE felkontroll AS LOGICAL NO-UNDO.
DEFINE VARIABLE ejvalue AS LOGICAL NO-UNDO.
DEFINE VARIABLE laddartal AS INTEGER NO-UNDO.
DEFINE VARIABLE forsta AS LOGICAL NO-UNDO.
DEFINE VARIABLE brwkoll AS INTEGER NO-UNDO EXTENT 10.
DEFINE VARIABLE radspar AS INTEGER NO-UNDO.

DEFINE NEW SHARED TEMP-TABLE bort_temp
   FIELD ATERDATUM AS DATE
   FIELD ATERKLOCKAN AS DECIMAL
   FIELD ANTALHSP AS INTEGER
   FIELD ANTALLSP AS INTEGER
   FIELD AVBROTTSTID AS DECIMAL
   FIELD AKTIVITET AS CHARACTER
   INDEX AVBROTT ATERDATUM ATERKLOCKAN ASCENDING.

&SCOPED-DEFINE NEW 
&SCOPED-DEFINE SHARED SHARED
{AVDELNINGTEMP.I} 
{STRTEMP.I}
{STORTEMP.I}
DEFINE TEMP-TABLE extrastorntemp NO-UNDO LIKE urstorntemp.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-PREPROCESSOR-BLOCK 

/* ********************  Preprocessor Definitions  ******************** */

&Scoped-define PROCEDURE-TYPE Window
&Scoped-define DB-AWARE no

/* Name of designated FRAME-NAME and/or first browse and/or first query */
&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define BROWSE-NAME BRW_ANL

/* Internal Tables (found by Frame, Query & Browse Queries)             */
&Scoped-define INTERNAL-TABLES anlaggningsdeltemp felorsaktemp anvandartemp

/* Definitions for BROWSE BRW_ANL                                       */
&Scoped-define FIELDS-IN-QUERY-BRW_ANL anlaggningsdeltemp.NAMN 
&Scoped-define ENABLED-FIELDS-IN-QUERY-BRW_ANL anlaggningsdeltemp.NAMN 
&Scoped-define ENABLED-TABLES-IN-QUERY-BRW_ANL anlaggningsdeltemp
&Scoped-define FIRST-ENABLED-TABLE-IN-QUERY-BRW_ANL anlaggningsdeltemp
&Scoped-define QUERY-STRING-BRW_ANL FOR EACH anlaggningsdeltemp NO-LOCK INDEXED-REPOSITION
&Scoped-define OPEN-QUERY-BRW_ANL OPEN QUERY BRW_ANL FOR EACH anlaggningsdeltemp NO-LOCK INDEXED-REPOSITION.
&Scoped-define TABLES-IN-QUERY-BRW_ANL anlaggningsdeltemp
&Scoped-define FIRST-TABLE-IN-QUERY-BRW_ANL anlaggningsdeltemp


/* Definitions for BROWSE BRW_FEL                                       */
&Scoped-define FIELDS-IN-QUERY-BRW_FEL felorsaktemp.NAMN 
&Scoped-define ENABLED-FIELDS-IN-QUERY-BRW_FEL felorsaktemp.NAMN 
&Scoped-define ENABLED-TABLES-IN-QUERY-BRW_FEL felorsaktemp
&Scoped-define FIRST-ENABLED-TABLE-IN-QUERY-BRW_FEL felorsaktemp
&Scoped-define QUERY-STRING-BRW_FEL FOR EACH felorsaktemp NO-LOCK INDEXED-REPOSITION
&Scoped-define OPEN-QUERY-BRW_FEL OPEN QUERY BRW_FEL FOR EACH felorsaktemp NO-LOCK INDEXED-REPOSITION.
&Scoped-define TABLES-IN-QUERY-BRW_FEL felorsaktemp
&Scoped-define FIRST-TABLE-IN-QUERY-BRW_FEL felorsaktemp


/* Definitions for BROWSE BRW_PERS                                      */
&Scoped-define FIELDS-IN-QUERY-BRW_PERS anvandartemp.ANVANDARE ~
anvandartemp.AV-NAMN 
&Scoped-define ENABLED-FIELDS-IN-QUERY-BRW_PERS anvandartemp.ANVANDARE 
&Scoped-define ENABLED-TABLES-IN-QUERY-BRW_PERS anvandartemp
&Scoped-define FIRST-ENABLED-TABLE-IN-QUERY-BRW_PERS anvandartemp
&Scoped-define QUERY-STRING-BRW_PERS FOR EACH anvandartemp NO-LOCK INDEXED-REPOSITION
&Scoped-define OPEN-QUERY-BRW_PERS OPEN QUERY BRW_PERS FOR EACH anvandartemp NO-LOCK INDEXED-REPOSITION.
&Scoped-define TABLES-IN-QUERY-BRW_PERS anvandartemp
&Scoped-define FIRST-TABLE-IN-QUERY-BRW_PERS anvandartemp


/* Definitions for FRAME FRAME-KUND                                     */

/* Definitions for FRAME FRAME-STOR                                     */

/* Standard List Definitions                                            */
&Scoped-Define ENABLED-OBJECTS RAD_KS MBTN_KUNDUPPG RECT-28 MBTN_STORNUPPG ~
BTN_OK BTN_AVB 
&Scoped-Define DISPLAYED-OBJECTS RAD_KS 

/* Custom List Definitions                                              */
/* List-1,List-2,List-3,List-4,List-5,List-6                            */

/* _UIB-PREPROCESSOR-BLOCK-END */
&ANALYZE-RESUME


/* ************************  Function Prototypes ********************** */

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _FUNCTION-FORWARD klockan100 C-Win 
FUNCTION klockan100 RETURNS DECIMAL
  (INPUT ber60 AS DECIMAL)  FORWARD.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _FUNCTION-FORWARD klockan60 C-Win 
FUNCTION klockan60 RETURNS DECIMAL
  (INPUT ber100 AS DECIMAL)  FORWARD.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


/* ***********************  Control Definitions  ********************** */

/* Define the widget handle for the window                              */
DEFINE VAR C-Win AS WIDGET-HANDLE NO-UNDO.

/* Definitions of the field level widgets                               */
DEFINE BUTTON BTN_AVB 
     LABEL "Avbryt" 
     SIZE 14 BY 1
     BGCOLOR 8 .

DEFINE BUTTON BTN_OK AUTO-GO 
     LABEL "Ok" 
     SIZE 14 BY 1
     BGCOLOR 8 .

DEFINE BUTTON MBTN_KUNDUPPG 
     LABEL "Kunduppgifter" 
     SIZE 18 BY 1.

DEFINE BUTTON MBTN_STORNUPPG 
     LABEL "Störningsuppgifter" 
     SIZE 18 BY 1.

DEFINE VARIABLE RAD_KS AS INTEGER 
     VIEW-AS RADIO-SET HORIZONTAL
     RADIO-BUTTONS 
          "Kunduppgifter", 1,
"Störningsuppgifter", 2
     SIZE 58 BY 1 NO-UNDO.

DEFINE RECTANGLE RECT-28
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 121.5 BY .08.

DEFINE BUTTON BTN_MINDAT2 
     LABEL "-" 
     SIZE 2.5 BY .75.

DEFINE BUTTON BTN_UPDAT2 
     LABEL "+" 
     SIZE 2.5 BY .75.

DEFINE VARIABLE CMB_AR AS CHARACTER FORMAT "X(256)":U 
     VIEW-AS COMBO-BOX INNER-LINES 5
     LIST-ITEMS "0" 
     DROP-DOWN-LIST
     SIZE 11 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_FOR AS CHARACTER FORMAT "X(256)":U 
     LABEL "Företag" 
     VIEW-AS COMBO-BOX INNER-LINES 8
     DROP-DOWN-LIST
     SIZE 28.75 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_OMR AS CHARACTER FORMAT "X(256)":U 
     LABEL "Distrikt" 
     VIEW-AS COMBO-BOX INNER-LINES 8
     DROP-DOWN-LIST
     SIZE 28.75 BY .96 NO-UNDO.

DEFINE VARIABLE ED_MEDD AS CHARACTER 
     VIEW-AS EDITOR MAX-CHARS 200 SCROLLBAR-VERTICAL
     SIZE 45.25 BY 6.58
     BGCOLOR 15  NO-UNDO.

DEFINE VARIABLE FILL-IN-ADRESS AS CHARACTER FORMAT "X(256)":U 
     LABEL "Feladress" 
     VIEW-AS FILL-IN 
     SIZE 29.63 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANM AS CHARACTER FORMAT "X(256)":U INITIAL "Anmärkning:" 
      VIEW-AS TEXT 
     SIZE 11.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANMALARE AS CHARACTER FORMAT "X(256)":U 
     LABEL "Felanmälare" 
     VIEW-AS FILL-IN 
     SIZE 29.63 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-ATER AS LOGICAL FORMAT "Ja/Nej":U INITIAL NO 
     LABEL "Återstående arbete" 
     VIEW-AS FILL-IN 
     SIZE 8 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DISTRIKT AS CHARACTER FORMAT "X(256)":U 
     LABEL "Distrikt nr" 
      VIEW-AS TEXT 
     SIZE 9 BY .67 NO-UNDO.

DEFINE VARIABLE FILL-IN-FDAT AS DATE FORMAT "99/99/99":U 
     LABEL "Färdig datum" 
     VIEW-AS FILL-IN 
     SIZE 9 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-FEL AS CHARACTER FORMAT "X(256)":U 
     LABEL "Fel uppgivet" 
     VIEW-AS FILL-IN 
     SIZE 29.63 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-FORETAG AS CHARACTER FORMAT "X(256)":U INITIAL "0" 
     LABEL "Företag" 
      VIEW-AS TEXT 
     SIZE 25 BY .67 NO-UNDO.

DEFINE VARIABLE FILL-IN-INLUP AS CHARACTER FORMAT "X(256)":U INITIAL "Inledande uppgifter:" 
      VIEW-AS TEXT 
     SIZE 22.5 BY 1.21
     FONT 17 NO-UNDO.

DEFINE VARIABLE FILL-IN-KUNUP AS CHARACTER FORMAT "X(256)":U INITIAL "Kund uppgifter:" 
      VIEW-AS TEXT 
     SIZE 19 BY 1.25
     FONT 17 NO-UNDO.

DEFINE VARIABLE FILL-IN-ORT AS CHARACTER FORMAT "X(256)":U 
     LABEL "Ort" 
     VIEW-AS FILL-IN 
     SIZE 29.63 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-OVER AS CHARACTER FORMAT "X(15)":U 
     LABEL "Överlämnat till" 
     VIEW-AS FILL-IN 
     SIZE 12 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-OVRUP AS CHARACTER FORMAT "X(256)":U INITIAL "Övriga uppgifter:" 
      VIEW-AS TEXT 
     SIZE 19.5 BY 1.25
     FONT 17 NO-UNDO.

DEFINE VARIABLE FILL-IN-POSTNR AS CHARACTER FORMAT "X(6)":U 
     LABEL "Postnr" 
     VIEW-AS FILL-IN 
     SIZE 9.25 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SOKPO AS CHARACTER FORMAT "X(256)":U INITIAL "Sök på:" 
      VIEW-AS TEXT 
     SIZE 8 BY .83 NO-UNDO.

DEFINE VARIABLE FILL-IN-TELE AS CHARACTER FORMAT "X(11)":U 
     LABEL "Telefonnummer" 
     VIEW-AS FILL-IN 
     SIZE 15.38 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TYP AS CHARACTER FORMAT "X(256)":U 
     LABEL "Typ av störning" 
      VIEW-AS TEXT 
     SIZE 24 BY .67 NO-UNDO.

DEFINE VARIABLE FILL-IN-UPP AS CHARACTER FORMAT "X(8)":U 
     LABEL "Upprättad av" 
      VIEW-AS TEXT 
     SIZE 8 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN_SFORNAMN AS CHARACTER FORMAT "x(25)" 
     LABEL "Namn" 
     VIEW-AS FILL-IN 
     SIZE 20 BY .83.

DEFINE VARIABLE FILL-IN_SPERSONALKOD AS CHARACTER FORMAT "x(15)" 
     LABEL "Användare" 
     VIEW-AS FILL-IN 
     SIZE 12 BY .83.

DEFINE VARIABLE RAD_VAL AS INTEGER 
     VIEW-AS RADIO-SET VERTICAL
     RADIO-BUTTONS 
          "Driftstörning", 1,
"Planerat avbrott", 2
     SIZE 23.5 BY 2.29 NO-UNDO.

DEFINE RECTANGLE RECT-2
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 121 BY 4.17
     BGCOLOR 8 .

DEFINE RECTANGLE RECT-4
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 121 BY 7.08
     BGCOLOR 8 .

DEFINE RECTANGLE RECT-6
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 41.25 BY 2.42
     BGCOLOR 8 .

DEFINE RECTANGLE RECT-7
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 121 BY 12.5
     BGCOLOR 8 .

DEFINE BUTTON BTN_BER 
     LABEL "Beräkna kundavbrottstid" 
     SIZE 22 BY 2.

DEFINE BUTTON BTN_MINDAT1 
     LABEL "-" 
     SIZE 2.5 BY .75.

DEFINE BUTTON BTN_MINDAT3 
     LABEL "-" 
     SIZE 2.5 BY .75.

DEFINE BUTTON BTN_MINDAT4 
     LABEL "-" 
     SIZE 2.5 BY .75.

DEFINE BUTTON BTN_TOT 
     LABEL "Specificera kundavbrottstid" 
     SIZE 22 BY 2.

DEFINE BUTTON BTN_UPDAT1 
     LABEL "+" 
     SIZE 2.5 BY .75.

DEFINE BUTTON BTN_UPDAT3 
     LABEL "+" 
     SIZE 2.5 BY .75.

DEFINE BUTTON BTN_UPDAT4 
     LABEL "+" 
     SIZE 2.5 BY .75.

DEFINE VARIABLE CMB_ANL AS CHARACTER FORMAT "X(256)":U 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 20 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_BEL AS CHARACTER FORMAT "X(256)":U 
     LABEL "Belägenhet" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 35 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_FEL AS CHARACTER FORMAT "X(256)":U 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 20 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_FRAN AS CHARACTER FORMAT "X(256)":U 
     LABEL "Frånkopplingsorgan" 
     VIEW-AS COMBO-BOX INNER-LINES 4
     DROP-DOWN-LIST
     SIZE 35 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_NAT AS CHARACTER FORMAT "X(256)":U 
     LABEL "Nättyp" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 35 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_REL AS CHARACTER FORMAT "X(256)":U 
     LABEL "Reläindekering" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 35 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_SEK AS CHARACTER FORMAT "X(256)":U 
     LABEL "Sektionering" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 35 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_SYS AS CHARACTER FORMAT "X(256)":U 
     LABEL "Frånkopplingsställe" 
     VIEW-AS COMBO-BOX INNER-LINES 4
     DROP-DOWN-LIST
     SIZE 35 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_SYS2 AS CHARACTER FORMAT "X(256)":U 
     LABEL "Felställe" 
     VIEW-AS COMBO-BOX INNER-LINES 4
     DROP-DOWN-LIST
     SIZE 35 BY .96 NO-UNDO.

DEFINE VARIABLE CMB_UTL AS CHARACTER FORMAT "X(256)":U 
     LABEL "Utlösning" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 35 BY .96 NO-UNDO.

DEFINE VARIABLE ED_ANM AS CHARACTER 
     VIEW-AS EDITOR SCROLLBAR-VERTICAL
     SIZE 57.5 BY 8.63 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANLDEL AS CHARACTER FORMAT "X(256)":U INITIAL "Anläggning, -del:" 
      VIEW-AS TEXT 
     SIZE 20.5 BY .75 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANLDEL-2 AS CHARACTER FORMAT "X(256)":U INITIAL "Start:" 
      VIEW-AS TEXT 
     SIZE 7.5 BY .75 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANLDEL-3 AS CHARACTER FORMAT "X(256)":U INITIAL "Bortkopplad belastning:" 
      VIEW-AS TEXT 
     SIZE 24 BY .75 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANLDEL-4 AS CHARACTER FORMAT "X(256)":U INITIAL "Spänningslösa kunder:" 
      VIEW-AS TEXT 
     SIZE 26 BY .75 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANLDEL-5 AS CHARACTER FORMAT "X(256)":U INITIAL "Kundavbrottstid (tim):" 
      VIEW-AS TEXT 
     SIZE 22.5 BY .75 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANLDEL-6 AS CHARACTER FORMAT "X(256)":U INITIAL "Energibortfall (kWh):" 
      VIEW-AS TEXT 
     SIZE 22.5 BY .75 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANLDEL-7 AS CHARACTER FORMAT "X(256)":U INITIAL "Systemspänning vid:" 
      VIEW-AS TEXT 
     SIZE 24 BY .75 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANMS AS CHARACTER FORMAT "X(256)":U INITIAL "Anmärkning:" 
      VIEW-AS TEXT 
     SIZE 13.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-ANN AS CHARACTER FORMAT "X(256)":U 
      VIEW-AS TEXT 
     SIZE 20 BY .88 NO-UNDO.

DEFINE VARIABLE FILL-IN-AVBROTT AS DECIMAL FORMAT ">>>>>>>9.99":U INITIAL 0 
      VIEW-AS TEXT 
     SIZE 20 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BEL AS CHARACTER FORMAT "X(256)":U 
     LABEL "Littera" 
     VIEW-AS FILL-IN 
     SIZE 20 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BORTFALL AS DECIMAL FORMAT ">>>>>>>>9":U INITIAL 0 
      VIEW-AS TEXT 
     SIZE 20 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BRYT AS CHARACTER FORMAT "X(256)":U 
     LABEL "Littera" 
     VIEW-AS FILL-IN 
     SIZE 20 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-FELOR AS CHARACTER FORMAT "X(256)":U 
      VIEW-AS TEXT 
     SIZE 20 BY .88 NO-UNDO.

DEFINE VARIABLE FILL-IN-FELT AS CHARACTER FORMAT "X(256)":U INITIAL "Felorsak:" 
      VIEW-AS TEXT 
     SIZE 9.13 BY .67 NO-UNDO.

DEFINE VARIABLE FILL-IN-HSPKUND AS INTEGER FORMAT ">>>>>":U INITIAL 0 
     LABEL "HSP" 
     VIEW-AS FILL-IN 
     SIZE 7.25 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-KW AS INTEGER FORMAT ">>>":U INITIAL 0 
     LABEL "kW" 
     VIEW-AS FILL-IN 
     SIZE 4.25 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-LSPKUND AS INTEGER FORMAT ">>>>>>":U INITIAL 0 
     LABEL "LSP" 
     VIEW-AS FILL-IN 
     SIZE 7.25 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-MW AS INTEGER FORMAT ">>>":U INITIAL 0 
     LABEL "MW" 
     VIEW-AS FILL-IN 
     SIZE 4.25 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SEK AS CHARACTER FORMAT "X(256)":U 
     LABEL "Littera" 
     VIEW-AS FILL-IN 
     SIZE 20 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SIST AS DECIMAL FORMAT "99.99":U INITIAL 0 
     LABEL "Klockan" 
     VIEW-AS FILL-IN 
     SIZE 8 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SISTDAT AS DATE FORMAT "99/99/99":U 
     LABEL "Datum" 
     VIEW-AS FILL-IN 
     SIZE 9 BY .96 NO-UNDO.

DEFINE VARIABLE FILL-IN-SLUT AS DECIMAL FORMAT "99.99":U INITIAL 0 
     LABEL "Klockan" 
     VIEW-AS FILL-IN 
     SIZE 8 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SLUTDAT AS DATE FORMAT "99/99/99":U 
     LABEL "Datum" 
     VIEW-AS FILL-IN 
     SIZE 9 BY .96 NO-UNDO.

DEFINE VARIABLE FILL-IN-START AS DECIMAL FORMAT "99.99":U INITIAL 0 
     LABEL "Klockan" 
     VIEW-AS FILL-IN 
     SIZE 8 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-STARTDAT AS DATE FORMAT "99/99/99":U 
     LABEL "Datum" 
     VIEW-AS FILL-IN 
     SIZE 9 BY .96 NO-UNDO.

DEFINE VARIABLE FILL-IN-TEXT1 AS CHARACTER FORMAT "X(256)":U 
      VIEW-AS TEXT 
     SIZE 27.75 BY .67 NO-UNDO.

DEFINE VARIABLE FILL-IN-TEXT2 AS CHARACTER FORMAT "X(256)":U 
      VIEW-AS TEXT 
     SIZE 27.38 BY .67 NO-UNDO.

DEFINE RECTANGLE RECT-10
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 61.5 BY 2.67.

DEFINE RECTANGLE RECT-11
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 35 BY 10.33.

DEFINE RECTANGLE RECT-12
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 59.38 BY 3.

DEFINE RECTANGLE RECT-13
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 26.5 BY 10.33.

DEFINE RECTANGLE RECT-14
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 59.38 BY 3.

DEFINE RECTANGLE RECT-15
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 59.38 BY 3.

DEFINE RECTANGLE RECT-16
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 59.38 BY 1.5.

DEFINE RECTANGLE RECT-17
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 59.5 BY 6.83.

DEFINE RECTANGLE RECT-27
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 61.5 BY 10.75.

DEFINE RECTANGLE RECT-8
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 59.38 BY 3.54.

DEFINE RECTANGLE RECT-9
     EDGE-PIXELS 2 GRAPHIC-EDGE  NO-FILL   
     SIZE 59.38 BY 3.

DEFINE VARIABLE TOG_70 AS LOGICAL INITIAL no 
     LABEL "" 
     VIEW-AS TOGGLE-BOX
     SIZE 1.88 BY .88 NO-UNDO.

/* Query definitions                                                    */
&ANALYZE-SUSPEND
DEFINE QUERY BRW_ANL FOR 
      anlaggningsdeltemp SCROLLING.

DEFINE QUERY BRW_FEL FOR 
      felorsaktemp SCROLLING.

DEFINE QUERY BRW_PERS FOR 
      anvandartemp SCROLLING.
&ANALYZE-RESUME

/* Browse definitions                                                   */
DEFINE BROWSE BRW_ANL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _DISPLAY-FIELDS BRW_ANL C-Win _STRUCTURED
  QUERY BRW_ANL NO-LOCK DISPLAY
      anlaggningsdeltemp.NAMN COLUMN-LABEL "Anläggning, -del" FORMAT "X(30)":U
  ENABLE
      anlaggningsdeltemp.NAMN
/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME
    WITH NO-ROW-MARKERS NO-COLUMN-SCROLLING SIZE 34.88 BY 6.13.

DEFINE BROWSE BRW_FEL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _DISPLAY-FIELDS BRW_FEL C-Win _STRUCTURED
  QUERY BRW_FEL NO-LOCK DISPLAY
      felorsaktemp.NAMN COLUMN-LABEL "Felorsak" FORMAT "X(30)":U
  ENABLE
      felorsaktemp.NAMN
/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME
    WITH NO-ROW-MARKERS NO-COLUMN-SCROLLING SIZE 34.88 BY 6.13.

DEFINE BROWSE BRW_PERS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _DISPLAY-FIELDS BRW_PERS C-Win _STRUCTURED
  QUERY BRW_PERS NO-LOCK DISPLAY
      anvandartemp.ANVANDARE COLUMN-LABEL "Användare" FORMAT "x(12)":U
      anvandartemp.AV-NAMN COLUMN-LABEL "Namn" FORMAT "x(40)":U
  ENABLE
      anvandartemp.ANVANDARE
/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME
    WITH NO-ROW-MARKERS NO-COLUMN-SCROLLING SIZE 41.25 BY 7.13
         TITLE "Personal".


/* ************************  Frame Definitions  *********************** */

DEFINE FRAME DEFAULT-FRAME
     RAD_KS AT ROW 1 COL 64 NO-LABEL
     MBTN_KUNDUPPG AT ROW 1.08 COL 1
     MBTN_STORNUPPG AT ROW 1.08 COL 19
     BTN_OK AT ROW 27.13 COL 92.88
     BTN_AVB AT ROW 27.13 COL 107.88
     RECT-28 AT ROW 2.08 COL 1
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 1
         SIZE 125 BY 28.42.

DEFINE FRAME FRAME-STOR
     CMB_SYS AT ROW 2.13 COL 22.38 COLON-ALIGNED
     FILL-IN-MW AT ROW 2.29 COL 65.75 COLON-ALIGNED
     FILL-IN-KW AT ROW 2.33 COL 77.25 COLON-ALIGNED
     FILL-IN-HSPKUND AT ROW 2.33 COL 96.13 COLON-ALIGNED
     FILL-IN-LSPKUND AT ROW 2.33 COL 110.63 COLON-ALIGNED
     CMB_SYS2 AT ROW 3.29 COL 22.38 COLON-ALIGNED
     BTN_UPDAT1 AT ROW 4 COL 90.13
     FILL-IN-STARTDAT AT ROW 4.08 COL 77.63 COLON-ALIGNED
     BTN_MINDAT1 AT ROW 4.88 COL 90.13
     CMB_FRAN AT ROW 4.96 COL 22.38 COLON-ALIGNED
     FILL-IN-START AT ROW 5.38 COL 77.88 COLON-ALIGNED
     FILL-IN-BRYT AT ROW 6.13 COL 22.38 COLON-ALIGNED
     TOG_70 AT ROW 6.75 COL 62
     BTN_UPDAT4 AT ROW 7.54 COL 90.13
     FILL-IN-SLUTDAT AT ROW 7.63 COL 77.63 COLON-ALIGNED
     CMB_SEK AT ROW 7.92 COL 22.38 COLON-ALIGNED
     BTN_MINDAT4 AT ROW 8.42 COL 90.13
     BTN_BER AT ROW 8.79 COL 97.63
     FILL-IN-SLUT AT ROW 8.92 COL 77.88 COLON-ALIGNED
     FILL-IN-SEK AT ROW 9.13 COL 22.38 COLON-ALIGNED
     CMB_UTL AT ROW 10.83 COL 22.38 COLON-ALIGNED
     BTN_UPDAT3 AT ROW 10.83 COL 90.13
     FILL-IN-SISTDAT AT ROW 11.04 COL 77.63 COLON-ALIGNED
     BTN_TOT AT ROW 11.29 COL 97.63
     BTN_MINDAT3 AT ROW 11.75 COL 90.13
     CMB_REL AT ROW 12 COL 22.38 COLON-ALIGNED
     FILL-IN-SIST AT ROW 12.33 COL 77.88 COLON-ALIGNED
     CMB_BEL AT ROW 13.63 COL 22.5 COLON-ALIGNED
     FILL-IN-BEL AT ROW 14.96 COL 22.5 COLON-ALIGNED
     ED_ANM AT ROW 15.33 COL 62.38 NO-LABEL
     CMB_NAT AT ROW 16.71 COL 22.5 COLON-ALIGNED
     CMB_ANL AT ROW 19.33 COL 2.88 NO-LABEL
     BRW_ANL AT ROW 18.33 COL 24.63
     CMB_FEL AT ROW 22.33 COL 2.88 NO-LABEL
     BRW_FEL AT ROW 18.33 COL 24.63
     FILL-IN-ANLDEL-7 AT ROW 1.25 COL 24.5 NO-LABEL
     FILL-IN-ANLDEL-3 AT ROW 1.33 COL 63 NO-LABEL
     FILL-IN-ANLDEL-4 AT ROW 1.33 COL 93.13 NO-LABEL
     FILL-IN-ANLDEL-2 AT ROW 4.04 COL 61.63 NO-LABEL
     FILL-IN-ANLDEL-5 AT ROW 4.25 COL 97 NO-LABEL
     FILL-IN-AVBROTT AT ROW 5.04 COL 94.88 COLON-ALIGNED NO-LABEL
     FILL-IN-ANLDEL-6 AT ROW 6.25 COL 97 NO-LABEL
     FILL-IN-TEXT1 AT ROW 6.75 COL 62.38 COLON-ALIGNED NO-LABEL
     FILL-IN-BORTFALL AT ROW 7.04 COL 94.88 COLON-ALIGNED NO-LABEL
     FILL-IN-TEXT2 AT ROW 10.08 COL 62 COLON-ALIGNED NO-LABEL
     FILL-IN-ANMS AT ROW 14.25 COL 60.63 COLON-ALIGNED NO-LABEL
     FILL-IN-ANLDEL AT ROW 18.42 COL 2.88 NO-LABEL
     FILL-IN-ANN AT ROW 20.29 COL 2.88 NO-LABEL
     FILL-IN-FELT AT ROW 21.38 COL 2.88 NO-LABEL
     FILL-IN-FELOR AT ROW 23.33 COL 2.88 NO-LABEL
     RECT-10 AT ROW 1 COL 60.5
     RECT-11 AT ROW 3.67 COL 60.5
     RECT-12 AT ROW 7.54 COL 1
     RECT-13 AT ROW 3.67 COL 95.5
     RECT-14 AT ROW 10.54 COL 1
     RECT-15 AT ROW 13.54 COL 1
     RECT-16 AT ROW 16.42 COL 1
     RECT-17 AT ROW 17.92 COL 1
     RECT-27 AT ROW 14 COL 60.5
     RECT-8 AT ROW 1 COL 1
     RECT-9 AT ROW 4.54 COL 1
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 3
         SIZE 125 BY 24.

DEFINE FRAME FRAME-KUND
     RAD_VAL AT ROW 2.29 COL 77.13 NO-LABEL
     CMB_FOR AT ROW 2.33 COL 27.13 COLON-ALIGNED
     CMB_OMR AT ROW 3.58 COL 27.13 COLON-ALIGNED
     CMB_AR AT ROW 3.58 COL 57.63 COLON-ALIGNED NO-LABEL
     FILL-IN-ANMALARE AT ROW 6.58 COL 27.25 COLON-ALIGNED
     FILL-IN-FEL AT ROW 6.63 COL 75.63 COLON-ALIGNED
     FILL-IN-ADRESS AT ROW 7.96 COL 27.25 COLON-ALIGNED
     FILL-IN-POSTNR AT ROW 9.33 COL 27.25 COLON-ALIGNED
     FILL-IN-ORT AT ROW 9.38 COL 46.25 COLON-ALIGNED
     FILL-IN-TELE AT ROW 10.75 COL 27.38 COLON-ALIGNED
     BRW_PERS AT ROW 13 COL 78.5
     FILL-IN-OVER AT ROW 13.96 COL 27.5 COLON-ALIGNED
     FILL-IN-ATER AT ROW 14 COL 64.5 COLON-ALIGNED
     BTN_UPDAT2 AT ROW 15.5 COL 40.88
     FILL-IN-FDAT AT ROW 15.88 COL 27.63 COLON-ALIGNED
     BTN_MINDAT2 AT ROW 16.67 COL 40.88
     ED_MEDD AT ROW 17.75 COL 29.5 NO-LABEL
     FILL-IN_SPERSONALKOD AT ROW 20.75 COL 95.25 COLON-ALIGNED
     FILL-IN_SFORNAMN AT ROW 21.83 COL 95.25 COLON-ALIGNED
     FILL-IN-INLUP AT ROW 1.25 COL 1.5 NO-LABEL
     FILL-IN-FORETAG AT ROW 2.58 COL 39.75 COLON-ALIGNED
     FILL-IN-TYP AT ROW 2.58 COL 70.5 COLON-ALIGNED
     FILL-IN-DISTRIKT AT ROW 3.67 COL 40.75 COLON-ALIGNED
     FILL-IN-KUNUP AT ROW 5.33 COL 1.5 NO-LABEL
     FILL-IN-OVRUP AT ROW 12.46 COL 1.5 NO-LABEL
     FILL-IN-UPP AT ROW 15.92 COL 64.63 COLON-ALIGNED
     FILL-IN-ANM AT ROW 17.63 COL 17.63 NO-LABEL
     FILL-IN-SOKPO AT ROW 20.75 COL 79.88 NO-LABEL
     RECT-2 AT ROW 1 COL 1
     RECT-4 AT ROW 5.17 COL 1
     RECT-6 AT ROW 20.5 COL 78.5
     RECT-7 AT ROW 12.25 COL 1
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 3
         SIZE 125 BY 23.75.


/* *********************** Procedure Settings ************************ */

&ANALYZE-SUSPEND _PROCEDURE-SETTINGS
/* Settings for THIS-PROCEDURE
   Type: Window
   Allow: Basic,Browse,DB-Fields,Window,Query
   Temp-Tables and Buffers:
      TABLE: anlaggningsdeltemp T "?" NO-UNDO temp-db anlaggningsdeltemp
      TABLE: anvandartemp T "?" NO-UNDO temp-db anvandartemp
      TABLE: felorsaktemp T "?" NO-UNDO temp-db felorsaktemp
   END-TABLES.
 */
&ANALYZE-RESUME _END-PROCEDURE-SETTINGS

/* *************************  Create Window  ************************** */

&ANALYZE-SUSPEND _CREATE-WINDOW
IF SESSION:DISPLAY-TYPE = "GUI":U THEN
  CREATE WINDOW C-Win ASSIGN
         HIDDEN             = YES
         TITLE              = "Störningsregistrering"
         HEIGHT             = 28.42
         WIDTH              = 125
         MAX-HEIGHT         = 29.04
         MAX-WIDTH          = 125.25
         VIRTUAL-HEIGHT     = 29.04
         VIRTUAL-WIDTH      = 125.25
         RESIZE             = yes
         SCROLL-BARS        = no
         STATUS-AREA        = no
         BGCOLOR            = ?
         FGCOLOR            = ?
         KEEP-FRAME-Z-ORDER = yes
         THREE-D            = yes
         MESSAGE-AREA       = no
         SENSITIVE          = yes.
ELSE {&WINDOW-NAME} = CURRENT-WINDOW.
/* END WINDOW DEFINITION                                                */
&ANALYZE-RESUME



/* ***********  Runtime Attributes and AppBuilder Settings  *********** */

&ANALYZE-SUSPEND _RUN-TIME-ATTRIBUTES
/* SETTINGS FOR WINDOW C-Win
  NOT-VISIBLE,,RUN-PERSISTENT                                           */
/* REPARENT FRAME */
ASSIGN FRAME FRAME-KUND:FRAME = FRAME DEFAULT-FRAME:HANDLE
       FRAME FRAME-STOR:FRAME = FRAME DEFAULT-FRAME:HANDLE.

/* SETTINGS FOR FRAME DEFAULT-FRAME
   FRAME-NAME                                                           */
/* SETTINGS FOR FRAME FRAME-KUND
                                                                        */
/* BROWSE-TAB BRW_PERS FILL-IN-TELE FRAME-KUND */
/* SETTINGS FOR FILL-IN FILL-IN-ANM IN FRAME FRAME-KUND
   ALIGN-L                                                              */
ASSIGN 
       FILL-IN-FDAT:HIDDEN IN FRAME FRAME-KUND           = TRUE.

/* SETTINGS FOR FILL-IN FILL-IN-INLUP IN FRAME FRAME-KUND
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-KUNUP IN FRAME FRAME-KUND
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-OVRUP IN FRAME FRAME-KUND
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-SOKPO IN FRAME FRAME-KUND
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-TYP IN FRAME FRAME-KUND
   NO-ENABLE                                                            */
/* SETTINGS FOR FRAME FRAME-STOR
   Custom                                                               */
/* BROWSE-TAB BRW_ANL CMB_ANL FRAME-STOR */
/* BROWSE-TAB BRW_FEL CMB_FEL FRAME-STOR */
/* SETTINGS FOR COMBO-BOX CMB_ANL IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR COMBO-BOX CMB_FEL IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-ANLDEL IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-ANLDEL-2 IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-ANLDEL-3 IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-ANLDEL-4 IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-ANLDEL-5 IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-ANLDEL-6 IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-ANLDEL-7 IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-ANN IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-FELOR IN FRAME FRAME-STOR
   ALIGN-L                                                              */
/* SETTINGS FOR FILL-IN FILL-IN-FELT IN FRAME FRAME-STOR
   ALIGN-L                                                              */
ASSIGN 
       FILL-IN-SIST:HIDDEN IN FRAME FRAME-STOR           = TRUE.

ASSIGN 
       FILL-IN-SISTDAT:HIDDEN IN FRAME FRAME-STOR           = TRUE.

ASSIGN 
       FILL-IN-SLUT:HIDDEN IN FRAME FRAME-STOR           = TRUE.

ASSIGN 
       FILL-IN-SLUTDAT:HIDDEN IN FRAME FRAME-STOR           = TRUE.

ASSIGN 
       FILL-IN-START:HIDDEN IN FRAME FRAME-STOR           = TRUE.

ASSIGN 
       FILL-IN-STARTDAT:HIDDEN IN FRAME FRAME-STOR           = TRUE.

IF SESSION:DISPLAY-TYPE = "GUI":U AND VALID-HANDLE(C-Win)
THEN C-Win:HIDDEN = yes.

/* _RUN-TIME-ATTRIBUTES-END */
&ANALYZE-RESUME


/* Setting information for Queries and Browse Widgets fields            */

&ANALYZE-SUSPEND _QUERY-BLOCK BROWSE BRW_ANL
/* Query rebuild information for BROWSE BRW_ANL
     _TblList          = "Temp-Tables.anlaggningsdeltemp"
     _Options          = "NO-LOCK INDEXED-REPOSITION"
     _FldNameList[1]   > Temp-Tables.anlaggningsdeltemp.NAMN
"anlaggningsdeltemp.NAMN" "Anläggning, -del" "X(30)" "character" ? ? ? ? ? ? yes ? no no ? yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _Query            is NOT OPENED
*/  /* BROWSE BRW_ANL */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK BROWSE BRW_FEL
/* Query rebuild information for BROWSE BRW_FEL
     _TblList          = "Temp-Tables.felorsaktemp"
     _Options          = "NO-LOCK INDEXED-REPOSITION"
     _FldNameList[1]   > Temp-Tables.felorsaktemp.NAMN
"felorsaktemp.NAMN" "Felorsak" "X(30)" "character" ? ? ? ? ? ? yes ? no no ? yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _Query            is NOT OPENED
*/  /* BROWSE BRW_FEL */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK BROWSE BRW_PERS
/* Query rebuild information for BROWSE BRW_PERS
     _TblList          = "Temp-Tables.anvandartemp"
     _Options          = "NO-LOCK INDEXED-REPOSITION"
     _FldNameList[1]   > Temp-Tables.anvandartemp.ANVANDARE
"anvandartemp.ANVANDARE" "Användare" ? "character" ? ? ? ? ? ? yes ? no no ? yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _FldNameList[2]   > Temp-Tables.anvandartemp.AV-NAMN
"anvandartemp.AV-NAMN" "Namn" ? "character" ? ? ? ? ? ? no ? no no ? yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _Query            is NOT OPENED
*/  /* BROWSE BRW_PERS */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK FRAME FRAME-KUND
/* Query rebuild information for FRAME FRAME-KUND
     _Query            is NOT OPENED
*/  /* FRAME FRAME-KUND */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK FRAME FRAME-STOR
/* Query rebuild information for FRAME FRAME-STOR
     _Query            is NOT OPENED
*/  /* FRAME FRAME-STOR */
&ANALYZE-RESUME

 



/* ************************  Control Triggers  ************************ */

&Scoped-define SELF-NAME C-Win
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL C-Win C-Win
ON END-ERROR OF C-Win /* Störningsregistrering */
OR ENDKEY OF {&WINDOW-NAME} ANYWHERE DO:
  /* This case occurs when the user presses the "Esc" key.
   In a persistently run window, just ignore this.  If we did not, the
   application would exit. */
   musz = TRUE.
   IF ny = TRUE THEN DO:
      RUN tabortstor_UI IN strproch.
   END.
   APPLY "CLOSE":U TO THIS-PROCEDURE.
   IF THIS-PROCEDURE:PERSISTENT THEN RETURN NO-APPLY.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL C-Win C-Win
ON WINDOW-CLOSE OF C-Win /* Störningsregistrering */
DO:
  /* This event will close the window and terminate the procedure.  */
   musz = TRUE.
   IF ny = TRUE THEN DO:
      RUN tabortstor_UI IN strproch.
   END.
   APPLY "CLOSE":U TO THIS-PROCEDURE.
   RETURN NO-APPLY.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define BROWSE-NAME BRW_ANL
&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME BRW_ANL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BRW_ANL C-Win
ON VALUE-CHANGED OF BRW_ANL IN FRAME FRAME-STOR
DO:
   status-ok = BRW_ANL:SELECT-FOCUSED-ROW() IN FRAME {&FRAME-NAME} NO-ERROR.
   IF AVAILABLE anlaggningsdeltemp THEN DO:
      ASSIGN
      FILL-IN-ANN = anlaggningsdeltemp.NAMN
      annvar = anlaggningsdeltemp.ADELID.
      DISPLAY FILL-IN-ANN WITH FRAME {&FRAME-NAME}.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define BROWSE-NAME BRW_FEL
&Scoped-define SELF-NAME BRW_FEL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BRW_FEL C-Win
ON VALUE-CHANGED OF BRW_FEL IN FRAME FRAME-STOR
DO:
   ASSIGN
   status-ok = BRW_FEL:SELECT-FOCUSED-ROW() IN FRAME {&FRAME-NAME} NO-ERROR.
   ASSIGN
   FILL-IN-FELOR = felorsaktemp.NAMN
   felvar = felorsaktemp.FELOID.
   DISPLAY FILL-IN-FELOR WITH FRAME {&FRAME-NAME}.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define BROWSE-NAME BRW_PERS
&Scoped-define FRAME-NAME FRAME-KUND
&Scoped-define SELF-NAME BRW_PERS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BRW_PERS C-Win
ON VALUE-CHANGED OF BRW_PERS IN FRAME FRAME-KUND /* Personal */
DO:
   status-ok = BRW_PERS:SELECT-FOCUSED-ROW() NO-ERROR.
   ASSIGN FILL-IN-OVER  = anvandartemp.ANVANDARE.
   DISPLAY FILL-IN-OVER WITH FRAME {&FRAME-NAME}.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME BTN_AVB
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_AVB C-Win
ON CHOOSE OF BTN_AVB IN FRAME DEFAULT-FRAME /* Avbryt */
DO:
   musz = TRUE.
   IF ny = TRUE THEN DO:
      RUN tabortstor_UI IN strproch.
   END.
   APPLY "CLOSE":U TO THIS-PROCEDURE.   
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME BTN_BER
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_BER C-Win
ON CHOOSE OF BTN_BER IN FRAME FRAME-STOR /* Beräkna kundavbrottstid */
DO:
   RUN btnber_UI.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME BTN_MINDAT1
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_MINDAT1 C-Win
ON CHOOSE OF BTN_MINDAT1 IN FRAME FRAME-STOR /* - */
DO: 
   ASSIGN
   FILL-IN-STARTDAT = INPUT FILL-IN-STARTDAT
   FILL-IN-STARTDAT = FILL-IN-STARTDAT - 1.
   DISPLAY FILL-IN-STARTDAT WITH FRAME {&FRAME-NAME}. 
   APPLY "LEAVE" TO FILL-IN-STARTDAT.
   /*
   IF FILL-IN-SISTDAT < FILL-IN-STARTDAT THEN DO:
      FILL-IN-SISTDAT = FILL-IN-STARTDAT.
      DISPLAY FILL-IN-SISTDAT WITH FRAME {&FRAME-NAME}.  
   END.
   */
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-KUND
&Scoped-define SELF-NAME BTN_MINDAT2
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_MINDAT2 C-Win
ON CHOOSE OF BTN_MINDAT2 IN FRAME FRAME-KUND /* - */
DO: 
   ASSIGN
   FILL-IN-FDAT = INPUT FILL-IN-FDAT
   FILL-IN-FDAT = FILL-IN-FDAT - 1.
   DISPLAY FILL-IN-FDAT WITH FRAME {&FRAME-NAME}. 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME BTN_MINDAT3
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_MINDAT3 C-Win
ON CHOOSE OF BTN_MINDAT3 IN FRAME FRAME-STOR /* - */
DO: 
   ASSIGN
   FILL-IN-SISTDAT = INPUT FILL-IN-SISTDAT
   FILL-IN-SISTDAT = FILL-IN-SISTDAT - 1.
   DISPLAY FILL-IN-SISTDAT WITH FRAME {&FRAME-NAME}. 
   brwkoll[1] = 1.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME BTN_MINDAT4
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_MINDAT4 C-Win
ON CHOOSE OF BTN_MINDAT4 IN FRAME FRAME-STOR /* - */
DO: 
   ASSIGN
   FILL-IN-SLUTDAT = INPUT FILL-IN-SLUTDAT
   FILL-IN-SLUTDAT = FILL-IN-SLUTDAT - 1.
   DISPLAY FILL-IN-SLUTDAT WITH FRAME {&FRAME-NAME}. 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME BTN_OK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_OK C-Win
ON CHOOSE OF BTN_OK IN FRAME DEFAULT-FRAME /* Ok */
DO:
   musz = FALSE.
   RUN btnokkund_UI.
   IF musz = FALSE THEN DO: 
      RUN btnokstor_UI.
      IF musz = FALSE THEN DO: 
         APPLY "CLOSE":U TO THIS-PROCEDURE.        
      END.
   END.
   musz = FALSE.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME BTN_TOT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_TOT C-Win
ON CHOOSE OF BTN_TOT IN FRAME FRAME-STOR /* Specificera kundavbrottstid */
DO:
   {muswait.i}
   &Scoped-define FRAME-NAME DEFAULT-FRAME
   {AVBGOM.I}
   &Scoped-define FRAME-NAME FRAME-STOR
   IF specvar = FALSE THEN DO:
      ASSIGN
      TOG_70 = INPUT TOG_70
      FILL-IN-STARTDAT = INPUT FILL-IN-STARTDAT
      FILL-IN-START = INPUT FILL-IN-START
      FILL-IN-SLUTDAT = INPUT FILL-IN-SLUTDAT
      FILL-IN-SLUT = INPUT FILL-IN-SLUT
      FILL-IN-SISTDAT = INPUT FILL-IN-SISTDAT
      FILL-IN-SIST = INPUT FILL-IN-SIST
      FILL-IN-LSPKUND = INPUT FILL-IN-LSPKUND
      FILL-IN-HSPKUND = INPUT FILL-IN-HSPKUND
      felkontroll = FALSE
      startdatum = FILL-IN-STARTDAT
      datum70 = FILL-IN-SLUTDAT
      datum30 = FILL-IN-SISTDAT
      starttid = FILL-IN-START
      tid70 = FILL-IN-SLUT
      tid30 = FILL-IN-SIST
      lspantal = FILL-IN-LSPKUND
      hspantal = FILL-IN-HSPKUND
      skapa = TRUE.
      RUN kontroll_UI.
      IF felkontroll = FALSE THEN DO:
         RUN berakna_UI.
      END.
   END.
   ELSE DO:
      ASSIGN
      FILL-IN-STARTDAT = INPUT FILL-IN-STARTDAT
      FILL-IN-START = INPUT FILL-IN-START
      FILL-IN-LSPKUND = INPUT FILL-IN-LSPKUND
      FILL-IN-HSPKUND = INPUT FILL-IN-HSPKUND
      FILL-IN-AVBROTT = INPUT FILL-IN-AVBROTT
      startdatum = FILL-IN-STARTDAT
      starttid = FILL-IN-START
      lspantal = FILL-IN-LSPKUND
      hspantal = FILL-IN-HSPKUND.
   END.
   RUN KUNDAVBR.W.
   IF specvar = TRUE THEN DO:
      FIND LAST bort_temp NO-LOCK NO-ERROR.
      IF AVAILABLE bort_temp THEN DO:
         ASSIGN
         FILL-IN-SLUTDAT:HIDDEN = TRUE
         FILL-IN-SLUT:HIDDEN = TRUE
         FILL-IN-TEXT1:HIDDEN = TRUE
         TOG_70:HIDDEN = TRUE
         BTN_MINDAT1:HIDDEN = TRUE
         BTN_UPDAT1:HIDDEN = TRUE
         BTN_MINDAT4:HIDDEN = TRUE
         BTN_UPDAT4:HIDDEN = TRUE
         BTN_MINDAT3:HIDDEN = TRUE
         BTN_UPDAT3:HIDDEN = TRUE
         FILL-IN-HSPKUND = hspantal
         FILL-IN-LSPKUND = lspantal
         FILL-IN-AVBROTT = totavbrott
         FILL-IN-MW = INPUT FILL-IN-MW
         FILL-IN-KW = INPUT FILL-IN-KW
         FILL-IN-SISTDAT = bort_temp.ATERDATUM
         FILL-IN-SIST = bort_temp.ATERKLOCKAN.
         RUN bortfall_UI.
         DISPLAY FILL-IN-AVBROTT FILL-IN-BORTFALL FILL-IN-HSPKUND FILL-IN-LSPKUND 
            FILL-IN-SISTDAT FILL-IN-SIST WITH FRAME {&FRAME-NAME}.
         DISABLE FILL-IN-STARTDAT FILL-IN-START FILL-IN-HSPKUND FILL-IN-LSPKUND 
            FILL-IN-SISTDAT FILL-IN-SIST WITH FRAME {&FRAME-NAME}.
      END.
      ELSE DO:
         ASSIGN
         FILL-IN-SLUTDAT:HIDDEN = FALSE
         FILL-IN-SLUT:HIDDEN = FALSE
         FILL-IN-TEXT1:HIDDEN = FALSE
         TOG_70:HIDDEN = FALSE
         BTN_MINDAT1:HIDDEN = FALSE
         BTN_UPDAT1:HIDDEN = FALSE
         BTN_MINDAT4:HIDDEN = FALSE
         BTN_UPDAT4:HIDDEN = FALSE
         BTN_MINDAT3:HIDDEN = FALSE
         BTN_UPDAT3:HIDDEN = FALSE
         FILL-IN-HSPKUND = 0
         FILL-IN-LSPKUND = 0
         FILL-IN-AVBROTT = 0
         FILL-IN-BORTFALL = 0
         specvar = FALSE.
         IF ny = TRUE THEN DO:
            DISPLAY FILL-IN-AVBROTT FILL-IN-BORTFALL FILL-IN-HSPKUND FILL-IN-LSPKUND WITH FRAME {&FRAME-NAME}.
         END.
         ELSE DO:
            ASSIGN
            FILL-IN-SLUTDAT = FILL-IN-STARTDAT
            FILL-IN-SLUT = FILL-IN-START
            FILL-IN-SISTDAT = FILL-IN-STARTDAT
            FILL-IN-SIST = FILL-IN-START.
            DISPLAY FILL-IN-AVBROTT FILL-IN-BORTFALL FILL-IN-HSPKUND FILL-IN-LSPKUND FILL-IN-SLUTDAT
            FILL-IN-SLUT FILL-IN-SISTDAT FILL-IN-SIST WITH FRAME {&FRAME-NAME}.
         END.
         IF TOG_70 = FALSE THEN DO:
            ASSIGN
            FILL-IN-SLUTDAT:HIDDEN = TRUE
            FILL-IN-SLUT:HIDDEN = TRUE
            BTN_MINDAT4:HIDDEN = TRUE
            BTN_UPDAT4:HIDDEN = TRUE.
         END.
         ENABLE FILL-IN-STARTDAT FILL-IN-START FILL-IN-HSPKUND FILL-IN-LSPKUND 
            FILL-IN-SISTDAT FILL-IN-SIST WITH FRAME {&FRAME-NAME}.
      END.
   END.
   ELSE DO:
      RUN bort_UI.
   END.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
   {AVBFRAM.I}
   &Scoped-define FRAME-NAME FRAME-STOR
   {musarrow.i}
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME BTN_UPDAT1
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_UPDAT1 C-Win
ON CHOOSE OF BTN_UPDAT1 IN FRAME FRAME-STOR /* + */
DO: 
   ASSIGN
   FILL-IN-STARTDAT = INPUT FILL-IN-STARTDAT.   
   FILL-IN-STARTDAT = FILL-IN-STARTDAT + 1.
   DISPLAY FILL-IN-STARTDAT WITH FRAME {&FRAME-NAME}.     
   APPLY "LEAVE" TO FILL-IN-STARTDAT.
   /*
   IF FILL-IN-SISTDAT < FILL-IN-STARTDAT THEN DO:
      FILL-IN-SISTDAT = FILL-IN-STARTDAT.
      DISPLAY FILL-IN-SISTDAT WITH FRAME {&FRAME-NAME}.  
   END.
   */
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-KUND
&Scoped-define SELF-NAME BTN_UPDAT2
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_UPDAT2 C-Win
ON CHOOSE OF BTN_UPDAT2 IN FRAME FRAME-KUND /* + */
DO: 
   ASSIGN
   FILL-IN-FDAT = INPUT FILL-IN-FDAT.   
   FILL-IN-FDAT = FILL-IN-FDAT + 1.
   DISPLAY FILL-IN-FDAT WITH FRAME {&FRAME-NAME}.     
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME BTN_UPDAT3
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_UPDAT3 C-Win
ON CHOOSE OF BTN_UPDAT3 IN FRAME FRAME-STOR /* + */
DO: 
   ASSIGN
   FILL-IN-SISTDAT = INPUT FILL-IN-SISTDAT.   
   FILL-IN-SISTDAT = FILL-IN-SISTDAT + 1.
   DISPLAY FILL-IN-SISTDAT WITH FRAME {&FRAME-NAME}.     
   brwkoll[1] = 1.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME BTN_UPDAT4
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_UPDAT4 C-Win
ON CHOOSE OF BTN_UPDAT4 IN FRAME FRAME-STOR /* + */
DO: 
   ASSIGN
   FILL-IN-SLUTDAT = INPUT FILL-IN-SLUTDAT.   
   FILL-IN-SLUTDAT = FILL-IN-SLUTDAT + 1.
   DISPLAY FILL-IN-SLUTDAT WITH FRAME {&FRAME-NAME}.     
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_ANL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_ANL C-Win
ON ENTRY OF CMB_ANL IN FRAME FRAME-STOR
DO:
   ASSIGN
   BRW_ANL:HIDDEN IN FRAME {&FRAME-NAME} = FALSE
   BRW_FEL:HIDDEN IN FRAME {&FRAME-NAME} = TRUE.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_ANL C-Win
ON VALUE-CHANGED OF CMB_ANL IN FRAME FRAME-STOR
DO:
   CMB_ANL = INPUT CMB_ANL.  
   FIND FIRST anlaggningstyptemp WHERE anlaggningstyptemp.NAMN = CMB_ANL NO-LOCK NO-ERROR.
   kommandoq = "anlaggningsdeltemp.ATYPID = " + STRING(anlaggningstyptemp.ATYPID).
   RUN setcolsortvar_UI IN brwproc[2] (INPUT kommandoq).
   RUN openbdynspec_UI IN brwproc[2].
   
   FIND FIRST anlaggningsdeltemp WHERE anlaggningsdeltemp.ADELID = annvar NO-LOCK NO-ERROR.
   IF AVAILABLE anlaggningsdeltemp THEN DO:
      RUN setlastrowid_UI IN brwproc[2] (INPUT ROWID(anlaggningsdeltemp)).
      RUN lastselectdyn_UI IN brwproc[2].             
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-KUND
&Scoped-define SELF-NAME CMB_AR
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_AR C-Win
ON VALUE-CHANGED OF CMB_AR IN FRAME FRAME-KUND
DO:
   CMB_AR = INPUT CMB_AR.
   sistartal = INTEGER(CMB_AR).
   RUN andraomr_UI.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME CMB_BEL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_BEL C-Win
ON VALUE-CHANGED OF CMB_BEL IN FRAME FRAME-STOR /* Belägenhet */
DO:
   CMB_BEL = INPUT CMB_BEL.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_FEL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_FEL C-Win
ON ENTRY OF CMB_FEL IN FRAME FRAME-STOR
DO:
   ASSIGN
   BRW_ANL:HIDDEN IN FRAME {&FRAME-NAME} = TRUE
   BRW_FEL:HIDDEN IN FRAME {&FRAME-NAME} = FALSE.
   FIND FIRST felorsaktemp WHERE felorsaktemp.FELOID = felvar USE-INDEX FELOID NO-LOCK NO-ERROR.
   FIND FIRST grundfeltyptemp WHERE grundfeltyptemp.GRUNDFELID =
      felorsaktemp.GRUNDFELID USE-INDEX GRUNDFELID NO-LOCK NO-ERROR.
   CMB_FEL:SCREEN-VALUE = grundfeltyptemp.NAMN.

   kommandoq = "felorsaktemp.GRUNDFELID = " + STRING(grundfeltyptemp.GRUNDFELID).
   RUN setcolsortvar_UI IN brwproc[3] (INPUT kommandoq).
   RUN openbdynspec_UI IN brwproc[3].

/*    ejvalue = TRUE. */
/*    APPLY "VALUE-CHANGED" TO CMB_FEL IN FRAME {&FRAME-NAME}. */
/*    ejvalue = FALSE. */
   FIND FIRST felorsaktemp WHERE felorsaktemp.FELOID = felvar
   USE-INDEX FELOID NO-LOCK NO-ERROR.
   IF AVAILABLE felorsaktemp THEN DO:
      RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(felorsaktemp)).
      RUN lastselectdyn_UI IN brwproc[3].             
   END.
/*    APPLY "VALUE-CHANGED" TO BRW_FEL IN FRAME {&FRAME-NAME}. */
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_FEL C-Win
ON VALUE-CHANGED OF CMB_FEL IN FRAME FRAME-STOR
DO:
   CMB_FEL = INPUT CMB_FEL.
   FIND FIRST grundfeltyptemp WHERE grundfeltyptemp.NAMN = CMB_FEL NO-LOCK NO-ERROR.
   kommandoq = "felorsaktemp.GRUNDFELID = " + STRING(grundfeltyptemp.GRUNDFELID).
   RUN setcolsortvar_UI IN brwproc[3] (INPUT kommandoq).
   RUN openbdynspec_UI IN brwproc[3].
   FIND FIRST felorsaktemp WHERE felorsaktemp.FELOID = felvar NO-LOCK NO-ERROR.
   IF ejvalue = FALSE THEN DO:
      IF AVAILABLE felorsaktemp THEN DO:
         RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(felorsaktemp)).
         RUN lastselectdyn_UI IN brwproc[3].             
      END.
   END.      
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-KUND
&Scoped-define SELF-NAME CMB_FOR
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_FOR C-Win
ON VALUE-CHANGED OF CMB_FOR IN FRAME FRAME-KUND /* Företag */
DO:
   CMB_FOR = INPUT CMB_FOR.
   RUN andraartal_UI.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME CMB_FRAN
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_FRAN C-Win
ON VALUE-CHANGED OF CMB_FRAN IN FRAME FRAME-STOR /* Frånkopplingsorgan */
DO:
   CMB_FRAN = INPUT CMB_FRAN.   
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_NAT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_NAT C-Win
ON VALUE-CHANGED OF CMB_NAT IN FRAME FRAME-STOR /* Nättyp */
DO:
   CMB_NAT = INPUT CMB_NAT.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-KUND
&Scoped-define SELF-NAME CMB_OMR
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_OMR C-Win
ON VALUE-CHANGED OF CMB_OMR IN FRAME FRAME-KUND /* Distrikt */
DO:
   RUN utvald_UI.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME CMB_REL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_REL C-Win
ON VALUE-CHANGED OF CMB_REL IN FRAME FRAME-STOR /* Reläindekering */
DO:
   CMB_REL = INPUT CMB_REL.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_SEK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_SEK C-Win
ON VALUE-CHANGED OF CMB_SEK IN FRAME FRAME-STOR /* Sektionering */
DO:
   CMB_SEK = INPUT CMB_SEK.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_SYS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_SYS C-Win
ON VALUE-CHANGED OF CMB_SYS IN FRAME FRAME-STOR /* Frånkopplingsställe */
DO:
   CMB_SYS = INPUT CMB_SYS.
   FIND FIRST spanningsnivtemp WHERE spanningsnivtemp.NAMN = CMB_SYS NO-LOCK NO-ERROR.
   FIND FIRST inlastabtemp WHERE inlastabtemp.INKODID = spanningsnivtemp.INKODID
   USE-INDEX INKODID NO-LOCK NO-ERROR.
   IF inlastabtemp.INKOD = "D" AND inlastabtemp.INKODPOSCH NE "" AND
   inlastabtemp.INKODTYP = "1" THEN DO:
      fransys = spanningsnivtemp.SPANID.
   END.
   ELSE DO:
      FIND NEXT spanningsnivtemp WHERE spanningsnivtemp.NAMN = CMB_SYS
      NO-LOCK NO-ERROR.
      fransys = spanningsnivtemp.SPANID.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_SYS2
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_SYS2 C-Win
ON VALUE-CHANGED OF CMB_SYS2 IN FRAME FRAME-STOR /* Felställe */
DO:
   CMB_SYS2 = INPUT CMB_SYS2.
   FIND FIRST spanningsnivtemp WHERE spanningsnivtemp.NAMN = CMB_SYS2 NO-LOCK NO-ERROR.
   FIND FIRST inlastabtemp WHERE inlastabtemp.INKODID = spanningsnivtemp.INKODID USE-INDEX INKODID NO-LOCK NO-ERROR.
   IF inlastabtemp.INKOD = "D" AND inlastabtemp.INKODPOSCH NE "" AND
   inlastabtemp.INKODTYP = "2" THEN DO:
      felsys = spanningsnivtemp.SPANID.
   END.
   ELSE DO:
      FIND NEXT spanningsnivtemp WHERE spanningsnivtemp.NAMN = CMB_SYS2
      NO-LOCK NO-ERROR.
      felsys = spanningsnivtemp.SPANID.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_UTL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_UTL C-Win
ON VALUE-CHANGED OF CMB_UTL IN FRAME FRAME-STOR /* Utlösning */
DO:
   CMB_UTL = INPUT CMB_UTL.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-KUND
&Scoped-define SELF-NAME FILL-IN-ATER
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-ATER C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN-ATER IN FRAME FRAME-KUND /* Återstående arbete */
DO:
   FILL-IN-ATER = INPUT FILL-IN-ATER.
   IF FILL-IN-ATER = TRUE THEN DO:
      ASSIGN
      FILL-IN-FDAT:HIDDEN = FALSE
      BTN_MINDAT2:HIDDEN = FALSE
      BTN_UPDAT2:HIDDEN = FALSE
      FILL-IN-ATER = FALSE.
   END.   
   ELSE DO:
      ASSIGN
      FILL-IN-FDAT:HIDDEN = TRUE
      BTN_MINDAT2:HIDDEN = TRUE
      BTN_UPDAT2:HIDDEN = TRUE
      FILL-IN-ATER = TRUE.
   END.   
   DISPLAY FILL-IN-ATER WITH FRAME {&FRAME-NAME}.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-FDAT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-FDAT C-Win
ON LEAVE OF FILL-IN-FDAT IN FRAME FRAME-KUND /* Färdig datum */
DO:
  FILL-IN-FDAT = INPUT FILL-IN-FDAT.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-FDAT C-Win
ON MOUSE-MENU-CLICK OF FILL-IN-FDAT IN FRAME FRAME-KUND /* Färdig datum */
DO:
   ASSIGN
   FILL-IN-FDAT = INPUT FILL-IN-FDAT
   Guru.GlobalaVariabler:regdatum = INPUT FILL-IN-FDAT.
   RUN AlmanBtn.w. 
   FILL-IN-FDAT = Guru.GlobalaVariabler:regdatum.
   DISPLAY FILL-IN-FDAT WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-OVER
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-OVER C-Win
ON ENTRY OF FILL-IN-OVER IN FRAME FRAME-KUND /* Överlämnat till */
DO:
   RUN entryofover_UI.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-OVER C-Win
ON LEAVE OF FILL-IN-OVER IN FRAME FRAME-KUND /* Överlämnat till */
DO:
   FILL-IN-OVER = INPUT FILL-IN-OVER.                     
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME FILL-IN-SIST
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SIST C-Win
ON LEAVE OF FILL-IN-SIST IN FRAME FRAME-STOR /* Klockan */
DO:
   FILL-IN-SIST = INPUT FILL-IN-SIST.
   IF FILL-IN-SIST >= 0 AND FILL-IN-SIST <= 24 THEN FILL-IN-SIST = FILL-IN-SIST.
   ELSE DO:
      MESSAGE "Klockslaget är orimligt!" VIEW-AS ALERT-BOX.
      RETURN NO-APPLY.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SIST C-Win
ON MOUSE-MENU-CLICK OF FILL-IN-SIST IN FRAME FRAME-STOR /* Klockan */
DO:
   klocka = INPUT FILL-IN-SIST.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
   
   &Scoped-define FRAME-NAME FRAME-STOR
   RUN KLOCKAN.W.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
   
   &Scoped-define FRAME-NAME FRAME-STOR
   FILL-IN-SIST = klocka.
   DISPLAY FILL-IN-SIST WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-SISTDAT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SISTDAT C-Win
ON ENTRY OF FILL-IN-SISTDAT IN FRAME FRAME-STOR /* Datum */
DO:
   brwkoll[1] = 1.
   
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SISTDAT C-Win
ON LEAVE OF FILL-IN-SISTDAT IN FRAME FRAME-STOR /* Datum */
DO:
  FILL-IN-SISTDAT = INPUT FILL-IN-SISTDAT.
   brwkoll[1] = 1.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SISTDAT C-Win
ON MOUSE-MENU-CLICK OF FILL-IN-SISTDAT IN FRAME FRAME-STOR /* Datum */
DO:
   ASSIGN
   FILL-IN-SISTDAT = INPUT FILL-IN-SISTDAT
   Guru.GlobalaVariabler:regdatum = INPUT FILL-IN-SISTDAT.
   RUN AlmanBtn.w. 
   FILL-IN-SISTDAT = Guru.GlobalaVariabler:regdatum.
   DISPLAY FILL-IN-SISTDAT WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-SLUT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SLUT C-Win
ON LEAVE OF FILL-IN-SLUT IN FRAME FRAME-STOR /* Klockan */
DO:
   FILL-IN-SLUT = INPUT FILL-IN-SLUT.
   IF FILL-IN-SLUT >= 0 AND FILL-IN-SLUT <= 24 THEN FILL-IN-SLUT = FILL-IN-SLUT.
   ELSE DO:
      MESSAGE "Klockslaget är orimligt!" VIEW-AS ALERT-BOX.
      RETURN NO-APPLY.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SLUT C-Win
ON MOUSE-MENU-CLICK OF FILL-IN-SLUT IN FRAME FRAME-STOR /* Klockan */
DO:
   klocka = INPUT FILL-IN-SLUT.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
   
   &Scoped-define FRAME-NAME FRAME-STOR
   RUN KLOCKAN.W.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
   
   &Scoped-define FRAME-NAME FRAME-STOR
   FILL-IN-SLUT = klocka.
   DISPLAY FILL-IN-SLUT WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-SLUTDAT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SLUTDAT C-Win
ON ENTRY OF FILL-IN-SLUTDAT IN FRAME FRAME-STOR /* Datum */
DO:
   /*brwkoll[1] = 1.*/
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SLUTDAT C-Win
ON LEAVE OF FILL-IN-SLUTDAT IN FRAME FRAME-STOR /* Datum */
DO:
  FILL-IN-SLUTDAT = INPUT FILL-IN-SLUTDAT.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SLUTDAT C-Win
ON MOUSE-MENU-CLICK OF FILL-IN-SLUTDAT IN FRAME FRAME-STOR /* Datum */
DO:
   ASSIGN
   FILL-IN-SLUTDAT = INPUT FILL-IN-SLUTDAT
   Guru.GlobalaVariabler:regdatum = INPUT FILL-IN-SLUTDAT.
   RUN AlmanBtn.w. 
   FILL-IN-SLUTDAT = Guru.GlobalaVariabler:regdatum.
   DISPLAY FILL-IN-SLUTDAT WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-START
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-START C-Win
ON LEAVE OF FILL-IN-START IN FRAME FRAME-STOR /* Klockan */
DO:
   FILL-IN-START = INPUT FILL-IN-START.
   IF FILL-IN-START >= 0 AND FILL-IN-START <= 24 THEN FILL-IN-START = FILL-IN-START.
   ELSE DO:
      MESSAGE "Klockslaget är orimligt!" VIEW-AS ALERT-BOX.
      RETURN NO-APPLY.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-START C-Win
ON MOUSE-MENU-CLICK OF FILL-IN-START IN FRAME FRAME-STOR /* Klockan */
DO:
   klocka = INPUT FILL-IN-START.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
   
   &Scoped-define FRAME-NAME FRAME-STOR
   RUN KLOCKAN.W.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
   
   &Scoped-define FRAME-NAME FRAME-STOR
   FILL-IN-START = klocka.
   DISPLAY FILL-IN-START WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-STARTDAT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-STARTDAT C-Win
ON LEAVE OF FILL-IN-STARTDAT IN FRAME FRAME-STOR /* Datum */
DO:
   FILL-IN-STARTDAT = INPUT FILL-IN-STARTDAT.
   IF FILL-IN-SISTDAT < FILL-IN-STARTDAT THEN DO:
      FILL-IN-SISTDAT = FILL-IN-STARTDAT.
      DISPLAY FILL-IN-SISTDAT WITH FRAME {&FRAME-NAME}.  

   END.
   IF ny = TRUE AND brwkoll[1] = 0 THEN DO:
      FILL-IN-SISTDAT = FILL-IN-STARTDAT.
      DISPLAY FILL-IN-SISTDAT WITH FRAME {&FRAME-NAME}.  
   END.

   IF FILL-IN-SLUTDAT < FILL-IN-STARTDAT THEN DO:
      FILL-IN-SLUTDAT = FILL-IN-STARTDAT.
      IF TOG_70 = TRUE THEN
      DISPLAY FILL-IN-SLUTDAT WITH FRAME {&FRAME-NAME}.  

   END.
   IF ny = TRUE AND brwkoll[1] = 0 THEN DO:
      FILL-IN-SLUTDAT = FILL-IN-STARTDAT.
      IF TOG_70 = TRUE THEN
      DISPLAY FILL-IN-SLUTDAT WITH FRAME {&FRAME-NAME}.  
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-STARTDAT C-Win
ON MOUSE-MENU-CLICK OF FILL-IN-STARTDAT IN FRAME FRAME-STOR /* Datum */
DO:
   ASSIGN
   FILL-IN-STARTDAT = INPUT FILL-IN-STARTDAT
   Guru.GlobalaVariabler:regdatum = INPUT FILL-IN-STARTDAT.
   RUN AlmanBtn.w. 
   FILL-IN-STARTDAT = Guru.GlobalaVariabler:regdatum.
   DISPLAY FILL-IN-STARTDAT WITH FRAME {&FRAME-NAME}.  
   IF FILL-IN-SISTDAT < FILL-IN-STARTDAT THEN DO:
      FILL-IN-SISTDAT = FILL-IN-STARTDAT.
      DISPLAY FILL-IN-SISTDAT WITH FRAME {&FRAME-NAME}.  
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-KUND
&Scoped-define SELF-NAME FILL-IN_SFORNAMN
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_SFORNAMN C-Win
ON ANY-KEY OF FILL-IN_SFORNAMN IN FRAME FRAME-KUND /* Namn */
DO:
   {TRYCKS.I}
   IF KEYFUNCTION(LASTKEY) = ("RETURN") THEN DO:
      APPLY "MOUSE-SELECT-DBLCLICK" TO FILL-IN_SFORNAMN IN FRAME {&FRAME-NAME}.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_SFORNAMN C-Win
ON MOUSE-SELECT-DBLCLICK OF FILL-IN_SFORNAMN IN FRAME FRAME-KUND /* Namn */
DO:   
   FILL-IN_SFORNAMN = INPUT FILL-IN_SFORNAMN.
   RUN sokurvaldyn_UI IN brwproc[1] (INPUT "AV-NAMN", INPUT FILL-IN_SFORNAMN).      
   APPLY "VALUE-CHANGED" TO BRW_PERS IN FRAME FRAME-KUND.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_SPERSONALKOD
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_SPERSONALKOD C-Win
ON ANY-KEY OF FILL-IN_SPERSONALKOD IN FRAME FRAME-KUND /* Användare */
DO:
   {TRYCKS.I}
   IF KEYFUNCTION(LASTKEY) = ("RETURN") THEN DO:
      APPLY "MOUSE-SELECT-DBLCLICK" TO FILL-IN_SPERSONALKOD IN FRAME {&FRAME-NAME}.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_SPERSONALKOD C-Win
ON MOUSE-SELECT-DBLCLICK OF FILL-IN_SPERSONALKOD IN FRAME FRAME-KUND /* Användare */
DO:   
   FILL-IN_SPERSONALKOD = INPUT FILL-IN_SPERSONALKOD.
   RUN sokurvaldyn_UI IN brwproc[1] (INPUT "ANVANDARE", INPUT FILL-IN_SPERSONALKOD).      
   APPLY "VALUE-CHANGED" TO BRW_PERS IN FRAME FRAME-KUND.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME MBTN_KUNDUPPG
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL MBTN_KUNDUPPG C-Win
ON CHOOSE OF MBTN_KUNDUPPG IN FRAME DEFAULT-FRAME /* Kunduppgifter */
DO:
  RAD_KS = 1.
  APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME {&FRAME-NAME}.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME MBTN_STORNUPPG
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL MBTN_STORNUPPG C-Win
ON CHOOSE OF MBTN_STORNUPPG IN FRAME DEFAULT-FRAME /* Störningsuppgifter */
DO:
  RAD_KS = 2.
  APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME {&FRAME-NAME}.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME RAD_KS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL RAD_KS C-Win
ON VALUE-CHANGED OF RAD_KS IN FRAME DEFAULT-FRAME
DO:
/*    RAD_KS = INPUT RAD_KS. */
   RUN ksvalchange_UI (INPUT RAD_KS).
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-KUND
&Scoped-define SELF-NAME RAD_VAL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL RAD_VAL C-Win
ON VALUE-CHANGED OF RAD_VAL IN FRAME FRAME-KUND
DO:
   ASSIGN
   RAD_VAL = INPUT RAD_VAL
   FILL-IN-ANMALARE = INPUT FILL-IN-ANMALARE
   FILL-IN-ADRESS = INPUT FILL-IN-ADRESS
   FILL-IN-FEL = INPUT FILL-IN-FEL.
   IF RAD_VAL = 1 THEN DO:
      ASSIGN
      FILL-IN-ANMALARE:LABEL = "Felanmälare"
      FILL-IN-ADRESS:LABEL = "Feladress"
      FILL-IN-FEL:LABEL = "Fel uppgivet"
      CMB_SYS2:HIDDEN IN FRAME FRAME-STOR = FALSE
      CMB_SEK:HIDDEN IN FRAME FRAME-STOR = FALSE
      FILL-IN-SEK:HIDDEN IN FRAME FRAME-STOR = FALSE 
      CMB_REL:HIDDEN IN FRAME FRAME-STOR = FALSE
      CMB_UTL:HIDDEN IN FRAME FRAME-STOR = FALSE
      CMB_FEL:HIDDEN IN FRAME FRAME-STOR = FALSE
      FILL-IN-FELOR:HIDDEN IN FRAME FRAME-STOR = FALSE
      FILL-IN-FELT:HIDDEN IN FRAME FRAME-STOR = FALSE.      
   END. 
   ELSE DO:
      ASSIGN
      FILL-IN-ANMALARE:LABEL = "Beställare"
      FILL-IN-ADRESS:LABEL = "Adress"
      FILL-IN-FEL:LABEL = "Avbrottsorsak"
      CMB_SYS2:HIDDEN IN FRAME FRAME-STOR = TRUE
      CMB_SEK:HIDDEN IN FRAME FRAME-STOR = TRUE
      FILL-IN-SEK:HIDDEN IN FRAME FRAME-STOR = TRUE 
      CMB_REL:HIDDEN IN FRAME FRAME-STOR = TRUE
      CMB_UTL:HIDDEN IN FRAME FRAME-STOR = TRUE
      CMB_FEL:HIDDEN IN FRAME FRAME-STOR = TRUE
      FILL-IN-FELOR:HIDDEN IN FRAME FRAME-STOR = TRUE
      FILL-IN-FELT:HIDDEN IN FRAME FRAME-STOR = TRUE.
   END.   
   DISPLAY FILL-IN-ANMALARE FILL-IN-ADRESS FILL-IN-FEL WITH FRAME {&FRAME-NAME}.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-STOR
&Scoped-define SELF-NAME TOG_70
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL TOG_70 C-Win
ON VALUE-CHANGED OF TOG_70 IN FRAME FRAME-STOR
DO:
   TOG_70 = INPUT TOG_70.
   IF TOG_70 = FALSE THEN DO:
      ASSIGN
      FILL-IN-SLUTDAT:HIDDEN IN FRAME {&FRAME-NAME} = TRUE
      FILL-IN-SLUT:HIDDEN IN FRAME {&FRAME-NAME} = TRUE
      BTN_MINDAT4:HIDDEN IN FRAME {&FRAME-NAME} = TRUE
      BTN_UPDAT4:HIDDEN IN FRAME {&FRAME-NAME} = TRUE.
   END.
   ELSE DO:
      ASSIGN
      FILL-IN-SLUTDAT:HIDDEN IN FRAME {&FRAME-NAME} = FALSE
      FILL-IN-SLUT:HIDDEN IN FRAME {&FRAME-NAME} = FALSE
      BTN_MINDAT4:HIDDEN IN FRAME {&FRAME-NAME} = FALSE
      BTN_UPDAT4:HIDDEN IN FRAME {&FRAME-NAME} = FALSE.
      DISPLAY FILL-IN-SLUTDAT WITH FRAME FRAME-STOR.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define BROWSE-NAME BRW_ANL
&UNDEFINE SELF-NAME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CUSTOM _MAIN-BLOCK C-Win 


/* ***************************  Main Block  *************************** */

/* Set CURRENT-WINDOW: this will parent dialog-boxes and frames.        */
ASSIGN CURRENT-WINDOW                = {&WINDOW-NAME} 
       THIS-PROCEDURE:CURRENT-WINDOW = {&WINDOW-NAME}.

/* The CLOSE event can be used from inside or outside the procedure to  */
/* terminate it.                                                        */
ON CLOSE OF THIS-PROCEDURE 
DO:
   {BORTBRWPROC.I}
   RUN disable_UI.
END.
   

/* Best default for GUI applications is...                              */
PAUSE 0 BEFORE-HIDE.

/* Now enable the interface and wait for the exit condition.            */
/* (NOTE: handle ERROR and END-KEY so cleanup code will always fire.    */
MAIN-BLOCK:
DO ON ERROR   UNDO MAIN-BLOCK, LEAVE MAIN-BLOCK
   ON END-KEY UNDO MAIN-BLOCK, LEAVE MAIN-BLOCK:
   {WIN_M_START.I}
   {muswait.i}
   {ALLSTARTDYN.I}  
   RUN huvudkund_UI.
   RUN huvudstor_UI.
   RUN enable_UI.   
   
   {FRMSIZEF.I} 
   RAD_KS = 1.
   RUN ksvalchange_UI (INPUT 1).
   RUN setcolsortvar_UI IN brwproc[1] (INPUT "anvandartemp.AV-LEVEL <> 0").
   RUN openbdynspec_UI IN brwproc[1].
   RUN entryofover_UI.
   RAD_KS:HIDDEN IN FRAME {&FRAME-NAME} = TRUE.
   RUN gomastor_UI.
   {musarrow.i}
   {WIN_M_SLUT.I}
   ON BACK-TAB ANYWHERE RUN taborder_UI IN THIS-PROCEDURE.
   ON TAB ANYWHERE RUN taborder_UI IN THIS-PROCEDURE.
   ON TAB OF FILL-IN_SFORNAMN IN FRAME FRAME-KUND RUN taborder_UI IN THIS-PROCEDURE.
   IF NOT THIS-PROCEDURE:PERSISTENT THEN
   WAIT-FOR CLOSE OF THIS-PROCEDURE.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


/* **********************  Internal Procedures  *********************** */

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE allstartbrw_UI C-Win 
PROCEDURE allstartbrw_UI :
/* -----------------------------------------------------------
  Purpose: Changing screen-value for combo-box CMB_OMR     
  Parameters:  Input = Screen-value for CMB_FOR
  Notes:       
-------------------------------------------------------------*/    
   ASSIGN
   anvandartemp.ANVANDARE:READ-ONLY IN BROWSE BRW_PERS = TRUE    
   anlaggningsdeltemp.NAMN:READ-ONLY IN BROWSE BRW_ANL = TRUE  
   felorsaktemp.NAMN:READ-ONLY IN BROWSE  BRW_FEL = TRUE.
   RUN DYNBRW.P PERSISTENT SET brwproc[1] 
      (INPUT BRW_PERS:HANDLE IN FRAME FRAME-KUND).
   RUN DYNBRW.P PERSISTENT SET brwproc[2] 
      (INPUT BRW_ANL:HANDLE IN FRAME FRAME-STOR).        
   RUN DYNBRW.P PERSISTENT SET brwproc[3]
      (INPUT BRW_FEL:HANDLE IN FRAME FRAME-STOR).   
/*    RUN addfillin_UI IN brwproc[1]                                                 */
/*       (INPUT FILL-IN_SPERSONALKOD:HANDLE IN FRAME FRAME-KUND, INPUT "ANVANDARE"). */
/*    RUN addfillin_UI IN brwproc[1]                                                 */
/*       (INPUT FILL-IN_SFORNAMN:HANDLE IN FRAME FRAME-KUND, INPUT "AV-NAMN").       */
/*    ON TAB OF CMB_FEL IN FRAME FRAME-STOR, FILL-IN_SFORNAMN IN FRAME FRAME-KUND */
/*       PERSISTENT RUN taborder_UI IN THIS-PROCEDURE.                            */   
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE andraartal_UI C-Win 
PROCEDURE andraartal_UI :
/* -----------------------------------------------------------
  Purpose: Changing screen-value for combo-box CMB_OMR     
  Parameters:  Input = Screen-value for CMB_FOR
  Notes:       
-------------------------------------------------------------*/      
   CMB_FOR = INPUT FRAME FRAME-KUND CMB_FOR.
   IF ny = TRUE THEN DO:
      FIND FIRST avdelningtemp WHERE avdelningtemp.AVDELNINGNAMN = CMB_FOR
      NO-LOCK NO-ERROR.
      forvar = avdelningtemp.AVDELNINGNR.
   END.
   ELSE DO:
      FIND FIRST avdelningtemp WHERE avdelningtemp.AVDELNINGNR = forvar
      NO-LOCK NO-ERROR.
   END.
   FIND FIRST stordistemp WHERE stordistemp.AVDELNINGNR = avdelningtemp.AVDELNINGNR
   NO-LOCK NO-ERROR.
   IF AVAILABLE stordistemp THEN DO:
      DO WHILE CMB_AR:NUM-ITEMS IN FRAME FRAME-KUND NE 0:
         CMB_AR:DELETE(ENTRY(1, CMB_AR:LIST-ITEMS, ",")).
      END.
      OPEN QUERY aq FOR EACH stordistemp WHERE stordistemp.AVDELNINGNR = forvar NO-LOCK BY ARTAL.
      GET FIRST aq NO-LOCK.
      laddartal = 0.
      DO WHILE AVAILABLE(stordistemp):
         IF laddartal NE stordistemp.ARTAL THEN DO:
            laddartal = stordistemp.ARTAL.
            status-ok = CMB_AR:ADD-FIRST(STRING(stordistemp.ARTAL)) IN FRAME FRAME-KUND.
         END.
         GET NEXT aq NO-LOCK.
      END.
      CLOSE QUERY aq.
      IF forsta = TRUE AND ny = FALSE THEN DO:
         ASSIGN
         forsta = FALSE
         CMB_AR:SCREEN-VALUE = STRING(laddartal).
         sistartal = laddartal.
      END.
      ELSE IF forsta = TRUE AND ny = TRUE THEN DO:
         ASSIGN
         forsta = FALSE
         CMB_AR:SCREEN-VALUE = STRING(sistartal).
      END.
      ELSE DO:
         ASSIGN
         forsta = FALSE
         CMB_AR:SCREEN-VALUE = STRING(laddartal).
         sistartal = laddartal.
      END.
      RUN andraomr_UI.      
   END.
   ELSE DO:
      MESSAGE "Det finns inget distrikt upplagt för " + avdelningtemp.AVDELNINGNAMN
      VIEW-AS ALERT-BOX TITLE "Meddelande".
      FIND FIRST avdelningtemp WHERE avdelningtemp.AVDELNINGNR = forvar
      NO-LOCK NO-ERROR.
      CMB_FOR:SCREEN-VALUE = avdelningtemp.AVDELNINGNAMN.
   END.
                           
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE andraomr_UI C-Win 
PROCEDURE andraomr_UI :
/* -----------------------------------------------------------
  Purpose: Changing screen-value for combo-box CMB_OMR     
  Parameters:  Input = Screen-value for CMB_FOR
  Notes:       
-------------------------------------------------------------*/      
   DO WHILE CMB_OMR:NUM-ITEMS IN FRAME FRAME-KUND NE 0:
      CMB_OMR:DELETE(ENTRY(1, CMB_OMR:LIST-ITEMS, ",")).
   END.
   OPEN QUERY oq FOR EACH stordistemp WHERE stordistemp.AVDELNINGNR = forvar AND 
      stordistemp.ARTAL = sistartal NO-LOCK.
   GET FIRST oq NO-LOCK.
   DO WHILE AVAILABLE(stordistemp):
      status-ok = CMB_OMR:ADD-LAST(STRING(stordistemp.NAMN)) IN FRAME FRAME-KUND.
      GET NEXT oq NO-LOCK.
   END.
   CLOSE QUERY oq.  
   IF Guru.Konstanter:globforetag = "GRAN" THEN DO:
      FIND FIRST stordistemp WHERE stordistemp.AVDELNINGNR = forvar AND 
      stordistemp.ARTAL = sistartal AND stordistemp.VIDISTRIKT = "1" NO-LOCK NO-ERROR.
   END.
   ELSE DO:
      FIND FIRST stordistemp WHERE stordistemp.AVDELNINGNR = forvar AND 
      stordistemp.DISTRIKTID = distvar AND stordistemp.ARTAL = sistartal NO-LOCK NO-ERROR.
   END.
   IF AVAILABLE stordistemp THEN DO:   
      ASSIGN
      CMB_OMR:SCREEN-VALUE IN FRAME FRAME-KUND = STRING(stordistemp.NAMN)
      distvar = stordistemp.DISTRIKTID.
   END.
   ELSE DO:
      FIND FIRST stordistemp WHERE stordistemp.AVDELNINGNR = forvar AND 
      stordistemp.ARTAL = sistartal NO-LOCK NO-ERROR.
      IF AVAILABLE stordistemp THEN DO:   
         ASSIGN
         CMB_OMR:SCREEN-VALUE IN FRAME FRAME-KUND = STRING(stordistemp.NAMN)
         distvar = stordistemp.DISTRIKTID.
      END.
   END.
   APPLY "VALUE-CHANGED" TO CMB_OMR IN FRAME FRAME-KUND.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE berakna_UI C-Win 
PROCEDURE berakna_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   &Scoped-define FRAME-NAME FRAME-STOR
   ASSIGN
   totavbrott = 0
   totbortfall = 0.
   IF TOG_70 = TRUE THEN DO:      
      RUN TIDBER.P (INPUT startdatum, INPUT datum70, INPUT starttid,
      INPUT tid70, OUTPUT timmar100, OUTPUT timmar60).   
      IF skapa = TRUE THEN DO:
         bortavbrott = klockan60((timmar100 * (lspantal + hspantal))).
         CREATE bort_temp.
         ASSIGN
         bort_temp.ATERDATUM = datum70
         bort_temp.ATERKLOCKAN = tid70
         bort_temp.AVBROTTSTID = bortavbrott
         bort_temp.ANTALLSP = lspantal
         bort_temp.ANTALHSP = hspantal.      
      END.
      totbortfall = totbortfall + ((FILL-IN-MW * 1000) + FILL-IN-KW) * timmar100.
      totavbrott = totavbrott + (timmar100 * (lspantal + hspantal)).
      RUN TIDBER.P (INPUT datum70, INPUT datum30, INPUT tid70,
      INPUT tid30, OUTPUT timmar100, OUTPUT timmar60).
      IF skapa = TRUE THEN DO:
         bortavbrott = klockan60((timmar100 * ((lspantal + hspantal) * 0.3))).
         CREATE bort_temp.
         ASSIGN
         bort_temp.ATERDATUM = datum30
         bort_temp.ATERKLOCKAN = tid30
         bort_temp.AVBROTTSTID = bortavbrott
         bort_temp.ANTALLSP = lspantal * 0.3
         bort_temp.ANTALHSP = hspantal * 0.3.
      END.
      totbortfall = totbortfall + (((FILL-IN-MW * 1000) + FILL-IN-KW) * (((lspantal + hspantal) * 0.3) / (lspantal + hspantal)) * timmar100).
      totavbrott = totavbrott + (timmar100 * ((lspantal + hspantal) * 0.3)).
   END.
   ELSE DO:
      RUN TIDBER.P (INPUT startdatum, INPUT datum30, INPUT starttid,
      INPUT tid30, OUTPUT timmar100, OUTPUT timmar60).
      IF skapa = TRUE THEN DO:
         bortavbrott = klockan60((timmar100 * (lspantal + hspantal))).
         CREATE bort_temp.
         ASSIGN
         bort_temp.ATERDATUM = datum30
         bort_temp.ATERKLOCKAN = tid30
         bort_temp.AVBROTTSTID = bortavbrott
         bort_temp.ANTALLSP = lspantal
         bort_temp.ANTALHSP = hspantal.
      END.
      ASSIGN
      totbortfall = totbortfall + ((FILL-IN-MW * 1000) + FILL-IN-KW) * timmar100
      totavbrott = totavbrott + (timmar100 * (lspantal + hspantal)).
   END.      
   ASSIGN
   FILL-IN-BORTFALL = klockan60(totbortfall)
   FILL-IN-AVBROTT = klockan60(totavbrott).
   DISPLAY FILL-IN-AVBROTT FILL-IN-BORTFALL WITH FRAME {&FRAME-NAME}.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE bortfall_UI C-Win 
PROCEDURE bortfall_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   ASSIGN
   totbortfall = 0
   mestbort = 0.
   FOR EACH bort_temp:
      IF bort_temp.ANTALHSP + bort_temp.ANTALLSP >= mestbort THEN DO:
         ASSIGN
         mestbort = bort_temp.ANTALHSP + bort_temp.ANTALLSP
         bortfallrec = RECID(bort_temp).
      END.
   END.
   FIND bort_temp WHERE RECID(bort_temp) = bortfallrec NO-LOCK NO-ERROR.
   totbortfall = totbortfall + (((FILL-IN-MW * 1000) + FILL-IN-KW) * (klockan100(bort_temp.AVBROTTSTID) / (bort_temp.ANTALLSP + bort_temp.ANTALHSP))).
   FOR EACH bort_temp WHERE RECID(bort_temp) NE bortfallrec:
      divmestbort = (bort_temp.ANTALLSP + bort_temp.ANTALHSP) / mestbort.
      totbortfall = totbortfall + ((((FILL-IN-MW * 1000) + FILL-IN-KW) * divmestbort) * (klockan100(bort_temp.AVBROTTSTID) / (bort_temp.ANTALLSP + bort_temp.ANTALHSP))).
   END.   
   FILL-IN-BORTFALL =  klockan60(totbortfall).   
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE bort_UI C-Win 
PROCEDURE bort_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/   
   OPEN QUERY bortq FOR EACH bort_temp NO-LOCK.
   GET FIRST bortq EXCLUSIVE-LOCK.
   DO WHILE AVAILABLE(bort_temp):
      DELETE bort_temp.
      GET NEXT bortq EXCLUSIVE-LOCK.
   END.
   CLOSE QUERY bortq.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE btnber_UI C-Win 
PROCEDURE btnber_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/   
   &Scoped-define FRAME-NAME FRAME-STOR
   {muswait.i}
   ASSIGN
   TOG_70 = INPUT FRAME {&FRAME-NAME} TOG_70
   FILL-IN-STARTDAT = INPUT FILL-IN-STARTDAT
   FILL-IN-START = INPUT FILL-IN-START
   FILL-IN-SLUTDAT = INPUT FILL-IN-SLUTDAT
   FILL-IN-SLUT = INPUT FILL-IN-SLUT
   FILL-IN-SISTDAT = INPUT FILL-IN-SISTDAT
   FILL-IN-SIST = INPUT FILL-IN-SIST
   FILL-IN-LSPKUND = INPUT FILL-IN-LSPKUND
   FILL-IN-HSPKUND = INPUT FILL-IN-HSPKUND
   FILL-IN-MW = INPUT FILL-IN-MW
   FILL-IN-KW = INPUT FILL-IN-KW
   felkontroll = FALSE
   startdatum = FILL-IN-STARTDAT
   datum70 = FILL-IN-SLUTDAT
   datum30 = FILL-IN-SISTDAT
   starttid = FILL-IN-START
   tid70 = FILL-IN-SLUT
   tid30 = FILL-IN-SIST
   lspantal = FILL-IN-LSPKUND
   hspantal = FILL-IN-HSPKUND
   
   skapa = FALSE.
   RUN kontroll_UI.
   IF felkontroll = FALSE THEN DO:
      IF specvar = TRUE THEN DO:
         ASSIGN  
         FILL-IN-MW = INPUT FILL-IN-MW
         FILL-IN-KW = INPUT FILL-IN-KW.
         RUN bortfall_UI.
         DISPLAY FILL-IN-BORTFALL WITH FRAME {&FRAME-NAME}.
      END.
      ELSE RUN berakna_UI.
   END.
   {musarrow.i}
   &Scoped-define FRAME-NAME DEAFULT-FRAME
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE btnokkund_UI C-Win 
PROCEDURE btnokkund_UI :
/*------------------------------------------------------------------------------
  Purpose:     DISABLE the User Interface
  Parameters:  <none>
  Notes:       Here we clean-up the user-interface by deleting
               dynamic widgets we have created and/or hide 
               frames.  This procedure is usually called when
               we are ready to "clean-up" after running.
------------------------------------------------------------------------------*/
   &Scoped-define FRAME-NAME FRAME-KUND
   ASSIGN
   RAD_VAL = INPUT FRAME {&FRAME-NAME} RAD_VAL 
   FILL-IN-ANMALARE = INPUT FRAME {&FRAME-NAME} FILL-IN-ANMALARE
   FILL-IN-ADRESS = INPUT FRAME {&FRAME-NAME} FILL-IN-ADRESS
   FILL-IN-POSTNR = INPUT FRAME {&FRAME-NAME} FILL-IN-POSTNR
   FILL-IN-ORT = INPUT FRAME {&FRAME-NAME} FILL-IN-ORT
   FILL-IN-TELE = INPUT FRAME {&FRAME-NAME} FILL-IN-TELE         
   FILL-IN-FEL = INPUT FRAME {&FRAME-NAME} FILL-IN-FEL
   FILL-IN-UPP = INPUT FRAME {&FRAME-NAME} FILL-IN-UPP
   FILL-IN-OVER = INPUT FRAME {&FRAME-NAME} FILL-IN-OVER
   FILL-IN-ATER = INPUT FRAME {&FRAME-NAME} FILL-IN-ATER   
   FILL-IN-FDAT = INPUT FRAME {&FRAME-NAME} FILL-IN-FDAT
   ED_MEDD = INPUT FRAME {&FRAME-NAME} ED_MEDD.
   IF Guru.Konstanter:globforetag = "SVEN" OR Guru.Konstanter:globforetag = "SEKG" THEN musz = musz.
   ELSE DO:   
      IF FILL-IN-OVER NE "" THEN DO:         
         FIND FIRST anvandartemp WHERE anvandartemp.ANVANDARE = FILL-IN-OVER       
         NO-LOCK NO-ERROR.
         IF NOT AVAILABLE anvandartemp THEN DO:
            MESSAGE "Personen saknas." VIEW-AS ALERT-BOX TITLE "Meddelande".
            RAD_KS = 1.
            RUN ksvalchange_UI (INPUT 1).
            APPLY "ENTRY" TO FILL-IN-OVER IN FRAME {&FRAME-NAME}.
            musz = TRUE.
            RETURN NO-APPLY.
         END.
      END.
   END.
   FIND LAST extrastorntemp NO-LOCK NO-ERROR. 
/*    IF ny = TRUE THEN DO:                  */
/*       ASSIGN                              */
/*       extrastorntemp.DISTRIKTID = distvar */
/*       extrastorntemp.STORTYPID = RAD_VAL. */
/*    END.                                   */
   ASSIGN
   extrastorntemp.DISTRIKTID = distvar
   extrastorntemp.STORTYPID = RAD_VAL
   extrastorntemp.VEMFEL = FILL-IN-ANMALARE
   extrastorntemp.ADRESSVEMFEL = FILL-IN-ADRESS
   extrastorntemp.VEMPOSTNUMMER = FILL-IN-POSTNR
   extrastorntemp.VEMORT = FILL-IN-ORT
   extrastorntemp.TELVEMFEL = FILL-IN-TELE 
   extrastorntemp.LOSEN = FILL-IN-FEL
   extrastorntemp.ANSVARIGPERS = FILL-IN-OVER 
   extrastorntemp.ANVANDARE = FILL-IN-UPP
   extrastorntemp.MERJOBB = FILL-IN-ATER      
   extrastorntemp.VEMINFO = ED_MEDD.
   IF FILL-IN-ATER = FALSE THEN DO:
      ASSIGN
      extrastorntemp.FDATUM = FILL-IN-FDAT
      extrastorntemp.FKLOCKAN = TIME.
   END.   
   ELSE DO:
      ASSIGN
      extrastorntemp.FDATUM = ?
      extrastorntemp.FKLOCKAN = ?.   
   END.
   musz = FALSE.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE btnokstor_UI C-Win 
PROCEDURE btnokstor_UI :
/*------------------------------------------------------------------------------
  Purpose:     DISABLE the User Interface
  Parameters:  <none>
  Notes:       Here we clean-up the user-interface by deleting
               dynamic widgets we have created and/or hide 
               frames.  This procedure is usually called when
               we are ready to "clean-up" after running.
------------------------------------------------------------------------------*/
   &Scoped-define FRAME-NAME FRAME-STOR
   RUN btnber_UI.
   IF felkontroll = TRUE THEN DO: 
      musz = TRUE.
      RETURN NO-APPLY.
   END.
   ASSIGN
   FILL-IN-STARTDAT = INPUT FRAME {&FRAME-NAME} FILL-IN-STARTDAT
   FILL-IN-START = INPUT FILL-IN-START
   FILL-IN-SLUTDAT = INPUT FILL-IN-SLUTDAT
   FILL-IN-SLUT = INPUT FILL-IN-SLUT
   FILL-IN-SISTDAT = INPUT FILL-IN-SISTDAT
   FILL-IN-SIST = INPUT FILL-IN-SIST  
   FILL-IN-ANN = INPUT FILL-IN-ANN
   FILL-IN-FELOR = INPUT FILL-IN-FELOR
   FILL-IN-HSPKUND = INPUT FILL-IN-HSPKUND
   FILL-IN-LSPKUND = INPUT FILL-IN-LSPKUND
   FILL-IN-KW = INPUT FILL-IN-KW
   FILL-IN-MW = INPUT FILL-IN-MW   
   FILL-IN-BRYT = INPUT FILL-IN-BRYT
   FILL-IN-SEK = INPUT FILL-IN-SEK
   FILL-IN-BEL = INPUT FILL-IN-BEL
   FILL-IN-AVBROTT = INPUT FILL-IN-AVBROTT
   ED_ANM = INPUT ED_ANM
   FILL-IN-BORTFALL = INPUT FILL-IN-BORTFALL.
   IF FILL-IN-SIST < 0 OR FILL-IN-SIST > 24 OR FILL-IN-START < 0 OR FILL-IN-START > 24 OR
   FILL-IN-SLUT < 0 OR FILL-IN-SLUT > 24 THEN DO:
      MESSAGE "Klockslaget är orimligt!" VIEW-AS ALERT-BOX.
      RAD_KS = 2.
      RUN ksvalchange_UI (INPUT 2).
      musz = TRUE.
      RETURN NO-APPLY.
   END.
   
   IF FILL-IN-ANN = "" THEN DO:
      MESSAGE "Ni har inte angett någon anläggning, -del."
      VIEW-AS ALERT-BOX TITLE "Meddelande".
      RAD_KS = 2.
      /*
      DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
      */
      APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.               
      APPLY "ENTRY" TO CMB_ANL.
      musz = TRUE.
      RETURN NO-APPLY.
   END.
   IF extrastorntemp.STORTYPID = 1 THEN DO:   
      IF FILL-IN-FELOR = "" THEN DO:
         MESSAGE "Ni har inte angett någon felorsak."
         VIEW-AS ALERT-BOX TITLE "Meddelande".
         RAD_KS = 2.
         /*
         DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
         */
         APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.             
         APPLY "ENTRY" TO CMB_FEL.
         musz = TRUE.
         RETURN NO-APPLY.
      END.
   END.
   OPEN QUERY bq FOR EACH bortkoppladtemp WHERE bortkoppladtemp.STORNUMMERID = 
   extrastorntemp.STORNUMMERID USE-INDEX STORNUMMERID NO-LOCK.
   GET FIRST bq EXCLUSIVE-LOCK.
   DO WHILE AVAILABLE(bortkoppladtemp):
      DELETE bortkoppladtemp.
      GET NEXT bq EXCLUSIVE-LOCK.
   END.
   CLOSE QUERY bq.  
   ASSIGN   
   extrastorntemp.BENAMNING = Guru.Konstanter:globanv
   extrastorntemp.HDATUM = FILL-IN-STARTDAT
   extrastorntemp.HKLOCKAN = FILL-IN-START
   extrastorntemp.BORTKW = FILL-IN-KW
   extrastorntemp.BORTMW = FILL-IN-MW
   extrastorntemp.ANTALLSP = FILL-IN-LSPKUND
   extrastorntemp.ANTALHSP = FILL-IN-HSPKUND
   extrastorntemp.ADELID = annvar      
   extrastorntemp.BRYTORGLIT = FILL-IN-BRYT
   extrastorntemp.AVBROTTSTID = totavbrott
   extrastorntemp.BORTFALL = totbortfall   
   extrastorntemp.FRANSPANID = fransys
   extrastorntemp.KOMMENTAR = ED_ANM
   extrastorntemp.STDRIFTLIT = FILL-IN-BEL.
   IF extrastorntemp.STORTYPID = 1 THEN DO:
      ASSIGN
      extrastorntemp.FELSPANID = felsys
      extrastorntemp.SEKTIONLIT = FILL-IN-SEK
      extrastorntemp.FELOID = felvar.
   END.
   IF specvar = FALSE THEN DO:
      IF TOG_70 = TRUE THEN DO: 
         ASSIGN     
         extrastorntemp.DATUM70% = FILL-IN-SLUTDAT
         extrastorntemp.KLOCKAN70% = FILL-IN-SLUT
         extrastorntemp.DATUM100% = FILL-IN-SISTDAT
         extrastorntemp.KLOCKAN100% = FILL-IN-SIST.
      END.
      ELSE DO:
         ASSIGN
         extrastorntemp.DATUM70% = ?
         extrastorntemp.KLOCKAN70% = ?     
         extrastorntemp.DATUM100% = FILL-IN-SISTDAT
         extrastorntemp.KLOCKAN100% = FILL-IN-SIST.
      END.   
   END.
   ELSE DO:
      ASSIGN
      extrastorntemp.DATUM70% = ?
      extrastorntemp.KLOCKAN70% = ?
      extrastorntemp.DATUM100% = ?
      extrastorntemp.KLOCKAN100% = ?.
      FOR EACH bort_temp:
         CREATE bortkoppladtemp.
         ASSIGN
         bortkoppladtemp.STORNUMMERID = extrastorntemp.STORNUMMERID
         bortkoppladtemp.ATERDATUM = bort_temp.ATERDATUM
         bortkoppladtemp.ATERKLOCKAN = bort_temp.ATERKLOCKAN
         bortkoppladtemp.ANTALHSP = bort_temp.ANTALHSP
         bortkoppladtemp.ANTALLSP = bort_temp.ANTALLSP
         bortkoppladtemp.AVBROTTSTID = bort_temp.AVBROTTSTID
         bortkoppladtemp.AKTIVITET = bort_temp.AKTIVITET.
      END.      
   END. 
        
   RUN andrabortkopplad_UI IN strproch (INPUT TABLE bortkoppladtemp, INPUT extrastorntemp.STORNUMMERID).
   
   IF extrastorntemp.STORTYPID = 1 THEN DO:
      CMB_SEK = INPUT CMB_SEK.         
      FIND FIRST sektioneringtemp WHERE sektioneringtemp.NAMN = CMB_SEK NO-LOCK NO-ERROR.
      extrastorntemp.SEKTIONERID = sektioneringtemp.SEKTIONERID.
      
      CMB_UTL = INPUT CMB_UTL.
      FIND FIRST utlosningskyddtemp WHERE utlosningskyddtemp.NAMN = CMB_UTL
      NO-LOCK NO-ERROR.
      extrastorntemp.UTLOSID = utlosningskyddtemp.UTLOSID.
      
      CMB_REL = INPUT CMB_REL.   
      FIND FIRST relaindikeringtemp WHERE relaindikeringtemp.NAMN = CMB_REL
      NO-LOCK NO-ERROR.
      extrastorntemp.RELINID = relaindikeringtemp.RELINID.
   END.   
      
   CMB_FRAN = INPUT CMB_FRAN.
   FIND FIRST brytorgantemp WHERE brytorgantemp.NAMN = CMB_FRAN NO-LOCK NO-ERROR.
   extrastorntemp.BRYTOID = brytorgantemp.BRYTOID. 

   CMB_BEL = INPUT CMB_BEL.
   FIND FIRST stordriftomrtemp WHERE stordriftomrtemp.NAMN = CMB_BEL NO-LOCK NO-ERROR.
   extrastorntemp.STDRIFTID = stordriftomrtemp.STDRIFTID.

   CMB_NAT = INPUT CMB_NAT.
   FIND FIRST nattyptemp WHERE nattyptemp.NAMN = CMB_NAT NO-LOCK NO-ERROR.
   extrastorntemp.NATTYPID = nattyptemp.NATTYPID.
   FIND FIRST vstorntemp WHERE vstorntemp.STORNUMMERID = extrastorntemp.STORNUMMERID 
   NO-LOCK NO-ERROR.
   IF NOT AVAILABLE vstorntemp THEN CREATE vstorntemp.
   BUFFER-COPY extrastorntemp TO vstorntemp.
   RUN sparastor_UI IN strproch (INPUT TABLE extrastorntemp).

   &Scoped-define FRAME-NAME DEFAULT-FRAME
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE disable_UI C-Win  _DEFAULT-DISABLE
PROCEDURE disable_UI :
/*------------------------------------------------------------------------------
  Purpose:     DISABLE the User Interface
  Parameters:  <none>
  Notes:       Here we clean-up the user-interface by deleting
               dynamic widgets we have created and/or hide 
               frames.  This procedure is usually called when
               we are ready to "clean-up" after running.
------------------------------------------------------------------------------*/
  /* Delete the WINDOW we created */
  IF SESSION:DISPLAY-TYPE = "GUI":U AND VALID-HANDLE(C-Win)
  THEN DELETE WIDGET C-Win.
  IF THIS-PROCEDURE:PERSISTENT THEN DELETE PROCEDURE THIS-PROCEDURE.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE enable_UI C-Win  _DEFAULT-ENABLE
PROCEDURE enable_UI :
/*------------------------------------------------------------------------------
  Purpose:     ENABLE the User Interface
  Parameters:  <none>
  Notes:       Here we display/view/enable the widgets in the
               user-interface.  In addition, OPEN all queries
               associated with each FRAME and BROWSE.
               These statements here are based on the "Other 
               Settings" section of the widget Property Sheets.
------------------------------------------------------------------------------*/
  DISPLAY RAD_KS 
      WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
  ENABLE RAD_KS MBTN_KUNDUPPG RECT-28 MBTN_STORNUPPG BTN_OK BTN_AVB 
      WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-DEFAULT-FRAME}
  DISPLAY RAD_VAL CMB_FOR CMB_OMR CMB_AR FILL-IN-ANMALARE FILL-IN-FEL 
          FILL-IN-ADRESS FILL-IN-POSTNR FILL-IN-ORT FILL-IN-TELE FILL-IN-OVER 
          FILL-IN-ATER FILL-IN-FDAT ED_MEDD FILL-IN_SPERSONALKOD 
          FILL-IN_SFORNAMN FILL-IN-INLUP FILL-IN-FORETAG FILL-IN-TYP 
          FILL-IN-DISTRIKT FILL-IN-KUNUP FILL-IN-OVRUP FILL-IN-UPP FILL-IN-ANM 
          FILL-IN-SOKPO 
      WITH FRAME FRAME-KUND IN WINDOW C-Win.
  ENABLE RECT-2 RECT-4 RECT-6 RECT-7 RAD_VAL CMB_FOR CMB_OMR CMB_AR 
         FILL-IN-ANMALARE FILL-IN-FEL FILL-IN-ADRESS FILL-IN-POSTNR FILL-IN-ORT 
         FILL-IN-TELE BRW_PERS FILL-IN-OVER FILL-IN-ATER BTN_UPDAT2 
         FILL-IN-FDAT BTN_MINDAT2 ED_MEDD FILL-IN_SPERSONALKOD FILL-IN_SFORNAMN 
         FILL-IN-INLUP FILL-IN-FORETAG FILL-IN-DISTRIKT FILL-IN-KUNUP 
         FILL-IN-OVRUP FILL-IN-UPP FILL-IN-ANM FILL-IN-SOKPO 
      WITH FRAME FRAME-KUND IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-FRAME-KUND}
  DISPLAY CMB_SYS FILL-IN-MW FILL-IN-KW FILL-IN-HSPKUND FILL-IN-LSPKUND CMB_SYS2 
          FILL-IN-STARTDAT CMB_FRAN FILL-IN-START FILL-IN-BRYT TOG_70 
          FILL-IN-SLUTDAT CMB_SEK FILL-IN-SLUT FILL-IN-SEK CMB_UTL 
          FILL-IN-SISTDAT CMB_REL FILL-IN-SIST CMB_BEL FILL-IN-BEL ED_ANM 
          CMB_NAT CMB_ANL CMB_FEL FILL-IN-ANLDEL-7 FILL-IN-ANLDEL-3 
          FILL-IN-ANLDEL-4 FILL-IN-ANLDEL-2 FILL-IN-ANLDEL-5 FILL-IN-AVBROTT 
          FILL-IN-ANLDEL-6 FILL-IN-TEXT1 FILL-IN-BORTFALL FILL-IN-TEXT2 
          FILL-IN-ANMS FILL-IN-ANLDEL FILL-IN-ANN FILL-IN-FELT FILL-IN-FELOR 
      WITH FRAME FRAME-STOR IN WINDOW C-Win.
  ENABLE CMB_SYS FILL-IN-MW FILL-IN-KW FILL-IN-HSPKUND FILL-IN-LSPKUND CMB_SYS2 
         BTN_UPDAT1 FILL-IN-STARTDAT BTN_MINDAT1 CMB_FRAN FILL-IN-START 
         FILL-IN-BRYT TOG_70 BTN_UPDAT4 FILL-IN-SLUTDAT CMB_SEK BTN_MINDAT4 
         BTN_BER FILL-IN-SLUT FILL-IN-SEK CMB_UTL BTN_UPDAT3 FILL-IN-SISTDAT 
         BTN_TOT BTN_MINDAT3 CMB_REL FILL-IN-SIST CMB_BEL FILL-IN-BEL ED_ANM 
         CMB_NAT CMB_ANL BRW_ANL CMB_FEL BRW_FEL FILL-IN-ANLDEL-7 
         FILL-IN-ANLDEL-3 FILL-IN-ANLDEL-4 FILL-IN-ANLDEL-2 FILL-IN-ANLDEL-5 
         FILL-IN-AVBROTT FILL-IN-ANLDEL-6 FILL-IN-TEXT1 FILL-IN-BORTFALL 
         FILL-IN-TEXT2 FILL-IN-ANMS FILL-IN-ANLDEL FILL-IN-ANN FILL-IN-FELT 
         FILL-IN-FELOR RECT-10 RECT-11 RECT-12 RECT-13 RECT-14 RECT-15 RECT-16 
         RECT-17 RECT-27 RECT-8 RECT-9 
      WITH FRAME FRAME-STOR IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-FRAME-STOR}
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE entryofover_UI C-Win 
PROCEDURE entryofover_UI :
/* -----------------------------------------------------------
  Purpose: Changing screen-value for combo-box CMB_OMR     
  Parameters:  Input = Screen-value for CMB_FOR
  Notes:       
-------------------------------------------------------------*/    
   FILL-IN-OVER = INPUT FRAME FRAME-KUND FILL-IN-OVER.
   FIND FIRST anvandartemp WHERE anvandartemp.ANVANDARE = FILL-IN-OVER       
   NO-LOCK NO-ERROR.
   IF AVAILABLE anvandartemp THEN DO:
      RUN setlastrowid_UI IN brwproc[1] (INPUT ROWID(anvandartemp)).
      RUN lastselectdyn_UI IN brwproc[1].             
   END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE gomastor_UI C-Win 
PROCEDURE gomastor_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/   
   &Scoped-define FRAME-NAME FRAME-STOR
   IF ny = FALSE THEN DO:
      FIND FIRST anlaggningsdeltemp WHERE anlaggningsdeltemp.ADELID = annvar
      USE-INDEX ADELID NO-LOCK NO-ERROR.
      FILL-IN-ANN = anlaggningsdeltemp.NAMN.
      DISPLAY FILL-IN-ANN WITH FRAME {&FRAME-NAME}.
      FIND FIRST anlaggningstyptemp WHERE anlaggningstyptemp.ATYPID = 
      anlaggningsdeltemp.ATYPID USE-INDEX ATYPID NO-LOCK NO-ERROR.
      CMB_ANL:SCREEN-VALUE IN FRAME {&FRAME-NAME} = anlaggningstyptemp.NAMN.
      APPLY "VALUE-CHANGED" TO CMB_ANL IN FRAME {&FRAME-NAME}.
      ED_ANM = extrastorntemp.KOMMENTAR.
      DISPLAY ED_ANM WITH FRAME FRAME-STOR.
      IF extrastorntemp.STORTYPID = 1 THEN DO:
         FIND FIRST felorsaktemp WHERE felorsaktemp.FELOID = felvar
         USE-INDEX FELOID NO-LOCK NO-ERROR.
         FILL-IN-FELOR = felorsaktemp.NAMN.
         DISPLAY FILL-IN-FELOR WITH FRAME {&FRAME-NAME}.   
         FIND FIRST grundfeltyptemp WHERE grundfeltyptemp.GRUNDFELID = 
         felorsaktemp.GRUNDFELID USE-INDEX GRUNDFELID NO-LOCK NO-ERROR.
         CMB_FEL:SCREEN-VALUE = grundfeltyptemp.NAMN.
      END.   
      IF extrastorntemp.DATUM70% = ? THEN DO:
         IF extrastorntemp.DATUM100% = ? THEN DO:
            ASSIGN
            FILL-IN-SLUTDAT:HIDDEN = TRUE
            FILL-IN-SLUT:HIDDEN = TRUE
            FILL-IN-TEXT1:HIDDEN = TRUE
            TOG_70:HIDDEN = TRUE
            BTN_MINDAT1:HIDDEN = TRUE
            BTN_UPDAT1:HIDDEN = TRUE
            BTN_MINDAT4:HIDDEN = TRUE
            BTN_UPDAT4:HIDDEN = TRUE
            BTN_MINDAT3:HIDDEN = TRUE
            BTN_UPDAT3:HIDDEN = TRUE
            BTN_BER:HIDDEN = TRUE.
            DISABLE FILL-IN-STARTDAT FILL-IN-START FILL-IN-HSPKUND FILL-IN-LSPKUND 
               FILL-IN-SISTDAT FILL-IN-SIST WITH FRAME {&FRAME-NAME}.         
         END.
         ELSE DO:
            ASSIGN
            FILL-IN-SLUTDAT:HIDDEN = TRUE
            FILL-IN-SLUT:HIDDEN = TRUE
            BTN_MINDAT4:HIDDEN = TRUE
            BTN_UPDAT4:HIDDEN = TRUE.
         END.   
      END.
   END.
   ELSE DO:
      ASSIGN
      FILL-IN-SLUTDAT:HIDDEN = TRUE
      FILL-IN-SLUT:HIDDEN = TRUE
      BTN_MINDAT4:HIDDEN = TRUE
      BTN_UPDAT4:HIDDEN = TRUE.
      APPLY "VALUE-CHANGED" TO CMB_ANL IN FRAME {&FRAME-NAME}.
   END.
   IF extrastorntemp.STORTYPID = 2 THEN DO:
      ASSIGN      
      CMB_SYS2:HIDDEN = TRUE
      CMB_SEK:HIDDEN = TRUE
      FILL-IN-SEK:HIDDEN = TRUE 
      CMB_REL:HIDDEN = TRUE
      CMB_UTL:HIDDEN = TRUE
      CMB_FEL:HIDDEN = TRUE
      FILL-IN-FELOR:HIDDEN = TRUE
      FILL-IN-FELT:HIDDEN = TRUE.
   END.    
   ASSIGN
   /*
   BTN_BER:LABEL = "    Beräkna~nkundavbrottstid"
   BTN_TOT:LABEL = " Specificera~nkundavbrottstid".
   */
   BTN_BER:LABEL = "    Beräkna kundavbrottstid"
   BTN_TOT:LABEL = " Specificera kundavbrottstid".
   /*
   RUN SetWindowLongA IN Guru.Konstanter:hpApi (BTN_BER:HWND IN FRAME {&FRAME-NAME},-16,1409294336,OUTPUT ReturnValue).
   RUN SendMessageA IN Guru.Konstanter:hpApi (BTN_BER:HWND IN FRAME {&FRAME-NAME},244,1409294336,1,OUTPUT ReturnValue).
   RUN SetWindowLongA IN Guru.Konstanter:hpApi (BTN_TOT:HWND IN FRAME {&FRAME-NAME},-16,1409294336,OUTPUT ReturnValue).
   RUN SendMessageA IN Guru.Konstanter:hpApi (BTN_TOT:HWND IN FRAME {&FRAME-NAME},244,1409294336,1,OUTPUT ReturnValue).
   */   
   &Scoped-define FRAME-NAME DEFAULT-FRAME
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE huvudkund_UI C-Win 
PROCEDURE huvudkund_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   &Scoped-define FRAME-NAME FRAME-KUND
   forsta = TRUE.
   IF ny = TRUE THEN DO:
      CMB_FOR:DELIMITER IN FRAME {&FRAME-NAME} = "$".
      FOR EACH avdelningtemp USE-INDEX AVDELNINGNR NO-LOCK:
         IF Guru.Konstanter:globforetag = "GRAN" THEN DO:
            IF avdelningtemp.AVDELNINGNR >= 64 THEN DO:
               status-ok = CMB_FOR:ADD-LAST(avdelningtemp.AVDELNINGNAMN).
            END.
         END.
         ELSE DO:
            status-ok = CMB_FOR:ADD-LAST(avdelningtemp.AVDELNINGNAMN).
         END.      
      END.
      FIND FIRST avdelningtemp WHERE avdelningtemp.AVDELNINGNR = forvar USE-INDEX AVDELNINGNR NO-LOCK NO-ERROR.
      CMB_FOR:SCREEN-VALUE = avdelningtemp.AVDELNINGNAMN.
      CMB_FOR = avdelningtemp.AVDELNINGNAMN.
      RUN andraartal_UI.
      RUN skapastor_UI IN strproch (OUTPUT TABLE extrastorntemp).
      FIND LAST extrastorntemp NO-LOCK.
      IF AVAILABLE extrastorntemp THEN DO:
         ASSIGN
         {&WINDOW-NAME}:TITLE = "Ny störning nr:" + 
         STRING(extrastorntemp.STORNUMMERID) 
         stornrid = extrastorntemp.STORNUMMERID.
      END.                
      FIND FIRST anvandartemp WHERE anvandartemp.ANVANDARE = Guru.Konstanter:globanv 
      USE-INDEX ANV NO-LOCK NO-ERROR.     
      IF AVAILABLE anvandartemp THEN DO:
         ASSIGN
         FILL-IN-UPP = anvandartemp.ANVANDARE.
      END.
      ASSIGN      
      FILL-IN-ATER = FALSE             
      FILL-IN-FDAT = TODAY.         
   END.
   ELSE DO:
      RUN hamtastor_UI IN strproch (INPUT stornrid, INPUT distvar, OUTPUT TABLE extrastorntemp).
      FIND LAST extrastorntemp NO-LOCK.
      IF AVAILABLE extrastorntemp THEN DO:
         FIND FIRST stordistemp WHERE stordistemp.DISTRIKTID = extrastorntemp.DISTRIKTID
         NO-LOCK NO-ERROR.
         forvar = stordistemp.AVDELNINGNR.
         FIND FIRST avdelningtemp WHERE avdelningtemp.AVDELNINGNR = forvar NO-LOCK NO-ERROR.
         IF AVAILABLE avdelningtemp THEN FILL-IN-FORETAG = avdelningtemp.AVDELNINGNAMN.
         RUN andraartal_UI.
         FIND FIRST stordistemp WHERE stordistemp.DISTRIKTID = extrastorntemp.DISTRIKTID NO-LOCK NO-ERROR.
         ASSIGN
         RAD_VAL = extrastorntemp.STORTYPID
         distvar = stordistemp.DISTRIKTID
         sistartal = stordistemp.ARTAL.
         /*MESSAGE extrastorntemp.STORTYPID.*/
         CMB_AR:SCREEN-VALUE IN FRAME {&FRAME-NAME} = STRING(sistartal).
         RUN andraomr_UI.
         CMB_OMR:SCREEN-VALUE IN FRAME {&FRAME-NAME} = STRING(stordistemp.NAMN).
         
/*          IF AVAILABLE stordistemp THEN DO:             */
/*             ASSIGN                                     */
/*             FILL-IN-FORETAG = stordistemp.AVDELNINGNR  */
/*             FILL-IN-DISTRIKT = stordistemp.VIDISTRIKT. */
/*          END.                                          */
         IF extrastorntemp.STORTYPID = 1 THEN rubrik = ". Driftstörning".
         ELSE rubrik = ". Planerat avbrott".  
         ASSIGN
         {&WINDOW-NAME}:TITLE = "Ändring av störning nr:" + 
         STRING(extrastorntemp.VSTORNUMMER) + rubrik.            
         ASSIGN
         FILL-IN-ANMALARE = extrastorntemp.VEMFEL
         FILL-IN-ADRESS = extrastorntemp.ADRESSVEMFEL
         FILL-IN-POSTNR = extrastorntemp.VEMPOSTNUMMER
         FILL-IN-ORT = extrastorntemp.VEMORT
         FILL-IN-TELE = extrastorntemp.TELVEMFEL
         FILL-IN-FEL = extrastorntemp.LOSEN
         FILL-IN-OVER = extrastorntemp.ANSVARIGPERS
         FILL-IN-UPP = extrastorntemp.ANVANDARE
         FILL-IN-ATER = extrastorntemp.MERJOBB
         FILL-IN-FDAT = extrastorntemp.FDATUM
         ED_MEDD = extrastorntemp.VEMINFO.         
         IF extrastorntemp.MERJOBB = TRUE THEN DO:
            ASSIGN            
            FILL-IN-FDAT = TODAY.
         END.
      END. 
      IF extrastorntemp.STORTYPID = 2 THEN DO:
         ASSIGN
         FILL-IN-ANMALARE:LABEL = "Beställare"
         FILL-IN-ADRESS:LABEL = "Adress"
         FILL-IN-FEL:LABEL = "Avbrottsorsak".
      END. 
      FIND FIRST anvandartemp WHERE anvandartemp.ANVANDARE = FILL-IN-OVER       
      NO-LOCK NO-ERROR.
      IF AVAILABLE anvandartemp THEN DO:
         RUN setlastrowid_UI IN brwproc[1] (INPUT ROWID(anvandartemp)).
         RUN lastselectdyn_UI IN brwproc[1].             
      END.
   END.  
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE huvudstor_UI C-Win 
PROCEDURE huvudstor_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   &Scoped-define FRAME-NAME FRAME-STOR
   EMPTY TEMP-TABLE bort_temp NO-ERROR. 
   ASSIGN
   FILL-IN-TEXT1 = "Huvuddel tillkopplad (70%):"
   FILL-IN-TEXT2 = "Sista kund tillkopplad:".
   OPEN QUERY sysq FOR EACH inlastabtemp WHERE inlastabtemp.INKOD = "D" NO-LOCK.
   GET FIRST sysq NO-LOCK.
   DO WHILE AVAILABLE(inlastabtemp):
      IF inlastabtemp.INKODPOSCH NE "" THEN DO:
         IF inlastabtemp.INKODTYP = "1" THEN DO:
            FIND FIRST spanningsnivtemp WHERE spanningsnivtemp.INKODID = 
            inlastabtemp.INKODID NO-LOCK NO-ERROR.
            IF AVAILABLE spanningsnivtemp THEN DO:
               status-ok = CMB_SYS:ADD-LAST(spanningsnivtemp.NAMN) IN FRAME {&FRAME-NAME}.
            END.
         END.
         ELSE DO:
            FIND FIRST spanningsnivtemp WHERE spanningsnivtemp.INKODID = 
            inlastabtemp.INKODID NO-LOCK NO-ERROR.
            IF AVAILABLE spanningsnivtemp THEN DO:
               status-ok = CMB_SYS2:ADD-LAST(spanningsnivtemp.NAMN).
            END.
         END.
      END.
      GET NEXT sysq NO-LOCK.
   END.   
   CLOSE QUERY sysq.
   FIND FIRST inlastabtemp WHERE inlastabtemp.INKOD = "D" AND inlastabtemp.INKODPOSCH NE "" AND
   inlastabtemp.INKODTYP = "1" NO-LOCK NO-ERROR.
   FIND FIRST spanningsnivtemp WHERE spanningsnivtemp.INKODID = 
   inlastabtemp.INKODID NO-LOCK NO-ERROR.
   IF AVAILABLE spanningsnivtemp THEN DO:
      ASSIGN
      CMB_SYS:SCREEN-VALUE = spanningsnivtemp.NAMN
      fransys = spanningsnivtemp.SPANID.
   END.
   FIND FIRST inlastabtemp WHERE inlastabtemp.INKOD = "D" AND inlastabtemp.INKODPOSCH NE "" AND
   inlastabtemp.INKODTYP = "2" NO-LOCK NO-ERROR.
   FIND FIRST spanningsnivtemp WHERE spanningsnivtemp.INKODID = 
   inlastabtemp.INKODID NO-LOCK NO-ERROR.
   IF AVAILABLE spanningsnivtemp THEN DO:
      ASSIGN
      CMB_SYS2:SCREEN-VALUE = spanningsnivtemp.NAMN
      felsys = spanningsnivtemp.SPANID.
   END.
   FOR EACH brytorgantemp USE-INDEX BRYTOID NO-LOCK:
      status-ok = CMB_FRAN:ADD-LAST(brytorgantemp.NAMN).
   END.
   FIND FIRST brytorgantemp USE-INDEX BRYTOID NO-LOCK NO-ERROR.
   CMB_FRAN:SCREEN-VALUE = brytorgantemp.NAMN. 
    
   FOR EACH sektioneringtemp USE-INDEX SEKTIONERID NO-LOCK:
      status-ok = CMB_SEK:ADD-LAST(sektioneringtemp.NAMN).
   END.
   FIND FIRST sektioneringtemp USE-INDEX SEKTIONERID NO-LOCK NO-ERROR.
   CMB_SEK:SCREEN-VALUE = sektioneringtemp.NAMN.
   
   FOR EACH utlosningskyddtemp USE-INDEX UTLOSID NO-LOCK:
      status-ok = CMB_UTL:ADD-LAST(utlosningskyddtemp.NAMN).
   END.
   FIND FIRST utlosningskyddtemp USE-INDEX UTLOSID NO-LOCK NO-ERROR.
   CMB_UTL:SCREEN-VALUE = utlosningskyddtemp.NAMN.
   
   CMB_REL:DELIMITER = "$".
   FOR EACH relaindikeringtemp USE-INDEX RELINID NO-LOCK:
      status-ok = CMB_REL:ADD-LAST(relaindikeringtemp.NAMN).
   END.
   FIND FIRST relaindikeringtemp USE-INDEX RELINID NO-LOCK NO-ERROR.
   CMB_REL:SCREEN-VALUE = relaindikeringtemp.NAMN.
   
   CMB_BEL:DELIMITER = "$".
   FOR EACH stordriftomrtemp USE-INDEX STDRIFTID NO-LOCK:
      status-ok = CMB_BEL:ADD-LAST(stordriftomrtemp.NAMN).
   END.
   FIND FIRST stordriftomrtemp WHERE stordriftomrtemp.NAMN = "EGET NÄT" NO-LOCK NO-ERROR.
   IF NOT AVAILABLE stordriftomrtemp THEN FIND FIRST stordriftomrtemp NO-LOCK NO-ERROR.
   CMB_BEL:SCREEN-VALUE = stordriftomrtemp.NAMN.
   
   CMB_NAT:DELIMITER = "$".
   FOR EACH nattyptemp USE-INDEX NATTYPID NO-LOCK:
      status-ok = CMB_NAT:ADD-LAST(nattyptemp.NAMN).
   END.
   FIND FIRST nattyptemp USE-INDEX NATTYPID NO-LOCK NO-ERROR.
   CMB_NAT:SCREEN-VALUE = nattyptemp.NAMN.

   FOR EACH anlaggningstyptemp USE-INDEX ATYPID NO-LOCK:
      status-ok = CMB_ANL:ADD-LAST(anlaggningstyptemp.NAMN).
   END.
   FIND FIRST anlaggningstyptemp USE-INDEX ATYPID NO-LOCK NO-ERROR.
   FIND FIRST anlaggningsdeltemp WHERE anlaggningsdeltemp.ATYPID = 
   anlaggningstyptemp.ATYPID USE-INDEX ADELID NO-LOCK NO-ERROR.
   ASSIGN
   annvar = anlaggningsdeltemp.ADELID
   CMB_ANL:SCREEN-VALUE = anlaggningstyptemp.NAMN.
   CMB_ANL = anlaggningstyptemp.NAMN.
   FOR EACH grundfeltyptemp USE-INDEX GRUNDFELID NO-LOCK:
      status-ok = CMB_FEL:ADD-LAST(grundfeltyptemp.NAMN).
   END.
   FIND FIRST grundfeltyptemp USE-INDEX GRUNDFELID NO-LOCK NO-ERROR.
   FIND FIRST felorsaktemp WHERE felorsaktemp.GRUNDFELID = 
   grundfeltyptemp.GRUNDFELID USE-INDEX FELOID NO-LOCK NO-ERROR.
   ASSIGN
   felvar = felorsaktemp.FELOID
   CMB_FEL:SCREEN-VALUE = grundfeltyptemp.NAMN.
   IF ny = TRUE THEN DO:
      ASSIGN           
      FILL-IN-STARTDAT = TODAY
      FILL-IN-START = 7
      FILL-IN-SLUTDAT = TODAY
      FILL-IN-SLUT = 7
      FILL-IN-SISTDAT = TODAY
      FILL-IN-SIST = 7
      specvar = FALSE
      TOG_70 = FALSE.
   END.
   ELSE DO:
      ASSIGN    
      FILL-IN-STARTDAT = extrastorntemp.HDATUM 
      FILL-IN-START = extrastorntemp.HKLOCKAN
      FILL-IN-KW = extrastorntemp.BORTKW
      FILL-IN-MW = extrastorntemp.BORTMW
      FILL-IN-LSPKUND = extrastorntemp.ANTALLSP
      FILL-IN-HSPKUND = extrastorntemp.ANTALHSP
      FILL-IN-BORTFALL = klockan60(extrastorntemp.BORTFALL)
      felvar = extrastorntemp.FELOID
      annvar = extrastorntemp.ADELID
      FILL-IN-SEK = extrastorntemp.SEKTIONLIT
      FILL-IN-BRYT = extrastorntemp.BRYTORGLIT
      FILL-IN-BEL = extrastorntemp.STDRIFTLIT
      FILL-IN-AVBROTT = klockan60(extrastorntemp.AVBROTTSTID)
      totavbrott = extrastorntemp.AVBROTTSTID.
      IF extrastorntemp.DATUM70% NE ? THEN DO:
         ASSIGN
         FILL-IN-SLUTDAT = extrastorntemp.DATUM70%
         FILL-IN-SLUT = extrastorntemp.KLOCKAN70%
         FILL-IN-SISTDAT = extrastorntemp.DATUM100%
         FILL-IN-SIST = extrastorntemp.KLOCKAN100%
         TOG_70 = TRUE.
         specvar = FALSE.
      END.   
      ELSE DO:
         IF extrastorntemp.DATUM100% NE ? THEN DO:           
            ASSIGN
            FILL-IN-SLUTDAT = extrastorntemp.HDATUM
            FILL-IN-SLUT = extrastorntemp.HKLOCKAN
            FILL-IN-SISTDAT = extrastorntemp.DATUM100%
            FILL-IN-SIST = extrastorntemp.KLOCKAN100%
            specvar = FALSE
            TOG_70 = FALSE.
         END.
         ELSE DO:
            OPEN QUERY bq FOR EACH bortkoppladtemp WHERE bortkoppladtemp.STORNUMMERID = 
            extrastorntemp.STORNUMMERID USE-INDEX STORNUMMERID NO-LOCK.
            GET FIRST bq NO-LOCK.
            DO WHILE AVAILABLE(bortkoppladtemp):
               CREATE bort_temp.
               ASSIGN
               bort_temp.ATERDATUM = bortkoppladtemp.ATERDATUM
               bort_temp.ATERKLOCKAN = bortkoppladtemp.ATERKLOCKAN
               bort_temp.ANTALHSP = bortkoppladtemp.ANTALHSP
               bort_temp.ANTALLSP = bortkoppladtemp.ANTALLSP
               bort_temp.AVBROTTSTID = bortkoppladtemp.AVBROTTSTID
               bort_temp.AKTIVITET = bortkoppladtemp.AKTIVITET.
               GET NEXT bq NO-LOCK.
            END.
            CLOSE QUERY bq.
            FIND LAST bort_temp NO-LOCK NO-ERROR.
            IF AVAILABLE bort_temp THEN DO:
               ASSIGN
               FILL-IN-SISTDAT:HIDDEN = FALSE
               FILL-IN-SIST:HIDDEN = FALSE
               FILL-IN-TEXT2:HIDDEN = FALSE
               FILL-IN-SISTDAT = bort_temp.ATERDATUM
               FILL-IN-SIST = bort_temp.ATERKLOCKAN.
               DISABLE FILL-IN-SISTDAT FILL-IN-SIST WITH FRAME {&FRAME-NAME}.
               DISPLAY FILL-IN-SISTDAT FILL-IN-SIST WITH FRAME {&FRAME-NAME}.
            END.
            specvar = TRUE.
         END.   
      END.   
            
      FIND FIRST brytorgantemp WHERE brytorgantemp.BRYTOID = 
      extrastorntemp.BRYTOID USE-INDEX BRYTOID NO-LOCK NO-ERROR.
      CMB_FRAN:SCREEN-VALUE = brytorgantemp.NAMN.

      FIND FIRST stordriftomrtemp WHERE stordriftomrtemp.STDRIFTID = 
      extrastorntemp.STDRIFTID USE-INDEX STDRIFTID NO-LOCK NO-ERROR.
      CMB_BEL:SCREEN-VALUE = stordriftomrtemp.NAMN.

      FIND FIRST nattyptemp WHERE nattyptemp.NATTYPID = 
      extrastorntemp.NATTYPID USE-INDEX NATTYPID NO-LOCK NO-ERROR.
      CMB_NAT:SCREEN-VALUE = nattyptemp.NAMN.
      FIND FIRST spanningsnivtemp WHERE spanningsnivtemp.SPANID = extrastorntemp.FRANSPANID
      USE-INDEX SPANID NO-LOCK NO-ERROR.
      ASSIGN
      fransys = spanningsnivtemp.SPANID
      CMB_SYS:SCREEN-VALUE = spanningsnivtemp.NAMN.
      IF extrastorntemp.STORTYPID = 1 THEN DO:
         FIND FIRST sektioneringtemp WHERE sektioneringtemp.SEKTIONERID =
         extrastorntemp.SEKTIONERID USE-INDEX SEKTIONERID NO-LOCK NO-ERROR.
         CMB_SEK:SCREEN-VALUE = sektioneringtemp.NAMN.
         
         FIND FIRST utlosningskyddtemp WHERE utlosningskyddtemp.UTLOSID = 
         extrastorntemp.UTLOSID USE-INDEX UTLOSID NO-LOCK NO-ERROR.
         CMB_UTL:SCREEN-VALUE = utlosningskyddtemp.NAMN.
         
         FIND FIRST relaindikeringtemp WHERE relaindikeringtemp.RELINID = 
         extrastorntemp.RELINID USE-INDEX RELINID NO-LOCK NO-ERROR.
         CMB_REL:SCREEN-VALUE = relaindikeringtemp.NAMN.
         
         FIND FIRST spanningsnivtemp WHERE spanningsnivtemp.SPANID = extrastorntemp.FELSPANID
         USE-INDEX SPANID NO-LOCK NO-ERROR.
         ASSIGN
         felsys = spanningsnivtemp.SPANID
         CMB_SYS2:SCREEN-VALUE = spanningsnivtemp.NAMN.
      END.   
   END.   
   &Scoped-define FRAME-NAME DEFAULT-FRAME
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE kontroll_UI C-Win 
PROCEDURE kontroll_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   &Scoped-define FRAME-NAME FRAME-STOR
   IF FILL-IN-HSPKUND = 0 THEN DO:
      IF FILL-IN-LSPKUND = 0 THEN DO:
         felkontroll = TRUE.
         IF skapa = FALSE THEN DO:
            MESSAGE "Både HSP- och LSP-antal kan ej vara 0."
            VIEW-AS ALERT-BOX TITLE "Meddelande".
            RAD_KS = 2.
            /*
            DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
            */
            APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.
            APPLY "ENTRY" TO FILL-IN-LSPKUND IN FRAME {&FRAME-NAME}.
            RETURN.         
         END.
      END.
   END. 
   IF TOG_70 = TRUE THEN DO:  
      IF FILL-IN-SLUTDAT >= FILL-IN-STARTDAT THEN DO:
         IF FILL-IN-SISTDAT >= FILL-IN-SLUTDAT THEN DO:
            IF FILL-IN-SLUTDAT = FILL-IN-STARTDAT THEN DO:
               IF FILL-IN-SLUT > FILL-IN-START THEN DO:
                  IF FILL-IN-SISTDAT = FILL-IN-SLUTDAT THEN DO:
                     IF FILL-IN-SIST > FILL-IN-SLUT THEN DO:
                        musz = musz.
                     END.
                     ELSE DO:
                         musz = musz.
                         
                        felkontroll = TRUE.
                        IF skapa = FALSE THEN DO:
                           MESSAGE "Tidpunkt för sistakund måste vara större än huvuddel tillkopplad."
                           VIEW-AS ALERT-BOX TITLE "Meddelande".   
                           RAD_KS = 2.
                                /*
                           DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
                           */
                           APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.
                           APPLY "ENTRY" TO FILL-IN-SIST IN FRAME {&FRAME-NAME}.
                           RETURN.
                                  
                        END.   
                     END.
                  END.                 
               END.
               ELSE DO:
                  felkontroll = TRUE.
                  IF skapa = FALSE THEN DO:
                     MESSAGE "Tidpunkt för huvuddel tillkopplad måste vara större än start."
                     VIEW-AS ALERT-BOX TITLE "Meddelande".   
                     RAD_KS = 2.
                     /*
                     DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
                     */
                     APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.
                     APPLY "ENTRY" TO FILL-IN-SLUT IN FRAME {&FRAME-NAME}.
                     RETURN.         
                  END.   
               END.
            END.
            ELSE DO:
               IF FILL-IN-SISTDAT = FILL-IN-SLUTDAT THEN DO:
                  IF FILL-IN-SIST > FILL-IN-SLUT THEN DO:
                     musz = musz.
                  END.
                  ELSE DO:
                         
                     felkontroll = TRUE.
                     IF skapa = FALSE THEN DO:
                        MESSAGE "Tidpunkt för sistakund måste vara större än huvuddel tillkopplad."
                        VIEW-AS ALERT-BOX TITLE "Meddelande".
                        RAD_KS = 2.
                        /*
                        DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
                        */
                        APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.
                        APPLY "ENTRY" TO FILL-IN-SIST IN FRAME {&FRAME-NAME}.
                        RETURN.         
                     END.
                        
                  END.
               END.             
            END.
         END.
         ELSE DO:
            felkontroll = TRUE.
            IF skapa = FALSE THEN DO:
               MESSAGE "Datum för sista kund tillkopplad måste vara större än eller lika med huvuddel tillkopplad."
               VIEW-AS ALERT-BOX TITLE "Meddelande".
               RAD_KS = 2.
               /*
               DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
               */
               APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.
               APPLY "ENTRY" TO FILL-IN-SISTDAT IN FRAME {&FRAME-NAME}.
               RETURN.         
            END.   
         END.
      END.
      ELSE DO:
         felkontroll = TRUE.
         IF skapa = FALSE THEN DO:
            MESSAGE "Datum för huvuddel tillkopplad måste vara större än eller lika med startdatum."
            VIEW-AS ALERT-BOX TITLE "Meddelande".         
            RAD_KS = 2.
            /*
            DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
            */
            APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.
            APPLY "ENTRY" TO FILL-IN-SLUTDAT IN FRAME {&FRAME-NAME}.
            RETURN.      
         END.   
      END.
   END.
   ELSE DO:
      IF FILL-IN-SISTDAT >= FILL-IN-STARTDAT THEN DO:
         IF FILL-IN-SISTDAT = FILL-IN-STARTDAT THEN DO:
            IF FILL-IN-SIST <= FILL-IN-START THEN DO:               
               felkontroll = TRUE.
               IF skapa = FALSE THEN DO:
                  MESSAGE "Tidpunkt för sistakund måste vara större än start."
                  VIEW-AS ALERT-BOX TITLE "Meddelande".            
                  RAD_KS = 2.
                  /*
                  DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
                  */
                  APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.
                  APPLY "ENTRY" TO FILL-IN-SIST IN FRAME {&FRAME-NAME}.
                  RETURN.         
               END.
            END.
         END.      
      END.
      ELSE DO:
         felkontroll = TRUE.
         IF skapa = FALSE THEN DO:
            MESSAGE "Datum för sista kund tillkopplad måste vara större än eller lika med startdatum."
            VIEW-AS ALERT-BOX TITLE "Meddelande".         
            RAD_KS = 2.
            /*
            DISPLAY RAD_KS WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
            */
            APPLY "VALUE-CHANGED" TO RAD_KS IN FRAME DEFAULT-FRAME.
            APPLY "ENTRY" TO FILL-IN-SISTDAT IN FRAME {&FRAME-NAME}.
            RETURN.      
         END.   
      END.
   END.   
   &Scoped-define FRAME-NAME DEFAULT-FRAME
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE ksvalchange_UI C-Win 
PROCEDURE ksvalchange_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   DEFINE INPUT PARAMETER ksval AS INTEGER NO-UNDO.
   FRAME FRAME-STOR:VISIBLE = FALSE.
   FRAME FRAME-KUND:VISIBLE = FALSE.
   IF ksval = 1 THEN DO:           
      RUN nyandkund_UI (INPUT ksval).
      FRAME FRAME-KUND:VISIBLE = TRUE.
      BRW_ANL:HIDDEN IN FRAME FRAME-STOR = FALSE.      
   END.
   ELSE IF ksval = 2 THEN DO:
      FRAME FRAME-STOR:VISIBLE = TRUE.
      BRW_FEL:HIDDEN IN FRAME FRAME-STOR = TRUE. 
   END.
   ELSE DO:
   END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE nyandkund_UI C-Win 
PROCEDURE nyandkund_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   &Scoped-define FRAME-NAME FRAME-KUND
   DEFINE INPUT PARAMETER ksval AS INTEGER NO-UNDO.
   IF ksval = 1 THEN DO:
      IF ny = FALSE THEN DO:
         ASSIGN
         CMB_FOR:HIDDEN IN FRAME {&FRAME-NAME} = TRUE
         CMB_AR:HIDDEN IN FRAME {&FRAME-NAME} = FALSE /*TRUE*/
         CMB_OMR:HIDDEN IN FRAME {&FRAME-NAME} = FALSE /*TRUE*/
         RAD_VAL:HIDDEN IN FRAME {&FRAME-NAME} = FALSE /*TRUE*/
         FILL-IN-FORETAG:HIDDEN IN FRAME {&FRAME-NAME} = FALSE
         FILL-IN-DISTRIKT:HIDDEN IN FRAME {&FRAME-NAME} = TRUE /*FALSE*/
         FILL-IN-TYP:HIDDEN IN FRAME {&FRAME-NAME} = TRUE. /*FALSE.*/
/*          DISABLE FILL-IN-TYP. */
         IF extrastorntemp.STORTYPID = 1 THEN FILL-IN-TYP = "Driftstörning".
         ELSE FILL-IN-TYP = "Planerat avbrott".
/*          DISPLAY FILL-IN-TYP WITH FRAME {&FRAME-NAME}. */
         IF extrastorntemp.MERJOBB = TRUE THEN DO:
            ASSIGN            
            FILL-IN-FDAT:HIDDEN IN FRAME {&FRAME-NAME} = TRUE
            BTN_MINDAT2:HIDDEN IN FRAME {&FRAME-NAME} = TRUE
            BTN_UPDAT2:HIDDEN IN FRAME {&FRAME-NAME} = TRUE.
         END.
      END.
      ELSE DO:
         ASSIGN
         CMB_FOR:HIDDEN IN FRAME {&FRAME-NAME} = FALSE
         CMB_AR:HIDDEN IN FRAME {&FRAME-NAME} = FALSE
         CMB_OMR:HIDDEN IN FRAME {&FRAME-NAME} = FALSE
         RAD_VAL:HIDDEN IN FRAME {&FRAME-NAME} = FALSE
         FILL-IN-FORETAG:HIDDEN IN FRAME {&FRAME-NAME} = TRUE
         FILL-IN-DISTRIKT:HIDDEN IN FRAME {&FRAME-NAME} = TRUE
         FILL-IN-TYP:HIDDEN IN FRAME {&FRAME-NAME} = TRUE.
      END.
   END.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE taborder_UI C-Win 
PROCEDURE taborder_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   IF SELF:NAME = "RAD_KS" THEN DO:
      ASSIGN
      BTN_OK:TAB-STOP IN FRAME DEFAULT-FRAME = FALSE
      BTN_AVB:TAB-STOP IN FRAME DEFAULT-FRAME = FALSE
      BTN_OK:TAB-STOP IN FRAME DEFAULT-FRAME = TRUE
      BTN_AVB:TAB-STOP IN FRAME DEFAULT-FRAME = TRUE.
   END.
   ELSE IF SELF:NAME = "BRW_ANL" OR SELF:NAME = "FILL-IN_SFORNAMN" OR 
      SELF:NAME = "BRW_FEL" THEN DO:
      ASSIGN
      BTN_OK:TAB-STOP IN FRAME DEFAULT-FRAME = FALSE
      BTN_AVB:TAB-STOP IN FRAME DEFAULT-FRAME = FALSE
      BTN_OK:TAB-STOP IN FRAME DEFAULT-FRAME = TRUE
      BTN_AVB:TAB-STOP IN FRAME DEFAULT-FRAME = TRUE.
   END.                                             
   ELSE IF SELF:NAME = "RAD_VAL" OR SELF:NAME = "FILL-IN-ANMALARE" OR 
      SELF:NAME = "CMB_SYS" THEN DO:
      ASSIGN
      BTN_OK:TAB-STOP IN FRAME DEFAULT-FRAME = FALSE
      BTN_AVB:TAB-STOP IN FRAME DEFAULT-FRAME = FALSE.
   END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE utvald_UI C-Win 
PROCEDURE utvald_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   &Scoped-define FRAME-NAME FRAME-KUND
   CMB_OMR = INPUT FRAME {&FRAME-NAME} CMB_OMR.
   FIND FIRST stordistemp WHERE stordistemp.NAMN = CMB_OMR AND
   stordistemp.ARTAL = sistartal AND stordistemp.AVDELNINGNR = forvar NO-LOCK NO-ERROR.
   distvar = stordistemp.DISTRIKTID.
   &Scoped-define FRAME-NAME DEFAULT-FRAME
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

/* ************************  Function Implementations ***************** */

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _FUNCTION klockan100 C-Win 
FUNCTION klockan100 RETURNS DECIMAL
  (INPUT ber60 AS DECIMAL) :
/*------------------------------------------------------------------------------
  Purpose:  
    Notes:  
------------------------------------------------------------------------------*/
  RETURN  (TRUNCATE(ber60,0) * 3600 + (ber60 - TRUNCATE(ber60,0)) * 100 * 60) / 3600. 
END FUNCTION.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _FUNCTION klockan60 C-Win 
FUNCTION klockan60 RETURNS DECIMAL
  (INPUT ber100 AS DECIMAL) :
/*------------------------------------------------------------------------------
  Purpose:  
    Notes:  
------------------------------------------------------------------------------*/
  RETURN TRUNCATE(ber100,0) + ((ber100 - TRUNCATE(ber100,0)) / 100) * 60.
END FUNCTION.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

