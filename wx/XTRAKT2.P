DEFINE VARIABLE arrhjsum LIKE TIDREGITAB.BERANTAL NO-UNDO.    
DEFINE VARIABLE counter AS INTEGER NO-UNDO.

DEFINE TEMP-TABLE dagtemp
   FIELD DATUM LIKE TIDREGITAB.DATUM
   FIELD AONR LIKE TIDREGITAB.AONR
   FIELD DELNR LIKE TIDREGITAB.DELNR 
   FIELD PERSONALKOD LIKE TIDREGITAB.PERSONALKOD 
   FIELD NAMN AS CHARACTER FORMAT "X(5)"
   FIELD GEOMRADE LIKE SUMTID.GEOMRADE 
   FIELD OMRADE LIKE SUMTID.OMRADE 
   FIELD TIMMAR LIKE EKRAPPRESULT.EANTAL LABEL "TIMMAR"  
   FIELD OTIMMAR LIKE EKRAPPRESULT.EANTAL LABEL "OTIMMAR"         
   FIELD BELOPP LIKE EKRAPPRESULT.EBELOPP LABEL "ARBKOSTNAD"           
   FIELD OBELOPP LIKE EKRAPPRESULT.EBELOPP LABEL "™-KOSTNAD"  
   FIELD TBELOPP LIKE EKRAPPRESULT.EBELOPP LABEL "T-KOSTNAD"
   FIELD LONKOST LIKE EKRAPPRESULT.EBELOPP LABEL "L-KOSTNAD"        
   INDEX AONR IS PRIMARY AONR DELNR.             
   
DEFINE TEMP-TABLE dagtemp2
   FIELD DATUM LIKE TIDREGITAB.DATUM
   FIELD AONR LIKE TIDREGITAB.AONR
   FIELD DELNR LIKE TIDREGITAB.DELNR 
   FIELD PERSONALKOD LIKE TIDREGITAB.PERSONALKOD 
   FIELD NAMN AS CHARACTER FORMAT "X(5)"
   FIELD GEOMRADE LIKE SUMTID.GEOMRADE 
   FIELD OMRADE LIKE SUMTID.OMRADE 
   FIELD TIMMAR LIKE EKRAPPRESULT.EANTAL LABEL "TIMMAR"  
   FIELD OTIMMAR LIKE EKRAPPRESULT.EANTAL LABEL "OTIMMAR"         
   FIELD BELOPP LIKE EKRAPPRESULT.EBELOPP LABEL "ARBKOSTNAD"           
   FIELD OBELOPP LIKE EKRAPPRESULT.EBELOPP LABEL "™-KOSTNAD"  
   FIELD TBELOPP LIKE EKRAPPRESULT.EBELOPP LABEL "T-KOSTNAD"
   FIELD LONKOST LIKE EKRAPPRESULT.EBELOPP LABEL "L-KOSTNAD"        
   INDEX AONR IS PRIMARY AONR DELNR.   

DEFINE QUERY sumq FOR SUMTIDDAG.


OPEN QUERY sumq FOR EACH SUMTIDDAG WHERE YEAR(SUMTIDDAG.DATUM) = 1997 AND
SUMTIDDAG.VECKOKORD NE " " AND SUMTIDDAG.TBELOPP NE 0 USE-INDEX AONR NO-LOCK.
GET FIRST sumq NO-LOCK.
DO WHILE AVAILABLE(SUMTIDDAG) TRANSACTION:             
   CREATE dagtemp.
   ASSIGN        
   dagtemp.AONR = SUMTIDDAG.AONR
   dagtemp.DELNR = SUMTIDDAG.DELNR
   dagtemp.PERSONALKOD = SUMTIDDAG.PERSONALKOD
   dagtemp.OMRADE = SUMTIDDAG.OMRADE
   dagtemp.TBELOPP = SUMTIDDAG.TBELOPP.
   GET NEXT sumq NO-LOCK.
END.                          
CLOSE QUERY sumq.         

arrhjsum = 0.
FOR EACH dagtemp
   BREAK BY dagtemp.AONR BY dagtemp.DELNR BY dagtemp.OMRADE BY dagtemp.PERSONALKOD: 
   ACCUMULATE 
   dagtemp.TBELOPP (TOTAL BY dagtemp.AONR BY dagtemp.DELNR 
   BY dagtemp.OMRADE BY dagtemp.PERSONALKOD).         
   IF LAST-OF(dagtemp.PERSONALKOD) THEN DO TRANSACTION:
      CREATE dagtemp2.
      ASSIGN   
      dagtemp2.AONR = dagtemp.AONR
      dagtemp2.DELNR = dagtemp.DELNR      
      dagtemp2.PERSONALKOD = dagtemp.PERSONALKOD      
      dagtemp2.OMRADE = dagtemp.OMRADE                       
      dagtemp2.TBELOPP = (ACCUM TOTAL dagtemp.TBELOPP) - arrhjsum            
      arrhjsum = ACCUM TOTAL dagtemp.TBELOPP.                       
   END.                                                   
END. 

counter = 0.

FOR EACH dagtemp2: 
   counter = counter + 1.
END.

DISPLAY counter WITH FRAME C1.
PAUSE.