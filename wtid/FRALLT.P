/*FRALLT.P*/
&Scoped-define NEW NEW
{FRDELTEMP.I}
DEFINE INPUT PARAMETER vadgora AS INTEGER NO-UNDO.
DEFINE INPUT-OUTPUT PARAMETER prec AS INTEGER NO-UNDO.
DEFINE INPUT-OUTPUT PARAMETER TABLE FOR frdeltemp.
/*HÄMTA ALLA*/
IF vadgora = 0 THEN DO:
   OPEN QUERY frq FOR EACH FRDEL NO-LOCK. 
   GET FIRST frq NO-LOCK.
   DO WHILE AVAILABLE(FRDEL):
      CREATE frdeltemp.
      BUFFER-COPY FRDEL TO frdeltemp.
      frdeltemp.RECIDVIS = RECID(FRDEL).
      FIND FIRST PERSONALTAB WHERE PERSONALTAB.PERSONALKOD = FRDEL.PERSONALKOD NO-LOCK NO-ERROR.
      IF AVAILABLE PERSONALTAB THEN DO:
         ASSIGN frdeltemp.FORNAMN = PERSONALTAB.FORNAMN
         frdeltemp.EFTERNAMN  = PERSONALTAB.EFTERNAMN.
      END.
      GET NEXT frq NO-LOCK.
   END.
END.
/*NY*/
IF vadgora = 1 THEN DO TRANSACTION:
   FIND FIRST frdeltemp WHERE frdeltemp.RECIDVIS = prec NO-ERROR.
   CREATE FRDEL.
   BUFFER-COPY frdeltemp TO FRDEL.
   
   ASSIGN 
   prec = RECID(FRDEL)
   frdeltemp.RECIDVIS = RECID(FRDEL).
   FIND FIRST PERSONALTAB WHERE PERSONALTAB.PERSONALKOD = FRDEL.PERSONALKOD NO-LOCK NO-ERROR.
   IF AVAILABLE PERSONALTAB THEN DO:
      ASSIGN frdeltemp.FORNAMN = PERSONALTAB.FORNAMN
      frdeltemp.EFTERNAMN  = PERSONALTAB.EFTERNAMN.
   END.
END.
/*ÄNDRA*/
IF vadgora = 2 THEN DO TRANSACTION:
   FIND FIRST frdeltemp WHERE frdeltemp.RECIDVIS = prec NO-ERROR.
   FIND FIRST FRDEL WHERE RECID(FRDEL) = prec EXCLUSIVE-LOCK NO-ERROR.
   BUFFER-COPY frdeltemp TO FRDEL.
   frdeltemp.RECIDVIS = RECID(FRDEL).
END.
IF vadgora = 3 THEN DO TRANSACTION:
   FIND FIRST frdeltemp WHERE frdeltemp.RECIDVIS = prec NO-ERROR.
   DELETE frdeltemp.
   FIND FIRST FRDEL WHERE RECID(FRDEL) = prec EXCLUSIVE-LOCK NO-ERROR.
   DELETE FRDEL.
END.
