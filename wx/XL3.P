FOR EACH SUMTIDDAG WHERE SUMTIDDAG.VECKOKORD NE "" NO-LOCK BREAK 
BY YEAR(SUMTIDDAG.DATUM) BY SUMTIDDAG.PERSONALKOD BY SUMTIDDAG.AONR BY SUMTIDDAG.DELNR 
BY SUMTIDDAG.PRISTYP BY SUMTIDDAG.OMRADE :
ACCUMULATE SUMTIDDAG.TIMMAR (TOTAL 
   BY YEAR(SUMTIDDAG.DATUM) BY SUMTIDDAG.PERSONALKOD BY SUMTIDDAG.AONR BY SUMTIDDAG.DELNR 
   BY SUMTIDDAG.PRISTYP BY SUMTIDDAG.OMRADE ). 
   ACCUMULATE SUMTIDDAG.BELOPP (TOTAL 
   BY YEAR(SUMTIDDAG.DATUM) BY SUMTIDDAG.PERSONALKOD BY SUMTIDDAG.AONR BY SUMTIDDAG.DELNR 
   BY SUMTIDDAG.PRISTYP BY SUMTIDDAG.OMRADE ).
   ACCUMULATE SUMTIDDAG.OTIMMAR (TOTAL 
   BY YEAR(SUMTIDDAG.DATUM) BY SUMTIDDAG.PERSONALKOD BY SUMTIDDAG.AONR BY SUMTIDDAG.DELNR 
   BY SUMTIDDAG.PRISTYP BY SUMTIDDAG.OMRADE ).
   ACCUMULATE SUMTIDDAG.OBELOPP (TOTAL 
   BY YEAR(SUMTIDDAG.DATUM) BY SUMTIDDAG.PERSONALKOD BY SUMTIDDAG.AONR BY SUMTIDDAG.DELNR 
   BY SUMTIDDAG.PRISTYP BY SUMTIDDAG.OMRADE ).
   ACCUMULATE SUMTIDDAG.TBELOPP (TOTAL 
   BY YEAR(SUMTIDDAG.DATUM) BY SUMTIDDAG.PERSONALKOD BY SUMTIDDAG.AONR BY SUMTIDDAG.DELNR 
   BY SUMTIDDAG.PRISTYP BY SUMTIDDAG.OMRADE ).
   ACCUMULATE SUMTIDDAG.LONKOST (TOTAL 
   BY YEAR(SUMTIDDAG.DATUM) BY SUMTIDDAG.PERSONALKOD BY SUMTIDDAG.AONR BY SUMTIDDAG.DELNR    
   BY SUMTIDDAG.PRISTYP BY SUMTIDDAG.OMRADE ).
   ACCUMULATE SUMTIDDAG.IKOSTNAD (TOTAL 
   BY YEAR(SUMTIDDAG.DATUM) BY SUMTIDDAG.PERSONALKOD BY SUMTIDDAG.AONR BY SUMTIDDAG.DELNR 
   BY SUMTIDDAG.PRISTYP BY SUMTIDDAG.OMRADE ).         
      IF LAST-OF(SUMTIDDAG.OMRADE) THEN DO:
         DO TRANSACTION:
           FIND FIRST SUMTID WHERE 
           YEAR(SUMTID.DATUM) = YEAR(SUMTIDDAG.DATUM) AND 
           SUMTID.PERSONALKOD = SUMTIDDAG.PERSONALKOD AND 
           SUMTID.AONR = SUMTIDDAG.AONR AND
           SUMTID.DELNR = SUMTIDDAG.DELNR AND 
           SUMTID.PRISTYP = SUMTIDDAG.PRISTYP AND
           SUMTID.OMRADE = SUMTIDDAG.OMRADE AND 
           SUMTID.VECKOKORD NE "" EXCLUSIVE-LOCK NO-ERROR.
           IF NOT AVAILABLE SUMTID THEN CREATE SUMTID.
                    
            ASSIGN
            SUMTID.VECKOKORD = SUMTIDDAG.VECKOKORD
            SUMTID.AUTODATUM = SUMTIDDAG.AUTODATUM
            SUMTID.PERSONALKOD = SUMTIDDAG.PERSONALKOD
            SUMTID.AONR = SUMTIDDAG.AONR 
            SUMTID.DELNR = SUMTIDDAG.DELNR 
            SUMTID.FORNAMN = SUMTIDDAG.FORNAMN
            SUMTID.EFTERNAMN = SUMTIDDAG.EFTERNAMN
            SUMTID.GEOMRADE = SUMTIDDAG.GEOMRADE
            SUMTID.OMRADE = SUMTIDDAG.OMRADE 
            SUMTID.ORT = SUMTIDDAG.ORT
            SUMTID.BEFATTNING = SUMTIDDAG.BEFATTNING 
            SUMTID.PERSMASK = SUMTIDDAG.PERSMASK
            SUMTID.DATUM = DATE(01,01,YEAR(SUMTIDDAG.DATUM))  
            SUMTID.FASTAAONR = SUMTIDDAG.FASTAAONR 
            SUMTID.PRISTYP = SUMTIDDAG.PRISTYP 
            SUMTID.PRIS = SUMTIDDAG.PRIS 
            SUMTID.PRISI = SUMTIDDAG.PRISI  				 
            SUMTID.TIMMAR = SUMTID.TIMMAR + (ACCUM TOTAL BY SUMTIDDAG.OMRADE SUMTIDDAG.TIMMAR)
            SUMTID.BELOPP  = SUMTID.BELOPP + (ACCUM TOTAL BY SUMTIDDAG.OMRADE SUMTIDDAG.BELOPP) 
            SUMTID.OTIMMAR = SUMTID.OTIMMAR + (ACCUM TOTAL BY SUMTIDDAG.OMRADE SUMTIDDAG.OTIMMAR)
            SUMTID.OBELOPP = SUMTID.OBELOPP + (ACCUM TOTAL BY SUMTIDDAG.OMRADE SUMTIDDAG.OBELOPP)
            SUMTID.TBELOPP = SUMTID.TBELOPP + (ACCUM TOTAL BY SUMTIDDAG.OMRADE SUMTIDDAG.TBELOPP)  
            SUMTID.LONKOST = SUMTID.LONKOST + (ACCUM TOTAL BY SUMTIDDAG.OMRADE SUMTIDDAG.LONKOST) 
            SUMTID.IKOSTNAD = SUMTID.IKOSTNAD + (ACCUM TOTAL BY SUMTIDDAG.OMRADE SUMTIDDAG.IKOSTNAD).
         END.                            
      END.   
   END.   


