&Scoped-define NEW   NEW
&Scoped-define SHARED SHARED

DEFINE NEW SHARED VARIABLE globforetag LIKE FORETAG.FORETAG NO-UNDO.
DEFINE NEW SHARED VARIABLE vkdatum AS DATE NO-UNDO.
DEFINE NEW SHARED VARIABLE gvisatidpermanad AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE man AS INTEGER FORMAT "99" NO-UNDO.
DEFINE NEW SHARED VARIABLE globanv LIKE ANVANDARE.ANVANDARE NO-UNDO.
DEF VAR A AS INTEGER NO-UNDO.
 
DEFINE  VARIABLE appcon AS LOGICAL NO-UNDO.
DEFINE BUFFER A FOR BERMTRL.
FIND FIRST FORETAG USE-INDEX FORETAG NO-LOCK NO-ERROR.
globforetag = FORETAG.FORETAG.
CREATE ALIAS RT9 FOR DATABASE VALUE(LDBNAME(1)) NO-ERROR.
{CONAPP.I}

IF globforetag = "gkal" THEN DO:
   OUTPUT TO \\goliat\DELAD\server\PRO9S\gkal\BERDUBGKAL.TXT.
END.
IF globforetag = "gran" THEN DO:
   OUTPUT TO \\GRANGURU\guru_ser\server\PRO9S\gran\BERDUBGran.TXT.
END.
IF globforetag = "lule" THEN DO:
   OUTPUT TO D:\elpool\DELAD\PRO9s\BERDUBlule.TXT.
END.
IF globforetag = "elpa" THEN DO:
   OUTPUT TO \\pc012\d\delad\pro9s\korning\BERDUBelpa.TXT.
END.
FOR EACH BERMTRL WHERE  BERMTRL.INKOP = FALSE AND
BERMTRL.DATUM GE 01/01/2005  NO-LOCK BY aonr BY omrade BY num BY SKAPNUM BY enr:
   
   FIND FIRST A WHERE A.AONR = BERMTRL.AONR 
   AND A.OMRADE = BERMTRL.OMRADE 
   AND A.num = BERMTRL.num 
   AND A.SKAPNUM = BERMTRL.SKAPNUM 
   AND A.enr = BERMTRL.enr 
   AND A.INKOP = BERMTRL.INKOP
   AND A.DATUM = BERMTRL.DATUM
   AND A.DATUM = BERMTRL.DATUM
   AND A.LEVKOD = BERMTRL.LEVKOD
   AND RECID(A) NE RECID(BERMTRL) NO-LOCK NO-ERROR.
   IF AVAILABLE A THEN DO:
      
      DISP A.aonr A.omrade A.num A.SKAPNUM A.enr A.antal A.datum .
      /*DISP BERMTRL.aonr BERMTRL.omrade BERMTRL.num BERMTRL.SKAPNUM BERMTRL.enr BERMTRL.antal BERMTRL.datum .*/
   END.
   
END.
OUTPUT CLOSE.
