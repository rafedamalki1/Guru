DEFINE VARIABLE CC LIKE FAKTTID.FAKTNR.
DEFINE BUFFER FAKTBUFF FOR FAKTTID.
OPEN QUERY FQ FOR EACH FAKTTID NO-LOCK.
GET FIRST FQ NO-LOCK.
DO WHILE AVAILABLE(FAKTTID):
   IF FAKTTID.FAKTNR >= 21 THEN DO TRANSACTION:
    FIND FIRST FAKTBUFF WHERE RECID(FAKTBUFF) NE RECID(FAKTTID) AND
    FAKTBUFF.AONR 	= FAKTTID.AONR 
    AND FAKTBUFF.BEFATTNING 	    = FAKTTID.BEFATTNING 
    AND FAKTBUFF.BELOPP 	    = FAKTTID.BELOPP 
    AND FAKTBUFF.DATUM 	    = FAKTTID.DATUM 
    AND FAKTBUFF.DECRESTID 	    = FAKTTID.DECRESTID 
    AND FAKTBUFF.DELNR 	    = FAKTTID.DELNR 
    AND FAKTBUFF.ENDAGS 	    = FAKTTID.ENDAGS 
    AND FAKTBUFF.FAKTNR 	    = FAKTTID.FAKTNR 
    AND FAKTBUFF.FDELNR 	    = FAKTTID.FDELNR 
    AND FAKTBUFF.GSLUT 	    = FAKTTID.GSLUT 
    AND FAKTBUFF.GSTART 	    = FAKTTID.GSTART 
    AND FAKTBUFF.KOSTBELOPP 	    = FAKTTID.KOSTBELOPP 
    AND FAKTBUFF.LONKOST 	    = FAKTTID.LONKOST 
    AND FAKTBUFF.LONTILLAGG 	    = FAKTTID.LONTILLAGG 
    AND FAKTBUFF.LONTILLANTAL 	    = FAKTTID.LONTILLANTAL 
    AND FAKTBUFF.LUNCH 	    = FAKTTID.LUNCH 
    AND FAKTBUFF.MED 	    = FAKTTID.MED 
    AND FAKTBUFF.MTRLKOST 	    = FAKTTID.MTRLKOST 
    AND FAKTBUFF.NAMN 	    = FAKTTID.NAMN 
    AND FAKTBUFF.OANT1 	    = FAKTTID.OANT1 
    AND FAKTBUFF.OBELOPP 	    = FAKTTID.OBELOPP 
    AND FAKTBUFF.OPRIS 	    = FAKTTID.OPRIS 
    AND FAKTBUFF.OTEXTID 	    = FAKTTID.OTEXTID 
    AND FAKTBUFF.OTIMMAR 	    = FAKTTID.OTIMMAR 
    AND FAKTBUFF.OVRKOST 	    = FAKTTID.OVRKOST 
    AND FAKTBUFF.PERSMASK 	    = FAKTTID.PERSMASK 
    AND FAKTBUFF.PERSONALKOD	    = FAKTTID.PERSONALKOD
    AND FAKTBUFF.PRISA 	    = FAKTTID.PRISA 
    AND FAKTBUFF.PRISTYP 	    = FAKTTID.PRISTYP 
    AND FAKTBUFF.RESKOST 	    = FAKTTID.RESKOST 
    AND FAKTBUFF.RESKOSTDEC 	    = FAKTTID.RESKOSTDEC 
    AND FAKTBUFF.RESPRIS 	    = FAKTTID.RESPRIS 
    AND FAKTBUFF.RESTIM 	    = FAKTTID.RESTIM 
    AND FAKTBUFF.SENASTFAK 	    = FAKTTID.SENASTFAK 
    AND FAKTBUFF.SENASTTID 	    = FAKTTID.SENASTTID 
    AND FAKTBUFF.SLUT 	    = FAKTTID.SLUT 
    AND FAKTBUFF.START 	    = FAKTTID.START 
    AND FAKTBUFF.TBELOPP 	    = FAKTTID.TBELOPP 
    AND FAKTBUFF.TIMMAR 	    = FAKTTID.TIMMAR 
    AND FAKTBUFF.TOTPRIS 	    = FAKTTID.TOTPRIS 
    AND FAKTBUFF.TRAKTANTAL 	    = FAKTTID.TRAKTANTAL 
    AND FAKTBUFF.TRAKTKOD 	    = FAKTTID.TRAKTKOD 
    AND FAKTBUFF.VECKOKORD 	    = FAKTTID.VECKOKORD 
    AND FAKTBUFF.VFAKTNR	= FAKTTID.VFAKTNR

    EXCLUSIVE-LOCK NO-ERROR.
    IF AVAILABLE FAKTBUFF THEN DELETE  FAKTBUFF.   
   END.
   GET NEXT FQ NO-LOCK.
END.
