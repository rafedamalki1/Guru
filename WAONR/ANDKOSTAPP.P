/*ANDKOSTAPP.P*/
&Scoped-define NEW NEW
&Scoped-define SHARED SHARED
{GLOBVAR2DEL1.I}
{REGVAR.I}

{LEVTEMP.I}
{KOSTREG.I}
{LEVTEMPORDNINGFUNC.I}
PROCEDURE ladda.
   DEFINE OUTPUT PARAMETER TABLE FOR levtemp.
   EMPTY TEMP-TABLE levtemp NO-ERROR.    
   OPEN QUERY lq FOR EACH LEVERANTOR NO-LOCK.
   GET FIRST lq NO-LOCK.
   DO WHILE AVAILABLE(LEVERANTOR):
      CREATE levtemp.
      BUFFER-COPY LEVERANTOR TO levtemp.
      {LEVTEMPORDNING.I}
      GET NEXT lq NO-LOCK.
   END.
   CLOSE QUERY lq.
   RETURN.
END PROCEDURE.

PROCEDURE btnok.
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER rad AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER anv AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER TABLE FOR kostregtemp.
   FIND FIRST kostregtemp WHERE kostregtemp.AONR = aonrvar AND
   kostregtemp.DELNR = delnrvar AND kostregtemp.RADNR = rad NO-LOCK NO-ERROR.
   IF AVAILABLE kostregtemp THEN DO:
      DO TRANSACTION:  
         FIND FIRST KOSTREG WHERE KOSTREG.AONR = aonrvar AND 
         KOSTREG.DELNR = delnrvar AND KOSTREG.RADNR = rad EXCLUSIVE-LOCK NO-ERROR.      
         IF NOT AVAILABLE KOSTREG THEN DO:
            CREATE KOSTREG.
         END.
         ASSIGN 
         KOSTREG.AONR = kostregtemp.AONR
         KOSTREG.DELNR = kostregtemp.DELNR
         KOSTREG.INKOMST = kostregtemp.INKOMST
         KOSTREG.BENAMNING = kostregtemp.BENAMNING 
         KOSTREG.BOKKONTO = kostregtemp.BOKKONTO
         KOSTREG.FAKTNR = kostregtemp.FAKTNR
         KOSTREG.LEVKOD = kostregtemp.LEVKOD 
         KOSTREG.MASKKOST = kostregtemp.MASKKOST 
         KOSTREG.MOMS = kostregtemp.MOMS 
         KOSTREG.MTRL = kostregtemp.MTRL 
         KOSTREG.OVRKR = kostregtemp.OVRKR 
         KOSTREG.PERSKOST = kostregtemp.PERSKOST 
         KOSTREG.BETDATUM = kostregtemp.BETDATUM
         KOSTREG.REGDATUM  = kostregtemp.REGDATUM
         KOSTREG.TRAKTKOST  = kostregtemp.TRAKTKOST
         KOSTREG.FAKTURERAD = kostregtemp.FAKTURERAD 
         KOSTREG.KOSTAUTO = kostregtemp.KOSTAUTO
         KOSTREG.RADNR = kostregtemp.RADNR
         SUBSTRING(KOSTREG.ANVANDARE,1,12) = anv.
         IF KOSTREG.BETDATUM = ? THEN KOSTREG.BETDATUM = TODAY.
      END.
      RELEASE KOSTREG NO-ERROR.
   END.
END PROCEDURE.
