
/*------------------------------------------------------------------------
    File        : XUPPDATTIDPRIS.P
    Purpose     : 

    Syntax      :

    Description : BEFATTNINGSTAB TIMKOSTNADSTAB TIDLOG 

    Author(s)   :UPPDATER TIDREGITAB OM PRISLISTAN ÄR FÖR SENT INLAGD 
    Created     : Tue Feb 02 10:29:00 CET 2021
    Notes       :
  ----------------------------------------------------------------------*/

/* ***************************  Definitions  ************************** */
DEFINE VARIABLE listdatum AS DATE NO-UNDO.

listdatum = 04/01/2022.

/*OUTPUT TO d:\delad\prisfel.txt.*/
FOR EACH TIDREGITAB WHERE TIDREGITAB.DATUM >=  listdatum AND TIDREGITAB.TIDLOG  = TRUE AND TIDREGITAB.PRIS > 0 EXCLUSIVE-LOCK BY TIDREGITAB.OVERTIDTILL: 
   FIND FIRST PERSONALPRIS WHERE PERSONALPRIS.STARTDATUM >= listdatum AND PERSONALPRIS.BEFATTNING = TIDREGITAB.OVERTIDTILL AND
   PERSONALPRIS.PERSONALKOD = TIDREGITAB.PERSONALKOD NO-LOCK NO-ERROR.
   IF AVAILABLE PERSONALPRIS THEN DO:
      /*PUT UNFORMATTED TIDREGITAB.PERSONALKOD " " TIDREGITAB.OVERTIDTILL FORMAT "x(12)" " " TIDREGITAB.DATUM " " TIDREGITAB.PRISTYP " " TIDREGITAB.pris " " PERSONALPRIS.PRIS  SKIP.*/
      TIDREGITAB.PRIS = PERSONALPRIS.PRIS.
   END.
END.
/*OUTPUT CLOSE.*/