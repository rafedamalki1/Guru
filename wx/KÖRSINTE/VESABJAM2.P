/*VESABJAM2.P*/
DEFINE TEMP-TABLE kon_temp 
   FIELD KONSKOD AS INTEGER
   FIELD KTYPKOD AS CHARACTER
   FIELD ENR AS CHARACTER
   FIELD BENAMNING AS CHARACTER
   FIELD F1 AS CHARACTER
   FIELD F2 AS CHARACTER
   FIELD F3 AS CHARACTER
   FIELD F4 AS CHARACTER
   FIELD F5 AS CHARACTER
   FIELD FORETAG AS CHARACTER.

DEFINE INPUT-OUTPUT PARAMETER TABLE FOR kon_temp.
DEFINE INPUT PARAMETER valfore AS CHARACTER.
DEFINE VARIABLE felexcel AS LOGICAL NO-UNDO.
OPEN QUERY GQ FOR EACH KONSTGRUPP NO-LOCK.
GET FIRST GQ NO-LOCK.
DO WHILE AVAILABLE(KONSTGRUPP):   
   OPEN QUERY KQ FOR EACH KONSTRUKTION WHERE KONSTRUKTION.KONSKOD = KONSTGRUPP.KONSKOD NO-LOCK.
   GET FIRST KQ NO-LOCK.
   DO WHILE AVAILABLE(KONSTRUKTION):
      OPEN QUERY KQ2 FOR EACH MTRLBER WHERE MTRLBER.KTYPKOD = KONSTRUKTION.KTYPKOD
      NO-LOCK.
      GET FIRST KQ2 NO-LOCK.
      DO WHILE AVAILABLE(MTRLBER):
         CREATE kon_temp.
         ASSIGN
         kon_temp.KONSKOD = KONSTGRUPP.KONSKOD
         kon_temp.KTYPKOD = MTRLBER.KTYPKOD
         kon_temp.ENR = MTRLBER.ENR
         kon_temp.BENAMNING = MTRLBER.BENAMNING
         kon_temp.F1 = MTRLBER.F1
         kon_temp.F2 = MTRLBER.F2
         kon_temp.F3 = MTRLBER.F3
         kon_temp.F4 = MTRLBER.F4
         kon_temp.F5 = MTRLBER.F5
         kon_temp.FORETAG = valfore.
         GET NEXT KQ2 NO-LOCK.
      END.
      CLOSE QUERY KQ2.
      GET NEXT KQ NO-LOCK.
   END.
   CLOSE QUERY KQ.
   GET NEXT GQ NO-LOCK.
END.
