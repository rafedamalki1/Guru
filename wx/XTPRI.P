DEF VAR PKOD LIKE PERSONALTAB.PERSONALKOD NO-UNDO.
OPEN QUERY tidq FOR EACH TIDREGITAB WHERE YEAR(TIDREGITAB.DATUM) = 2000
AND PRISTYP = "TOT.PRIS." NO-LOCK.
PKOD = "" .
DO TRANSACTION:
   GET FIRST tidq EXCLUSIVE-LOCK.
   
   IF AVAILABLE TIDREGITAB THEN DO:   
      IF pkod ne TIDREGITAB.PERSONALKOD THEN DO:
         pkod = TIDREGITAB.PERSONALKOD.
         FIND FIRST TIMKOSTNADSTAB 
         WHERE TIMKOSTNADSTAB.PERSONALKOD = pkod AND
         TIMKOSTNADSTAB.PRISTYP = 'TOT.PRIS.' USE-INDEX PRISPERS NO-LOCK NO-ERROR.
      END.
      ASSIGN TIDREGITAB.PRIS = TIMKOSTNADSTAB.PRISA.
   END.
END.
DO WHILE AVAILABLE(TIDREGITAB):
   DO TRANSACTION:
      GET NEXT tidq EXCLUSIVE-LOCK.
      IF AVAILABLE TIDREGITAB THEN DO:   
         IF pkod ne TIDREGITAB.PERSONALKOD THEN DO:
            pkod = TIDREGITAB.PERSONALKOD.
            FIND FIRST TIMKOSTNADSTAB 
            WHERE TIMKOSTNADSTAB.PERSONALKOD = pkod AND
            TIMKOSTNADSTAB.PRISTYP = 'TOT.PRIS.' USE-INDEX PRISPERS NO-LOCK NO-ERROR.
         END.
         ASSIGN TIDREGITAB.PRIS = TIMKOSTNADSTAB.PRISA.
      END.
   END.
END.
