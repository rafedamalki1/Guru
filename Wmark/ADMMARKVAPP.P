/*ADMMARKVAPP.P*/

{STARTFORAPP.I}
{MARKVARD.I}


PROCEDURE laddabrw.
   DEFINE OUTPUT PARAMETER TABLE FOR kindextemp. 
   DEFINE OUTPUT PARAMETER TABLE FOR volkrtemp.
   EMPTY TEMP-TABLE kindextemp NO-ERROR.    
   OPEN QUERY kq FOR EACH KINDEX USE-INDEX AR NO-LOCK.
   GET FIRST kq NO-LOCK.
   DO WHILE AVAILABLE(KINDEX):
      CREATE kindextemp.
      BUFFER-COPY KINDEX TO kindextemp.
      GET NEXT kq NO-LOCK.
   END.
   CLOSE QUERY kq.
   EMPTY TEMP-TABLE volkrtemp NO-ERROR.    
   OPEN QUERY vq FOR EACH VOLKR USE-INDEX DIAM NO-LOCK.
   GET FIRST vq NO-LOCK.
   DO WHILE AVAILABLE(VOLKR):
      CREATE volkrtemp.
      BUFFER-COPY VOLKR TO volkrtemp. 
      GET NEXT vq NO-LOCK.
   END.
   CLOSE QUERY vq.
   RETURN.
END PROCEDURE.

PROCEDURE delkindex.
   DEFINE INPUT PARAMETER artalvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER manadvar AS INTEGER NO-UNDO.
   DO TRANSACTION:
      FIND FIRST KINDEX WHERE KINDEX.AR = artalvar AND 
      KINDEX.MANAD = manadvar EXCLUSIVE-LOCK NO-ERROR.
      IF AVAILABLE KINDEX THEN DO:
         DELETE KINDEX.
      END.
   END.
END PROCEDURE.

PROCEDURE delvolkr.
   DEFINE INPUT PARAMETER diamvar AS INTEGER NO-UNDO.
   DO TRANSACTION:
      FIND FIRST VOLKR WHERE VOLKR.DIAM = diamvar EXCLUSIVE-LOCK NO-ERROR.
      IF AVAILABLE VOLKR THEN DO:
         DELETE VOLKR.
      END.      
   END.
END PROCEDURE.


