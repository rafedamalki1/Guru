/*DIVERSESTOREKG.P*/
DEF VAR A AS INTEGER.
DEF VAR B AS INTEGER.
DEF VAR C AS INTEGER.
DEF VAR D AS INTEGER.
DEF VAR antkund AS INTEGER.
DEF VAR antavbtid AS INTEGER.
DEF VAR bortkw AS INTEGER.




DEFINE VARIABLE timmar100 AS DECIMAL NO-UNDO.
DEFINE VARIABLE timmar60 AS DECIMAL FORMAT ">9.999" NO-UNDO.

 FOR EACH STORNINGSTAB WHERE YEAR(STORNINGSTAB.HDATUM) = 2011 AND
 STORNINGSTAB.STDRIFTID = 2 AND STORNINGSTAB.FRANSPANID = 21     USE-INDEX stornummerid NO-LOCK.
    FIND LAST BORTKOPPLAD WHERE BORTKOPPLAD.STORNUMMERID = STORNINGSTAB.STORNUMMERID
      USE-INDEX AVBROTT NO-LOCK NO-ERROR.
      IF AVAILABLE BORTKOPPLAD THEN DO:
         RUN TIDBER.P (INPUT STORNINGSTAB.HDATUM, INPUT BORTKOPPLAD.ATERDATUM, INPUT STORNINGSTAB.HKLOCKAN,
         INPUT BORTKOPPLAD.ATERKLOCKAN, OUTPUT timmar100, OUTPUT timmar60).
      END.
      ELSE DO:
         RUN TIDBER.P (INPUT STORNINGSTAB.HDATUM, INPUT STORNINGSTAB.DATUM100%, INPUT STORNINGSTAB.HKLOCKAN,
         INPUT STORNINGSTAB.KLOCKAN100%, OUTPUT timmar100, OUTPUT timmar60).
      END.
      IF STORNINGSTAB.AVBROTTSTID LE 0 AND timmar60 > 0000.03 THEN DO:
/*        disp STORNINGSTAB.stornummerid  STORNINGSTAB.ANTALHSP  STORNINGSTAB.ANTALLSP.*/               
          A = A + STORNINGSTAB.ANTALHSP + STORNINGSTAB.ANTALLSP.

      END.   
      ELSE IF STORNINGSTAB.AVBROTTSTID > 0 AND timmar60 > 0000.03 THEN DO:
         antkund = antkund  + STORNINGSTAB.ANTALHSP + STORNINGSTAB.ANTALLSP.
         antavbtid = antavbtid + STORNINGSTAB.AvbrottsTid. 
         bortkw = bortkw + ((STORNINGSTAB.BORTMW * 1000) + STORNINGSTAB.BORTKW).
        B = B + STORNINGSTAB.ANTALHSP + STORNINGSTAB.ANTALLSP.
      END.   
/*      ELSE  DO:

       C = C + STORNINGSTAB.ANTALHSP + STORNINGSTAB.ANTALLSP.

      END. 
      D = A + B .*/
 END.
 MESSAGE antkund antavbtid bortkw .

/* MESSAGE A B  D.*/
