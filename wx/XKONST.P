
   
   /*
   FIND LAST KONSTVAL WHERE KONSTVAL.KONSKOD = 0 AND
         KONSTVAL.ktypkod = "cdc" AND KONSTVAL.KVALKOD = "nollklämma" AND
         KONSTVAL.KOPP = TRUE.
   DISP KONSTVAL.KVALKOD ordning.
    */
   DEFINE TEMP-TABLE feltemp NO-UNDO
      FIELD KTYPKOD AS CHARACTER
      FIELD KVALKOD  AS CHARACTER
      FIELD typ AS INTEGER
      INDEX KTYPKOD KTYPKOD KVALKOD.
   DEFINE OUTPUT PARAMETER AA AS INTEGER NO-UNDO.
   DEFINE OUTPUT PARAMETER BB AS INTEGER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR feltemp.
   FOR EACH MTRLBER  USE-INDEX KOD NO-LOCK:  
      BB = BB + 1.
      IF MTRLBER.F1 NE "" THEN DO:
         FIND FIRST KONSTVAL WHERE KONSTVAL.KTYPKOD = MTRLBER.KTYPKOD AND KONSTVAL.KVALKOD = MTRLBER.F1 AND
         KONSTVAL.KOPP = TRUE
         NO-LOCK NO-ERROR.
         IF NOT AVAILABLE KONSTVAL THEN DO:
            AA = AA + 1.
            CREATE feltemp.
            ASSIGN
            feltemp.TYP = 1
            feltemp.KTYPKOD = MTRLBER.KTYPKOD
            feltemp.KVALKOD = MTRLBER.F1.
         END.
      END.
      IF MTRLBER.F2 NE "" THEN DO:
         FIND FIRST KONSTVAL WHERE KONSTVAL.KTYPKOD = MTRLBER.KTYPKOD AND 
         KONSTVAL.KVALKOD = MTRLBER.F2 AND KONSTVAL.KOPP = TRUE
         NO-LOCK NO-ERROR.
         IF NOT AVAILABLE KONSTVAL THEN DO:
            AA = AA + 1.
            CREATE feltemp.
            ASSIGN
            feltemp.TYP = 2
            feltemp.KTYPKOD = MTRLBER.KTYPKOD
            feltemp.KVALKOD = MTRLBER.F2.
         END.
      END.
      IF MTRLBER.F3 NE "" THEN DO:
         FIND FIRST KONSTVAL WHERE KONSTVAL.KTYPKOD = MTRLBER.KTYPKOD AND 
         KONSTVAL.KVALKOD = MTRLBER.F3 AND KONSTVAL.KOPP = TRUE
         NO-LOCK NO-ERROR.
         IF NOT AVAILABLE KONSTVAL THEN DO:
            AA = AA + 1.
            CREATE feltemp.
            ASSIGN
            feltemp.TYP = 3
            feltemp.KTYPKOD = MTRLBER.KTYPKOD
            feltemp.KVALKOD = MTRLBER.F3.
         END.
      END.
      IF MTRLBER.F4 NE "" THEN DO:
         FIND FIRST KONSTVAL WHERE KONSTVAL.KTYPKOD = MTRLBER.KTYPKOD AND 
         KONSTVAL.KVALKOD = MTRLBER.F4 AND KONSTVAL.KOPP = TRUE
         NO-LOCK NO-ERROR.
         IF NOT AVAILABLE KONSTVAL THEN DO:
            AA = AA + 1.
            CREATE feltemp.
            ASSIGN
            feltemp.TYP = 4
            feltemp.KTYPKOD = MTRLBER.KTYPKOD
            feltemp.KVALKOD = MTRLBER.F4.
         END.
      END.
      IF MTRLBER.F5 NE "" THEN DO:
         FIND FIRST KONSTVAL WHERE KONSTVAL.KTYPKOD = MTRLBER.KTYPKOD AND 
         KONSTVAL.KVALKOD = MTRLBER.F5 AND KONSTVAL.KOPP = TRUE
         NO-LOCK NO-ERROR.
         IF NOT AVAILABLE KONSTVAL THEN DO:
            AA = AA + 1.
            CREATE feltemp.
            ASSIGN
            feltemp.TYP = 5
            feltemp.KTYPKOD = MTRLBER.KTYPKOD
            feltemp.KVALKOD = MTRLBER.F5.
         END.
      END.
   END.

         

