
DEFINE VARIABLE prognamn2 AS CHARACTER  NO-UNDO.
DEFINE VARIABLE prognamn3 AS CHARACTER  NO-UNDO.
DEFINE VARIABLE prognamn4 AS CHARACTER  NO-UNDO.
/*prognamn2 = "d:\DELAD\server\PRO9S\gkal\".*/
/*prognamn2 = "g:\delad\pro9s\korning\".
prognamn2 = "\\pc012\d\delad\pro9s\korning\".*/
   prognamn2 = "C:\LENA\".
   /*prognamn3 = prognamn2 + "pasumma.d".
   prognamn4 = prognamn2 + "test2.D".
   OS-COPY VALUE(prognamn3) VALUE(prognamn4).   */
   DEFINE TEMP-TABLE pa90fil
   FIELD PPERSKOD LIKE PERSONALTAB.PERSONALKOD
   FIELD PLONTILLAGG LIKE TIDREGITAB.LONTILLAGG
   FIELD PLONTILLANTAL LIKE TIDREGITAB.LONTILLANTAL
   FIELD POVERTIDTILL LIKE TIDREGITAB.OVERTIDTILL
   FIELD POVERANTAL LIKE TIDREGITAB.OVERANTAL
   FIELD PTRAKTKOD LIKE TIDREGITAB.TRAKTKOD
   FIELD PTRAKTANTAL LIKE TIDREGITAB.TRAKTANTAL
   FIELD PBEREDSKAP LIKE TIDREGITAB.BEREDSKAP
   FIELD PBERANTAL LIKE TIDREGITAB.BERANTAL
   FIELD PDATUM LIKE TIDREGITAB.DATUM
   FIELD MANAD AS INTEGER
   FIELD PVECKONUMMER LIKE TIDREGITAB.VECKONUMMER
   FIELD PSORT AS CHARACTER FORMAT "XX"
   FIELD PKOD LIKE ANSTFORMTAB.KOD
   FIELD POMR LIKE PERSONALTAB.OMRADE
   INDEX PPERSKOD IS PRIMARY PPERSKOD ASCENDING.
   
   DEFINE TEMP-TABLE pa90filen
   FIELD PPERSKOD AS CHARACTER FORMAT "X(10)"
   FIELD PNR AS CHARACTER FORMAT "X(10)"
   FIELD PDATUMET AS CHARACTER FORMAT "X(6)"
   FIELD MANAD AS INTEGER
   FIELD UTDATUM AS DATE
   FIELD PTILLAGG LIKE TIDREGITAB.LONTILLAGG
   FIELD PTI  AS DECIMAL
   FIELD PANTAL AS DECIMAL
   FIELD PKR AS DECIMAL
   FIELD PKOD LIKE ANSTFORMTAB.KOD
   FIELD POMR LIKE PERSONALTAB.OMRADE
   FIELD ORSAK AS CHARACTER
   FIELD VIJUDID AS CHARACTER
   FIELD PSORT AS CHARACTER FORMAT "XX"
   INDEX PPERSKOD IS PRIMARY PPERSKOD PTILLAGG.
   DEFINE VARIABLE lorsak AS CHARACTER NO-UNDO.



   CREATE pa90fil.
   ASSIGN pa90fil.PPERSKOD = "120"
   pa90fil.PLONTILLAGG = "4510"
   pa90fil.PLONTILLANTAL = 2
   pa90fil.PDATUM = TODAY   
   pa90fil.PKOD = "K".
   CREATE pa90fil.
   ASSIGN pa90fil.PPERSKOD = "120"
   pa90fil.PLONTILLAGG = "4512"
   pa90fil.PLONTILLANTAL = 4
   pa90fil.PDATUM = TODAY   
   pa90fil.PKOD = "K".

   FOR EACH pa90fil :      
         CREATE pa90filen.         
         ASSIGN
         pa90filen.PPERSKOD = pa90fil.PPERSKOD      
         pa90filen.UTDATUM = pa90fil.PDATUM
         pa90filen.MANAD = pa90fil.MANAD
         pa90filen.PTILLAGG = pa90fil.PLONTILLAGG
         pa90filen.PSORT = pa90fil.PSORT
         pa90filen.POMR = pa90fil.POMR
         
         pa90filen.PANTAL = pa90fil.plontillantal.
         RUN orsak_UI (INPUT pa90filen.PTILLAGG, OUTPUT lorsak).
         ASSIGN pa90filen.ORSAK = lorsak.
         
   END.
   FOR EACH pa90filen:
      DISPLAY pa90filen.
   END.


prognamn3 = prognamn2 + "TEST3.D".
OUTPUT TO prognamn3.

FOR EACH pa90filen:
  EXPORT pa90filen.
END.

PROCEDURE orsak_UI :
   DEFINE INPUT PARAMETER lart AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER lorsak AS CHARACTER NO-UNDO.
   IF lart = "4510" THEN lorsak = "Övenktid".
   IF lart = "4512" THEN lorsak = "Fyll/led".
   
END PROCEDURE.
