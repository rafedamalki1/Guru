/*ENRELEF2.P*/
DEFINE VARIABLE kalle AS LOGICAL NO-UNDO. 
DEFINE INPUT PARAMETER leverant LIKE LEVERANTOR.LEVKOD NO-UNDO.
  
   OPEN QUERY kq FOR EACH MTRL WHERE MTRL.LEVKOD = leverant AND MTRL.KALKNR = 0 NO-LOCK.
   DO TRANSACTION:
      GET FIRST kq EXCLUSIVE-LOCK.
      IF SUBSTRING(MTRL.ENR,1,1) = "E" THEN kalle = kalle.
      ELSE IF SUBSTRING(MTRL.ENR,1,1) = "X" THEN kalle = kalle.
      ELSE MTRL.ENR = "E" + MTRL.ENR.
   END.
   REPEAT:
      DO TRANSACTION:
         GET NEXT kq EXCLUSIVE-LOCK.
         IF NOT AVAILABLE MTRL THEN LEAVE.
         ELSE DO:
            IF SUBSTRING(MTRL.ENR,1,1) = "E" THEN kalle = kalle.
            ELSE IF SUBSTRING(MTRL.ENR,1,1) = "X" THEN kalle = kalle.
            ELSE MTRL.ENR = "E" + MTRL.ENR.
         END.
      END.
   END.

   
