&Scoped-define NEW   NEW
&Scoped-define SHARED SHARED
/*{GLOBVAR2DEL1.I}*/
/*DEFINE NEW SHARED VARIABLE gvisatidpermanad AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE globforetag LIKE FORETAG.FORETAG NO-UNDO.*/
DEFINE NEW SHARED VARIABLE globforetag LIKE FORETAG.FORETAG NO-UNDO.
DEFINE NEW SHARED VARIABLE vkdatum AS DATE NO-UNDO.
DEFINE NEW SHARED VARIABLE gvisatidpermanad AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE man AS INTEGER FORMAT "99" NO-UNDO.
DEFINE NEW SHARED VARIABLE globanv LIKE ANVANDARE.ANVANDARE NO-UNDO.
 
DEFINE  VARIABLE appcon AS LOGICAL NO-UNDO.
DEFINE VARIABLE manval AS LOGICAL NO-UNDO.
DEFINE VARIABLE samvar AS CHARACTER NO-UNDO.
DEFINE VARIABLE prognamn2 AS CHARACTER  NO-UNDO.
DEFINE VARIABLE prognamn3 AS CHARACTER  NO-UNDO.
DEFINE NEW SHARED TEMP-TABLE tidut
   FIELD UT AS CHARACTER FORMAT "X(132)".
&Scoped-define NEW   
&Scoped-define SHARED 
{LONEDEF.I}

/*DEFINE TEMP-TABLE lonefil
   FIELD PERSONNUMMER LIKE PERSONALTAB.PERSONNUMMER
   FIELD START LIKE TIDREGITAB.START
   FIELD SLUT LIKE TIDREGITAB.SLUT
   FIELD PLONTILLAGG LIKE TIDREGITAB.LONTILLAGG
   FIELD PLONTILLANTAL LIKE TIDREGITAB.LONTILLANTAL
   FIELD POVERTIDTILL LIKE TIDREGITAB.OVERTIDTILL
   FIELD POVERANTAL LIKE TIDREGITAB.OVERANTAL
   FIELD PTRAKTKOD LIKE TIDREGITAB.TRAKTKOD
   FIELD PTRAKTANTAL LIKE TIDREGITAB.TRAKTANTAL
   FIELD PBEREDSKAP LIKE TIDREGITAB.BEREDSKAP
   FIELD PBERANTAL LIKE TIDREGITAB.BERANTAL
   FIELD PDATUM LIKE TIDREGITAB.DATUM
   FIELD SLUTDATUM LIKE TIDREGITAB.DATUM INITIAL ?
   FIELD PVECKONUMMER LIKE TIDREGITAB.VECKONUMMER
   FIELD MANAD AS INTEGER
   FIELD PSORT AS CHARACTER FORMAT "XX"
   FIELD PPAR8 AS DECIMAL FORMAT "-99.99"
   FIELD AONR LIKE TIDREGITAB.AONR
   FIELD DELNR LIKE TIDREGITAB.DELNR
   FIELD PAVTAL AS CHARACTER
   FIELD TID AS LOGICAL
   FIELD BERKOLL AS LOGICAL INITIAL FALSE
   FIELD PROCENT AS DECIMAL FORMAT "999.9"
   FIELD NAMN AS CHARACTER
   FIELD RESMAL AS CHARACTER
   FIELD ERSATTNING AS DECIMAL    
   INDEX PERSONNUMMER IS PRIMARY PERSONNUMMER ASCENDING.*/

FIND FIRST FORETAG USE-INDEX FORETAG NO-LOCK NO-ERROR.
globforetag = FORETAG.FORETAG.
CREATE ALIAS RT9 FOR DATABASE VALUE(LDBNAME(1)) NO-ERROR.
{CONAPP.I}

gvisatidpermanad = TRUE.
DEFINE VARIABLE invkdatum AS DATE NO-UNDO.
DEFINE VARIABLE gkorvar AS CHARACTER NO-UNDO.
ASSIGN
/*invkdatum = 01/31/2006
gkorvar = "FLEX".*/
invkdatum = 01/31/2006
gkorvar = "W20060203".
/*IF globforetag = "GKAL" THEN prognamn2 = "\\goliat\DELAD\server\PRO9S\gkal\".*/
IF globforetag = "SUND" THEN prognamn2 = "D:\DELAD\SERVER\PRO9S\EXPORT\lon\".

         /*IF globforetag = "GKAL"  THEN DO:
         /*nytt löneprogram från dec 2004 */    
         prognamn3 = prognamn2 + "KALESAMM.TXT".
         MESSAGE "Nu starar den" VIEW-AS ALERT-BOX.
         RUN GKALVE1.P  ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
         (INPUT prognamn3,INPUT invkdatum, INPUT gvisatidpermanad, INPUT globforetag,INPUT gkorvar ).
         
         RUN GKALFR1.P  ON Guru.Konstanter:apphand TRANSACTION DISTINCT     
         (INPUT prognamn3,INPUT invkdatum, INPUT gvisatidpermanad, INPUT globforetag,INPUT gkorvar).         
      END.*/

      manval = FALSE.    
      
      prognamn3 = prognamn2 + "SULESAMM.TXT".
      MESSAGE prognamn3 VIEW-AS ALERT-BOX.
      RUN SUTILLN1.P  ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT prognamn3,INPUT invkdatum, INPUT Guru.Konstanter:globanv, INPUT gkorvar,OUTPUT TABLE lonefil).
      
      RUN SUFRN1.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT prognamn3,INPUT vkdatum, INPUT Guru.Konstanter:globanv,INPUT gkorvar, INPUT TABLE lonefil).      
      MESSAGE "klar" VIEW-AS ALERT-BOX.
      IF Guru.Konstanter:appcon THEN Guru.Konstanter:appcon = Guru.Konstanter:apphand:DISCONNECT().
      DELETE OBJECT Guru.Konstanter:apphand.
