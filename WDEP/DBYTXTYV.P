/*BYT ARTIKEL X TILL ARTIKEL Y*/
&Scoped-define NEW 
&Scoped-define SHARED
{SMTRL.I}
/*{MTRLTEMP.I}*/

DEFINE TEMP-TABLE byt_mtrl NO-UNDO LIKE spec_mtrl.

/*DEFINE TEMP-TABLE spec_mtrl
    FIELD KALKNR LIKE MTRL.KALKNR 
    FIELD ENR LIKE MTRL.ENR
    FIELD BENAMNING LIKE MTRL.BENAMNING
    FIELD ENHET LIKE MTRL.ENHET
    FIELD NPRIS LIKE MTRL.NPRIS 
    FIELD BPRIS LIKE MTRL.BPRIS
    FIELD SUMMA LIKE MTRL.SUMMA
    FIELD BERKVANT LIKE MTRL.BERKVANT    
    FIELD LEVKOD LIKE MTRL.LEVKOD
    FIELD MARK AS LOGICAL
    FIELD LINKAB LIKE MTRLBER.LINKAB
    FIELD MODUL LIKE MTRLBER.MODUL
    FIELD TYPBER LIKE MTRLBER.TYPBER
    FIELD DIAMETER LIKE MTRLBER.DIAMETER
    FIELD SATS LIKE MTRLBER.SATS
    FIELD ARBKOD LIKE KALKBER.ARBKOD
    FIELD LOPNR LIKE KALKBER.LOPNR
    FIELD ANTAL LIKE KALKBER.ANTAL.
    
DEFINE TEMP-TABLE byt_mtrl
    FIELD KALKNR LIKE MTRL.KALKNR 
    FIELD ENR LIKE MTRL.ENR
    FIELD BENAMNING LIKE MTRL.BENAMNING
    FIELD ENHET LIKE MTRL.ENHET
    FIELD NPRIS LIKE MTRL.NPRIS 
    FIELD BPRIS LIKE MTRL.BPRIS
    FIELD SUMMA LIKE MTRL.SUMMA
    FIELD BERKVANT LIKE MTRL.BERKVANT    
    FIELD LEVKOD LIKE MTRL.LEVKOD
    FIELD MARK AS LOGICAL
    FIELD LINKAB LIKE MTRLBER.LINKAB
    FIELD MODUL LIKE MTRLBER.MODUL
    FIELD TYPBER LIKE MTRLBER.TYPBER
    FIELD DIAMETER LIKE MTRLBER.DIAMETER
    FIELD SATS LIKE MTRLBER.SATS
    FIELD ARBKOD LIKE KALKBER.ARBKOD
    FIELD LOPNR LIKE KALKBER.LOPNR
    FIELD ANTAL LIKE KALKBER.ANTAL.    */

DEFINE INPUT PARAMETER TABLE FOR spec_mtrl.
DEFINE INPUT PARAMETER TABLE FOR byt_mtrl.

/*DEFINE QUERY mtrlq FOR MTRLDEP.*/

   FIND FIRST byt_mtrl NO-LOCK NO-ERROR.        
   FIND FIRST spec_mtrl NO-LOCK NO-ERROR.       
   OPEN QUERY mtrlq FOR EACH MTRLDEP WHERE MTRLDEP.ENR = spec_mtrl.ENR AND 
   MTRLDEP.LEVKOD = spec_mtrl.LEVKOD AND MTRLDEP.IBDATUM = ? AND 
   MTRLDEP.LAGER = TRUE NO-LOCK. 
   DO TRANSACTION:
      GET FIRST mtrlq EXCLUSIVE-LOCK.
      IF AVAILABLE MTRLDEP THEN DO:
         ASSIGN
         MTRLDEP.ENR = byt_mtrl.ENR
         MTRLDEP.BENAMNING = byt_mtrl.BENAMNING
         MTRLDEP.ENHET = byt_mtrl.ENHET
         MTRLDEP.NPRIS = byt_mtrl.NPRIS
         MTRLDEP.BPRIS = byt_mtrl.BPRIS
         MTRLDEP.LEVKOD = byt_mtrl.LEVKOD.
      END.
   END.
   REPEAT:
      DO TRANSACTION:
         GET NEXT mtrlq EXCLUSIVE-LOCK.
         IF AVAILABLE MTRLDEP THEN DO:
            ASSIGN
            MTRLDEP.ENR = byt_mtrl.ENR
            MTRLDEP.BENAMNING = byt_mtrl.BENAMNING
            MTRLDEP.ENHET = byt_mtrl.ENHET
            MTRLDEP.NPRIS = byt_mtrl.NPRIS
            MTRLDEP.BPRIS = byt_mtrl.BPRIS
            MTRLDEP.LEVKOD = byt_mtrl.LEVKOD.
         END.
         ELSE LEAVE.
      END.
   END.            
