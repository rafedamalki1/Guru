/*EXEMKABLU2.P*/
DEFINE VARIABLE markag AS INTEGER NO-UNDO.
DEFINE VARIABLE extrarader AS INTEGER NO-UNDO.
DEFINE VARIABLE extrarader2 AS INTEGER FORMAT "-9999999" NO-UNDO.
DEFINE VARIABLE extram AS INTEGER NO-UNDO.
DEFINE VARIABLE emg AS INTEGER NO-UNDO.
DEFINE VARIABLE uColumn  AS INTEGER INITIAL 0.
DEFINE VARIABLE fnamn AS CHARACTER NO-UNDO.
DEFINE VARIABLE fnamn2 AS CHARACTER NO-UNDO.
DEFINE VARIABLE fnamnA AS CHARACTER NO-UNDO.
DEFINE VARIABLE fnamnB AS CHARACTER NO-UNDO.
DEFINE VARIABLE fnamnC AS CHARACTER NO-UNDO.
DEFINE VARIABLE fnamnD AS CHARACTER NO-UNDO.
DEFINE VARIABLE fnamnU AS CHARACTER NO-UNDO.
DEFINE VARIABLE link AS CHARACTER NO-UNDO.
DEFINE VARIABLE bytcol AS LOGICAL NO-UNDO.
DEFINE VARIABLE bytacol AS CHARACTER NO-UNDO.
DEFINE VARIABLE bytbcol AS CHARACTER NO-UNDO.
DEFINE VARIABLE bytccol AS CHARACTER NO-UNDO.
DEFINE VARIABLE bytgcol AS CHARACTER NO-UNDO.
DEFINE VARIABLE bythcol AS CHARACTER NO-UNDO.

DEFINE VARIABLE valvardnr AS INTEGER NO-UNDO.
DEFINE VARIABLE omravd AS INTEGER NO-UNDO.
DEFINE VARIABLE aovar AS CHARACTER NO-UNDO.
DEFINE VARIABLE delnrvar AS INTEGER NO-UNDO.
DEFINE VARIABLE ortvar AS CHARACTER NO-UNDO.   
DEFINE VARIABLE fkommun AS CHARACTER NO-UNDO.   
DEFINE VARIABLE fvaker AS CHARACTER NO-UNDO.   
DEFINE VARIABLE vman AS CHARACTER NO-UNDO.   
DEFINE VARIABLE vadress AS CHARACTER NO-UNDO.
DEFINE VARIABLE vpadress AS CHARACTER NO-UNDO.
DEFINE VARIABLE vtelef AS CHARACTER NO-UNDO.
DEFINE VARIABLE felmedd AS CHARACTER NO-UNDO.
DEFINE VARIABLE omromr AS CHARACTER NO-UNDO.
DEFINE VARIABLE hjproc AS DECIMAL NO-UNDO.
DEFINE VARIABLE hjagare AS INTEGER NO-UNDO.
DEFINE VARIABLE projl AS CHARACTER NO-UNDO.
DEFINE VARIABLE arrendator AS CHARACTER NO-UNDO.
DEFINE VARIABLE allnamn AS CHARACTER NO-UNDO.
DEFINE VARIABLE allpersnr AS CHARACTER NO-UNDO.
DEFINE VARIABLE lujona AS CHARACTER NO-UNDO.
DEFINE VARIABLE minimi AS INTEGER NO-UNDO.
DEFINE VARIABLE skprotapph AS HANDLE NO-UNDO.
DEFINE VARIABLE lelitt AS CHARACTER NO-UNDO.
DEFINE VARIABLE pnamn AS CHARACTER NO-UNDO.
DEFINE VARIABLE pled AS CHARACTER NO-UNDO.
DEFINE VARIABLE konc AS CHARACTER NO-UNDO.
DEFINE VARIABLE diarienr AS CHARACTER NO-UNDO.
/*DEFINE VARIABLE domsaga AS CHARACTER NO-UNDO.*/
DEFINE VARIABLE nstn AS CHARACTER NO-UNDO.
DEFINE VARIABLE par1a AS INTEGER NO-UNDO.
DEFINE VARIABLE par1b AS INTEGER NO-UNDO.
DEFINE VARIABLE par2c AS INTEGER NO-UNDO.
DEFINE VARIABLE antfast AS INTEGER NO-UNDO.
DEFINE VARIABLE fbet AS CHARACTER NO-UNDO.
DEFINE VARIABLE flerfastsum AS INTEGER NO-UNDO.
DEFINE VARIABLE lled AS INTEGER NO-UNDO.
DEFINE VARIABLE jkab AS DECIMAL  NO-UNDO.
DEFINE VARIABLE nats AS INTEGER NO-UNDO.
DEFINE VARIABLE jklsp AS INTEGER NO-UNDO.
DEFINE VARIABLE kskap AS INTEGER NO-UNDO.
DEFINE VARIABLE ovg AS INTEGER NO-UNDO.
DEFINE VARIABLE tlgg AS INTEGER NO-UNDO.
DEFINE VARIABLE mmini AS INTEGER NO-UNDO.
DEFINE VARIABLE ttalt AS INTEGER NO-UNDO.
DEFINE VARIABLE gers AS INTEGER NO-UNDO.
DEFINE VARIABLE mg AS CHARACTER NO-UNDO.
DEFINE VARIABLE fabet AS CHARACTER NO-UNDO.
DEFINE VARIABLE delsumover AS LOGICAL NO-UNDO.
DEFINE VARIABLE kommnatkab AS CHARACTER NO-UNDO.
DEFINE VARIABLE kommkskap AS CHARACTER NO-UNDO.
DEFINE VARIABLE fastbelopp AS INTEGER NO-UNDO.

DEFINE VARIABLE vardman AS CHARACTER NO-UNDO.
DEFINE VARIABLE vardtel AS CHARACTER NO-UNDO.
DEFINE VARIABLE kabersatt AS DECIMAL NO-UNDO.
DEFINE VARIABLE gamled AS CHARACTER NO-UNDO.
DEFINE VARIABLE dodas AS CHARACTER NO-UNDO.
DEFINE VARIABLE krha AS INTEGER NO-UNDO.
DEFINE VARIABLE skadeers AS INTEGER NO-UNDO.
DEFINE VARIABLE tilldag AS DATE NO-UNDO.
DEFINE VARIABLE tkmeter AS CHARACTER NO-UNDO.
DEFINE VARIABLE natstn AS INTEGER NO-UNDO.
DEFINE VARIABLE utsag AS INTEGER NO-UNDO.
DEFINE VARIABLE lleduex AS INTEGER  NO-UNDO.
DEFINE VARIABLE jkabuex AS DECIMAL  NO-UNDO.
DEFINE VARIABLE exltot AS decimal NO-UNDO.
DEFINE VARIABLE fabet1 AS CHARACTER NO-UNDO.
DEFINE VARIABLE sidvar AS INTEGER NO-UNDO.
DEFINE VARIABLE kskapkr AS INTEGER NO-UNDO.
DEFINE VARIABLE nstnakerkr AS INTEGER NO-UNDO.
DEFINE VARIABLE nstnovrigkr AS INTEGER NO-UNDO.
DEFINE VARIABLE natsuexl AS INTEGER NO-UNDO.
DEFINE VARIABLE natsbaraexl AS INTEGER NO-UNDO.
DEFINE VARIABLE kskapuexl AS INTEGER NO-UNDO.
DEFINE VARIABLE kskapbaraexl AS INTEGER NO-UNDO.
DEFINE VARIABLE sumupplat AS DECIMAL NO-UNDO.
DEFINE VARIABLE sumovrigt AS DECIMAL NO-UNDO.
DEFINE VARIABLE vardnrnatag AS CHARACTER NO-UNDO.
DEFINE VARIABLE kommjk AS CHARACTER NO-UNDO.
DEFINE VARIABLE kommLUFT AS CHARACTER NO-UNDO.
DEFINE VARIABLE telearb AS CHARACTER NO-UNDO.
DEFINE VARIABLE telebost AS CHARACTER NO-UNDO.
DEFINE VARIABLE mobil AS CHARACTER NO-UNDO.
DEFINE VARIABLE epost AS CHARACTER NO-UNDO.
DEFINE VARIABLE fagare AS CHARACTER NO-UNDO.
DEFINE VARIABLE vardartal AS INTEGER NO-UNDO.
DEFINE VARIABLE kopindex AS DECIMAL NO-UNDO.
DEFINE VARIABLE bbelopp AS INTEGER NO-UNDO.
DEFINE VARIABLE projledf AS CHARACTER NO-UNDO.
DEFINE VARIABLE projtel AS CHARACTER NO-UNDO.
DEFINE VARIABLE projepost AS CHARACTER NO-UNDO.
DEFINE VARIABLE vaman AS CHARACTER NO-UNDO.
DEFINE VARIABLE vatel AS CHARACTER NO-UNDO.
DEFINE VARIABLE vaepost AS CHARACTER NO-UNDO.



{MARAG.I}


DEFINE TEMP-TABLE uppfoltemp   
   FIELD FORETAG AS CHARACTER
   FIELD ANVANDARE AS CHARACTER  
   FIELD ALLAMA AS LOGICAL
   FIELD VALVARD AS CHARACTER
   FIELD FORSTA AS LOGICAL
   FIELD STAMP AS LOGICAL.  
{TIDUTTT.I}
{SUMTEMP.I}
{MAGA.I}

{allavardtemp.I}   
     
DEFINE TEMP-TABLE fastaga         
   FIELD MARKNR AS INTEGER
   FIELD MARKAGARE AS CHARACTER
   FIELD PERSONNUMMER AS CHARACTER     
   INDEX MARKNR IS PRIMARY MARKNR ASCENDING.      
     
DEFINE VARIABLE kommando AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommando2 AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommando3 AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommando4 AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommando5 AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommandoU AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommandoU4 AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE chWord AS COM-HANDLE     NO-UNDO.
DEFINE VARIABLE chDoc  AS COM-HANDLE     NO-UNDO. 
DEFINE VARIABLE chWord2 AS COM-HANDLE     NO-UNDO.
DEFINE VARIABLE chDoc2  AS COM-HANDLE     NO-UNDO.
DEFINE VARIABLE SELECTION AS COM-HANDLE NO-UNDO.
DEFINE VARIABLE bkRange AS COM-HANDLE NO-UNDO.

DEFINE VARIABLE bokvalue AS CHARACTER NO-UNDO.
DEFINE VARIABLE bokname AS CHARACTER NO-UNDO.
DEFINE VARIABLE antagare AS INTEGER NO-UNDO.

DEFINE INPUT PARAMETER ponr AS CHARACTER FORMAT "X(12)" NO-UNDO.
DEFINE INPUT PARAMETER avtal AS CHARACTER NO-UNDO.
DEFINE INPUT PARAMETER spmall AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER fildir AS CHARACTER NO-UNDO.
DEFINE INPUT PARAMETER skrivutmall AS LOGICAL NO-UNDO.

{GLOBVAR2DEL1.I}
&Scoped-define SHARED SHARED  
{MARKVAL.I}                         
DEFINE BUFFER markvalbuff FOR markval.

&SCOPED-DEFINE NEW NEW
&SCOPED-DEFINE SHARED SHARED
{BLOB.I}
DEFINE VARIABLE bloblog AS LOGICAL NO-UNDO.
DEFINE VARIABLE blobproch AS HANDLE NO-UNDO.

DEFINE VARIABLE cDocPath AS CHARACTER NO-UNDO.
DEFINE VARIABLE cDocName AS CHARACTER NO-UNDO.
DEFINE VARIABLE wdGoToBookmark AS INTEGER NO-UNDO INITIAL -1.
DEFINE VARIABLE edataapph AS HANDLE NO-UNDO.
{EXTRADATA.I}

    
IF Guru.Konstanter:appcon THEN DO:
   RUN EXTRADATAHMT.P PERSISTENT SET edataapph ON Guru.Konstanter:apphand TRANSACTION DISTINCT. 
END.
ELSE DO:
  RUN EXTRADATAHMT.P PERSISTENT SET edataapph.  
END.

IF Guru.Konstanter:appcon THEN DO:
   RUN SKAPPROTOU7.P PERSISTENT SET skprotapph ON Guru.Konstanter:apphand TRANSACTION DISTINCT. 
END.
ELSE DO:
   RUN SKAPPROTOU7.P PERSISTENT SET skprotapph.
END.




IF ponr NE ? AND ponr NE ""  THEN DO:
   EMPTY TEMP-TABLE inextradatatemp NO-ERROR. 
   CREATE inextradatatemp.          
   ASSIGN
   inextradatatemp.PROGRAM = "NATPROJ"                   
   inextradatatemp.HUVUDCH = ponr.                    
   RUN etabhamt_UI IN edataapph (INPUT TABLE inextradatatemp, OUTPUT TABLE extradatatemp). 
   FIND FIRST extradatatemp NO-LOCK NO-ERROR.
   IF AVAILABLE extradatatemp THEN DO:      
      ASSIGN       
      lelitt = extradatatemp.SOKCHAR[1] 
      pnamn = extradatatemp.SOKCHAR[2] 
      pled = extradatatemp.SOKCHAR[3] 
      konc = extradatatemp.SOKCHAR[4] 
      diarienr = extradatatemp.SOKCHAR[5]
      /*domsaga = extradatatemp.SOKCHAR[5]*/
      nstn = extradatatemp.SOKCHAR[9]
      par1a = extradatatemp.SOKINT[1]
      par1b = extradatatemp.SOKINT[2]
      par2c = extradatatemp.SOKINT[3].
   
   END.
   
   /*används ej längre */
   /*EMPTY TEMP-TABLE inextradatatemp NO-ERROR. 
   CREATE inextradatatemp.          
   ASSIGN
   inextradatatemp.PROGRAM = "PROJHSAND"                   
   inextradatatemp.HUVUDCH = ponr.                    
   RUN etabhamt_UI IN edataapph (INPUT TABLE inextradatatemp, OUTPUT TABLE extradatatemp). 
   FIND FIRST extradatatemp NO-LOCK NO-ERROR.
   IF AVAILABLE extradatatemp THEN DO:      
      ASSIGN       
      gamled = extradatatemp.SOKCHAR[1] 
      dodas = extradatatemp.SOKCHAR[2] 
      krha = extradatatemp.SOKINT[1]             
      skadeers = extradatatemp.SOKINT[2]
      tilldag = extradatatemp.SOKDATE[1]
      tkmeter = extradatatemp.SOKCHAR[3]     
      natstn = extradatatemp.SOKINT[4].                 
   
   END.*/
END.      
fabet1 = "".
sidvar = 1.
EMPTY TEMP-TABLE emarkval NO-ERROR.    
FOR EACH markval BY markval.BETECKNING:   
   IF fabet NE markval.BETECKNING THEN DO:
      FOR EACH markvalbuff  WHERE markvalbuff.BETECKNING = markval.BETECKNING:       
         CREATE emarkval.
         BUFFER-COPY markvalbuff TO emarkval.
      END.         
      RUN skapamua_UI.            
      sidvar = sidvar + 1.   
      EMPTY TEMP-TABLE emarkval NO-ERROR.
      fabet = markval.BETECKNING.
   END.
END.         
IF VALID-HANDLE(skprotapph) THEN DELETE PROCEDURE skprotapph.      
skprotapph = ?.
IF VALID-HANDLE(edataapph) THEN DELETE PROCEDURE edataapph.   
edataapph = ?.
PROCEDURE skapamua_UI :

   EMPTY TEMP-TABLE marag NO-ERROR.
   EMPTY TEMP-TABLE marag2 NO-ERROR.
   EMPTY TEMP-TABLE sumtemp NO-ERROR.
   EMPTY TEMP-TABLE uppfoltemp NO-ERROR.  
   FIND FIRST emarkval NO-LOCK NO-ERROR.  
 
   IF Guru.Konstanter:appcon THEN DO:                           
      RUN EXKABLUAPP3.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT emarkval.VARDNR,INPUT emarkval.BETECKNING,INPUT TABLE emarkval,OUTPUT omravd,OUTPUT omromr,OUTPUT aovar,OUTPUT delnrvar,OUTPUT ortvar,OUTPUT fkommun,OUTPUT fvaker
      ,OUTPUT vman,OUTPUT vadress,OUTPUT vpadress, OUTPUT vtelef , OUTPUT projl, OUTPUT arrendator,OUTPUT TABLE marag ).
   END.
   ELSE DO:
      RUN EXKABLUAPP3.P 
      (INPUT emarkval.VARDNR,INPUT emarkval.BETECKNING,INPUT TABLE emarkval,OUTPUT omravd,OUTPUT omromr,OUTPUT aovar,OUTPUT delnrvar,OUTPUT ortvar,OUTPUT fkommun,OUTPUT fvaker
      ,OUTPUT vman,OUTPUT vadress,OUTPUT vpadress, OUTPUT vtelef , OUTPUT projl , OUTPUT arrendator,OUTPUT TABLE marag ).
   END.   
    
   FOR EACH marag:
      CREATE marag2.
      BUFFER-COPY marag TO marag2.
   END.
     
   CREATE uppfoltemp.
   ASSIGN
   uppfoltemp.FORETAG = Guru.Konstanter:globforetag   
   uppfoltemp.ALLAMA = FALSE
   uppfoltemp.VALVARD = ""
   uppfoltemp.FORSTA = TRUE
   uppfoltemp.STAMP = FALSE.
   
   FIND FIRST emarkval NO-LOCK NO-ERROR.
   EMPTY TEMP-TABLE inextradatatemp NO-ERROR.
   EMPTY TEMP-TABLE extradatatemp NO-ERROR. 
   CREATE inextradatatemp.          
   ASSIGN
   inextradatatemp.PROGRAM = "VARDNRARTAL"                   
   inextradatatemp.HUVUDINT = emarkval.VARDNR.                    
   RUN etabhamt_UI IN edataapph (INPUT TABLE inextradatatemp, OUTPUT TABLE extradatatemp). 
   FIND FIRST extradatatemp NO-LOCK NO-ERROR.
   IF AVAILABLE extradatatemp THEN DO:      
      ASSIGN
      vardartal = extradatatemp.SOKINT[1].      
   END.
   ELSE vardartal = YEAR(TODAY).   
   EMPTY TEMP-TABLE inextradatatemp NO-ERROR.
   EMPTY TEMP-TABLE extradatatemp NO-ERROR.
   
   RUN kopindex_UI IN skprotapph  (INPUT  (vardartal - 1), OUTPUT kopindex, OUTPUT bbelopp ).
   minimi = 3 * bbelopp.
    
   FIND FIRST emarkval NO-LOCK NO-ERROR.
   
   RUN vardman_UI IN skprotapph (INPUT emarkval.VARDNR, OUTPUT vardman, OUTPUT vardtel, OUTPUT kabersatt).
   FIND FIRST emarkval NO-LOCK NO-ERROR.
   
   RUN projledup_UI IN skprotapph (INPUT emarkval.VARDNR, OUTPUT projledf, OUTPUT projtel, OUTPUT projepost, OUTPUT vaman, OUTPUT vatel, OUTPUT vaepost).
   FIND FIRST emarkval NO-LOCK NO-ERROR.
   RUN vardnrnatag_UI IN skprotapph (INPUT emarkval.VARDNR, OUTPUT vardnrnatag).   
   FIND FIRST emarkval NO-LOCK NO-ERROR.  
   RUN markupp_UI IN skprotapph
   (INPUT "" ,INPUT emarkval.BETECKNING,INPUT emarkval.MARKREC,INPUT TABLE uppfoltemp,INPUT TABLE emarkval,INPUT TABLE maga,OUTPUT TABLE sumtemp).
   FIND FIRST emarkval NO-LOCK NO-ERROR. 
    
   RUN kommentarnat_UI IN skprotapph
   (INPUT emarkval.BETECKNING,INPUT emarkval.VARDNR,OUTPUT kommnatkab).
   RUN kommentarkskap_UI IN skprotapph
   (INPUT emarkval.BETECKNING,INPUT emarkval.VARDNR,OUTPUT kommkskap).
   
   RUN kommentarluft_UI IN skprotapph
   (INPUT emarkval.BETECKNING,INPUT emarkval.VARDNR,OUTPUT kommluft).
   RUN kommentarjk_UI IN skprotapph
   (INPUT emarkval.BETECKNING,INPUT emarkval.VARDNR,OUTPUT kommjk).
     
  /* FOR EACH SUMTEMP WHERE NO-LOCK:
      MESSAGE SUMTEMP.BETECKNING SUMTEMP.SUMMA SUMTEMP.PROCENT SUMTEMP.TILLAGG SUMTEMP.PASLAG SUMTEMP.NINTRANG SUMTEMP.ERSATT
      VIEW-AS ALERT-BOX.
   END.*/
   RUN mval_UI.
   antagare = 0.
   FOR EACH marag NO-LOCK:
      antagare = antagare + 1.
   END.   
   ASSIGN
   antfast = 0
   fbet = "".
   FOR EACH marag BY marag.BETECKNING:
      IF fbet NE marag.BETECKNING THEN antfast = antfast + 1.
      fbet = marag.BETECKNING.
   END.
   IF antfast > 1 THEN DO:
      mg = "".
      FOR EACH marag BY marag.MARKAGARE:
         IF mg = marag.MARKAGARE THEN DELETE marag.
         IF AVAILABLE marag THEN mg = marag.MARKAGARE.
      END.
      mg = "".
      FOR EACH marag2 BY marag2.MARKAGARE:
         IF mg = marag2.MARKAGARE THEN DELETE marag2.
         IF AVAILABLE marag2 THEN mg = marag2.MARKAGARE.
      END.
   END.
   IF Guru.Konstanter:globforetag = "BHEL"  OR Guru.Konstanter:globforetag = "ESKO" THEN omravd = 4.
   IF Guru.Konstanter:globforetag = "NYLB"  THEN omravd = 1.
   IF Guru.Konstanter:globforetag = "GREL"  THEN omravd = 1.
   IF Guru.Konstanter:globforetag = "REJI" OR Guru.Konstanter:globforetag = "ELPC"  THEN omravd = 1.
   IF Guru.Konstanter:globforetag = "FORS"  THEN omravd = 1.
   IF Guru.Konstanter:globforetag = "ETSA"  THEN omravd = 1.
   delsumover = FALSE.
   
   ASSIGN
   lled = 0
   jkab = 0
   nats = 0
   jklsp = 0
   kskap = 0
   ovg = 0
   tlgg = 0
   ttalt = 0
   mmini = 0
   lleduex = 0
   jkabuex = 0
   natsuexl = 0 
   natsbaraexl = 0                  
   kskapuexl =  0
   kskapbaraexl = 0
   gers = 0

   fbet = ""
   fabet = "".
   fastbelopp = 0.
   /*Obs dessa uträkningar finns i OVERSIKTVIS.W också men då i temp-table MUAtemp*/ 
   /* summera ihop  för om det finns fler fastigehter*/
   
   /*FOR EACH mval WHERE NO-LOCK:
      MESSAGE "A" mval.BETECKNING mval.PRODEL mval.ANDEL MVAL.MARKERAD MVAL.KONTAKT MVAL.PRODEL
      VIEW-AS ALERT-BOX.
       
   END.*/
   
   FOR EACH mval BY mval.BETECKNING:
      IF mval.BETECKNING NE fbet THEN DO:
         fabet = fabet + " " + mval.BETECKNING.
         FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
         IF AVAILABLE sumtemp THEN DO:
           
            mmini = mmini + sumtemp.MINIERS.
            IF avtal BEGINS "upplåtelse"  THEN DO:             
               lled = lled + sumtemp.OMN + sumtemp.OMB + sumtemp.SMN + sumtemp.SMB.
               /*OM DECIMAL FRAMRÄKNAD - ANVÄND*/
               IF sumtemp.JKNDEC > 0 THEN jkab = jkab + sumtemp.JKNDEC - sumtemp.JKB.            
               ELSE jkab = jkab + sumtemp.JKN - sumtemp.JKB.  
               IF Guru.Konstanter:varforetypval[40] = 1 THEN DO:  
                  lleduex = lleduex + ((sumtemp.OMN + sumtemp.OMB)/ ( 1 + ( 0.25 * 0.66 )))  + ((sumtemp.SMN + sumtemp.SMB) / 1.25).
                  /*OM DECIMAL FRAMRÄKNAD - ANVÄND*/
                  IF sumtemp.JKNDEC > 0 THEN jkabuex = jkabuex + ((sumtemp.JKNDEC - sumtemp.JKB) / 1.25).
                  ELSE jkabuex = jkabuex + ((sumtemp.JKN - sumtemp.JKB) / 1.25).      
               END.                  
               nats = nats + sumtemp.TSF - sumtemp.TSB.
               IF Guru.Konstanter:varforetypval[40] = 1 THEN DO:   
                  natsuexl =  nats / 1.25.
                  natsbaraexl = nats - ( nats / 1.25).
               END.          
               /*separera kabelskåp och station på två rader kabelskåp ska in på överigt   lena 20140507*/
                              
               kskap = kskap + sumtemp.TSKF - sumtemp.TSKB.
               IF Guru.Konstanter:varforetypval[40] = 1 THEN DO:   
                  kskapuexl =  kskap / 1.25.
                  kskapbaraexl = kskap - ( kskap / 1.25).
               END.                    
               IF avtal BEGINS "upplåtelse" THEN DO:                                                     
                  ovg = ovg + sumtemp.OVRIG.
                  IF Guru.Konstanter:varforetypval[40] = 1 THEN DO:    
                     tlgg = tlgg + sumtemp.TILLAGG.   /* + kskapbaraexl + natsbaraexl.*/  
                  END.
                  ELSE tlgg = tlgg + sumtemp.TILLAGG.
                   
                  jkab = jkab + sumtemp.JKLN - sumtemp.JKLB.     /* obs! lägg till lågspänning om uppdalad*/
                  fastbelopp = fastbelopp + sumtemp.SMF + sumtemp.JKF +  sumtemp.OMF.
                  /* borttaget eftersom kabelskåp ska ut separat 20140507
                  nats = nats + sumtemp.TSKF - sumtemp.TSKB.    /*lägg till även kabelskåpen till nätstation*/*/                    
               END.
            END.
          
           
            gers = gers + sumtemp.GRUNDERS.         
            ttalt = ttalt + sumtemp.SUMMA.
            
         END.
      END.
      fbet = mval.BETECKNING.
   END.   
   
   IF Guru.Konstanter:varforetypval[40] = 1 THEN DO:      
      exltot = (lled - lleduex) + (jkab - jkabuex) + (sumtemp.TSF + sumtemp.TSKF - ((sumtemp.TSF + sumtemp.TSKF) / 1.25)).
   END.
   ELSE IF Guru.Konstanter:varforetypval[40] = 0 THEN DO:                
      exltot = ((sumtemp.OMN + sumtemp.OMB) * ( 0.25 * 0.66 ))  + ((sumtemp.SMN + sumtemp.SMB) * 0.25) + ((sumtemp.TSF + sumtemp.TSKF) * 0.25).
      /*OM DECIMAL FRAMRÄKNAD - ANVÄND*/
      IF sumtemp.JKNDEC > 0 THEN exltot = exltot + ((sumtemp.JKNDEC - sumtemp.JKB) * 0.25).
      ELSE exltot = exltot + ((sumtemp.JKN - sumtemp.JKB) * 0.25).      
   END.      
   fnamnb = ".doc".
   fnamnD = ".docx".
   
   IF avtal = "upplåtelseluft" OR avtal BEGINS "upplåtelseluftLast" OR avtal BEGINS "upplåtelseovanLast"  THEN DO:   
      lujona = "".
      IF avtal = "upplåtelseluft" THEN fnamnA = "Muluft".      
      ELSE IF avtal = "upplåtelseluftLast2022" THEN DO:
          fnamnA = "MUA Luft2022".
          fnamnC = "MUA Under".
          fnamnB = ".docx".
      END.      
      ELSE IF avtal = "upplåtelseluftLast2020" THEN DO:
          fnamnA = "MUA Luft2020".
          fnamnC = "MUA Under".
          fnamnB = ".docx".
      END.       
      ELSE IF avtal = "upplåtelseluftLastsnat" THEN DO:
         fnamnA = "MUA Luftsnat".     
         fnamnB = ".docx".     
      END.
      ELSE IF avtal = "upplåtelseluftLastpite" THEN DO:
         fnamnA = "MUA Luftpite".     
         fnamnB = ".doc".     
      END.
      ELSE IF avtal = "upplåtelseluftLastVB" THEN DO:
         fnamnA = "MUA VBE".     
         fnamnB = ".docx".     
      END.
      ELSE IF avtal = "upplåtelseluftLastmal" THEN DO:
         fnamnA = "MUA MalungSälen luft".     
         fnamnB = ".docx".     
      END.           
      ELSE IF avtal = "upplåtelseluftLastEllevio" THEN DO:
         fnamnA = "MUA Ellevio".     
         fnamnB = ".docx".         
      END.
      ELSE IF avtal = "upplåtelseluftLast2022Ellevio" THEN DO:
         fnamnA = "MUA Ellevio2022".     
         fnamnB = ".docx".         
      END.
      
      ELSE IF avtal = "upplåtelseovanLast" THEN DO:
         fnamnA = "MUA ovan odlingsgräns".     
         fnamnB = ".docx".         
      END.
      ELSE IF avtal = "upplåtelseovanLastJSB" THEN DO:
         fnamnA = "SFV ovan odlingsgräns".     
         fnamnB = ".doc".         
      END.
                     
      FIND FIRST mval NO-LOCK NO-ERROR.   
      FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
      IF AVAILABLE sumtemp THEN DO:             
         IF Guru.Konstanter:globforetag = "TECT" OR Guru.Konstanter:globforetag = "PICA"  OR Guru.Konstanter:globforetag = "SWEO" OR Guru.Konstanter:globforetag = "REJI" OR Guru.Konstanter:globforetag = "ELPC" OR Guru.Konstanter:globforetag = "SKOK"
         OR Guru.Konstanter:globforetag = "JSBF" OR Guru.Konstanter:globforetag = "ATS" OR Guru.Konstanter:globforetag = "SKEL"  OR Guru.Konstanter:globforetag = "VALL" OR Guru.Konstanter:globforetag = "LULE" THEN DO: 
            /*tectel vill ha skogen (kalmark) som luftledning*/
            IF (sumtemp.OMN + sumtemp.OMB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = "l".  /*Luftledning*/
            IF (sumtemp.JKN - sumtemp.JKB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/
            IF (sumtemp.TSF - sumtemp.TSB) > 0 THEN lujona = lujona + "n".                     /*Nätstation*/
         END.
         ELSE DO:
            IF (sumtemp.OMN + sumtemp.OMB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = "l".  /*Luftledning*/
            IF (sumtemp.JKN - sumtemp.JKB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/
            IF (sumtemp.TSF - sumtemp.TSB) > 0 THEN lujona = lujona + "n".                     /*Nätstation*/
         END.
      END.            
   END.
   ELSE IF avtal = "upplåtelsemark" OR avtal BEGINS "upplåtelsemarkLast" OR avtal BEGINS "upplåtelsetätLast" 
    OR avtal = "upplåtelseutanLastsnat"   OR avtal BEGINS  "upplåtelseoptoLast"    THEN DO:
       lujona = "".
       IF avtal = "upplåtelsemarkLast2022" THEN DO:
          fnamnA = "MUA Jord2022".
          fnamnB = ".docx".
          fnamnC = "MUA Under".
       END.             
       ELSE IF avtal = "upplåtelsemarkLast2020" THEN DO:
          fnamnA = "MUA Jord2020".
          fnamnB = ".docx".
          fnamnC = "MUA Under".
       END.             
       ELSE IF avtal = "upplåtelsetätLast2022" THEN DO:
          fnamnA = "MUA Tät2022".
          fnamnC = "MUA Under".
          fnamnB = ".docx".
       END.
       ELSE IF avtal = "upplåtelsetätLast2020" THEN DO:
          fnamnA = "MUA Tät2020".
          fnamnC = "MUA Under".
          fnamnB = ".docx".
       END.             
       /*ELSE IF avtal = "upplåtelseoptLast2017" THEN DO:
          fnamnA = "MUA Opto2017".
          fnamnC = "MUA Under".
       END.*/
       ELSE IF avtal = "upplåtelsemarkLastsnat" THEN DO:
         fnamnA = "MUA Marksnat".     
         fnamnB = ".docx".     
       END.
       ELSE IF avtal = "upplåtelseutanLastsnat" THEN DO:
         fnamnA = "MUA Utansnat".     
         fnamnB = ".docx".     
       END.
       ELSE IF avtal = "upplåtelsemarkLastdala" THEN DO:
         fnamnA = "MUA MarkDala".     
         fnamnB = ".docx".     
       END.      
       ELSE IF avtal = "upplåtelsemarkLastpite" THEN DO:
         fnamnA = "MUA Jordpite".     
         fnamnB = ".doc".     
       END.
       ELSE IF avtal = "upplåtelseoptoLastpite" THEN DO:
         fnamnA = "MUA Optopite".     
         fnamnB = ".doc".     
       END.       
       ELSE IF avtal = "upplåtelsemarkLastjämtL" THEN DO:
          lujona = "".      
          fnamnA = "JämtkraftMUAL". 
          fnamnb = ".dotx".        
       END.              
       ELSE IF avtal = "upplåtelsemarkLastjämtM" THEN DO:
          lujona = "".      
          fnamnA = "JämtkraftMUAM". 
          fnamnb = ".dotx".        
       END.              
       ELSE IF avtal = "upplåtelsemarkLastjämtSM" THEN DO:
          lujona = "".      
          fnamnA = "JämtkraftMUASM". 
          fnamnb = ".dotx".        
       END.              
       ELSE IF avtal = "upplåtelsemarkLastjämtTM" THEN DO:
          lujona = "".      
          fnamnA = "JämtkraftMUATM". 
          fnamnb = ".dotx".        
       END.
       ELSE IF avtal = "upplåtelsemarkLastjämtKO" THEN DO:
          lujona = "".      
          fnamnA = "JämtkraftMUAKO". 
          fnamnb = ".docx".        
       END.
       ELSE IF avtal = "upplåtelsemarkLastjämtJ" THEN DO:
          lujona = "".      
          fnamnA = "JämtkraftMUAJ". 
          fnamnb = ".docx".        
       END.
       ELSE IF avtal = "upplåtelsemarkLastmal" THEN DO:
         fnamnA = "MUA MalungSälen mark".     
         fnamnB = ".docx".     
      END.
       
                               
       FIND FIRST mval NO-LOCK NO-ERROR.   
       FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
       IF AVAILABLE sumtemp THEN DO:             
          IF Guru.Konstanter:globforetag = "TECT" OR Guru.Konstanter:globforetag = "PICA"  OR Guru.Konstanter:globforetag = "SWEO" OR Guru.Konstanter:globforetag = "REJI" OR Guru.Konstanter:globforetag = "ELPC" OR Guru.Konstanter:globforetag = "SKOK"
          OR Guru.Konstanter:globforetag = "JSBF" OR Guru.Konstanter:globforetag = "ATS" OR Guru.Konstanter:globforetag = "SKEL"   OR Guru.Konstanter:globforetag = "VALL" OR Guru.Konstanter:globforetag = "LULE" THEN DO: 
            /*tectel vill ha skogen (kalmark) som luftledning*/            
            IF (sumtemp.JKN - sumtemp.JKB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/
            IF (sumtemp.TSF - sumtemp.TSB) > 0 THEN lujona = lujona + "n".                     /*Nätstation*/
         END.
         ELSE DO:            
            IF (sumtemp.JKN - sumtemp.JKB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/
            IF (sumtemp.TSF - sumtemp.TSB) > 0 THEN lujona = lujona + "n".                     /*Nätstation*/
         END.
      END.           
   END.
   ELSE IF avtal = "elleviofölj" THEN DO:
       fnamnA = "FöljebrevEllevioSV".
       fnamnB = ".docx".
   END.
   ELSE IF avtal = "dalafölj" THEN DO:
       fnamnA = "FöljebrevDESV".
       fnamnB = ".doc".
   END.
   ELSE IF avtal = "ellevioinfo" THEN DO:
       fnamnA = "Infobrev Ellevio AxedaMM".
       fnamnB = ".docx".
   END.
   ELSE IF avtal = "UEföljFP" THEN DO:
       fnamnA = "Följebrev UE fysisk person".
       fnamnB = ".doc".
   END.
   ELSE IF avtal = "UEföljJP" THEN DO:
       fnamnA = "Följebrev UE Juridisk person".
       fnamnB = ".doc".
   END.
   ELSE IF avtal = "UEföljRA" THEN DO:
       fnamnA = "Följebrev UE Rev-avtal".
       fnamnB = ".doc".
   END.
   /*ELSE IF avtal = "upplåtelsemarkLastjämtL" THEN DO:
      lujona = "".      
      fnamnA = "JämtkraftMUAL". 
      fnamnb = ".dotx".        
   END.              
   ELSE IF avtal = "upplåtelsemarkLastjämtM" THEN DO:
      lujona = "".      
      fnamnA = "JämtkraftMUAM". 
      fnamnb = ".dotx".        
   END.              
   ELSE IF avtal = "upplåtelsemarkLastjämtSM" THEN DO:
      lujona = "".      
      fnamnA = "JämtkraftMUASM". 
      fnamnb = ".dotx".        
   END.              
   ELSE IF avtal = "upplåtelsemarkLastjämtTM" THEN DO:
      lujona = "".      
      fnamnA = "JämtkraftMUATM". 
      fnamnb = ".dotx".        
   END.*/
   ELSE IF avtal = "upplåtelsemarkbod" THEN fnamnA = "Markujordb".      
   ELSE IF avtal = "upplåtelseluftbod" THEN fnamnA = "Markuluftb".     
   ELSE IF avtal = "upplåtelsemarklul" THEN DO:
       fnamnA = "Mujordlu".
       fnamnB = ".docx".
   END.            
   ELSE IF avtal = "upplåtelseluftlul" THEN DO:
      fnamnA = "Muluftlu".
      fnamnB = ".docx".
   END.   
   ELSE IF avtal = "gravtillstandlul" THEN DO:
      fnamnA = "GrävtillståndLuleå".
      fnamnB = ".docx".
   END.    
   ELSE IF avtal = "upplåtelsemarkjuk" THEN DO:
       fnamnA = "Mujordju".        
   END.
   ELSE IF avtal = "upplåtelsemarkjuk10" THEN DO:
       fnamnA = "Mujordju10".        
   END.   
   ELSE IF avtal = "upplåtelseluftjuk" THEN DO:
       fnamnA = "Muluftju".        
   END.    
   ELSE IF avtal = "upplåtelsekom" THEN fnamnA = "MUAHU".
   ELSE IF avtal = "upplåtelsekomso" THEN DO:
       fnamnA = "MUASO".
       fnamnB = ".docx".
   END.
   ELSE IF avtal = "upplåtelsekomty" THEN DO:
       fnamnA = "MUATY".
       fnamnB = ".doc".
   END.
      
  
   ELSE IF avtal = "upplåtelseskell" THEN DO:
      assign
      fnamnA = "MUAskellefteå"
      fnamnb = ".dotx".
      FIND FIRST mval NO-LOCK NO-ERROR.   
      FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
      IF AVAILABLE sumtemp THEN DO:                                             
         IF (sumtemp.JKN - sumtemp.JKB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/
         IF (sumtemp.TSF - sumtemp.TSB) > 0 THEN lujona = lujona + "n".                     /*Nätstation*/         
      END.
   END.                     
   ELSE IF avtal = "eonupplåtelse"  OR avtal = "eonupplåtelseN" OR avtal = "eonupplåtelse2022" THEN DO:
      IF avtal = "eonupplåtelse" THEN fnamnb = ".doc".
      IF avtal = "eonupplåtelseN" THEN fnamnb = ".dotm".
      IF avtal = "eonupplåtelse2022" THEN fnamnb = ".docx".      
      lujona = "".
      FIND FIRST mval NO-LOCK NO-ERROR.   
      FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
      IF AVAILABLE sumtemp THEN DO:             
         IF Guru.Konstanter:globforetag = "TECT" OR Guru.Konstanter:globforetag = "PICA"  OR Guru.Konstanter:globforetag = "SWEO" OR Guru.Konstanter:globforetag = "REJI" OR Guru.Konstanter:globforetag = "ELPC" OR Guru.Konstanter:globforetag = "SKOK"
         OR Guru.Konstanter:globforetag = "JSBF" OR Guru.Konstanter:globforetag = "ATS" OR Guru.Konstanter:globforetag = "SKEL"  OR Guru.Konstanter:globforetag = "VALL"  OR Guru.Konstanter:globforetag = "WSP"  OR Guru.Konstanter:globforetag = "LULE"
         OR Guru.Konstanter:globforetag = "SSEL" THEN DO: 
            IF (sumtemp.OMN + sumtemp.OMB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = "l".  /*Luftledning*/
            IF (sumtemp.JKN - sumtemp.JKB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/    
         END.
         ELSE DO:
            IF (sumtemp.OMN + sumtemp.OMB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = "l".  /*Luftledning*/
            IF (sumtemp.JKN - sumtemp.JKB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/    
         END.
      END.
      IF avtal = "eonupplåtelse2022" THEN fnamnA = "EONMUA-mark".
      
      ELSE fnamnA = "Eonmarkupp".
               
   END.
   ELSE IF avtal = "eonupplåtelseR" THEN DO:
      fnamnA = "Eonmarkteupp".           
   END.
      
                                 
   fnamn = fnamnA + fnamnB.  
   IF fnamnC NE "" THEN fnamnU = fnamnC + fnamnD.
   
   /*fnamn = "Markupplåtelseavtal.Doc".*/
   IF Guru.Konstanter:appcon THEN RUN FINNSTABELL.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT (INPUT "BLOBINFO", OUTPUT bloblog).
   ELSE RUN FINNSTABELL.P (INPUT "BLOBINFO", OUTPUT bloblog).
   
   IF bloblog = TRUE THEN DO:
      {FINNSDYNBLOB.I}
      DEFINE VARIABLE resid AS INTEGER NO-UNDO.
      RUN blobfil_UI IN blobproch (INPUT fnamn, OUTPUT resid).
      IF resid = ? THEN DO:
         kommando = SEARCH(fnamn).      
      END.
      ELSE DO:
         FIND FIRST blobinfotemp WHERE blobinfotemp.ID = resid NO-LOCK NO-ERROR.
         RUN blobopen_UI IN blobproch (INPUT blobinfotemp.FILNAMN, OUTPUT kommando).
      END.
      RUN deleteproc_UI IN blobproch.
      IF VALID-HANDLE(blobproch) THEN DELETE PROCEDURE blobproch NO-ERROR.
   END.
   ELSE kommando = SEARCH(fnamn).   
   /*MESSAGE kommando "SÖK OK" VIEW-AS ALERT-BOX.*/
   IF kommando = ? THEN DO:
      MESSAGE "Hittade inte " fnamn VIEW-AS ALERT-BOX.
      RETURN.       
   END.   
  
   IF fnamnU NE "" THEN DO:
      IF bloblog = TRUE THEN DO:
         {FINNSDYNBLOB.I}
         RUN blobfil_UI IN blobproch (INPUT fnamnU, OUTPUT resid).
         IF resid = ? THEN DO:
            kommandoU = SEARCH(fnamnU).      
         END.
         ELSE DO:
            FIND FIRST blobinfotemp WHERE blobinfotemp.ID = resid NO-LOCK NO-ERROR.
            RUN blobopen_UI IN blobproch (INPUT blobinfotemp.FILNAMN, OUTPUT kommandoU).
         END.
         RUN deleteproc_UI IN blobproch.
         IF VALID-HANDLE(blobproch) THEN DELETE PROCEDURE blobproch NO-ERROR.
      END.
      ELSE kommando = SEARCH(fnamn).         
      IF kommandoU = ? THEN DO:
         MESSAGE "Hittade inte " fnamnU VIEW-AS ALERT-BOX.
         RETURN.       
      END.   
      kommandoU4 = kommandoU.
   END.   
   
   kommando2 = SESSION:TEMP-DIRECTORY + Guru.Konstanter:globanv + "\".
   kommando3 = SESSION:TEMP-DIRECTORY + Guru.Konstanter:globanv + "\".
   kommando4 = kommando.
   
   {SESSIONTEMPDIR.I}
   IF SESSION:CLIENT-TYPE = "WEBCLIENT" THEN DO:
       kommando2 = webclienttempdir.
       kommando3 = webclienttempdir.
   END.
   OS-CREATE-DIR VALUE(kommando2) NO-ERROR.
   
   IF spmall = TRUE AND fildir NE "" THEN DO:
      kommando2 = fildir  + "\".
      kommando3 = fildir  + "\".  
   END.
   
   
      
   DO:   
      RUN skapdok_UI.
      IF avtal = "upplåtelseluftlul"  AND antagare > 4 THEN.
      ELSE IF antagare > 8 THEN DO:
         IF fnamnc NE "" THEN    RUN skapaunderbil_UI.
      END.   
   END.   
END PROCEDURE.

PROCEDURE skapdok_UI.
  DEF VAR hjfastnamn AS CHARACTER.
  
   FIND FIRST marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR .         
   IF AVAILABLE marag2 THEN DO:
      hjfastnamn = marag2.BETECKNING.
      hjfastnamn = REPLACE(hjfastnamn,":"," ").
      hjfastnamn = REPLACE(hjfastnamn,"/"," ").      
      hjfastnamn = REPLACE(hjfastnamn,"-"," ").
      hjfastnamn = REPLACE(hjfastnamn,">"," ").
      hjfastnamn = REPLACE(hjfastnamn,"<"," ").
      
      /*kompletterat med tecken som ej får finnas i filnamn lena 20221124*/
      hjfastnamn = REPLACE(hjfastnamn,"\"," ").
      hjfastnamn = REPLACE(hjfastnamn,"*"," ").
      hjfastnamn = REPLACE(hjfastnamn,"|"," ").
      hjfastnamn = REPLACE(hjfastnamn,'"'," ").
      hjfastnamn = REPLACE(hjfastnamn,";"," ").      
      hjfastnamn = REPLACE(hjfastnamn,","," ").
      hjfastnamn = REPLACE(hjfastnamn,"'"," ").
      hjfastnamn = REPLACE(hjfastnamn,"+"," ").
      hjfastnamn = REPLACE(hjfastnamn,"."," "). 
      
      IF Guru.GlobalaVariabler:plusaonr = "" OR Guru.GlobalaVariabler:plusaonr = ? THEN DO:
         kommando2 = kommando3 + fnamnA + " " + hjfastnamn + fnamnB.
      END.
      ELSE DO:
         kommando2 = kommando3 + TRIM (Guru.GlobalaVariabler:plusaonr) + TRIM(STRING(Guru.GlobalaVariabler:plusdnr,Guru.Konstanter:varforetypchar[1])) + fnamnA + " " + hjfastnamn +  fnamnB.
      END.
   END.
   ELSE DO:   
      
      IF Guru.GlobalaVariabler:plusaonr = "" OR Guru.GlobalaVariabler:plusaonr = ? THEN DO:
         kommando2 = kommando3 + fnamnA + string(sidvar) + fnamnB.
      END.
      ELSE DO:
         kommando2 = kommando3 + TRIM (Guru.GlobalaVariabler:plusaonr) + TRIM(STRING(Guru.GlobalaVariabler:plusdnr,Guru.Konstanter:varforetypchar[1])) + fnamnA + string(sidvar) + fnamnB.
      END.
   END.   
   
   OS-COPY VALUE(kommando4) VALUE(kommando2).   
   kommando = kommando2.
 /*
   MESSAGE "nu skapas word!"  kommando4  " och " kommando2 
   VIEW-AS ALERT-BOX.
   */   
   CREATE "Word.Application" chWord NO-ERROR.
   
   /*
   MESSAGE "Fel status läge 1" ERROR-STATUS:ERROR 
   VIEW-AS ALERT-BOX. 
   */
   IF ERROR-STATUS:ERROR = FALSE THEN DO:
      chWord:Options:AllowReadingMode = FALSE NO-ERROR. /*Fix för excel 2013*/
      chDoc = chWord:Documents:Open(kommando,,,,,,,,,).
      IF avtal BEGINS "upplåtelseluftLast" OR avtal BEGINS  "upplåtelsemarkLast" OR avtal BEGINS  "upplåtelsetätLast" OR avtal BEGINS  "upplåtelseovanLast" THEN DO:
         /*chDoc:Unprotect("gurulösen").*/
         chWord:VISIBLE = FALSE.
      END.   
      ELSE DO:
         chDoc:Protect(2) NO-ERROR.
         chWord:VISIBLE = TRUE.
      END.  
      IF spmall = TRUE THEN chWord:Visible = FALSE.
      ELSE IF  skrivutmall = TRUE THEN chWord:Visible = FALSE.
      EMPTY TEMP-TABLE tidut NO-ERROR. 
      ASSIGN
      hjproc = 0
      hjagare = 0.
      FOR EACH mval:
         hjagare = hjagare + 1.
         hjproc = hjproc + mval.PRODEL.
      END.
      
      FIND FIRST mval NO-LOCK NO-ERROR.  
      ASSIGN mval.AONR = aovar
      mval.DELNR = delnrvar.   
      
      IF avtal BEGINS  "eonupplåtelse" THEN DO:  
         IF Guru.Konstanter:globforetag = "TECT" OR Guru.Konstanter:globforetag = "PICA"  OR Guru.Konstanter:globforetag = "SWEO" OR Guru.Konstanter:globforetag = "GREL" OR Guru.Konstanter:globforetag = "FORS" OR Guru.Konstanter:globforetag = "REJI" OR Guru.Konstanter:globforetag = "ELPC" OR Guru.Konstanter:globforetag = "ETSA" 
         OR Guru.Konstanter:globforetag = "SKOK" OR Guru.Konstanter:globforetag = "JSBF" OR Guru.Konstanter:globforetag = "ATS"  OR Guru.Konstanter:globforetag = "SKEL"  OR Guru.Konstanter:globforetag = "VALL"  OR Guru.Konstanter:globforetag = "WSP"  OR Guru.Konstanter:globforetag = "LULE" 
         OR Guru.Konstanter:globforetag = "SSEL" THEN DO:                        
            IF pnamn NE "" THEN RUN inbokvalue_UI (INPUT "Projektnamn" ,INPUT pnamn).
            IF lelitt NE "" THEN RUN inbokvalue_UI (INPUT "Text1" ,INPUT lelitt).                            
            IF konc NE "" THEN RUN inbokvalue_UI (INPUT "Text2" ,INPUT konc).
            IF konc NE "" THEN RUN inbokvalue_UI (INPUT "Konc" ,INPUT konc).         
            /*IF domsaga NE "" THEN RUN inbokvalue_UI (INPUT "Text5" ,INPUT domsaga).*/                        
            /*IF par1a > 0 THEN RUN inbokvalue_UI (INPUT "a1" ,INPUT par1a).                        
            IF par1b > 0 THEN RUN inbokvalue_UI (INPUT "b1" ,INPUT par1b).                        
            IF par2c > 0 THEN RUN inbokvalue_UI (INPUT "c2" ,INPUT par2c).*/                        
            
         END.
         RUN inbokvaluetba12_UI (INPUT "Kontaktnamn" ,INPUT vman).  
         RUN inbokvaluetba12_UI (INPUT "Kontaktnamn2" ,INPUT vman).  
         RUN inbokvaluetba12_UI (INPUT "KontaktAdress" ,INPUT vadress + "   " + vpadress ).        
         RUN inbokvaluetba12_UI (INPUT "Kontakttele" ,INPUT vtelef).
         FIND FIRST marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR .
         
         IF AVAILABLE marag2 THEN DO:
            /*ägare 1*/         
            RUN inbokvaluetnr12_UI (INPUT "Fägare1" ,INPUT marag2.MARKAGARE).   
            RUN inbokvaluetba12_UI (INPUT "Fastighetsägare1" ,INPUT marag2.MARKAGARE).   
            RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande1" ,INPUT marag2.BETECKNING).
            RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande1" ,INPUT marag2.KOMMUN).
         END.
         FIND NEXT marag2 USE-INDEX BETECKNING  NO-LOCK NO-ERROR.
         IF AVAILABLE marag2 THEN DO:
            /*ägare 2*/   
            RUN inbokvaluetnr12_UI (INPUT "Fägare2" ,INPUT marag2.MARKAGARE).   
            RUN inbokvaluetba12_UI (INPUT "Fastighetsägare2" ,INPUT marag2.MARKAGARE).   
            RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande2" ,INPUT marag2.BETECKNING).
            RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande2" ,INPUT marag2.KOMMUN).
            FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
            IF AVAILABLE marag2 THEN DO:       
               /*ägare 3*/
               RUN inbokvaluetnr12_UI (INPUT "Fägare3" ,INPUT marag2.MARKAGARE).   
               RUN inbokvaluetba12_UI (INPUT "Fastighetsägare3" ,INPUT marag2.MARKAGARE).   
               RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande3" ,INPUT marag2.BETECKNING).
               RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande3" ,INPUT marag2.KOMMUN).
               RUN inbokvaluetnr12_UI (INPUT "BilagaFastighet" ,INPUT marag2.BETECKNING).   
               FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
               IF AVAILABLE marag2 THEN DO:          
                  /*ägare 4*/
                  RUN inbokvaluetnr12_UI (INPUT "Fägare4" ,INPUT marag2.MARKAGARE).   
                  RUN inbokvaluetba12_UI (INPUT "Fastighetsägare4" ,INPUT marag2.MARKAGARE).   
                  RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande4" ,INPUT marag2.BETECKNING).
                  RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande4" ,INPUT marag2.KOMMUN).
                  FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                  IF AVAILABLE marag2 THEN DO:
                     /*ägare 5*/
                     RUN inbokvaluetnr12_UI (INPUT "Fägare5" ,INPUT marag2.MARKAGARE).   
                     RUN inbokvaluetba12_UI (INPUT "Fastighetsägare5" ,INPUT marag2.MARKAGARE).   
                     RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande5" ,INPUT marag2.BETECKNING).
                     RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande5" ,INPUT marag2.KOMMUN).
                     FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                     IF AVAILABLE marag2 THEN DO:
                        /*ägare 6*/
                        RUN inbokvaluetnr12_UI (INPUT "Fägare6" ,INPUT marag2.MARKAGARE).   
                        RUN inbokvaluetba12_UI (INPUT "Fastighetsägare6" ,INPUT marag2.MARKAGARE).   
                        RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande6" ,INPUT marag2.BETECKNING).
                        RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande6" ,INPUT marag2.KOMMUN).
                        FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                        IF AVAILABLE marag2 THEN DO:
                           /*ägare 7*/
                           RUN inbokvaluetnr12_UI (INPUT "Fägare7" ,INPUT marag2.MARKAGARE).   
                           RUN inbokvaluetba12_UI (INPUT "Fastighetsägare7" ,INPUT marag2.MARKAGARE).   
                           RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande7" ,INPUT marag2.BETECKNING).
                           RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande7" ,INPUT marag2.KOMMUN).
                           FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                           IF AVAILABLE marag2 THEN DO:
                             
                              /*ägare 8*/
                              RUN inbokvaluetnr12_UI (INPUT "Fägare8" ,INPUT marag2.MARKAGARE).   
                              RUN inbokvaluetba12_UI (INPUT "Fastighetsägare8" ,INPUT marag2.MARKAGARE).   
                              RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande8" ,INPUT marag2.BETECKNING).
                              RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande8" ,INPUT marag2.KOMMUN).
                              FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                              IF AVAILABLE marag2 THEN DO:
                                 /*ägare 9*/
                                 RUN inbokvaluetnr12_UI (INPUT "Fägare9" ,INPUT marag2.MARKAGARE).   
                                 RUN inbokvaluetba12_UI (INPUT "Fastighetsägare9" ,INPUT marag2.MARKAGARE).   
                                 RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande9" ,INPUT marag2.BETECKNING).
                                 RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande9" ,INPUT marag2.KOMMUN).
                                 FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                                 IF AVAILABLE marag2 THEN DO:
                                    /*ägare 10*/
                                    RUN inbokvaluetnr12_UI (INPUT "Fägare10" ,INPUT marag2.MARKAGARE).   
                                    RUN inbokvaluetba12_UI (INPUT "Fastighetsägare10" ,INPUT marag2.MARKAGARE).   
                                    RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande10" ,INPUT marag2.BETECKNING).
                                    RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande10" ,INPUT marag2.KOMMUN).
                                    FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                                    IF AVAILABLE marag2 THEN DO:
                                       /*ägare 11*/
                                       RUN inbokvaluetnr12_UI (INPUT "Fägare11" ,INPUT marag2.MARKAGARE).   
                                       RUN inbokvaluetba12_UI (INPUT "Fastighetsägare11" ,INPUT marag2.MARKAGARE).   
                                       RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande11" ,INPUT marag2.BETECKNING).
                                       RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande11" ,INPUT marag2.KOMMUN).
                                       FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                                       IF AVAILABLE marag2 THEN DO:
                                          /*ägare 12*/
                                          RUN inbokvaluetnr12_UI (INPUT "Fägare12" ,INPUT marag2.MARKAGARE).   
                                          RUN inbokvaluetba12_UI (INPUT "Fastighetsägare12" ,INPUT marag2.MARKAGARE).   
                                          RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande12" ,INPUT marag2.BETECKNING).
                                          RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande12" ,INPUT marag2.KOMMUN).
                                       END.
                                    END.
                                 END.
                              END.
   
                           END.
                        END.
   
                     END.
                  END.
   
               END.
            END.
         END.      
         IF arrendator NE "" THEN RUN inbokvalue_UI (INPUT "Nyttjanderättsinneh" ,INPUT arrendator).      
         IF ttalt > 0 THEN RUN inbokvaluetnr12_UI (INPUT "Totalt" ,INPUT STRING(ttalt) + " :-").                       
      END.
      ELSE IF avtal BEGINS  "upplåtelsemarkLastjämt" THEN DO:
         RUN inbokvalue_UI (INPUT "Textruta21" ,INPUT vman).           
         IF antfast > 1 THEN RUN inbokvalue_UI (INPUT "Textruta23" ,INPUT fabet).
         ELSE RUN inbokvalue_UI (INPUT "Textruta23" ,INPUT mval.BETECKNING).          
         RUN inbokvalue_UI (INPUT "Textruta25" ,INPUT fkommun).         
         RUN inbokvalue_UI (INPUT "Text3" ,INPUT fvaker). 
         
         RUN inbokvalue_UI (INPUT "Textruta13" ,INPUT vman).  
         RUN inbokvalue_UI (INPUT "Textruta14" ,INPUT vadress).  
         RUN inbokvalue_UI (INPUT "Textruta15" ,INPUT vpadress).  
         
         RUN inbokvalue_UI (INPUT "Textruta40" ,INPUT vardman).
         
         FIND FIRST marag WHERE marag.MARKAGARE = vman NO-LOCK NO-ERROR.
         IF AVAILABLE marag THEN DO:
            RUN inbokvalue_UI (INPUT "Textruta22" ,INPUT STRING(marag.PERSONNUMMER,"999999-9999")).
         END.   
         IF lelitt NE "" THEN RUN inbokvalue_UI (INPUT "Textruta17" ,INPUT lelitt).                         
         IF nstn NE "" THEN RUN inbokvalue_UI (INPUT "Textruta18" ,INPUT nstn).              
 
 
         FIND FIRST marag NO-LOCK NO-ERROR.                  
         /*ägare 1*/                       
         RUN inbokvalue_UI (INPUT "Textruta27" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).              
         /*IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare21" ,INPUT marag.MARKAGARE).*/                          
         FIND NEXT marag NO-LOCK NO-ERROR.
         IF AVAILABLE marag THEN DO:
            /*ägare 2*/                          
            RUN inbokvalue_UI (INPUT "Textruta28" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                  
            /*IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare22" ,INPUT marag.MARKAGARE).*/                     
            FIND NEXT marag NO-LOCK NO-ERROR.
            IF AVAILABLE marag THEN DO:       
               /*ägare 3*/                          
               RUN inbokvalue_UI (INPUT "Textruta29" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                        
               /*IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare23" ,INPUT marag.MARKAGARE).*/       
               FIND NEXT marag NO-LOCK NO-ERROR.
               IF AVAILABLE marag THEN DO:          
                  /*ägare 4*/                            
                  RUN inbokvalue_UI (INPUT "Textruta30" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                              
                  /*IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare24" ,INPUT marag.MARKAGARE).*/                               
                  FIND NEXT marag NO-LOCK NO-ERROR.
                  IF AVAILABLE marag THEN DO:
                     /*ägare 5*/                                
                     RUN inbokvalue_UI (INPUT "Textruta31" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                                                 
                     /*IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare25" ,INPUT marag.MARKAGARE).*/
                  END.
               END.
            END.
         END.                             
      END.
      ELSE IF avtal = "gravtillstandlul" THEN DO:
         RUN inbokvalue_UI (INPUT "KontaktNamn" ,INPUT vman).  
         RUN inbokvalue_UI (INPUT "KontaktAdress" ,INPUT vadress).  
         RUN inbokvalue_UI (INPUT "KontaktPostadress" ,INPUT vpadress).  
         /*RUN inbokvalue_UI (INPUT "Kontakttele" ,INPUT vtelef).*/
         RUN inbokvalue_UI (INPUT "Fastighettjänande" ,INPUT fabet).
         
         FIND FIRST marag NO-LOCK NO-ERROR.                              
         RUN inbokvalue_UI (INPUT "Fägare1" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).               
         RUN inbokvalue_UI (INPUT "Fastighet1" ,INPUT marag.BETECKNING).
         RUN inbokvalue_UI (INPUT "Datum" ,INPUT STRING(today,"9999-99-99")).
         
         RUN tuppg2_UI IN skprotapph (INPUT marag.MARKNR,OUTPUT telearb,OUTPUT telebost,OUTPUT mobil,OUTPUT epost).
         IF mobil NE "" THEN RUN inbokvalue_UI (INPUT "Kontakttele" ,INPUT mobil).
         ELSE IF telebost NE "" THEN RUN inbokvalue_UI (INPUT "Kontakttele" ,INPUT telebost).
         ELSE IF telearb NE "" THEN RUN inbokvalue_UI (INPUT "Kontakttele" ,INPUT telearb).
         
         RUN inbokvalue_UI (INPUT "epost" ,INPUT epost).
      END.         
      ELSE DO:           
            
         /* "upplåtelseluft"  "upplåtelseluftLast"  "upplåtelsemark"  "upplåtelsemarkLast" */                     
         
         IF lujona NE  "" THEN DO:     
            IF avtal = "upplåtelseluftLast2022Ellevio" THEN DO: 
               /*KRYSSRUTA2 finns ej med i MUA-mark*/
               IF INDEX(lujona,"j") NE 0 THEN RUN inboklog_UI (INPUT "Kryssruta2" ,INPUT TRUE).
               IF INDEX(lujona,"l") NE 0 THEN RUN inboklog_UI (INPUT "Kryssruta1" ,INPUT TRUE).               
               IF INDEX(lujona,"n") NE 0 THEN RUN inboklog_UI (INPUT "Kryssruta3" ,INPUT TRUE).
            END.
            ELSE DO:          
               /*KRYSSRUTA2 finns ej med i MUA-mark*/
               IF INDEX(lujona,"j") NE 0 THEN RUN inboklog_UI (INPUT "Kryssruta1" ,INPUT TRUE).
               IF INDEX(lujona,"l") NE 0 THEN RUN inboklog_UI (INPUT "Kryssruta2" ,INPUT TRUE).               
               IF INDEX(lujona,"n") NE 0 THEN RUN inboklog_UI (INPUT "Kryssruta3" ,INPUT TRUE).
               /*skellefteå kraft*/
               IF INDEX(lujona,"n") NE 0 THEN RUN inboklog_UI (INPUT "Kryssruta12" ,INPUT TRUE).  /*som kryssruta3*/
               IF INDEX(lujona,"j") NE 0 THEN RUN inboklog_UI (INPUT "Kryssruta11" ,INPUT TRUE).  /*som kryssruta1*/
            END.                               
         END.
         
         /*IF vman = "" THEN DO :
            Går det att hitta markerad person istället för kontaktperson 20150924 Lena
         END.
         ELSE DO:*/
         IF vman = "" THEN DO:            
            FIND FIRST marag  WHERE marag.MARKERAD = TRUE NO-LOCK NO-ERROR.
            RUN inbokvalue_UI (INPUT "Text12" ,INPUT marag.MARKAGARE).  
            RUN inbokvalue_UI (INPUT "Text13" ,INPUT marag.GATUADRESS).  
            RUN inbokvalue_UI (INPUT "Text14" ,INPUT (STRING(marag.POSTNUMMER,"xxx xx") + " " + marag.POSTADRESS)).  
            RUN inbokvalue_UI (INPUT "Text15" ,INPUT marag.TELEFON).        
                  
         END.
         ELSE IF avtal = "upplåtelseluftLastEllevio" OR   avtal = "upplåtelseluftLast2022Ellevio" THEN DO:                     
            FIND FIRST marag  WHERE marag.MARKERAD = TRUE NO-LOCK NO-ERROR.
            RUN inbokvalue_UI (INPUT "Text12" ,INPUT marag.MARKAGARE).  
            RUN inbokvalue_UI (INPUT "Text13" ,INPUT marag.GATUADRESS).  
            RUN inbokvalue_UI (INPUT "Text14" ,INPUT (STRING(marag.POSTNUMMER,"xxx xx") + " " + marag.POSTADRESS)).  
            RUN inbokvalue_UI (INPUT "Text15" ,INPUT marag.TELEFON).          
         END.
                  
         ELSE DO:      
           
            RUN inbokvalue_UI (INPUT "Text12" ,INPUT vman).  
            RUN inbokvalue_UI (INPUT "Text13" ,INPUT vadress).  
            RUN inbokvalue_UI (INPUT "Text14" ,INPUT vpadress).  
            RUN inbokvalue_UI (INPUT "Text15" ,INPUT vtelef).
            
            RUN inbokvalue_UI (INPUT "KontaktNamn" ,INPUT vman).
            RUN inbokvalue_UI (INPUT "KontaktNamn1" ,INPUT vman).  
            RUN inbokvalue_UI (INPUT "KontaktAdress" ,INPUT vadress).  
            RUN inbokvalue_UI (INPUT "KontaktPostadress" ,INPUT vpadress).  
            RUN inbokvalue_UI (INPUT "Kontakttele" ,INPUT vtelef).
         END.   
         /*END.     */
         
         /*ccc*/
         IF antfast > 1 THEN RUN inbokvalue_UI (INPUT "Text1" ,INPUT fabet).
         ELSE RUN inbokvalue_UI (INPUT "Text1" ,INPUT mval.BETECKNING).
         IF antfast > 1 THEN RUN inbokvalue_UI (INPUT "Fastighettjänande" ,INPUT fabet).
         ELSE RUN inbokvalue_UI (INPUT "Fastighettjänande" ,INPUT mval.BETECKNING).
         
         RUN inbokvalue_UI (INPUT "Text2" ,INPUT fkommun).
         RUN inbokvalue_UI (INPUT "Kommuntjänande" ,INPUT fkommun).
         RUN inbokvalue_UI (INPUT "Text3" ,INPUT fvaker).
         RUN inbokvalue_UI (INPUT "Läntjänande" ,INPUT fvaker).      

         IF Guru.Konstanter:globforetag = "PICA"  OR Guru.Konstanter:globforetag = "SWEO" OR Guru.Konstanter:globforetag = "REJI" OR Guru.Konstanter:globforetag = "ELPC" OR Guru.Konstanter:globforetag = "SKOK" OR Guru.Konstanter:globforetag = "JSBF" OR Guru.Konstanter:globforetag = "ATS" 
         OR Guru.Konstanter:globforetag = "tect" OR  Guru.Konstanter:globforetag = "SKEL"  OR Guru.Konstanter:globforetag = "VALL"  OR Guru.Konstanter:globforetag = "WSP"  OR Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "SSLE" THEN DO:
            IF avtal = "upplåtelseluftlul" OR avtal = "upplåtelsemarklul" THEN DO:
               /*redan ifyllt*/                              
               RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Luleå").
               RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").
            END.             
            ELSE IF avtal = "upplåtelseluftbod" OR avtal = "upplåtelsemarkbod" THEN DO:
               /*ingen fastighet för bodenavtal*/
               RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Boden").
               RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").
               IF Guru.Konstanter:globforetag = "SKOK" THEN DO:
                  RUN inbokvalue_UI (INPUT "Ledningsunderskrift" ,INPUT "Jan-Olov Nylander").                              
               END.         
            END.
            ELSE DO:         
               IF avtal = "upplåtelsekomso" THEN.  /*förmånsfastighet redan ifylld*/
               ELSE DO:
                  IF fkommun = "Haparanda" OR fkommun = "Kalix" OR fkommun = "Överkalix" OR fkommun =  "Övertorneå"   THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Näsbyn 4:15").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Kalix").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Norrbottens län").
                         
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Näsbyn 4:15").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Kalix").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").         
                  END.              
                  IF fkommun = "Gällivare" OR fkommun = "Jokkmokk" OR fkommun = "Kiruna" OR fkommun =  "Pajala"   THEN DO:    
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Videt 7").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Gällivare").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Norrbottens län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Videt 7").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Gällivare").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").         
                  END.        
                  IF fkommun = "Arvidsjaur" OR fkommun = "Arjeplog" OR fkommun = "Boden" OR fkommun =  "Piteå" OR fkommun =  "Älvsbyn"  THEN DO:    
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Arvidsjaur 6:20").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Arvidsjaur").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Norrbottens län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Arvidsjaur 6:20").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Arvidsjaur").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").                           
                  END.
                  IF fvaker = "Västerbottens län" OR fvaker = "Västernorrlands län" THEN DO: 
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Harrselsfors 1:22").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Vännäs ").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västerbottens län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Harrselsfors 1:22").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Vännäs ").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västerbottens län").         
                  END.               
                  IF fkommun = "Strängnäs" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Biholm 3:10").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Strängnäs").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Södermanlands län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Biholm 3:10").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Strängnäs").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Södermanlands län").
                  END.
                  IF fkommun = "Tyresö" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Bollmora 1:61").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Tyresö").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholms län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Bollmora 1:61").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Tyresö").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
                  END.
                  IF fkommun = "Värmdö" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Bullandö 1:9").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Värmdö").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholms län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Bullandö 1:9").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Värmdö").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
                  END.
                  IF fkommun = "Sigtuna" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Märsta 8:1").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Sigtuna").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholms län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Märsta 8:1").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Sigtuna").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
                  END.
                  IF fkommun = "Botkyrka" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Tumba 8:21").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Botkyrka").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholms län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Tumba 8:21").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Botkyrka").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
                  END.
                  IF fkommun = "Norrtälje" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Häverö-Västernäs 1:65").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Norrtälje").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholms län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Häverö-Västernäs 1:65").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Norrtälje").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
                  END.
                  IF fkommun = "Huddinge" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Transformatorn 2").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Huddinge").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholms län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Transformatorn 2").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Huddinge").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
                  END.
                  IF fkommun = "Sundbyberg" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Sundbyberg 2:28").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Sundbyberg").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholms län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Sundbyberg 2:28").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Sundbyberg").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
                  END.
                  IF fkommun = "Eskilstuna" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Knutstaslog 1:5").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Eskilstuna").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Södermanlands län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Knutstaslog 1:5").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Eskilstuna").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Södermanlands län").
                  END.
                  IF fkommun = "Surahammar" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Surahammar 9:3").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Surahammar").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västmanlands län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Surahammar 9:3").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Surahammar").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västmanlands län").
                  END.
                  IF fkommun = "Avesta" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Myran 1").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Avesta").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Dalarnas län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Myran 1").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Avesta").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Dalarnas län").
                  END.
                  IF fkommun = "Uppsala" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Fullerö 18:45").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Uppsala").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Uppsala län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Fullerö 18:45").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Uppsala").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Uppsala län").
                  END.
                  IF fkommun = "Tierp" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Vallskoga 1:121").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Tierp").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Uppsala län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Vallskoga 1:121").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Tierp").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Uppsala län").
                  END.
                  IF fkommun = "Knivsta" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Husby-Långhundra 6:20").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Knivsta").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Uppsala län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Husby-Långhundra 6:20").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Knivsta").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Uppsala län").
                  END.               
                  IF fkommun = "Enköping" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Rymningen 16:3").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Enköping").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Uppsala län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Rymningen 16:3").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Enköping").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Uppsala län").
                  END.
                  IF fkommun = "Boden" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Sävast 17:7").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Boden").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Norrbottens län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Sävast 17:7").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Boden").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").
                  END.                                             
                  IF fkommun = "Trollhättan" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Lextorp 7:1").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Trollhättan").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västra Götalands län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Lextorp 7:1").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Trollhättan").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västra Götalands län").
                  END.
                  IF fkommun = "Vänersborg" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Begonian 10").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Vänersborg").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västra Götalands län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Begonian 10").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Vänersborg").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västra Götalands län").
                  END.
                  IF fkommun = "Motala" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Charlottenborg 2:18").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Motala").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Östergötlands län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Charlottenborg 2:18").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Motala").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Östergötlands län").
                  END.               
                  IF fkommun = "Nyköping" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Nyköpings Bruk 6").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Nyköping").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Södermanlands län").
                     
                     RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Nyköpings Bruk 6").
                     RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Nyköping").
                     RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Södermanlands län").
                  END.                
               END.
            END.   
         END.
         IF avtal = "upplåtelseluftLastEllevio" or avtal = "upplåtelseluftLast2022Ellevio" THEN DO:
            IF konc NE "" AND INTEGER(konc) > 0 THEN DO :
               IF INTEGER(konc) = 30 OR INTEGER(konc) = 31 OR INTEGER(konc) = 32 OR INTEGER(konc) = 33 OR INTEGER(konc) = 34 OR INTEGER(konc) = 44 OR INTEGER(konc) = 45 OR INTEGER(konc) = 47 OR INTEGER(konc) = 53 OR INTEGER(konc) = 54 THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Dingelsundet 2:65").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Karlstad").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Värmland").
               END.
               ELSE IF INTEGER(konc) = 35 OR INTEGER(konc) = 36 OR INTEGER(konc) = 52 OR INTEGER(konc) = 64 OR INTEGER(konc) = 65  THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Forsön 1:5").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Bollnäs").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Gävleborg").
               END.
               ELSE IF INTEGER(konc) = 38  THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Hammerö 14:3").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Kungsbacka").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Halland").
               END.
               ELSE IF INTEGER(konc) = 39  THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Mölneby 3:16").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Orust").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västra Götaland").
               END.
               ELSE IF INTEGER(konc) = 40 OR INTEGER(konc) = 41 OR INTEGER(konc) = 42  THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Fjällskivlingen 1").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Strömstad").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västra Götaland").
               END.
               ELSE IF INTEGER(konc) = 60   THEN DO:
                  IF fkommun = "Älvdalen" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Älvdalens Kyrkby 16:51").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Älvdalen").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Dalarna").
                  END.   
                  ELSE IF fkommun = "Mora" OR fkommun = "Orsa" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Utmeland 604:1").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Mora").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Dalarna").
                  END.
               END.
               ELSE IF INTEGER(konc) = 48  THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Floden 1").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Stockholm").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholm").
               END.
               ELSE IF INTEGER(konc) = 50  THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Tibble 10:31").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Täby").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholm").
               END.
               ELSE IF INTEGER(konc) = 51  THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Lidingö 9:158").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Lidingö").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholm").
               END.
               ELSE IF INTEGER(konc) = 61  THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Sånga-Sundby 2:2").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Ekerö").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholm").
               END.
             END.
             ELSE DO:   
               IF fvaker BEGINS "Värmland"  THEN DO:            
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Dingelsundet 2:65").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Karlstad").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Värmland").
               END.   
               IF fvaker BEGINS "Gävleborg"  THEN DO:            
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Forsön 1:5").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Bollnäs").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Gävleborg").
               END.   
               IF fvaker BEGINS "Halland"  THEN DO:            
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Hammerö 14:3").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Kungsbacka").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Halland").
               END.   
               IF fvaker BEGINS "Västra Götaland"  THEN DO:
                  IF fkommun = "Orust" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Mölneby 3:16").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Orust").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västra Götaland").
                  END.   
                  ELSE IF fkommun = "Strömstad" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Fjällskivlingen 1").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Strömstad").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västra Götaland").
                  END.
                  ELSE DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Fjällskivlingen 1").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Strömstad").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västra Götaland").
                  END.
               END.       
               IF fvaker BEGINS "Jämtland"  THEN DO:            
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Jorm 1:88").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Strömsund").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Jämtland").
               END.   
               IF fvaker BEGINS "Dalarna"  THEN DO:
                  IF fkommun = "Älvdalen" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Älvdalens Kyrkby 16:51").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Älvdalen").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Dalarna").
                  END.   
                  ELSE IF fkommun = "Mora" OR fkommun = "Orsa" THEN DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Utmeland 604:1").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Mora").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Dalarna").
                  END.
                  ELSE DO:
                     RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Utmeland 604:1").
                     RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Mora").
                     RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Dalarna").
                  END.
               END.      
               IF fkommun = "Stockholm" THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Floden 1").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Stockholm").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholm").
               END.
               IF fkommun = "Täby" THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Tibble 10:31").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Täby").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholm").
               END.
               IF fkommun = "Lidingö" THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Lidingö 9:158").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Lidingö").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholm").
               END.
               IF fkommun = "Ekerö" THEN DO:
                  RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Sånga-Sundby 2:2").
                  RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Ekerö").
                  RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Stockholm").
               END.
            END.   
                           
         END.         
         IF Guru.Konstanter:globforetag = "VAST" OR Guru.Konstanter:globforetag = "VELD" OR Guru.Konstanter:globforetag = "BHEL" OR Guru.Konstanter:globforetag = "ESKO" OR Guru.Konstanter:globforetag = "NYLB" OR Guru.Konstanter:globforetag = "cELPA" THEN DO: 
            IF omravd = 1 OR omravd = 2  THEN DO:    
               RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Begonian 10").
               RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Vänersborg").
               RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västra Götaland").
               
               RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Begonian 10").
               RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Vänersborg").
               RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västra Götaland").         
            END.
            IF omravd = 3 THEN DO:
               RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Nyköpingsbruk 6").         
               RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Nyköping").
               RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Södermanland").
               
               RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Nyköpingsbruk 6").         
               RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Nyköping").
               RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Södermanland").                                 
            END.         
         END.
        
         IF Guru.Konstanter:globforetag = "SNAT" THEN DO: 
            IF fkommun BEGINS "Sundsvall" THEN DO:    
               RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Skönsberg 3:31").
               RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Sundsvall").
               RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västernorrlands Län").
            END.            
            IF fkommun BEGINS "Ånge" THEN DO:    
               RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Ånge 31:94").
               RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Ånge").
               RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västernorrlands Län").
            END.
            IF fkommun BEGINS "Härnösand" THEN DO:    
               RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Utansjö 3:188").
               RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Härnösand").
               RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Västernorrlands Län").
            END.
            IF fkommun BEGINS "Strömsund" THEN DO:    
               RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Strömsund 2:26").
               RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Strömsund").
               RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Jämtlands län").
            END.
            IF fkommun BEGINS "Ragunda" THEN DO:    
               RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Hammaren 2:1").
               RUN inbokvalue_UI (INPUT "Text19" ,INPUT "Ragunda").
               RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Jämtlands län").
            END.            
            IF fkommun BEGINS "Berg" OR  fkommun BEGINS "Härjedalen" THEN DO:    
               RUN inbokvalue_UI (INPUT "Text18" ,INPUT "Kvarntorp 1:3").
               RUN inbokvalue_UI (INPUT "Text19" ,INPUT fkommun).
               RUN inbokvalue_UI (INPUT "Text20" ,INPUT "Jämtlands län").
            END.
         END.               
         IF avtal = "elleviofölj" THEN DO:
            FIND FIRST marag USE-INDEX MARKERAD NO-LOCK NO-ERROR.
            RUN inbokvalue_UI (INPUT "Text4" ,INPUT fkommun).
            RUN inbokvalue_UI (INPUT "Text5" ,INPUT marag.BETECKNING).
            RUN inbokvalue_UI (INPUT "Text1" ,INPUT marag.MARKAGARE).
            RUN inbokvalue_UI (INPUT "Text2" ,INPUT marag.GATUADRESS).  
            RUN inbokvalue_UI (INPUT "Text3" ,INPUT (STRING(marag.POSTNUMMER,"xxx xx") + " " + marag.POSTADRESS)).  
            RUN inbokvalue_UI (INPUT "Text6" ,INPUT ponr).
            RUN inbokvalue_UI (INPUT "Text10" ,INPUT vardman).
            RUN inbokvalue_UI (INPUT "Text11" ,INPUT vardman).
            /*RUN inbokvalue_UI (INPUT "Text15" ,INPUT vardman).*/
            RUN inbokvalue_UI (INPUT "Text12" ,INPUT vardtel).
            RUN inbokvalue_UI (INPUT "Text25" ,INPUT projl).
            IF vardman = "Stefan Viktorsson" THEN DO:
               RUN inbokvalue_UI (INPUT "Text13" ,INPUT "Råtallsvägen 9").
               RUN inbokvalue_UI (INPUT "Text14" ,INPUT "771 43 Ludvika").
            END.
            IF vardman = "Emelie Forslund" THEN DO:
               RUN inbokvalue_UI (INPUT "Text13" ,INPUT "Fjärrviksvägen 2A").
               RUN inbokvalue_UI (INPUT "Text14" ,INPUT "653 50 Karlstad").
            END.
                     
         END.
         ELSE IF avtal = "dalafölj" THEN DO:
            
            FIND FIRST marag USE-INDEX MARKERAD NO-LOCK NO-ERROR.
            RUN inbokvalue_UI (INPUT "Text4" ,INPUT fkommun).
            RUN inbokvalue_UI (INPUT "Text5" ,INPUT marag.BETECKNING).
            RUN inbokvalue_UI (INPUT "Text1" ,INPUT marag.MARKAGARE).
            RUN inbokvalue_UI (INPUT "Text2" ,INPUT marag.GATUADRESS).  
            RUN inbokvalue_UI (INPUT "Text3" ,INPUT (STRING(marag.POSTNUMMER,"xxx xx") + " " + marag.POSTADRESS)).  
            RUN inbokvalue_UI (INPUT "Text6" ,INPUT ponr).
            RUN inbokvalue_UI (INPUT "Text10" ,INPUT vardman).
            RUN inbokvalue_UI (INPUT "Text11" ,INPUT vardman).
            RUN inbokvalue_UI (INPUT "Text15" ,INPUT vardman).
            RUN inbokvalue_UI (INPUT "Text12" ,INPUT vardtel).
            RUN inbokvalue_UI (INPUT "Text25" ,INPUT projl).
            IF vardman = "Stefan Viktorsson" THEN DO:
               RUN inbokvalue_UI (INPUT "Text13" ,INPUT "Råtallsvägen 9").
               RUN inbokvalue_UI (INPUT "Text14" ,INPUT "771 43 Ludvika").
            END.
            IF vardman = "Emelie Forslund" THEN DO:
               RUN inbokvalue_UI (INPUT "Text13" ,INPUT "Fjärrviksvägen 2A").
               RUN inbokvalue_UI (INPUT "Text14" ,INPUT "653 50 Karlstad").
            END.   
            
                     
         END.
         ELSE IF avtal = "ellevioinfo" THEN DO:            
            FIND FIRST marag USE-INDEX MARKERAD NO-LOCK NO-ERROR.
            RUN inbokvalue_UI (INPUT "Datum" ,INPUT STRING(today,"9999-99-99")).        
            RUN inbokvalue_UI (INPUT "Text1" ,INPUT marag.MARKAGARE).
            RUN inbokvalue_UI (INPUT "Text2" ,INPUT marag.GATUADRESS).  
            RUN inbokvalue_UI (INPUT "Text3" ,INPUT (STRING(marag.POSTNUMMER,"xxx xx") + " " + marag.POSTADRESS)).              
         END.
         IF avtal = "UEföljFP" OR avtal = "UEföljJP" OR avtal = "UEföljRA" THEN DO:
            FIND FIRST marag USE-INDEX MARKERAD NO-LOCK NO-ERROR.
            RUN inbokvalue_UI (INPUT "Diarienr" ,INPUT diarienr).
            RUN inbokvalue_UI (INPUT "Datum" ,INPUT STRING(today,"9999-99-99")).
            RUN inbokvalue_UI (INPUT "Text5" ,INPUT marag.BETECKNING).
            RUN inbokvalue_UI (INPUT "Text1" ,INPUT marag.MARKAGARE).
            RUN inbokvalue_UI (INPUT "Text2" ,INPUT marag.GATUADRESS).  
            RUN inbokvalue_UI (INPUT "Text3" ,INPUT (STRING(marag.POSTNUMMER,"xxx xx") + " " + marag.POSTADRESS)).  
            RUN inbokvalue_UI (INPUT "Text6" ,INPUT ponr).
            RUN inbokvalue_UI (INPUT "Text10" ,INPUT vardman).
                         
            IF projledf NE vardman AND projledf NE "" THEN DO:
               RUN inbokvalue_UI (INPUT "Text11" ,INPUT "På uppdrag av " +  projledf).
               RUN inbokvalue_UI (INPUT "Text71" ,INPUT  projledf).
               RUN inbokvalue_UI (INPUT "Text72" ,INPUT  projtel).
               RUN inbokvalue_UI (INPUT "Text73" ,INPUT  projepost).               
            END.
            ELSE DO:
               RUN inbokvalue_UI (INPUT "Text71" ,INPUT  vaman).
               RUN inbokvalue_UI (INPUT "Text72" ,INPUT  vatel).
               RUN inbokvalue_UI (INPUT "Text73" ,INPUT  vaepost).    
            END.   
            
            /*RUN inbokvalue_UI (INPUT "Text15" ,INPUT vardman).
            RUN inbokvalue_UI (INPUT "Text12" ,INPUT vardtel).
            RUN inbokvalue_UI (INPUT "Text25" ,INPUT projl).*/
            /*CCCCCCCC*/
                     
         END.         
         ELSE IF avtal =  "upplåtelseluftLastEllevio" OR avtal = "upplåtelseluftLast2022Ellevio" THEN DO:      
                     
            /* "upplåtelseluft"  "upplåtelseluftLast"  "upplåtelsemark"  "upplåtelsemarkLast" */
            FIND FIRST marag USE-INDEX MARKERAD NO-LOCK NO-ERROR.                  
            /*ägare 1*/                       
                           
            /*släck enligt GDPR - ändra till 6 siffror  Lena 20221020*/
            RUN inbokvalue_UI (INPUT "Text63" ,INPUT STRING(marag.PERSONNUMMER,"999999")).   
            RUN inbokvalue_UI (INPUT "Text61" ,INPUT marag.MARKAGARE).
            RUN inbokvalue_UI (INPUT "Text41" ,INPUT marag.MARKAGARE).
                                                    
            FIND NEXT marag USE-INDEX MARKERAD NO-LOCK NO-ERROR.
            IF AVAILABLE marag THEN DO:
               /*ägare 2*/                                         
               /*släck enligt GDPR - ändra till 6 siffror  Lena 20221020*/
               RUN inbokvalue_UI (INPUT "Text5" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999")).      
               RUN inbokvalue_UI (INPUT "Text42" ,INPUT marag.MARKAGARE).  
                                    
               FIND NEXT marag USE-INDEX MARKERAD NO-LOCK NO-ERROR.
               IF AVAILABLE marag THEN DO:       
                  /*ägare 3*/                                            
                  /*släck enligt GDPR - ändra till 6 siffror  Lena 20221020*/
                  RUN inbokvalue_UI (INPUT "Text6" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999")).         
                  RUN inbokvalue_UI (INPUT "Text43" ,INPUT marag.MARKAGARE).
                         
                  FIND NEXT marag USE-INDEX MARKERAD NO-LOCK NO-ERROR.
                  IF AVAILABLE marag THEN DO:          
                     /*ägare 4*/                     
                     /*släck enligt GDPR - ändra till 6 siffror  Lena 20221020*/                            
                     RUN inbokvalue_UI (INPUT "Text7" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999")).            
                     RUN inbokvalue_UI (INPUT "Text44" ,INPUT marag.MARKAGARE).              
                  END.
               END.
            END.
         END.         
         ELSE DO:                                       
            /* "upplåtelseluft"  "upplåtelseluftLast"  "upplåtelsemark"  "upplåtelsemarkLast" */
            FIND FIRST marag NO-LOCK NO-ERROR.
            IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
            ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").                                                              
            /*ägare 1*/                       
            RUN inbokvalue_UI (INPUT "Text4" ,INPUT fagare).   
            RUN inbokvalue_UI (INPUT "Text41" ,INPUT marag.MARKAGARE).           
            RUN inbokvalue_UI (INPUT "Fägare1" ,INPUT fagare).   
            RUN inbokvalue_UI (INPUT "Fastighetsägare1" ,INPUT marag.MARKAGARE).                           
            IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare21" ,INPUT marag.MARKAGARE).            
            FIND NEXT marag NO-LOCK NO-ERROR.            
            IF AVAILABLE marag THEN DO:               
               /*ägare 2*/             
               IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
               ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").             
               RUN inbokvalue_UI (INPUT "Text5" ,INPUT fagare).      
               RUN inbokvalue_UI (INPUT "Text42" ,INPUT marag.MARKAGARE).  
               
               RUN inbokvalue_UI (INPUT "Fägare2" ,INPUT fagare).      
               RUN inbokvalue_UI (INPUT "Fastighetsägare2" ,INPUT marag.MARKAGARE).
               IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare22" ,INPUT marag.MARKAGARE).                                     
               FIND NEXT marag NO-LOCK NO-ERROR.               
               IF AVAILABLE marag THEN DO:      
                  /*ägare 3*/
                  IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
                  ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").                                         
                  RUN inbokvalue_UI (INPUT "Text6" ,INPUT fagare).         
                  RUN inbokvalue_UI (INPUT "Text43" ,INPUT marag.MARKAGARE).
                  
                  RUN inbokvalue_UI (INPUT "Fägare3" ,INPUT fagare).         
                  RUN inbokvalue_UI (INPUT "Fastighetsägare3" ,INPUT marag.MARKAGARE).
                  IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare23" ,INPUT marag.MARKAGARE).                         
                  FIND NEXT marag NO-LOCK NO-ERROR.
                  IF AVAILABLE marag THEN DO:          
                     /*ägare 4*/                            
                     IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
                     ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").
                     RUN inbokvalue_UI (INPUT "Text7" ,INPUT fagare).            
                     RUN inbokvalue_UI (INPUT "Text44" ,INPUT marag.MARKAGARE).
                     
                     RUN inbokvalue_UI (INPUT "Fägare4" ,INPUT fagare).            
                     RUN inbokvalue_UI (INPUT "Fastighetsägare4" ,INPUT marag.MARKAGARE).
                     IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare24" ,INPUT marag.MARKAGARE).
                                                   
                     FIND NEXT marag NO-LOCK NO-ERROR.
                     IF AVAILABLE marag THEN DO:
                        /*ägare 5*/             
                        IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
                        ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").                   
                        RUN inbokvalue_UI (INPUT "Text8" ,INPUT fagare).               
                        RUN inbokvalue_UI (INPUT "Text45" ,INPUT marag.MARKAGARE).
                        
                        RUN inbokvalue_UI (INPUT "Fägare5" ,INPUT fagare).               
                        RUN inbokvalue_UI (INPUT "Fastighetsägare5" ,INPUT marag.MARKAGARE).
                        IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare25" ,INPUT marag.MARKAGARE).                                      
                        FIND NEXT marag NO-LOCK NO-ERROR.
                        IF AVAILABLE marag THEN DO:
                           /*ägare 6*/             
                           IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
                           ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").                     
                           RUN inbokvalue_UI (INPUT "Text9" ,INPUT fagare).                  
                           RUN inbokvalue_UI (INPUT "Text46" ,INPUT marag.MARKAGARE).
                           
                           RUN inbokvalue_UI (INPUT "Fägare6" ,INPUT fagare).                  
                           RUN inbokvalue_UI (INPUT "Fastighetsägare6" ,INPUT marag.MARKAGARE).
                           IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare26" ,INPUT marag.MARKAGARE).                                                                   
                           FIND NEXT marag NO-LOCK NO-ERROR.
                           IF AVAILABLE marag THEN DO:
                              /*ägare 7*/
                              IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
                              ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").                                      
                              RUN inbokvalue_UI (INPUT "Text10" ,INPUT fagare).                     
                              RUN inbokvalue_UI (INPUT "Text47" ,INPUT marag.MARKAGARE).
                              
                              RUN inbokvalue_UI (INPUT "Fägare7" ,INPUT fagare).                     
                              RUN inbokvalue_UI (INPUT "Fastighetsägare7" ,INPUT marag.MARKAGARE).
                              IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare27" ,INPUT marag.MARKAGARE).                                           
                              FIND NEXT marag NO-LOCK NO-ERROR.
                              IF AVAILABLE marag THEN DO:
                                 /*ägare 8*/
                                 IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
                                 ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").                                         
                                 RUN inbokvalue_UI (INPUT "Text11" ,INPUT fagare).                     
                                 RUN inbokvalue_UI (INPUT "Text48" ,INPUT marag.MARKAGARE).                              
                                 RUN inbokvalue_UI (INPUT "Fägare8" ,INPUT fagare).                     
                                 RUN inbokvalue_UI (INPUT "Fastighetsägare8" ,INPUT marag.MARKAGARE).
                                 IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare28" ,INPUT marag.MARKAGARE).
                                 
                                 FIND NEXT marag NO-LOCK NO-ERROR.
                                 IF AVAILABLE marag THEN DO:
                                    /*ägare 9*/
                                    IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
                                    ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").                                         
                                    /*RUN inbokvalue_UI (INPUT "Text11" ,INPUT fagare).                     
                                    RUN inbokvalue_UI (INPUT "Text48" ,INPUT marag.MARKAGARE).*/                              
                                    RUN inbokvalue_UI (INPUT "Fägare9" ,INPUT fagare).                     
                                    RUN inbokvalue_UI (INPUT "Fastighetsägare9" ,INPUT marag.MARKAGARE).
                                    IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare29" ,INPUT marag.MARKAGARE).
                                    FIND NEXT marag NO-LOCK NO-ERROR.
                                    IF AVAILABLE marag THEN DO:
                                       /*ägare 10*/
                                       IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
                                       ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").                                         
                                       /*RUN inbokvalue_UI (INPUT "Text11" ,INPUT fagare).                     
                                       RUN inbokvalue_UI (INPUT "Text48" ,INPUT marag.MARKAGARE).*/                              
                                       RUN inbokvalue_UI (INPUT "Fägare10" ,INPUT fagare).                     
                                       RUN inbokvalue_UI (INPUT "Fastighetsägare10" ,INPUT marag.MARKAGARE).
                                       IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare30" ,INPUT marag.MARKAGARE).
                                       FIND NEXT marag NO-LOCK NO-ERROR.
                                       IF AVAILABLE marag THEN DO:
                                          /*ägare 11*/
                                          IF Guru.Konstanter:globforetag = "LULE"  THEN fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999"  + "  " + marag.ANDEL).
                                          ELSE fagare = marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999").                                         
                                          /*RUN inbokvalue_UI (INPUT "Text11" ,INPUT fagare).                     
                                          RUN inbokvalue_UI (INPUT "Text48" ,INPUT marag.MARKAGARE).*/                              
                                          RUN inbokvalue_UI (INPUT "Fägare11" ,INPUT fagare).                     
                                          RUN inbokvalue_UI (INPUT "Fastighetsägare11" ,INPUT marag.MARKAGARE).
                                          IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare31" ,INPUT marag.MARKAGARE).
                                       END.   
                                    END.
                                 END.                                       
                              END.
                           END.
                        END.
                     END.
                  END.
               END.
            END.
         END.
         IF vardnrnatag NE ? THEN  RUN inbokvalue_UI (INPUT "Text60" ,INPUT vardnrnatag).           
         IF ponr NE ? THEN RUN inbokvalue_UI (INPUT "Text23" ,INPUT ponr).
         IF ponr NE ? THEN RUN inbokvalue_UI (INPUT "Text70" ,INPUT ponr).
         IF lelitt NE "" THEN RUN inbokvalue_UI (INPUT "Text21" ,INPUT lelitt).
         
         IF ponr NE ? THEN RUN inbokvalue_UI (INPUT "Projektnummer" ,INPUT ponr).
         IF ponr NE ? THEN RUN inbokvalue_UI (INPUT "Projektnummer1" ,INPUT ponr).
         IF lelitt NE "" THEN RUN inbokvalue_UI (INPUT "Littera" ,INPUT lelitt).
         IF Guru.Konstanter:varforetypchar[7] = "1" THEN  DO:
            /*projejv.p = "1"  PROJTECT2.W = "2"*/
            IF ortvar NE "" THEN RUN inbokvalue_UI (INPUT "Text24" ,INPUT ortvar).               
            RUN inbokvalue_UI (INPUT "Text25" ,INPUT projl).
            
            IF ortvar NE "" THEN RUN inbokvalue_UI (INPUT "Projektnamn" ,INPUT ortvar).               
            RUN inbokvalue_UI (INPUT "Projektledare" ,INPUT projl).
         END.                     
         ELSE DO:                                                                              
            IF pnamn NE "" THEN RUN inbokvalue_UI (INPUT "Text24" ,INPUT pnamn).               
            IF pled NE "" THEN RUN inbokvalue_UI (INPUT "Text25" ,INPUT pled).         
            IF nstn NE "" THEN RUN inbokvalue_UI (INPUT "Text22" ,INPUT nstn).
            
            IF pnamn NE "" THEN RUN inbokvalue_UI (INPUT "Projektnamn" ,INPUT pnamn).               
            IF pled NE "" THEN RUN inbokvalue_UI (INPUT "Projektledare" ,INPUT pled).         
            IF nstn NE "" THEN RUN inbokvalue_UI (INPUT "nstn" ,INPUT nstn).         
         END.                                 
         FIND FIRST mval WHERE mval.MARKERAD = TRUE NO-LOCK NO-ERROR.   
         FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
         IF AVAILABLE sumtemp THEN DO:
                         
            IF avtal BEGINS "upplåtelseskell"  THEN DO:
               /* Frivillig överenskommelse redovisas på respektive post skellefteå kraft*/
               IF jkab > 0  THEN RUN inbokvalue_UI (INPUT "Text27" ,INPUT STRING(INTEGER(jkab * 1.2))).
               IF nats > 0 THEN RUN inbokvalue_UI (INPUT "Text28" ,INPUT STRING(INTEGER(nats * 1.2))).
               IF  fastbelopp > 0 AND INTEGER((fastbelopp - ovg) * 1.2  ) = 0 THEN  RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(INTEGER((kskap + ovg) * 1.2))).   
               ELSE RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(INTEGER(kskap * 1.2))).
               IF kskap > 0 THEN RUN inboklog_UI (INPUT "Kryssruta10" ,INPUT TRUE).               
            END.
            ELSE IF avtal = "upplåtelsemarkLastdala"  THEN DO:
               /*Stefan Viktorsson vill ha markerad markägares andel  20201109*/

               sumupplat = 0.
               sumovrigt = 0.                                                                                            
               IF jkab > 0 THEN  RUN inbokvalue_UI (INPUT "Text27" ,INPUT STRING(INTEGER(jkab * mval.PRODEL / 100))).
               IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "Text30" ,INPUT STRING(INTEGER(exltot * mval.PRODEL / 100))).
               IF gers > 0 THEN RUN inbokvalue_UI (INPUT "Text50" ,INPUT STRING(INTEGER(gers * mval.PRODEL / 100))).
               
               /*IF lled > 0  THEN RUN inbokvalue_UI (INPUT "Luftledning" ,INPUT STRING(lled * mval.PRODEL / 100)).              
               IF jkab > 0 THEN  RUN inbokvalue_UI (INPUT "Jordkabel" ,INPUT STRING(INTEGER(jkab * mval.PRODEL / 100))).
               IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "exl" ,INPUT STRING(INTEGER(exltot * mval.PRODEL / 100))).*/               
               sumupplat = lled + jkab + exltot.                                                    
               /*IF nats > 0  THEN DO:                  
                   RUN inbokvalue_UI (INPUT "Text28" ,INPUT STRING(nats * mval.PRODEL / 100)).
                   RUN inbokvalue_UI (INPUT "Nätstation" ,INPUT STRING(nats * mval.PRODEL / 100)).
                   sumupplat = sumupplat + nats.                     
               END.                        
               
               IF kommnatkab NE "" THEN RUN inbokvalue_UI (INPUT "Text34" ,INPUT STRING(kommnatkab)).                         
               IF kommnatkab NE "" THEN RUN inbokvalue_UI (INPUT "kommnat" ,INPUT STRING(kommnatkab)).*/
         
               /*kabelskåp ska in på övrigt- flyttat ner 20140827*/               
               /*IF kskap > 0  THEN RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap)).*/                     
               IF kommkskap NE "" THEN RUN inbokvalue_UI (INPUT "Text35" ,INPUT STRING(kommkskap)).               
               /*IF kommkskap NE "" THEN RUN inbokvalue_UI (INPUT "ovrigtkom" ,INPUT STRING(kommkskap)).               
               IF kommluft NE "" THEN RUN inbokvalue_UI (INPUT "Text32" ,INPUT STRING(kommluft)).
               IF kommjk NE "" THEN RUN inbokvalue_UI (INPUT "Text33" ,INPUT STRING(kommjk)).*/                                        
               /*ändrat samma för alla 20150302 Lena*/                                                                        
               
               IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(INTEGER((kskap + ovg + nats) * mval.PRODEL / 100))).   
               ELSE RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(INTEGER((kskap + nats) * mval.PRODEL / 100))).                                            
                                    
                                                                              
               IF tlgg > 0  THEN RUN inbokvalue_UI (INPUT "Text31" ,INPUT STRING(INTEGER(tlgg * mval.PRODEL / 100))).
               IF tlgg > 0  THEN RUN inbokvalue_UI (INPUT "overens" ,INPUT STRING(INTEGER(tlgg * mval.PRODEL / 100))).
               sumupplat = sumupplat + tlgg.                              
               
               IF ttalt = mmini THEN DO:
                  /* lägg till mellanskillnaden upp till minimi på övrigt*/
                  IF INTEGER(mmini - sumupplat) > 0 THEN DO:
                     RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(INTEGER((sumovrigt + (mmini - sumupplat)) * mval.PRODEL / 100))).
                  END.   
               END.   
               IF ttalt > 0  THEN RUN inbokvalue_UI (INPUT "Text38" ,INPUT STRING(INTEGER(ttalt  * mval.PRODEL / 100 ))).
            END.   
            ELSE IF avtal BEGINS "upplåtelse"  THEN DO:            
               sumupplat = 0.
               sumovrigt = 0.
               IF Guru.Konstanter:globforetag = "TECT" OR Guru.Konstanter:globforetag = "PICA"  OR Guru.Konstanter:globforetag = "SWEO" OR Guru.Konstanter:globforetag = "REJI" OR Guru.Konstanter:globforetag = "ELPC" OR Guru.Konstanter:globforetag = "SKOK" OR Guru.Konstanter:globforetag = "JSBF" 
               OR Guru.Konstanter:globforetag = "ATS"  OR Guru.Konstanter:globforetag = "SKEL"  OR Guru.Konstanter:globforetag = "VALL"  OR Guru.Konstanter:globforetag = "WSP"  OR Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "SSEL" THEN DO:                         
                  IF Guru.Konstanter:varforetypval[40] = 1 THEN DO:
                      /* dela upp för expropriationslagen som VP Vatt*/
                      IF lleduex > 0  THEN RUN inbokvalue_UI (INPUT "Text26" ,INPUT STRING(lleduex)).                      
                      IF jkabuex > 0  THEN RUN inbokvalue_UI (INPUT "Text27" ,INPUT STRING(INTEGER(jkabuex))).
                      IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "Text30" ,INPUT STRING(INTEGER(exltot))).
                      IF gers > 0 THEN RUN inbokvalue_UI (INPUT "Text50" ,INPUT STRING(INTEGER(gers))).
                      
                      IF lleduex > 0  THEN RUN inbokvalue_UI (INPUT "Luftledning" ,INPUT STRING(lleduex)).                      
                      IF jkabuex > 0  THEN RUN inbokvalue_UI (INPUT "Jordkabel" ,INPUT STRING(INTEGER(jkabuex))).
                      IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "exl" ,INPUT STRING(INTEGER(exltot))).
                      sumupplat = lleduex + jkabuex + exltot.
                   END.
                   ELSE DO:
                      IF lled > 0  THEN RUN inbokvalue_UI (INPUT "Text26" ,INPUT STRING(lled)).
                      IF jkab > 0  THEN RUN inbokvalue_UI (INPUT "Text27" ,INPUT STRING(INTEGER(jkab))).
                      IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "Text30" ,INPUT STRING(INTEGER(exltot))).
                      IF gers > 0 THEN RUN inbokvalue_UI (INPUT "Text50" ,INPUT STRING(INTEGER(gers))).
                      
                      IF lled > 0  THEN RUN inbokvalue_UI (INPUT "Luftledning" ,INPUT STRING(lled)).
                      IF jkab > 0  THEN RUN inbokvalue_UI (INPUT "Jordkabel" ,INPUT STRING(INTEGER(jkab))).
                      IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "exl" ,INPUT STRING(INTEGER(exltot))).      
                      sumupplat = lled + jkab + exltot.                
                   END.                                                           
               END.
               ELSE DO:                  
                  IF Guru.Konstanter:varforetypval[40] = 1 THEN DO:  
                      /* dela upp för expropriationslagen som VP Vatt*/
                      IF lleduex > 0 THEN  RUN inbokvalue_UI (INPUT "Text26" ,INPUT STRING(lleduex)).                      
                      IF jkabuex > 0 THEN RUN inbokvalue_UI (INPUT "Text27" ,INPUT STRING(INTEGER(jkabuex))).
                      IF exltot > 0 THEN RUN inbokvalue_UI (INPUT "Text30" ,INPUT STRING(INTEGER(exltot))).                      
                      IF gers > 0 THEN RUN inbokvalue_UI (INPUT "Text50" ,INPUT STRING(INTEGER(gers))).                      
                      IF lleduex > 0 THEN  RUN inbokvalue_UI (INPUT "Luftledning" ,INPUT STRING(lleduex)).                      
                      IF jkabuex > 0 THEN RUN inbokvalue_UI (INPUT "Jordkabel" ,INPUT STRING(INTEGER(jkabuex))).
                      IF exltot > 0 THEN RUN inbokvalue_UI (INPUT "exl" ,INPUT STRING(INTEGER(exltot))).
                      sumupplat = lleduex + jkabuex + exltot.                      
                  END.
                  ELSE DO:
                     IF lled > 0  THEN RUN inbokvalue_UI (INPUT "Text26" ,INPUT STRING(lled)).              
                     IF jkab > 0 THEN  RUN inbokvalue_UI (INPUT "Text27" ,INPUT STRING(INTEGER(jkab))).
                     IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "Text30" ,INPUT STRING(INTEGER(exltot))).
                     IF gers > 0 THEN RUN inbokvalue_UI (INPUT "Text50" ,INPUT STRING(INTEGER(gers))).
                     
                     IF lled > 0  THEN RUN inbokvalue_UI (INPUT "Luftledning" ,INPUT STRING(lled)).              
                     IF jkab > 0 THEN  RUN inbokvalue_UI (INPUT "Jordkabel" ,INPUT STRING(INTEGER(jkab))).
                     IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "exl" ,INPUT STRING(INTEGER(exltot))).
                     
                     sumupplat = lled + jkab + exltot.       
                  END. 
               END.
                              
               IF nats > 0  THEN DO:
                  IF Guru.Konstanter:varforetypval[40] = 1 THEN DO:                     
                      RUN inbokvalue_UI (INPUT "Text28" ,INPUT STRING(natsuexl)).
                      RUN inbokvalue_UI (INPUT "Nätstation" ,INPUT STRING(natsuexl)).
                      sumupplat = sumupplat + natsuexl.
                   END.
                   ELSE DO: 
                      RUN inbokvalue_UI (INPUT "Text28" ,INPUT STRING(nats)).
                      RUN inbokvalue_UI (INPUT "Nätstation" ,INPUT STRING(nats)).
                      sumupplat = sumupplat + nats.
                   END.      
               END.                        
               
               IF kommnatkab NE "" THEN RUN inbokvalue_UI (INPUT "Text34" ,INPUT STRING(kommnatkab)).                         
               IF kommnatkab NE "" THEN RUN inbokvalue_UI (INPUT "kommnat" ,INPUT STRING(kommnatkab)).
         
               /*kabelskåp ska in på övrigt- flyttat ner 20140827*/               
               /*IF kskap > 0  THEN RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap)).*/                     
               IF kommkskap NE "" THEN RUN inbokvalue_UI (INPUT "Text35" ,INPUT STRING(kommkskap)).               
               IF kommkskap NE "" THEN RUN inbokvalue_UI (INPUT "ovrigtkom" ,INPUT STRING(kommkskap)).
               
               IF kommluft NE "" THEN RUN inbokvalue_UI (INPUT "Text32" ,INPUT STRING(kommluft)).
               IF kommjk NE "" THEN RUN inbokvalue_UI (INPUT "Text33" ,INPUT STRING(kommjk)).                                        
               /*ändrat samma för alla 20150302 Lena*/                                                                        
               IF avtal BEGINS "upplåtelse" THEN DO:                      
                  IF avtal = "upplåtelsemarkLastdala" THEN DO:
                     IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(kskap + ovg + nats)).   
                     ELSE RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(kskap + nats)).                                            
                  END.                     
                  ELSE IF kskap > 0  THEN DO:                     
                     IF Guru.Konstanter:varforetypval[40] = 1 THEN DO:                      
                        IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(kskapuexl + ovg)).   
                        ELSE RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(kskapuexl)).                       
                        IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskapuexl + ovg)).   
                        ELSE RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskapuexl )).                        
                        IF fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN DO:
                           sumupplat = sumupplat + kskapuexl + ovg.
                           sumovrigt = kskapuexl + ovg.
                        END.    
                        ELSE DO:
                           sumupplat = sumupplat + kskapuexl.
                           sumovrigt = kskapuexl .
                        END.   
                     END.   
                     ELSE DO:
                        IF avtal = "upplåtelsemarkLastdala" THEN DO:
                           IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(kskap + ovg + nats)).   
                           ELSE RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(kskap + nats)).                       
                           IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap + ovg + nats)).   
                           ELSE RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap + nats)).
                        END.
                        ELSE DO:   
                           IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(kskap + ovg)).   
                           ELSE RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(kskap)).                       
                           IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap + ovg)).   
                           ELSE RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap)).
                        END.
                        IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN DO:
                           sumupplat = sumupplat + kskap + ovg.
                           sumovrigt = kskap + ovg.
                        END.    
                        ELSE DO:
                           sumupplat = sumupplat + kskap.
                           sumovrigt = kskap.
                        END.   
                    END.                              
                  END.                    
                  ELSE IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg ) = 0 THEN DO:
                     RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(ovg)).
                     RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(ovg)).
                     sumupplat = sumupplat + ovg.
                     sumovrigt = ovg.
                  END.     
                  ELSE IF (ovg - tlgg) > 0  THEN DO: 
                     RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(ovg - tlgg)).
                     RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(ovg - tlgg)).
                     sumupplat = sumupplat + ovg - tlgg.
                     sumovrigt = ovg - tlgg.                           
                  END.                                                               
                  IF tlgg > 0  THEN RUN inbokvalue_UI (INPUT "Text31" ,INPUT STRING(tlgg)).
                  IF tlgg > 0  THEN RUN inbokvalue_UI (INPUT "overens" ,INPUT STRING(tlgg)).
                  sumupplat = sumupplat + tlgg.                              
               END.
               IF ttalt = mmini THEN DO:
                  /* lägg till mellanskillnaden upp till minimi på övrigt*/
                  IF INTEGER(mmini - sumupplat) > 0 THEN DO:
                     RUN inbokvalue_UI (INPUT "Text29" ,INPUT STRING(INTEGER(sumovrigt + (mmini - sumupplat)))).
                  END.   
               END.
               IF ttalt > 0  THEN RUN inbokvalue_UI (INPUT "Text38" ,INPUT STRING(ttalt)).
               IF ttalt > 0  THEN RUN inbokvalue_UI (INPUT "Totalt" ,INPUT STRING(ttalt)).
               IF ttalt > 0  THEN RUN inbokvalue_UI (INPUT "Totalt1" ,INPUT STRING(ttalt)).                             
               RUN inbokvalue_UI (INPUT "minimi" ,INPUT minimi).         
            END.
            IF avtal = "upplåtelseluftLastEllevio" OR avtal = "upplåtelseluftLast2022Ellevio" THEN DO:
               /*Ellevio  ska bara ha ut belopp för markerad*/               
               IF ttalt > 0  THEN RUN inbokvalue_UI (INPUT "Text62" ,INPUT STRING(INTEGER(ttalt * mval.PRODEL / 100))).                  
            END.
                   
            
         END.
      END.
      IF avtal BEGINS  "upplåtelseluftLast" OR AVTAL BEGINS  "upplåtelsemarkLast" OR AVTAL BEGINS  "upplåtelsetätLast" OR AVTAL BEGINS  "upplåtelseovanLast" THEN DO: 
         /*chDoc:Protect(2,,"gurulösen").*/
         IF spmall = TRUE THEN chWord:Visible = FALSE.
         ELSE IF skrivutmall = TRUE THEN chWord:Visible = FALSE. 
         ELSE chWord:VISIBLE = TRUE.
      END.   
      /*ELSE  chDoc:Protect(2).*/
      /*
      MESSAGE "Fel status läge 6" ERROR-STATUS:ERROR 
      VIEW-AS ALERT-BOX.
      */
      IF spmall = TRUE OR skrivutmall = TRUE THEN DO:
         chWord:displayalerts = FALSE.      
         chDoc:SaveAs(kommando,,,,,,,,,).        
         chWord:displayalerts = TRUE.
         IF skrivutmall = TRUE THEN DO:                                 
            chWord:ScreenUpdating = FALSE.
            chDoc:PrintOut(,,,,STRING(SESSION:PRINTER-NAME),,,).                           
         END.                          
         NO-RETURN-VALUE chDoc:CLOSE().
         NO-RETURN-VALUE chWord:QUIT().
      END.   
      RELEASE OBJECT chDoc NO-ERROR.
      /*
      MESSAGE "Fel status läge 7" ERROR-STATUS:ERROR 
      VIEW-AS ALERT-BOX.
      */
   END.
   RELEASE OBJECT chWord NO-ERROR.
   
END PROCEDURE.


PROCEDURE skapaunderbil_UI.

   IF Guru.GlobalaVariabler:plusaonr = "" OR Guru.GlobalaVariabler:plusaonr = ? THEN DO:
      kommando2 = kommando3 + fnamnC + string(sidvar) + fnamnD.
   END.
   ELSE DO:
      kommando2 = kommando3 + TRIM (Guru.GlobalaVariabler:plusaonr) + TRIM(STRING(Guru.GlobalaVariabler:plusdnr,Guru.Konstanter:varforetypchar[1])) + fnamnC + string(sidvar) + fnamnD.
   END.
   
   OS-COPY VALUE(kommandoU4) VALUE(kommando2).   
   kommandoU = kommando2.
   /*   
   MESSAGE "nu skapas word!"  kommando4  " och " kommando2 
   VIEW-AS ALERT-BOX.
   */   
   CREATE "Word.Application" chWord NO-ERROR.
   
   /*
   MESSAGE "Fel status läge 8" ERROR-STATUS:ERROR 
   VIEW-AS ALERT-BOX. 
   */
      
  
   
   IF ERROR-STATUS:ERROR = FALSE THEN DO:
      chWord:Options:AllowReadingMode = FALSE NO-ERROR. /*Fix för excel 2013*/
      chDoc = chWord:Documents:Open(kommandoU,,,,,,,,,).
      IF avtal BEGINS  "upplåtelseluftLast" OR avtal BEGINS "upplåtelsemarkLast" OR avtal BEGINS "upplåtelsetätLast" OR avtal BEGINS "upplåtelseovanLast" THEN DO:
         /*chDoc:Unprotect("gurulösen").*/
         chWord:VISIBLE = FALSE.
      END.   
      ELSE DO:
         chDoc:Protect(2) NO-ERROR.
         chWord:VISIBLE = TRUE.
      END.  
      IF spmall = TRUE THEN chWord:Visible = FALSE.
      ELSE IF  skrivutmall = TRUE THEN chWord:Visible = FALSE.
      EMPTY TEMP-TABLE tidut NO-ERROR. 
      ASSIGN
      hjproc = 0
      hjagare = 0.
      FOR EACH mval:
         hjagare = hjagare + 1.
         hjproc = hjproc + mval.PRODEL.
      END.
      
      FIND FIRST mval NO-LOCK NO-ERROR.  
      ASSIGN mval.AONR = aovar
      mval.DELNR = delnrvar.   
      
         
      /*ccc*/
      IF antfast > 1 THEN RUN inbokvalue_UI (INPUT "Text1" ,INPUT fabet).
      ELSE RUN inbokvalue_UI (INPUT "Text1" ,INPUT mval.BETECKNING).
      IF antfast > 1 THEN RUN inbokvalue_UI (INPUT "Fastighettjänande" ,INPUT fabet).
      ELSE RUN inbokvalue_UI (INPUT "Fastighettjänande" ,INPUT mval.BETECKNING).
      IF ponr NE "" THEN RUN inbokvalue_UI (INPUT "Text2" ,INPUT ponr).
      
            
      /* "upplåtelseluft"  "upplåtelseluftLast"  "upplåtelsemark"  "upplåtelsemarkLast" */
      FIND FIRST marag NO-LOCK NO-ERROR. /*ägare 1*/                                                                      
      FIND NEXT marag NO-LOCK NO-ERROR. /*ägare 2*/
      FIND NEXT marag NO-LOCK NO-ERROR. /*ägare 3*/
      FIND NEXT marag NO-LOCK NO-ERROR. /*ägare 4*/
      FIND NEXT marag NO-LOCK NO-ERROR. /*ägare 5*/
      FIND NEXT marag NO-LOCK NO-ERROR. /*ägare 6*/
      FIND NEXT marag NO-LOCK NO-ERROR. /*ägare 7*/
      FIND NEXT marag NO-LOCK NO-ERROR. /*ägare 8*/
      FIND NEXT marag NO-LOCK NO-ERROR. /*ägare 9*/
      IF AVAILABLE marag THEN DO:                     
         RUN inbokvalue_UI (INPUT "Text3" ,INPUT marag.MARKAGARE).                                  
         FIND NEXT marag NO-LOCK NO-ERROR.
         IF AVAILABLE marag THEN DO:       
            /*ägare 10*/                                                     
            RUN inbokvalue_UI (INPUT "Text4" ,INPUT marag.MARKAGARE).
            FIND NEXT marag NO-LOCK NO-ERROR.
            IF AVAILABLE marag THEN DO:       
               /*ägare 11*/                                                     
               RUN inbokvalue_UI (INPUT "Text5" ,INPUT marag.MARKAGARE).
               FIND NEXT marag NO-LOCK NO-ERROR.
               IF AVAILABLE marag THEN DO:       
                  /*ägare 12*/                                                     
                  RUN inbokvalue_UI (INPUT "Text6" ,INPUT marag.MARKAGARE).
                  FIND NEXT marag NO-LOCK NO-ERROR.
                  IF AVAILABLE marag THEN DO:       
                     /*ägare 13*/                                                     
                     RUN inbokvalue_UI (INPUT "Text7" ,INPUT marag.MARKAGARE).
                     FIND NEXT marag NO-LOCK NO-ERROR.
                     IF AVAILABLE marag THEN DO:       
                        /*ägare 14*/                                                     
                        RUN inbokvalue_UI (INPUT "Text8" ,INPUT marag.MARKAGARE).
                        FIND NEXT marag NO-LOCK NO-ERROR.
                        IF AVAILABLE marag THEN DO:       
                           /*ägare 15*/                                                     
                           RUN inbokvalue_UI (INPUT "Text9" ,INPUT marag.MARKAGARE).
                           FIND NEXT marag NO-LOCK NO-ERROR.
                           IF AVAILABLE marag THEN DO:       
                              /*ägare 16*/                                                     
                              RUN inbokvalue_UI (INPUT "Text10" ,INPUT marag.MARKAGARE).
                              FIND NEXT marag NO-LOCK NO-ERROR.
                              IF AVAILABLE marag THEN DO:       
                                 /*ägare 17*/                                                     
                                 RUN inbokvalue_UI (INPUT "Text11" ,INPUT marag.MARKAGARE).
                                 FIND NEXT marag NO-LOCK NO-ERROR.
                                 IF AVAILABLE marag THEN DO:       
                                    /*ägare 18*/                                                     
                                    RUN inbokvalue_UI (INPUT "Text12" ,INPUT marag.MARKAGARE).
                                    FIND NEXT marag NO-LOCK NO-ERROR.
                                    IF AVAILABLE marag THEN DO:       
                                       /*ägare 19*/                                                     
                                       RUN inbokvalue_UI (INPUT "Text13" ,INPUT marag.MARKAGARE).
                                       FIND NEXT marag NO-LOCK NO-ERROR.
                                       IF AVAILABLE marag THEN DO:       
                                          /*ägare 20*/                                                     
                                          RUN inbokvalue_UI (INPUT "Text14" ,INPUT marag.MARKAGARE).
                                          FIND NEXT marag NO-LOCK NO-ERROR.
                                          IF AVAILABLE marag THEN DO:       
                                             /*ägare 21*/                                                     
                                             RUN inbokvalue_UI (INPUT "Text15" ,INPUT marag.MARKAGARE).
                                          END.
                                       END.
                                    END.
                                 END.
                              END.
                           END.
                        END.
                     END.
                  END.
               END.
            END.
         END.       
      END.
      IF avtal BEGINS "upplåtelseluftLast" OR AVTAL BEGINS  "upplåtelsemarkLast" OR AVTAL BEGINS  "upplåtelsetätLast" OR AVTAL BEGINS  "upplåtelseovanLast"  THEN DO: 
         /*chDoc:Protect(2,,"gurulösen").*/
         IF spmall = TRUE THEN chWord:Visible = FALSE.
         ELSE IF skrivutmall = TRUE THEN chWord:Visible = FALSE. 
         ELSE chWord:VISIBLE = TRUE.
      END.   
      /*ELSE  chDoc:Protect(2).*/
      
      IF spmall = TRUE OR skrivutmall = TRUE THEN DO:
         chWord:displayalerts = FALSE.      
         chDoc:SaveAs(kommandoU,,,,,,,,,).        
         chWord:displayalerts = TRUE.
         IF skrivutmall = TRUE THEN DO:                                 
            chWord:ScreenUpdating = FALSE.
            chDoc:PrintOut(,,,,STRING(SESSION:PRINTER-NAME),,,).                           
         END.                          
         NO-RETURN-VALUE chDoc:CLOSE().
         NO-RETURN-VALUE chWord:QUIT().
      END.   
      
      RELEASE OBJECT chDoc NO-ERROR.
   END.
   RELEASE OBJECT chWord NO-ERROR.
   
END PROCEDURE.



PROCEDURE skapdokuts_UI.
   CREATE "Word.Application" chWord NO-ERROR.
   
   IF ERROR-STATUS:ERROR = FALSE THEN DO:
      chDoc = chWord:Documents:Open(kommando,,,,,,,,,).
      chWord:VISIBLE = TRUE.
      chDoc = chWord:ActiveDocument.
      EMPTY TEMP-TABLE tidut NO-ERROR. 
      /*ASSIGN
      hjproc = 0
      hjagare = 0.
      FOR EACH mval:
         hjagare = hjagare + 1.
         hjproc = hjproc + mval.PRODEL.
      END.*/   
      
      RUN inbokvalue_UI (INPUT "vardman" ,INPUT vardman).
      RUN inbokvalue_UI (INPUT "vardman2" ,INPUT vardman).
      RUN inbokvalue_UI (INPUT "vardtel" ,INPUT vardtel).
      RUN inbokvalue_UI (INPUT "vman" ,INPUT vman).  
      RUN inbokvalue_UI (INPUT "KontaktAdress" ,INPUT vadress).  
      RUN inbokvalue_UI (INPUT "KontaktPostadress" ,INPUT vpadress).  
      RUN inbokvalue_UI (INPUT "Kontakttele" ,INPUT vtelef).
      RUN inbokvalue_UI (INPUT "kabersatt" ,INPUT STRING(kabersatt,">9.99")).  
      RUN inbokvalue_UI (INPUT "Nätstation" ,INPUT STRING(nats)).          
      RUN inbokvalue_UI (INPUT "Datum" ,INPUT STRING(today,"9999-99-99")).
      RUN inbokvalue_UI (INPUT "Fastighet" ,INPUT marag.BETECKNING).
      RUN inbokvalue_UI (INPUT "Fastighet1" ,INPUT marag.BETECKNING).
      RUN inbokvalue_UI (INPUT "Fägare1" ,INPUT marag.MARKAGARE).   
      RUN inbokvalue_UI (INPUT "Pnr1" ,INPUT STRING(marag.PERSONNUMMER,"999999-9999")).   
      RUN inbokvalue_UI (INPUT "Fastighetsägare1" ,INPUT marag.MARKAGARE).              
      IF ttalt > 0 THEN RUN inbokvalue_UI (INPUT "Totalt1" ,INPUT STRING(ttalt)).  
      IF arrendator = "" THEN  RUN inbokvalue_UI (INPUT "Fastighetsägare21" ,INPUT marag.MARKAGARE).
      RUN inbokvalue_UI (INPUT "projekt" ,INPUT ponr).
      RUN inbokvalue_UI (INPUT "gamled" ,INPUT gamled).
      RUN inbokvalue_UI (INPUT "dödas" ,INPUT dodas).
      IF krha NE 9680 THEN RUN inbokvalue_UI (INPUT "krha" ,INPUT krha).
      IF skadeers > 0 THEN RUN inbokvalue_UI (INPUT "skadeersättning" ,INPUT skadeers).
      IF tilldag NE ? THEN RUN inbokvalue_UI (INPUT "tillträdelsedag" ,INPUT STRING(tilldag,"9999-99-99")).
      IF tkmeter NE "" THEN RUN inbokvalue_UI (INPUT "tkmeter" ,INPUT tkmeter).
      IF tkmeter NE "" THEN RUN inbokvalue_UI (INPUT "tkmeter2" ,INPUT tkmeter).                           
   
      
      chDoc:Protect(2) NO-ERROR.
      RELEASE OBJECT chDoc NO-ERROR.
   END.
   RELEASE OBJECT chWord NO-ERROR.
   /*IF VALID-HANDLE(skprotapph) THEN DELETE PROCEDURE skprotapph.      
   skprotapph = ?.
   IF VALID-HANDLE(edataapph) THEN DELETE PROCEDURE edataapph.   
   edataapph = ?.*/
END PROCEDURE.   

/*PROCEDURE inbokvalue_UI.
   DEFINE INPUT PARAMETER bokname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER bokvalue AS CHARACTER NO-UNDO.
   
   IF chDoc:Bookmarks:EXISTS( bokname ) = TRUE THEN DO:      
      chWord:SELECTION:GOTO (wdGoToBookmark BY-VARIANT-POINTER,,,bokname BY-VARIANT-POINTER).  
      IF bokvalue <> ? THEN chWord:SELECTION:TypeText ( bokvalue )  NO-ERROR.   
   END.
END PROCEDURE.*/

PROCEDURE inbokvalue_UI.
   DEFINE INPUT PARAMETER bokname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER bokvalue AS CHARACTER NO-UNDO.
   IF chDoc:Bookmarks:EXISTS( bokname ) = TRUE THEN DO:
      IF bokvalue <> ? THEN DO:
         chDoc:FormFields:item(bokname):RESULT = bokvalue NO-ERROR .
      END.               
   END.
END PROCEDURE.

PROCEDURE inbokvaluetnr12_UI.
   DEFINE INPUT PARAMETER bokname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER bokvalue AS CHARACTER NO-UNDO.
   IF chDoc:Bookmarks:EXISTS( bokname ) = TRUE THEN DO:       
      IF bokvalue <> ? THEN DO: 
         /*chWord:SELECTION:FONT:NAME = "Times New Roman".
         chWord:SELECTION:FONT:SIZE = 12.*/
         chDoc:FormFields:item(bokname):RESULT = bokvalue NO-ERROR .
         /*chWord:SELECTION:TypeText ( bokvalue ) NO-ERROR.*/ 
      END.
     
   END.
END PROCEDURE.

PROCEDURE inbokvaluetba12_UI.
   DEFINE INPUT PARAMETER bokname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER bokvalue AS CHARACTER NO-UNDO.
   IF chDoc:Bookmarks:EXISTS( bokname ) = TRUE THEN DO:       
      IF bokvalue <> ? THEN DO: 
         /*chWord:SELECTION:FONT:NAME = "Book Antiqua".
         chWord:SELECTION:FONT:SIZE = 12.*/
         chDoc:FormFields:item(bokname):RESULT = bokvalue NO-ERROR . 
         /*chWord:SELECTION:TypeText ( bokvalue ) NO-ERROR.*/ 
      END.
     
   END.
END PROCEDURE.

PROCEDURE inboklog_UI.
/*
 MESSAGE "Fel status läge 2" ERROR-STATUS:ERROR 
   VIEW-AS ALERT-BOX.
   */
   DEFINE INPUT PARAMETER bokname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER bokvalue AS LOGICAL NO-UNDO.
   IF chDoc:Bookmarks:EXISTS( bokname ) = TRUE THEN DO:
      chWord:SELECTION:GOTO (wdGoToBookmark BY-VARIANT-POINTER,,,bokname BY-VARIANT-POINTER).
      chDoc:FormFields:item(bokname):CheckBox:Value  = bokvalue  NO-ERROR .        
   END.
   /*
    MESSAGE "Fel status läge 3" ERROR-STATUS:ERROR 
   VIEW-AS ALERT-BOX.
   */
END PROCEDURE.


PROCEDURE mval_UI :
   EMPTY TEMP-TABLE mval NO-ERROR. 
   FOR EACH emarkval:      
      CREATE mval.
      BUFFER-COPY emarkval TO mval.
      ASSIGN mval.PRODEL = mval.PROCENT
      mval.ANDEL = "".
      /*markägare andel*/
      IF Guru.Konstanter:varforetypval[22] = 1 THEN DO:      
      
         IF mval.PROCENT = 100 THEN DO:
            ASSIGN
            mval.ANDEL = "1/1"        
            mval.PRODEL = mval.PROCENT.         
         END.
         ELSE DO:      
            EMPTY TEMP-TABLE inextradatatemp NO-ERROR. 
            CREATE inextradatatemp.          
            ASSIGN
            inextradatatemp.PROGRAM = "MARKFASTANDEL"                   
            inextradatatemp.HUVUDINT = mval.MARKNR.                    
            inextradatatemp.HUVUDCH = mval.BETECKNING.                    
            RUN etabhamt_UI IN edataapph (INPUT TABLE inextradatatemp, OUTPUT TABLE extradatatemp). 
            FIND FIRST extradatatemp NO-LOCK NO-ERROR.
            IF AVAILABLE extradatatemp THEN DO:      
               ASSIGN
               mval.ANDEL = extradatatemp.SOKCHAR[1]               
               mval.PRODEL = extradatatemp.SOKDEC[1].         
            END.       
            ELSE DO:
               mval.PRODEL = mval.PROCENT.
               IF mval.PROCENT = 100 THEN mval.ANDEL = "1/1".
               ELSE IF mval.PROCENT = 80 THEN mval.ANDEL = "4/5".         
               ELSE IF mval.PROCENT = 66 THEN mval.ANDEL = "2/3".         
               ELSE IF mval.PROCENT = 60 THEN mval.ANDEL = "3/5".         
               ELSE IF mval.PROCENT = 50 THEN mval.ANDEL = "1/2".         
               ELSE IF mval.PROCENT = 40 THEN mval.ANDEL = "2/5".         
               ELSE IF mval.PROCENT = 33 THEN mval.ANDEL = "1/3".         
               ELSE IF mval.PROCENT = 34 THEN mval.ANDEL = "1/3".   
               ELSE IF mval.PROCENT = 25 THEN mval.ANDEL = "1/4".
               ELSE IF mval.PROCENT = 20 THEN mval.ANDEL = "1/5".
               ELSE IF mval.PROCENT = 10 THEN mval.ANDEL = "1/10".
               ELSE mval.ANDEL = STRING(mval.PROCENT) + "/100".
            END.
         END.
      END.
   END.

END PROCEDURE.



