/*VECKHAKL.P*/
DEFINE VARIABLE tidtabrec AS RECID NO-UNDO.
DEFINE BUFFER tidbuff FOR TIDREGITAB.
DEFINE BUFFER persbuff FOR PERSONALTAB.

DEFINE INPUT PARAMETER persrec AS RECID NO-UNDO.
DEFINE INPUT PARAMETER hjdatum AS DATE NO-UNDO.
DEFINE OUTPUT PARAMETER komptimmar AS DECIMAL NO-UNDO.


komptimmar = 0.
FIND PERSONALTAB WHERE RECID(PERSONALTAB) = persrec NO-LOCK NO-ERROR.
FIND FIRST ANSTFORMTAB WHERE ANSTFORMTAB.ANSTALLNING = PERSONALTAB.ANSTALLNING
USE-INDEX ANSTF NO-LOCK NO-ERROR.   
FIND FIRST FORETAG NO-LOCK NO-ERROR.
/*msv får inte komptimmar för veckovila halvdag eller klämdag Ingrid 20101108
msv får nu komptimmar för veckovila halvdag eller klämdag enligt Ulla Backman 20120510
MISV nyttavtal 20220101 ej komptimmar för veckovila hal eller klämdag Lena Jönsson         */
IF FORETAG.FORETAG = "SUND" OR FORETAG.FORETAG = "SNAT" OR FORETAG.FORETAG = "cMISV" OR FORETAG.FORETAG = "ELPA" THEN DO:
   FIND FIRST OVERAVTAB WHERE OVERAVTAB.DATUM = hjdatum AND 
   OVERAVTAB.KOD = ANSTFORMTAB.KOD USE-INDEX ODATUM NO-LOCK NO-ERROR.
   IF AVAILABLE OVERAVTAB THEN DO:   
      IF OVERAVTAB.DAGEQ = "HAL" THEN DO:      
         FIND FIRST LONTILL WHERE LONTILL.KOD = ANSTFORMTAB.KOD AND LONTILL.LONTILLAGG = "260" NO-LOCK NO-ERROR.
         IF AVAILABLE LONTILL THEN DO:
            komptimmar = 3.
         END.
      END.   
   END.
END.

