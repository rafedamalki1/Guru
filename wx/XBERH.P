DEFINE VARIABLE delvar AS LOGICAL NO-UNDO.
DEFINE VARIABLE bernrvar AS CHARACTER NO-UNDO.
DEFINE VARIABLE omrvar AS CHARACTER NO-UNDO.
bernrvar = "2506".
omrvar = "tev8".   
      
FOR EACH beredning WHERE beredning.bernr = INTEGER(bernrvar) AND OMRADE = omrvar:
   
   DISP "h" BEREDNING.BERNR BEREDNING.BENAMNING BEREDNING.AONR BEREDNING.DELNR FORMAT ">>>>>>>>9" BEREDNING.BERAONR WITH FRAME CC.
   FIND FIRST BERMTRL WHERE BERMTRL.OMRADE = BEREDNING.OMRADE AND  BERMTRL.AONR = string(BEREDNING.bernr)  
   AND BERMTRL.INKOP = TRUE NO-ERROR.   
   /*finns inköp*/
   IF AVAILABLE BERMTRL THEN  DISP "m" BERMTRL.DATUM BERMTRL.DBEST BERMTRL.DELNR FORMAT ">>>>>>>>9" BERMTRL.ENR BERMTRL.INKOP WITH FRAME CC2.

   
      /*koll del beställning*/
   /*
   FOR EACH berval WHERE berval.OMRADE = BEREDNING.OMRADE AND  berval.AONR = string(BEREDNING.bernr):
      DISP  "k" berval.DELNR FORMAT ">>>>>>>>9" berval.ort FORMAT "X(10)" BERVAL.NUM BERVAL.KONSKOD BERVAL.KTYPKOD BERVAL.SKAPNUM.
      /* uppdatera delbest*/
      /*
      berval.ort = STRING(TODAY).
      berval.delnr = 50596.
      UPDATE berval.ort berval.DELNR.
       */
   END.
   */
   /*visar inköpet*/
   FOR EACH BERMTRL WHERE BERMTRL.OMRADE = BEREDNING.OMRADE AND  BERMTRL.AONR = string(BEREDNING.bernr) AND 
   BERMTRL.INKOP = TRUE BY BERMTRL.ENR:
      DISP "m" BERMTRL.DATUM BERMTRL.DBEST BERMTRL.DELNR FORMAT ">>>>>>>>9" BERMTRL.ENR BERMTRL.INKOP .
      
      /*nollar inköpet*/
      DELETE BERMTRL.
      /*BERMTRL.INKOP = FALSE.
      BERMTRL.DELNR = 0.
      */
  END.
  
  
  /*visar upplaget för del inköp endast intresant */  
  FOR EACH berupp WHERE berupp.OMRADE = BEREDNING.OMRADE AND  berupp.AONR = string(BEREDNING.bernr):
     DISP  "u" BERUPP.AONR BERUPP.OMRADE BERUPP.DELNR FORMAT ">>>>>>>>9" BERUPP.ANTALRADER BERUPP.UPPLAG.
  END.

  /*visar linkab*/
  FOR EACH BERLINKAB WHERE BERLINKAB.OMRADE = BEREDNING.OMRADE AND  BERLINKAB.AONR = string(BEREDNING.bernr):
     DISP  "L" BERLINKAB.datum BERLINKAB.DELNR FORMAT ">>>>>>>>9" BERLINKAB.BENAMNING BERLINKAB.UPPLAG BERLINKAB.meter.
  END.

   
   /*vilka beställningar som finns*/
   FOR EACH LEVTRP WHERE LEVTRP.OMRADE = BEREDNING.OMRADE AND  LEVTRP.BERNR = BEREDNING.bernr:
      DISP  "TRP"         
         levtrp.LEVERANS FORMAT "X(45)"  LEVTRP.BERBESTNR  LEVTRP.BESTNR LEVTRP.LEVKOD LEVTRP.BESTALLD LEVTRP.KTKONTAKT.              
 
     /*DELETE    LEVTRP. 
      UPDATE LEVTRP.LEVKOD.
      
      UPDATE LEVTRP.LEVERANS.
      */
      UPDATE LEVTRP.LEVERANS.
     IF LEVTRP.LEVERANS = "X" THEN DELETE LEVTRP.     
       
   END.
   FOR EACH LEVTRP2 WHERE LEVTRP2.OMRADE = BEREDNING.OMRADE AND  LEVTRP2.BERNR = BEREDNING.bernr:
      DISP  "TRP2" LEVTRP2.DATUM LEVTRP2.BESTNR LEVTRP2.BESTALLD LEVTRP2.LEVKOD.      
 
      /*DELETE    LEVTRP2.     
      UPDATE LEVTRP2.BESTALLD.
      */
       UPDATE LEVTRP2.BESTALLD.
      IF LEVTRP2.BESTALLD = "X" THEN DELETE LEVTRP2.            
            
   END.
   FOR EACH BESTSTAT WHERE BESTSTAT.OMRADE = BEREDNING.OMRADE AND BESTSTAT.BERNR = BEREDNING.BERNR:
      DISP  "bs" BESTSTAT.DATUM BESTSTAT.BESTNR BESTSTAT.BESTALLD BESTSTAT.LEVKOD.     
                              /*
      UPDATE BESTSTAT.BESTALLD.
      */
       UPDATE BESTSTAT.BESTALLD.
       IF BESTSTAT.BESTALLD = "X" THEN DELETE BESTSTAT.  
      
   END.   
END.
