/*TIDMENY.P*/
{AVDTEMP.I}
{ALLDEF.I}
{GLOBVAR2DEL1.I}
{HOPPSEK2W.I}
{TIDWID.I}
&Scoped-define NEW 
&Scoped-define SHARED SHARED
{FORETEMP.I}
{SOKDEF.I}
{DIRDEF.I}
{TIDALLT.I}
{TIDPERS.I}
{UPPGHMT.I}
{PHMT.I}
{FLEXTAB.I}
{REGVAR.I}
{OMRTEMPW.I}
{OTIDBEORD.I}
DEFINE VARIABLE globanvpkod AS CHARACTER NO-UNDO.
DEFINE SHARED TEMP-TABLE markpers    
   FIELD EFTERNAMN AS CHARACTER
   FIELD FORNAMN AS CHARACTER
   FIELD PERSONALKOD AS CHARACTER
   INDEX PERSONALKOD IS PRIMARY PERSONALKOD ASCENDING. 
DEFINE SHARED TEMP-TABLE vavdelningtemp    
   FIELD AVDELNINGNR AS INTEGER  
   FIELD AVDELNINGNAMN AS CHARACTER
   INDEX AVD IS PRIMARY AVDELNINGNR ASCENDING.
DEFINE  SHARED TEMP-TABLE vomrtemp
   FIELD OMRADE AS CHARACTER
   FIELD NAMN AS CHARACTER
   INDEX OMR IS PRIMARY OMRADE
   INDEX OMRNAMN NAMN.
DEFINE TEMP-TABLE valtemp
   FIELD VALDLISTA AS CHARACTER
   FIELD BAVAL AS INTEGER
   FIELD ALLTID AS LOGICAL
   FIELD STARTDATUM AS DATE
   FIELD SLUTDATUM AS DATE.
DEFINE TEMP-TABLE vispers
   FIELD PERSONALKOD AS CHARACTER
   FIELD FORNAMN AS CHARACTER
   FIELD EFTERNAMN AS CHARACTER
   INDEX PKOD IS PRIMARY PERSONALKOD.   
DEFINE  SHARED VARIABLE tomdat AS DATE NO-UNDO.
DEFINE  SHARED VARIABLE manad AS INTEGER NO-UNDO.
DEFINE  SHARED VARIABLE korda AS INTEGER NO-UNDO.
DEFINE  SHARED VARIABLE dirtid AS LOGICAL NO-UNDO.
DEFINE  SHARED VARIABLE dirtidoveraknare AS INTEGER NO-UNDO.
DEFINE  SHARED VARIABLE dirtidrec AS RECID NO-UNDO.
DEFINE  SHARED VARIABLE allatidvar AS LOGICAL NO-UNDO.
DEFINE  SHARED VARIABLE manvaxla AS LOGICAL NO-UNDO.
DEFINE  SHARED VARIABLE flexav AS LOGICAL NO-UNDO.
DEFINE  SHARED VARIABLE bustart3 AS DECIMAL NO-UNDO. 
DEFINE  SHARED VARIABLE vaxla AS LOGICAL NO-UNDO.
DEFINE  SHARED VARIABLE perssokrec AS RECID NO-UNDO. 
DEFINE  SHARED VARIABLE tidtabrec AS RECID NO-UNDO.
DEFINE  SHARED VARIABLE tidtabrec2 AS RECID NO-UNDO.  
DEFINE  SHARED VARIABLE tidsedrec AS RECID NO-UNDO.
DEFINE  SHARED VARIABLE tidsedlog AS LOGICAL NO-UNDO.
DEFINE  SHARED VARIABLE andvisrec AS RECID NO-UNDO.
DEFINE  SHARED VARIABLE persrec AS RECID NO-UNDO. 
DEFINE  SHARED VARIABLE persrec2 AS RECID NO-UNDO.
DEFINE  SHARED VARIABLE vartgamla AS CHARACTER FORMAT "X(3)" NO-UNDO.
DEFINE  SHARED VARIABLE klocka AS DECIMAL NO-UNDO. 
DEFINE  SHARED VARIABLE andvisvnr AS INTEGER FORMAT "999" NO-UNDO.
DEFINE  SHARED VARIABLE andvisdatum AS DATE NO-UNDO.
DEFINE  SHARED VARIABLE radmusz AS LOGICAL NO-UNDO.
DEFINE  SHARED VARIABLE flrec AS RECID NO-UNDO.
DEFINE  SHARED VARIABLE flrec2 AS RECID NO-UNDO.
DEFINE  SHARED VARIABLE fldrec AS RECID NO-UNDO.
DEFINE  SHARED VARIABLE fldrec2 AS RECID NO-UNDO.
DEFINE  SHARED VARIABLE arnr AS INTEGER FORMAT "9999" NO-UNDO. 
DEFINE  SHARED VARIABLE manadnr AS INTEGER FORMAT "99" NO-UNDO.
DEFINE  SHARED VARIABLE manadnamn AS CHARACTER NO-UNDO.
DEFINE  SHARED VARIABLE vkdatum AS DATE NO-UNDO.
DEFINE SHARED VARIABLE skrivut AS LOGICAL NO-UNDO.
DEFINE SHARED VARIABLE musz AS LOGICAL NO-UNDO. 
DEFINE SHARED VARIABLE vartpro AS CHARACTER FORMAT "X(3)" NO-UNDO.
DEFINE SHARED VARIABLE vart AS CHARACTER FORMAT "X(3)" NO-UNDO.

DEFINE VARIABLE storkollbredd AS INTEGER NO-UNDO.
DEFINE VARIABLE storkollhojd AS INTEGER NO-UNDO.
DEFINE VARIABLE alltidspar AS INTEGER NO-UNDO.
DEFINE VARIABLE medvar AS LOGICAL NO-UNDO.
DEFINE VARIABLE sparomrade AS CHARACTER NO-UNDO.
DEFINE SHARED VARIABLE RAD_LISTA AS INTEGER NO-UNDO.
DEFINE SHARED VARIABLE TOGGLE-MONTH AS LOGICAL INITIAL ? NO-UNDO.
DEFINE SHARED VARIABLE RAD_GOD AS INTEGER NO-UNDO.
DEFINE VARIABLE datkoll AS DATE NO-UNDO.
DEFINE VARIABLE markpkod AS CHARACTER NO-UNDO.
DEFINE VARIABLE ejvisdatum AS DATE NO-UNDO.
DEFINE VARIABLE status-ok AS LOGICAL NO-UNDO.
DEFINE VARIABLE antal_valda AS INTEGER NO-UNDO.
DEFINE VARIABLE antal_raknare AS INTEGER NO-UNDO.
DEFINE VARIABLE sekertid AS INTEGER NO-UNDO.
DEFINE VARIABLE dagnr AS INTEGER NO-UNDO. 
DEFINE VARIABLE sok1 AS CHARACTER NO-UNDO.
DEFINE VARIABLE sok2 AS INTEGER NO-UNDO.
DEFINE VARIABLE sok3 AS CHARACTER NO-UNDO.
DEFINE VARIABLE sok4 AS CHARACTER NO-UNDO.
DEFINE VARIABLE sok5 AS DECIMAL NO-UNDO.
DEFINE VARIABLE markladdad AS LOGICAL INITIAL FALSE NO-UNDO.
DEFINE VARIABLE radspar AS INTEGER NO-UNDO.
DEFINE VARIABLE nyttaoapph AS HANDLE NO-UNDO.                     /* NYTTAOAPP.P */
DEFINE VARIABLE persapph AS HANDLE NO-UNDO.                     /* PHMTAPP.P */
DEFINE VARIABLE btnnovit AS HANDLE NO-UNDO.
DEFINE VARIABLE jid AS CHARACTER NO-UNDO.
DEFINE VARIABLE hjrak AS INTEGER NO-UNDO.
DEFINE VARIABLE hjdat AS DATE NO-UNDO.
DEFINE VARIABLE visaigen AS LOGICAL INITIAL FALSE NO-UNDO.
DEFINE VARIABLE igendat AS DATE NO-UNDO.
DEFINE VARIABLE atkman AS INTEGER NO-UNDO.
DEFINE VARIABLE uppsal AS LOGICAL NO-UNDO.
DEFINE VARIABLE obeordg AS LOGICAL NO-UNDO.
DEFINE VARIABLE lasanv AS CHARACTER NO-UNDO.
DEFINE VARIABLE ptraff AS LOGICAL NO-UNDO.
framesizeh = framesizeextrah.
DEFINE VARIABLE marktemph AS HANDLE NO-UNDO.
marktemph = TEMP-TABLE markpers:DEFAULT-BUFFER-HANDLE. 
DEFINE VARIABLE vavdelemph AS HANDLE NO-UNDO.
vavdelemph = TEMP-TABLE vavdelningtemp:DEFAULT-BUFFER-HANDLE. 
DEFINE VARIABLE avdelemph AS HANDLE NO-UNDO.
avdelemph = TEMP-TABLE avdelningtemp:DEFAULT-BUFFER-HANDLE. 

ON 'MOUSE-SELECT-DBLCLICK':U OF BRW_MARK PERSISTENT RUN brwmark_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF BTN_AVB PERSISTENT RUN avb_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF BTN_FDA PERSISTENT RUN btnfdas_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF BTN_NDA PERSISTENT RUN btnnda_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF BTN_VOVER PERSISTENT RUN btnvover_UI IN THIS-PROCEDURE.
ON 'LEAVE':U OF CMB_AR PERSISTENT RUN lvcmbar_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF CMB_AR PERSISTENT RUN vccmbar_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF CMB_MANAD PERSISTENT RUN vccmbmanad_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF CMB_OMR PERSISTENT RUN vccmbomr_UI IN THIS-PROCEDURE.
ON 'LEAVE':U OF CMB_TARSL PERSISTENT RUN lvcmbtarsl_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF CMB_TARSL PERSISTENT RUN vccmbtarsl_UI IN THIS-PROCEDURE.
ON 'LEAVE':U OF CMB_TARST PERSISTENT RUN lvcmbtarst_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF CMB_TARST PERSISTENT RUN vccmbtarst_UI IN THIS-PROCEDURE.
ON 'LEAVE':U OF CMB_TMANADSL PERSISTENT RUN lvcmbmanadsl_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF CMB_TMANADSL PERSISTENT RUN vccmbmanadsl_UI IN THIS-PROCEDURE.
ON 'LEAVE':U OF CMB_TMANADST PERSISTENT RUN lvcmbmanadst_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF CMB_TMANADST PERSISTENT RUN vccmbmanadst_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_AND PERSISTENT RUN btnand0_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_ANDGOD PERSISTENT RUN btnandgod0_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_ANOV PERSISTENT RUN btnanov_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_ARB PERSISTENT RUN btnarb_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_LASUPPT PERSISTENT RUN btnlasuppt_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_ARES PERSISTENT RUN btnares_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_AVVIK PERSISTENT RUN btnavvik_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_BER PERSISTENT RUN bered_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_FLKORN PERSISTENT RUN btnfelk_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_FRAMAN PERSISTENT RUN btnfranm_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_FRAPP PERSISTENT RUN btnfrapp_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_GOD PERSISTENT RUN btngod_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_GRAN PERSISTENT RUN btngran_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_KONT PERSISTENT RUN btnkont_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_KONTROLL PERSISTENT RUN btnkotroll0_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_LGOD PERSISTENT RUN btnlgod0_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_LON PERSISTENT RUN btnlon_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_LONA PERSISTENT RUN btnlona_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_MANSAL PERSISTENT RUN btnmansal_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_OVER PERSISTENT RUN btnover_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_PERIOD PERSISTENT RUN btnperiod_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_REG PERSISTENT RUN btnreg_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_SALDO PERSISTENT RUN btnsaldo_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_SALMAN PERSISTENT RUN btnsalman_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_SKR PERSISTENT RUN btnskr_UI IN THIS-PROCEDURE.
ON 'MOUSE-MENU-CLICK':U OF FBTN_SKR PERSISTENT RUN mmbtnskr_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_TBRES PERSISTENT RUN btntbres_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_TID PERSISTENT RUN btntid_UI IN THIS-PROCEDURE.
ON 'MOUSE-MENU-CLICK':U OF FBTN_TID PERSISTENT RUN mmbtntid_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_TRA PERSISTENT RUN btntra_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_UTRES PERSISTENT RUN btnutres_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_VECK PERSISTENT RUN btnveck_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_VISA PERSISTENT RUN btnvisa_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_VTID PERSISTENT RUN btnvtid_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF FBTN_VTIDV PERSISTENT RUN btnvtidv0_UI IN THIS-PROCEDURE.
ON 'LEAVE':U OF FILL-IN-TDATUM PERSISTENT RUN lvtdatum_UI IN THIS-PROCEDURE.
ON 'LEAVE':U OF FILL-IN-TDATUM-2 PERSISTENT RUN lvtdatum2_UI IN THIS-PROCEDURE.
ON 'LEAVE':U OF FILL-IN_DATUM PERSISTENT RUN filldatum_UI IN THIS-PROCEDURE.
ON 'MOUSE-MENU-CLICK' OF FILL-IN_DATUM PERSISTENT RUN mmfilldatum_UI IN THIS-PROCEDURE.
ON 'ANY-KEY':U OF FILL-IN_EPERSONALKOD PERSISTENT RUN akepers_UI IN THIS-PROCEDURE.
ON 'ANY-KEY':U OF FILL-IN_ETIDSGODK PERSISTENT RUN aketidsgodk_UI IN THIS-PROCEDURE.
ON 'MOUSE-SELECT-DBLCLICK':U OF FILL-IN_EPERSONALKOD PERSISTENT RUN mdepers_UI IN THIS-PROCEDURE.
ON 'MOUSE-SELECT-DBLCLICK':U OF FILL-IN_ETIDSGODK PERSISTENT RUN mdegodkpers_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF MBTN_FLEXADM PERSISTENT RUN mbtnflexadm_UI IN THIS-PROCEDURE.
 ON 'CHOOSE':U OF MBTN_STANSA PERSISTENT RUN mbtnstansa_UI IN THIS-PROCEDURE. 
ON 'CHOOSE':U OF MBTN_TIDADM PERSISTENT RUN mbtntidadm_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF MBTN_TIDSEDEL PERSISTENT RUN mbtntidsed_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF MBTN_TILLAGG PERSISTENT RUN mbtntillagg_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF MBTN_TJANSTERESA PERSISTENT RUN mbtntjanstres_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF RAD_ALLTID PERSISTENT RUN btnradallt_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF RAD_ALLVAL PERSISTENT RUN btnradallv_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF RAD_TIDSVAL PERSISTENT RUN tomdat_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED':U OF TOG_MAN PERSISTENT RUN togman_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF BTN_AOF PERSISTENT RUN sparaaofavoriter_UI IN THIS-PROCEDURE.
ON 'CHOOSE':U OF BTN_HAOF PERSISTENT RUN hmtfavoriter_UI IN THIS-PROCEDURE.

PROCEDURE btnvit_UI :
   DEFINE INPUT PARAMETER btnh AS HANDLE NO-UNDO.
   DEFINE VARIABLE btnlabel AS CHARACTER NO-UNDO.
   IF btnnovit NE ? THEN DO:
      btnlabel = btnnovit:IMAGE.
      btnlabel = REPLACE(btnlabel,"_vit.gif",".gif"). 
      btnnovit:LOAD-IMAGE (btnlabel) NO-ERROR.
   END.
   btnlabel = btnh:IMAGE.
   btnlabel = REPLACE(btnlabel,".gif","_vit.gif"). 
   btnh:LOAD-IMAGE (btnlabel) NO-ERROR.
   btnnovit = btnh.   
END PROCEDURE.

PROCEDURE autofavo_UI :
   FIND FIRST markpers NO-LOCK NO-ERROR.
   IF AVAILABLE markpers THEN DO:
      RUN sparaaofavoriter_UI.
   END.
END PROCEDURE.
PROCEDURE hmtfavoriter_UI :
   DEFINE VARIABLE ttbuffh AS HANDLE NO-UNDO.
   tthandle = TEMP-TABLE markpers:HANDLE.
   ttbuffh = tthandle:DEFAULT-BUFFER-HANDLE.
   RUN ttcopy_UI IN huvprogh (INPUT TABLE-HANDLE tthandle).
   ttbuffh:EMPTY-TEMP-TABLE() NO-ERROR.
   FIND FIRST sparaladdatemp NO-ERROR.
   IF NOT AVAILABLE sparaladdatemp THEN CREATE sparaladdatemp.  
   ASSIGN
   sparaladdatemp.GLOBANV = Guru.Konstanter:globanv /*Användare, i detta fall ELPAO*/
   sparaladdatemp.BENAMNING = "TID" /*Benämnings sufix, i detta fall ELPAO$STOR*/
   sparaladdatemp.TABVAL = "PERSONALTAB" /*Tabellnamn*/
   sparaladdatemp.FALTVALAO = "PERSONALKOD" /*Character field*/
   sparaladdatemp.FALTVALDEL = "" /*Integer field*/
   sparaladdatemp.FALTVALDATE = "".   /*DATE field*/
   RUN laddabrw_UI IN brwproc[3]  (INPUT TABLE-HANDLE tthandle, INPUT TABLE sparaladdatemp).         
   RUN ttjmf_UI IN huvprogh (INPUT-OUTPUT ttbuffh).
   RUN openbdyn_UI IN brwproc[3] (INPUT ""). 
END PROCEDURE.
{OMSTARTAVGURUH.I}
RUN main_UI.
{musarrow.i}

PROCEDURE togman_UI :
   IF TOG_MAN:CHECKED = ? THEN TOG_MAN:CHECKED = FALSE.
   RUN mangoma_UI.
   RUN tomdat_UI. 
END PROCEDURE.
PROCEDURE btnradallv_UI :
   RUN radallval_UI.
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(4) THEN DO:
      
      FIND FIRST markpers NO-ERROR.
      IF NOT AVAILABLE markpers THEN DO:      
         RUN laddspers_UI.         
         IF Guru.Konstanter:globallm = FALSE AND markladdad = FALSE THEN DO:
            FIND FIRST markpers WHERE markpers.PERSONALKOD = Guru.Konstanter:globanvpkod NO-LOCK NO-ERROR.
            IF NOT AVAILABLE markpers THEN DO:
               FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = Guru.Konstanter:globanvpkod AND 
               personaltemp.AKTIV = TRUE NO-LOCK NO-ERROR.
               IF AVAILABLE personaltemp THEN DO:
                  CREATE markpers.
                  ASSIGN  markpers.EFTERNAMN = personaltemp.EFTERNAMN 
                  markpers.FORNAMN = personaltemp.FORNAMN 
                  markpers.PERSONALKOD = personaltemp.PERSONALKOD.            
                  RUN openbdynspec_UI IN brwproc[3].                                 
               END.
            END.
         END.
      END.
      
      markladdad = FALSE.
   END.
   DEBUGGER:SET-BREAK().
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(6) THEN DO:                    
      FIND FIRST godkannartemp WHERE godkannartemp.PERSONALKOD = Guru.Konstanter:globanvpkod NO-LOCK NO-ERROR.
      IF AVAILABLE godkannartemp THEN DO:
         FIND FIRST markpers WHERE markpers.PERSONALKOD = Guru.Konstanter:globanvpkod NO-LOCK NO-ERROR.
         IF NOT AVAILABLE markpers THEN DO:
            FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = Guru.Konstanter:globanvpkod AND 
            personaltemp.AKTIV = TRUE NO-LOCK NO-ERROR.
            IF AVAILABLE personaltemp THEN DO:
               CREATE markpers.
               ASSIGN  markpers.EFTERNAMN = personaltemp.EFTERNAMN 
               markpers.FORNAMN = personaltemp.FORNAMN 
               markpers.PERSONALKOD = personaltemp.PERSONALKOD.            
               RUN openbdynspec_UI IN brwproc[3].                                 
            END.
         END.
      END.
   END.
   
END PROCEDURE.
PROCEDURE btnradallt_UI :
   DEFINE VARIABLE radkoll AS INTEGER NO-UNDO.
   {OMSTARTAVGURUH.I}
   radkoll = INTEGER(RAD_ALLTID:SCREEN-VALUE).
   BTN_AOF:HIDDEN = TRUE.
   BTN_HAOF:HIDDEN = TRUE.
   FBTN_LASUPPT:HIDDEN = TRUE.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(3) THEN DO:
      RUN imladda_UI.      
   END.
   ELSE IF RAD_ALLTID:SCREEN-VALUE = STRING(4) THEN DO:
      RUN imladda_UI.      
   END.
   ELSE IF RAD_ALLTID:SCREEN-VALUE = STRING(5) THEN DO:
      RUN imladda_UI.    
   END.
   ELSE IF RAD_ALLTID:SCREEN-VALUE = STRING(6) THEN DO:
      RUN imladda_UI.      
   END.
   ELSE IF RAD_ALLTID:SCREEN-VALUE = STRING(7) THEN DO:
      RUN imladda_UI.      
   END.
   ELSE IF RAD_ALLTID:SCREEN-VALUE = STRING(8) THEN DO:
      RUN imladda_UI.      
   END.
   ELSE IF RAD_ALLTID:SCREEN-VALUE = STRING(9) THEN DO:
      RUN imladda_UI.     
   END.
   /*Lena 02/06/2004 fel om man byter från tidsedel till ändra utan att röra cmb*/ 
   IF RAD_ALLTID:SCREEN-VALUE = STRING(9) THEN regar = INTEGER(CMB_TARSL:SCREEN-VALUE).
   ELSE regar = INTEGER(CMB_AR:SCREEN-VALUE).
   IF RAD_ALLTID:SCREEN-VALUE NE STRING(9) THEN DO:      
      IF RAD_ALLVAL:SCREEN-VALUE = STRING(4) THEN DO:      
         FOR EACH markpers:
            FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = markpers.PERSONALKOD NO-ERROR.
            IF NOT AVAILABLE personaltemp THEN DO: 
               FIND FIRST tidpers WHERE tidpers.PERSONALKOD = markpers.PERSONALKOD  NO-ERROR.
               IF AVAILABLE tidpers THEN DELETE tidpers.
               DELETE markpers.               
            END.
            ELSE DO:
               IF personaltemp.AKTIV = FALSE THEN DO:
                  FIND FIRST tidpers WHERE tidpers.PERSONALKOD = markpers.PERSONALKOD  NO-ERROR.
                  IF AVAILABLE tidpers THEN DELETE tidpers.
                  DELETE markpers.
                  DELETE personaltemp.
               END.
            END.           
         END.
         RUN openbdynspec_UI IN brwproc[3].
         RUN openbdynspec_UI IN brwproc[5].
      END.
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(6) THEN DO:      
      {AVBGOM2.I}
      RUN STANSTID.W (OUTPUT markpkod).
      {AVBFRAM2.I}      
      IF markpkod NE "" THEN DO:
         FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = markpkod AND 
         personaltemp.AKTIV = TRUE
         NO-LOCK NO-ERROR.
         IF AVAILABLE personaltemp THEN DO:
            ASSIGN
            RAD_ALLTID:SCREEN-VALUE = STRING(5)
            RAD_ALLVAL:SCREEN-VALUE = STRING(4).
            EMPTY TEMP-TABLE markpers NO-ERROR. 
            FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = markpkod AND 
            personaltemp.AKTIV = TRUE
            NO-LOCK NO-ERROR.
            CREATE markpers.
            ASSIGN  markpers.EFTERNAMN = personaltemp.EFTERNAMN 
            markpers.FORNAMN = personaltemp.FORNAMN 
            markpers.PERSONALKOD = personaltemp.PERSONALKOD.            
            RUN openbdynspec_UI IN brwproc[3].                          
         END.
         ELSE DO:
            ASSIGN
            RAD_ALLTID:SCREEN-VALUE = STRING(radkoll).
         END.
      END.
      ELSE DO:
         ASSIGN
         RAD_ALLTID:SCREEN-VALUE = STRING(radkoll).
      END.
   END. 
   ELSE RUN radallatid_UI.   
   radspar = INTEGER(RAD_ALLTID:SCREEN-VALUE). 
   RUN PlaceraKnapp_UI.
   {musarrow.i}
END PROCEDURE.
PROCEDURE imladda_UI :
   
END PROCEDURE.

PROCEDURE mbtntjanstres_UI :

   RUN btnvit_UI (INPUT MBTN_TJANSTERESA).
   RAD_ALLTID:SCREEN-VALUE = STRING(4).
   APPLY "VALUE-CHANGED" TO RAD_ALLTID.
END PROCEDURE.
PROCEDURE mbtntillagg_UI :

   RUN btnvit_UI (INPUT MBTN_TILLAGG).
   RAD_ALLTID:SCREEN-VALUE = STRING(5).
   APPLY "VALUE-CHANGED" TO RAD_ALLTID.
END PROCEDURE.
PROCEDURE mbtntidsed_UI :

  RUN btnvit_UI (INPUT MBTN_TIDSEDEL).
  RAD_ALLTID:SCREEN-VALUE = STRING(9).
  APPLY "VALUE-CHANGED" TO RAD_ALLTID.
END PROCEDURE.
PROCEDURE mbtntidadm_UI :

   RUN btnvit_UI (INPUT MBTN_TIDADM).
   RAD_ALLTID:SCREEN-VALUE = STRING(7).
   APPLY "VALUE-CHANGED" TO RAD_ALLTID.
END PROCEDURE.
PROCEDURE mbtnstansa_UI :

   RAD_ALLTID:SCREEN-VALUE = STRING(6).
   APPLY "VALUE-CHANGED" TO RAD_ALLTID.
END PROCEDURE.
PROCEDURE mbtnflexadm_UI :

   RUN btnvit_UI (INPUT MBTN_FLEXADM).
   RAD_ALLTID:SCREEN-VALUE = STRING(8).
   APPLY "VALUE-CHANGED" TO RAD_ALLTID.
END PROCEDURE.
PROCEDURE mdepers_UI :
   RUN hamten_UI.   
END PROCEDURE.
PROCEDURE mdegodkpers_UI :   
   RUN hamtgodpers_UI.
END PROCEDURE.
PROCEDURE akepers_UI :
   {TRYCKS.I}
   IF KEYFUNCTION(LASTKEY) = ("RETURN") THEN DO:
      APPLY "MOUSE-SELECT-DBLCLICK" TO FILL-IN_EPERSONALKOD.
   END.
END PROCEDURE.
PROCEDURE aketidsgodk_UI :
   {TRYCKS.I}
   IF KEYFUNCTION(LASTKEY) = ("RETURN") THEN DO:
      APPLY "MOUSE-SELECT-DBLCLICK" TO FILL-IN_ETIDSGODK.
   END.
END PROCEDURE.
PROCEDURE mmfilldatum_UI :
   Guru.GlobalaVariabler:regdatum = DATE(FILL-IN_DATUM:SCREEN-VALUE).
   RUN AlmanBtn.w.
   FILL-IN_DATUM:SCREEN-VALUE = STRING(Guru.GlobalaVariabler:regdatum).
   
END PROCEDURE.
PROCEDURE filldatum_UI :
   ASSIGN
   regdatum = DATE(FILL-IN_DATUM:SCREEN-VALUE)
   tomdat = DATE(FILL-IN_DATUM:SCREEN-VALUE).
   FIND FIRST flexavttemp WHERE flexavttemp.PERSONALKOD = personaltemp.PERSONALKOD NO-LOCK NO-ERROR.
   FIND FIRST ansttemp WHERE ansttemp.ANSTALLNING = personaltemp.ANSTALLNING
   USE-INDEX ANSTF NO-LOCK NO-ERROR.  
   ASSIGN
   sok1 = ansttemp.KOD
   sok4 = STRING(regdatum).
   IF Guru.Konstanter:appcon THEN DO: 
      RUN FLEXTIDH.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT 8,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
      INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
   END.
   ELSE DO:
      RUN FLEXTIDH.P 
      (INPUT 8,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
      INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
   END.
   IF sok2 = 0 THEN dagnr = WEEKDAY(regdatum).
   ELSE dagnr = sok2.   
END PROCEDURE.
PROCEDURE lvtdatum2_UI :
   RUN dagkoll_UI.  
   RUN dag_UI.
END PROCEDURE.
PROCEDURE lvtdatum_UI :
   RUN dagkoll_UI.  
   RUN dag_UI.
END PROCEDURE.

PROCEDURE btnvtidv0_UI :
   RUN btnvtidv_UI.   
   {musarrow.i}
END PROCEDURE.
PROCEDURE btnvtid_UI :
   RUN tidv_UI.
   {musarrow.i}
END PROCEDURE.
PROCEDURE tidv_UI :
   {OMSTARTAVGURUH.I}   
   APPLY "VALUE-CHANGED" TO TOG_MAN.    
   {musarrow.i}   
END PROCEDURE.

PROCEDURE btnvisa_UI :
   {OMSTARTAVGURUH.I}
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:      
      IF obeordg = TRUE  THEN RUN findtp_UI (INPUT "OTBURVALU.W",INPUT 5).      
      ELSE RUN findtp_UI (INPUT "TIDVISA.W",INPUT 1).      
   END.
   {musarrow.i}
END PROCEDURE.
PROCEDURE btnveck_UI :
   
   {OMSTARTAVGURUH.I}
   {AVBGOM2.I}   
   {AMERICANEUROPEAN.I}
   RUN VKORNING.W.
   {EUROPEANAMERICAN.I}     
   
   {AVBFRAM2.I} 
   {musarrow.i}

END PROCEDURE.
PROCEDURE btnutres_UI :
   {OMSTARTAVGURUH.I}
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      {AVBGOMD2.I}
      RUN findtp_UI (INPUT "UTLRESR.W (INPUT ?, INPUT 1)",INPUT 3).
      {AVBFRAMD2.I}
      APPLY "ENTRY" TO RAD_ALLTID.      
   END.
   {musarrow.i}
END PROCEDURE.
PROCEDURE btntra_UI :
   RUN trakt_UI. 
   {musarrow.i}
END PROCEDURE.

PROCEDURE mmbtntid_UI :
   IF Guru.Konstanter:globforetag = "ELPA"  OR Guru.Konstanter:globforetag = "NORD" 
   OR Guru.Konstanter:globforetag = "ESAN" OR Guru.Konstanter:globforetag = "ESMA" OR Guru.Konstanter:globforetag = "ETA" 
    OR Guru.Konstanter:globforetag = "SUND"  OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globanv = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)  
   THEN musz = musz.
   ELSE RETURN NO-APPLY.
   RUN onmeny_UI.
END PROCEDURE.
PROCEDURE btntid_UI :
   RUN tida_UI. 
   {musarrow.i}
END PROCEDURE.

PROCEDURE fselectfoc_UI :
   DEFINE VARIABLE brwrowid AS ROWID NO-UNDO.
   DEFINE VARIABLE brwrecid AS RECID NO-UNDO.
   IF NOT VALID-HANDLE(avdelemph) THEN DO:
      avdelemph = TEMP-TABLE avdelningtemp:DEFAULT-BUFFER-HANDLE.
   END.
   RUN fetrowid_UI IN brwproc[6] (INPUT antal_raknare,OUTPUT brwrowid) .
   FIND FIRST avdelningtemp WHERE ROWID(avdelningtemp) = brwrowid NO-LOCK NO-ERROR.
END PROCEDURE.

PROCEDURE selectfoc_UI :
   DEFINE VARIABLE brwrowid AS ROWID NO-UNDO.
   DEFINE VARIABLE brwrecid AS RECID NO-UNDO.
   IF NOT VALID-HANDLE(marktemph) THEN DO:
      marktemph = TEMP-TABLE markpers:DEFAULT-BUFFER-HANDLE.
   END.
   RUN selectrowid_UI IN brwproc[3] (OUTPUT brwrowid).
   RUN selectrecid_UI IN brwproc[3] (OUTPUT brwrecid).
   FIND FIRST markpers WHERE ROWID(markpers) = brwrowid NO-LOCK NO-ERROR.
END PROCEDURE.
PROCEDURE btntbres_UI :
   {OMSTARTAVGURUH.I}
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      RUN selectfoc_UI.
      {AVBGOMD2.I}
      RUN findtp_UI (INPUT "RESBORT.W (INPUT ?, INPUT 1)",INPUT 3).
      {AVBFRAMD2.I}
   END.
   {musarrow.i} 
END PROCEDURE.
PROCEDURE mmbtnskr_UI :
   RUN SIDLANGD.W.   
END PROCEDURE.
PROCEDURE btnskr_UI :
   skrivut = TRUE.
   RUN btnvtidv_UI.
   skrivut = FALSE.
END PROCEDURE.
PROCEDURE btnvtidv_UI :
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.
      RETURN.
   END.   
   IF CMB_AR:VISIBLE = TRUE THEN DO:
      ASSIGN  
      regar = INTEGER(CMB_AR:SCREEN-VALUE)
      regmannamn = CMB_MANAD:SCREEN-VALUE.   
   END.
   IF CMB_TARST:VISIBLE = TRUE THEN DO:
      ASSIGN  
      regar = INTEGER(CMB_TARST:SCREEN-VALUE)
      regmannamn = CMB_TMANADST:SCREEN-VALUE.   
   END.
   RUN MANNR.P. 
   andvisdatum = DATE(regmnr,01,regar).     
   RUN selectfoc_UI.   
   FIND FIRST tidpers WHERE tidpers.PERSONALKOD = markpers.PERSONALKOD NO-LOCK NO-ERROR.
   IF NOT AVAILABLE tidpers THEN FIND FIRST tidpers NO-LOCK NO-ERROR.
   persrec = tidpers.TIDPERSREC.
   RUN findtp_UI (INPUT "XXXX.W",INPUT 3).
   korda = 0.
   IF RAD_TIDSVAL:VISIBLE = TRUE THEN DO:
      IF RAD_TIDSVAL:SCREEN-VALUE = STRING(2) THEN DO:
         IF  Guru.Konstanter:globforetag = "ESAN" OR Guru.Konstanter:globforetag = "ESMA" OR Guru.Konstanter:globforetag = "ELPA" 
         OR Guru.Konstanter:globforetag = "SUND"  OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "GRAN"  OR 
            Guru.Konstanter:globforetag = "LULE" THEN DO:
            {AVBGOMD2.I}
            RUN VALGOD.W.
            {AVBFRAMD2.I}
            IF RAD_GOD = 1 THEN ASSIGN korda = 1.
            IF RAD_GOD = 2 THEN ASSIGN korda = 2.
            IF RAD_GOD = 3 THEN ASSIGN korda = 3.         
         END.
         ELSE DO:
            MESSAGE "Vill du se godkända tidsedlar svara JA (vald månad)." SKIP
                    "Vill du se godkända ej körda tidsedlar svara NEJ (alla månader)"      
            VIEW-AS ALERT-BOX QUESTION BUTTONS YES-NO UPDATE val AS LOGICAL.
            CASE val:
               WHEN TRUE THEN ASSIGN  korda = 1.         
               WHEN FALSE THEN ASSIGN korda = 2.               
            END CASE. 
         END.   
      END.      
   END.
   RUN deca_UI. 
   RUN visaut_UI.      

END PROCEDURE.
PROCEDURE deca_UI :
   IF RAD_TIDSVAL:SCREEN-VALUE = STRING(2) AND korda = 2 THEN DO:
      IF MONTH(TODAY) = 1 AND DAY(TODAY) LE 10 THEN DO:
         ASSIGN bdatum = DATE(01,01,YEAR(TODAY) - 1)
         avdatum = DATE(12,01,YEAR(TODAY)- 1).
      END.   
      ELSE DO:
         ASSIGN        
         bdatum = DATE(01,01,YEAR(TODAY))
         avdatum = TODAY.
         IF regmnr = 12 THEN DO:
            avdatum = DATE(12,31,INTEGER(CMB_TARSL:SCREEN-VALUE)).
         END.
         ELSE DO:            
            avdatum = DATE(regmnr + 1,01,INTEGER(CMB_TARSL:SCREEN-VALUE)) - 1.
         END.
      END.   
   END.   
   ELSE DO:
      regmannamn = CMB_TMANADST:SCREEN-VALUE.
      RUN MANNR.P.
      bdatum = DATE(regmnr,01,INTEGER(CMB_TARST:SCREEN-VALUE)).
      regmannamn = CMB_TMANADSL:SCREEN-VALUE.
      RUN MANNR.P.
      avdatum = DATE(regmnr,01,INTEGER(CMB_TARST:SCREEN-VALUE)).
      IF avdatum < bdatum THEN DO:
         MESSAGE 
         "Periodens startmånad kan inte var större än slutmånad." 
         VIEW-AS ALERT-BOX.
         musz = TRUE.
         RETURN.
      END.             
   END.   
    
END PROCEDURE.

PROCEDURE btnsalman_UI :
   RUN radflex_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
      IF NOT AVAILABLE tidpers THEN DO:
         MESSAGE 
         "Du är inte behörig att ändra eller visa denna persons tidregistreringar." SKIP
         "eller så har personen i fråga inte flextidsavtal."
         VIEW-AS ALERT-BOX.
      END.  
      ELSE DO:                
         RUN VALMAN.W.
         {AVBGOM2.I} 
         IF musz = FALSE THEN RUN SALMAN.W.
          musz = FALSE.
         {AVBFRAM2.I} 
      END.
   END.
   {musarrow.i}   
END PROCEDURE.
PROCEDURE btnsaldo_UI :
  {OMSTARTAVGURUH.I}
   RUN radflex_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
      IF NOT AVAILABLE tidpers THEN DO:     
         MESSAGE 
         "Du är inte behörig att ändra eller visa denna persons tidregistreringar." SKIP
         "eller så har personen i fråga inte flextidsavtal."
         VIEW-AS ALERT-BOX.
      END.  
      ELSE DO:    
         IF Guru.Konstanter:globforetag = "SUND"  OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" THEN DO:         
            MESSAGE "Vill du se de saldon tom igår klicka på JA." SKIP
            "Vill du se de saldon tom föregående månadsskifte klicka på NEJ." VIEW-AS ALERT-BOX
            QUESTION BUTTONS YES-NO-CANCEL UPDATE val3 AS LOGICAL.
            CASE val3:
               WHEN TRUE THEN DO:
                  IF Guru.Konstanter:appcon THEN DO:                           
                     RUN NATTMAN.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
                     (INPUT TABLE tidpers).
                  END.
                  ELSE DO:
                     RUN NATTMAN.P 
                     (INPUT TABLE tidpers).                  
                  END.
                  manad = 1.              
                  {AVBGOM2.I}   
                  RUN FLSALDO.W.
                  {AVBFRAM2.I}
               END.
               WHEN FALSE THEN DO:
                  IF Guru.Konstanter:appcon THEN DO:                           
                     RUN NATTMAN.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
                     (INPUT TABLE tidpers).
                  END.
                  ELSE DO:
                     RUN NATTMAN.P 
                     (INPUT TABLE tidpers).                  
                  END.
                  manad = 0.
                  {AVBGOM2.I}   
                  RUN FLSALDO.W.
                  {AVBFRAM2.I}
               END.   
            END CASE.             
         END.
         ELSE DO:
            IF Guru.Konstanter:globforetag = "GKAL" THEN DO:
               IF Guru.Konstanter:appcon THEN DO:                           
                  RUN GKALUPP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
                  (INPUT TABLE tidpers).
               END.
               ELSE DO:
                  RUN GKALUPP.P 
                  (INPUT TABLE tidpers).                  
               END.
               manad = 1.              
               {AVBGOM2.I}   
               RUN FLSALDO.W.
               {AVBFRAM2.I}
            END.
            ELSE IF Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "ELPA" THEN DO:
               manad = 1.         
               MESSAGE "Vill du se de saldon tom igår klicka på JA." SKIP
               "Vill du se de saldon tom föregående månadsskifte klicka på NEJ." VIEW-AS ALERT-BOX
               QUESTION BUTTONS YES-NO-CANCEL UPDATE val4 AS LOGICAL.
               CASE val4:                  
                  WHEN TRUE THEN manad = 1.
                  WHEN FALSE THEN manad = 0.   
               END CASE.     
               IF Guru.Konstanter:appcon THEN DO:                           
                  RUN LULEFUPP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
                  (INPUT TABLE tidpers).
               END.
               ELSE DO:
                  RUN LULEFUPP.P 
                  (INPUT TABLE tidpers).                  
               END.
                             
               {AVBGOM2.I}   
               RUN FLSALDO.W.
               {AVBFRAM2.I}
            END.
            
         END.
      END.
   END.
   {musarrow.i}
END PROCEDURE.

PROCEDURE btnreg_UI :
   DEFINE VARIABLE status-mus2 AS LOGICAL NO-UNDO.
   {OMSTARTAVGURUH.I}      
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      IF AVAILABLE markpers THEN DO:
         FIND FIRST tidpers WHERE tidpers.PERSONALKOD = markpers.PERSONALKOD NO-ERROR.
         IF NOT AVAILABLE tidpers THEN DO:
            FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
         END.
      END.
      ELSE FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
      IF NOT AVAILABLE tidpers THEN DO:      
         status-mus2 = SESSION:SET-WAIT-STATE("").
         MESSAGE 
         "Du är inte behörig att ändra eller visa denna persons tidregistreringar."
         VIEW-AS ALERT-BOX.
      END.
      ELSE DO:
         {AVBGOMD2.I}            
         IF RAD_ALLTID:SCREEN-VALUE = STRING(3) THEN DO:
            RUN BERREG.W (INPUT 1,INPUT tidpers.PERSONALKOD).      
         END.
         ELSE IF RAD_ALLTID:SCREEN-VALUE = STRING(4) THEN DO:
            RUN RESREGN.W (INPUT TODAY, INPUT "", INPUT 0, INPUT FALSE, INPUT 1,INPUT tidpers.PERSONALKOD).
         END.      
         {AVBFRAMD2.I}
      END.
      APPLY "ENTRY" TO RAD_ALLVAL.
   END.
   {musarrow.i}
END PROCEDURE.
PROCEDURE btnperiod_UI :
   {OMSTARTAVGURUH.I}
   RUN radflex_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:                      
      RUN selectfoc_UI.      
      RUN findtp_UI (INPUT "PERIODA.W",INPUT 2).                  
   END.
   {musarrow.i} 
END PROCEDURE.
PROCEDURE btnover_UI :
    RUN over_UI.
   {musarrow.i}
END PROCEDURE.
PROCEDURE over_UI :
   {OMSTARTAVGURUH.I}                  
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      RUN selectfoc_UI.      
      RUN findtp_UI (INPUT "ALLAAND.W (INPUT 5)",INPUT 4).     
   END.
   {musarrow.i}
END PROCEDURE.

PROCEDURE btnmansal_UI :
   {OMSTARTAVGURUH.I}
  RUN FLUTBET.W.
  {musarrow.i}
END PROCEDURE.
PROCEDURE btnlona_UI :
   {OMSTARTAVGURUH.I}
   {AVBGOMD2.I}   
   RUN LONADMN.W.
   {AVBFRAMD2.I}
   {musarrow.i}
END PROCEDURE.
PROCEDURE btnlon_UI :
  RUN lon_UI.
   {musarrow.i}
END PROCEDURE.
PROCEDURE lon_UI :
   {OMSTARTAVGURUH.I}      
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      RUN selectfoc_UI.      
      RUN findtp_UI (INPUT "ALLAAND.W (INPUT 2)",INPUT 4).        
   END.
   {musarrow.i}
END PROCEDURE.

PROCEDURE btnlgod0_UI :
   RUN btnlgod_UI.   
   {musarrow.i}
END PROCEDURE.
PROCEDURE tida_UI :
   {OMSTARTAVGURUH.I}
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.
      RETURN.
   END.
   RUN selectfoc_UI.   
   IF Guru.Konstanter:globforetag = "elpa" THEN RUN findtp_UI (INPUT "ALLAAND.W (INPUT 1)",INPUT 4).         
   ELSE RUN findtp_UI (INPUT "ALLAAND.W (INPUT 1)",INPUT 4).      
   {musarrow.i}
END PROCEDURE.

PROCEDURE btnlgod_UI :
   {OMSTARTAVGURUH.I}
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      regmannamn = CMB_MANAD:SCREEN-VALUE.
      RUN MANNR.P.
      regar = INTEGER(CMB_AR:SCREEN-VALUE).
      {AVBGOM2.I}      
      RUN LISTTID.W.
      {AVBFRAM2.I}
   END.
   {musarrow.i}   
END PROCEDURE.

PROCEDURE btnkotroll0_UI :
   {OMSTARTAVGURUH.I}
  RUN btnkotroll_UI.  
  {musarrow.i}
END PROCEDURE.
PROCEDURE btnkotroll_UI :
   RUN radflex_UI.
   IF musz = TRUE THEN DO:
       musz = FALSE.     
   END.
   ELSE DO:
      IF Guru.Konstanter:globforetag = "GKAL" THEN DO:
         IF Guru.Konstanter:appcon THEN DO:                           
            RUN GKALUPP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
            (INPUT TABLE tidpers).
         END.
         ELSE DO:
            RUN GKALUPP.P 
            (INPUT TABLE tidpers).                  
         END.
      END.
      ELSE IF Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "CELPA" THEN DO:
         IF Guru.Konstanter:appcon THEN DO:                           
            RUN LULEFUPP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
            (INPUT TABLE tidpers).
         END.
         ELSE DO:
            RUN LULEFUPP.P 
            (INPUT TABLE tidpers).                  
         END.
      END.
      ELSE DO:      
         IF Guru.Konstanter:appcon THEN DO:                           
            RUN NATTMAN.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
            (INPUT TABLE tidpers).
         END.
         ELSE DO:
            RUN NATTMAN.P 
            (INPUT TABLE tidpers).                  
         END.
      END.
   END.   
END PROCEDURE.

PROCEDURE btnkont_UI :
   {OMSTARTAVGURUH.I}  
   BTN_AVB:HIDDEN = TRUE.
   RUN DisableWindowClose IN Guru.Konstanter:hpApi (INPUT CURRENT-WINDOW).
   RUN kont_UI.   
   BTN_AVB:HIDDEN = FALSE.
  
   {musarrow.i}
END PROCEDURE.
PROCEDURE btngran_UI :
   {OMSTARTAVGURUH.I}
   RUN gransk_UI.   
   {musarrow.i}     
END PROCEDURE.
PROCEDURE btngod_UI :
   {OMSTARTAVGURUH.I}
   RUN godk_UI.
   {musarrow.i}
END PROCEDURE.
PROCEDURE btnfrapp_UI :
   {OMSTARTAVGURUH.I}
   RUN radflex_UI.
   
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:      
      FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
      IF NOT AVAILABLE tidpers THEN DO:   
         MESSAGE 
         "Du är inte behörig att ändra eller visa denna persons tidregistreringar," SKIP
         "eller så har personen i fråga inte flextidsavtal." VIEW-AS ALERT-BOX.
      END.  
      ELSE DO:    
         IF AVAILABLE markpers THEN DO:
            FIND FIRST tidpers WHERE tidpers.PERSONALKOD = markpers.PERSONALKOD NO-ERROR.
            IF NOT AVAILABLE tidpers THEN DO:
               FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
            END.
         END.
         MESSAGE "Vill du se rapport för ej körd flextid klicka på JA." SKIP
         "Vill du se rapport för förra körningen av flextid klicka på NEJ." VIEW-AS ALERT-BOX
         QUESTION BUTTONS YES-NO-CANCEL UPDATE val3 AS LOGICAL.     
         
         CASE val3:
            WHEN TRUE THEN DO:
               manad = 1.      
               {AVBGOM2.I}
               RUN FLARAP2.W (INPUT tidpers.PERSONALKOD). 
               {AVBFRAM2.I}
            END.
            WHEN FALSE THEN DO:
               manad = 0.
               {AVBGOM2.I}
               RUN FLARAP2.W (INPUT tidpers.PERSONALKOD).
               {AVBFRAM2.I}
            END.   
         END CASE.  
      END.
   END.   
   {musarrow.i}          
END PROCEDURE.
   
PROCEDURE btnfranm_UI :
   RUN radflex_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
      IF NOT AVAILABLE tidpers THEN DO:   
         MESSAGE 
         "Du är inte behörig att ändra eller visa denna persons tidregistreringar." SKIP
         "eller så har personen i fråga inte flextidsavtal."
         VIEW-AS ALERT-BOX.
      END.  
      ELSE DO:
         
         RUN VALMAN.W.     
         IF musz = FALSE THEN DO:
            RUN selectfoc_UI.            
            RUN findtp_UI (INPUT "RAPPMA2.W",INPUT 2).                              
         END.
         musz = FALSE.               
      END.
   END.
   {musarrow.i}
END PROCEDURE.

PROCEDURE btnfelk_UI :
   IF Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "LULE" THEN DO:
      MESSAGE "Flexkörning görs från tidredovisningen" VIEW-AS ALERT-BOX.
   END.
   /*ELSE DO:         
      RUN FKORNDAT.W.
      musz = FALSE.      
   END.*/
   {musarrow.i}           
END PROCEDURE.

PROCEDURE bered_UI :
   {OMSTARTAVGURUH.I}
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      RUN selectfoc_UI.      
      RUN findtp_UI (INPUT "ALLAAND.W (INPUT 3)",INPUT 4).        
   END.
   {musarrow.i}
END PROCEDURE.

PROCEDURE btnavvik_UI :
   RUN radflex_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      tomdat = DATE(FILL-IN_DATUM:SCREEN-VALUE).
      RUN findtp_UI (INPUT "FLAVVIK.W",INPUT 1).
   END.
   {musarrow.i}         
END PROCEDURE.

PROCEDURE btnares_UI :
   {OMSTARTAVGURUH.I}

   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.    
   END.
   ELSE DO:  
      {AVBGOMD2.I}
      RUN findtp_UI (INPUT "TJANAST.W (INPUT ?, INPUT 1)",INPUT 3).      
      {AVBFRAMD2.I}
   END.
   {musarrow.i}       
END PROCEDURE.

PROCEDURE btnarb_UI :
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.    
   END.
   ELSE DO:        
      RUN findtp_UI (INPUT "ARBETSTID2.W",INPUT 2).            
   END.
   {musarrow.i}       
END PROCEDURE.

PROCEDURE btnlasuppt_UI :
   DEFINE VARIABLE status-mus2 AS LOGICAL NO-UNDO.
   DEFINE VARIABLE ptraff AS LOGICAL NO-UNDO.
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.    
   END.
   ELSE DO:
      RUN selectfoc_UI.
      IF AVAILABLE markpers THEN DO:
         FIND FIRST tidpers WHERE tidpers.PERSONALKOD = markpers.PERSONALKOD NO-ERROR.        
      END.      
      IF NOT AVAILABLE tidpers THEN DO:      
         status-mus2 = SESSION:SET-WAIT-STATE("").
         MESSAGE 
         "Du är inte behörig att ändra eller visa denna persons tidregistreringar."
         VIEW-AS ALERT-BOX.
      END.
      ELSE DO:             
         IF Guru.Konstanter:appcon THEN DO:                           
            RUN TIDSTOPP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
            (INPUT 9,INPUT tidpers.PERSONALKOD,INPUT Guru.Konstanter:globanv, OUTPUT lasanv,INPUT-OUTPUT TABLE felmeddtemp).
         END.
         ELSE DO:
            RUN TIDSTOPP.P 
            (INPUT 9,INPUT tidpers.PERSONALKOD,INPUT Guru.Konstanter:globanv, OUTPUT lasanv,INPUT-OUTPUT TABLE felmeddtemp).
         END.
         FIND FIRST felmeddtemp NO-LOCK NO-ERROR.
         IF AVAILABLE felmeddtemp THEN DO:
            
            MESSAGE felmeddtemp.FELMEDD  SKIP
             "Vill du verkligen låsa upp  " + tidpers.PERSONALKOD + " ? Du måste vara säker på att " + tidpers.PERSONALKOD + " inte är kvar inne i Tid."
            VIEW-AS ALERT-BOX
            QUESTION BUTTONS YES-NO-CANCEL UPDATE val4 AS LOGICAL.
            DELETE felmeddtemp.
            CASE val4:                  
               WHEN TRUE THEN DO:           
                  RUN lasupptid_UI IN persapph (INPUT  tidpers.PERSONALKOD, OUTPUT ptraff).
                  IF ptraff = TRUE THEN DO:
                     MESSAGE tidpers.PERSONALKOD + " är nu upplåst!."
                     VIEW-AS ALERT-BOX.
                  END.                         
               END.                  
            END CASE.                          
         END.
         ELSE DO:
            MESSAGE tidpers.PERSONALKOD + " är inte låst! Upplåsning ej möjlig."
            VIEW-AS ALERT-BOX.            
         END.   
       END.            
   END.
   {musarrow.i}       
END PROCEDURE.

PROCEDURE btnanov_UI :
   tomdat = DATE(FILL-IN_DATUM:SCREEN-VALUE).
   RUN radflex_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:
      RUN findtp_UI (INPUT "VFLLIST.W (INPUT RAD_ALLVAL:SCREEN-VALUE)",INPUT 3).
   END.
   {musarrow.i}
END PROCEDURE.

PROCEDURE btnandgod0_UI :
   {OMSTARTAVGURUH.I}
   RUN andgod_UI. 
   {musarrow.i}
END PROCEDURE.
PROCEDURE btnand0_UI :
   {OMSTARTAVGURUH.I}
   RUN btnand_UI.
   {musarrow.i}
END PROCEDURE.
PROCEDURE btnand_UI :      
   regdatum = DATE(FILL-IN_DATUM:SCREEN-VALUE). 
   RUN radflex_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
      RETURN.
   END.
   FIND FIRST tidpers NO-LOCK NO-ERROR.
   IF NOT AVAILABLE tidpers THEN DO:
      RUN findtp_UI (INPUT "XXXX.W",INPUT 1).
      musz = FALSE.

      RETURN.
   END.
   tidsedrec = RECID(tidpers).
   FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = tidpers.PERSONALKOD NO-LOCK NO-ERROR. 
   FIND FIRST flexavttemp WHERE flexavttemp.PERSONALKOD = personaltemp.PERSONALKOD NO-LOCK NO-ERROR.
   FIND FIRST ansttemp WHERE ansttemp.ANSTALLNING = personaltemp.ANSTALLNING
   USE-INDEX ANSTF NO-LOCK NO-ERROR.  
   ASSIGN
   sok1 = ansttemp.KOD
   sok4 = STRING(regdatum).
   IF Guru.Konstanter:appcon THEN DO: 
      RUN FLEXTIDH.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT 8,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
      INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
   END.
   ELSE DO:
      RUN FLEXTIDH.P 
      (INPUT 8,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
      INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
   END.
   IF sok2 = 0 THEN dagnr = WEEKDAY(regdatum).
   ELSE dagnr = sok2.
   IF Guru.Konstanter:globforetag =  "elpa" THEN dagnr = dagnr.
   ELSE IF dagnr = 1 OR dagnr = 7 THEN DO:
      MESSAGE "Du kan inte registrera flex helgdagar." VIEW-AS ALERT-BOX.
      RETURN.
   END.      
   RUN selectfoc_UI.   
   RUN findtp_UI (INPUT "FLEXAND.W",INPUT 2).       
   {musarrow.i}
END PROCEDURE.

PROCEDURE vccmbmanadst_UI :
   RUN slutdat_UI.   
   RUN tomdat_UI.
END PROCEDURE.
PROCEDURE lvcmbmanadst_UI :
   RUN slutdat_UI.
   RUN tomdat_UI.
END PROCEDURE.
PROCEDURE vccmbmanadsl_UI :
   RUN slutdat2_UI.   
   RUN tomdat_UI.
END PROCEDURE.
PROCEDURE lvcmbmanadsl_UI :
   RUN slutdat2_UI.
   RUN tomdat_UI.
END PROCEDURE.

PROCEDURE vccmbtarst_UI :
   regar = INTEGER(CMB_TARST:SCREEN-VALUE).
   RUN slutdat_UI.
   RUN tomdat_UI.
END PROCEDURE.
PROCEDURE lvcmbtarst_UI :
   regar = INTEGER(CMB_TARST:SCREEN-VALUE).
   RUN slutdat_UI.
   RUN tomdat_UI.
END PROCEDURE.
PROCEDURE vccmbtarsl_UI :
   regar = INTEGER(CMB_TARSL:SCREEN-VALUE).
   RUN slutdat2_UI.   
   RUN tomdat_UI.
END PROCEDURE.
PROCEDURE lvcmbtarsl_UI :
   regar = INTEGER(CMB_TARSL:SCREEN-VALUE).
   RUN slutdat2_UI.
   RUN tomdat_UI.
END PROCEDURE.

PROCEDURE vccmbomr_UI :
   FIND FIRST omrtemp WHERE omrtemp.NAMN = CMB_OMR:SCREEN-VALUE 
   USE-INDEX OMRNAMN NO-LOCK NO-ERROR.
   IF CMB_OMR:SCREEN-VALUE = Guru.Konstanter:gomrk + " : alla" THEN DO:
      RUN setcolsortvar_UI IN brwproc[5] (INPUT "personaltemp.AKTIV = TRUE").
   END.
   ELSE DO: 
      RUN setcolsortvar_UI IN brwproc[5] 
      (INPUT "personaltemp.AKTIV = TRUE AND personaltemp.OMRADE = " + '"' + omrtemp.OMRADE + '"').
   END.   
   RUN openbdynspec_UI IN brwproc[5].
END PROCEDURE.
PROCEDURE vccmbmanad_UI :
   regmannamn = CMB_MANAD:SCREEN-VALUE.
   RUN MANNR.P.
   IF MONTH(TODAY) = 12 THEN musz = musz.   
   ELSE IF DATE(regmnr,01,INTEGER(CMB_AR:SCREEN-VALUE)) > DATE(MONTH(TODAY) + 1,01,YEAR(TODAY)) THEN DO:
      MESSAGE "Är det korrekt att du vill skriva tid för: " + CMB_AR:SCREEN-VALUE + " " + regmannamn + " ?" 
      VIEW-AS ALERT-BOX QUESTION BUTTONS OK-CANCEL UPDATE val AS LOGICAL.   
      IF val = FALSE THEN DO:
         RUN globman3_UI.         
         RETURN.
      END.      
   END.   
END PROCEDURE.
PROCEDURE vccmbar_UI :
   regar = INTEGER(CMB_AR:SCREEN-VALUE).
   regmannamn = CMB_MANAD:SCREEN-VALUE.
   RUN MANNR.P.
   IF MONTH(TODAY) = 12 THEN DO:
      IF DATE(regmnr,01,regar) > DATE(01,01,YEAR(TODAY) + 1) THEN DO:
         MESSAGE "Är det korrekt att du vill skriva tid för: " + CMB_AR:SCREEN-VALUE + " " + regmannamn + " ?" 
         VIEW-AS ALERT-BOX QUESTION BUTTONS OK-CANCEL UPDATE val AS LOGICAL.   
         IF val = FALSE THEN DO: 
            CMB_AR:SCREEN-VALUE = STRING(CMB_AR:SCREEN-VALUE).
            RUN globman3_UI.  
            RETURN.
         END.     
      END.
   END.
   ELSE IF DATE(regmnr,01,regar) > DATE(MONTH(TODAY) + 1,01,YEAR(TODAY)) THEN DO:
      MESSAGE "Är det korrekt att du vill skriva tid för: " + CMB_AR:SCREEN-VALUE + " " + regmannamn + " ?" 
      VIEW-AS ALERT-BOX QUESTION BUTTONS OK-CANCEL UPDATE val2 AS LOGICAL.   
      IF val2 = FALSE THEN DO: 
         CMB_AR:SCREEN-VALUE = STRING(CMB_AR:SCREEN-VALUE).
         RUN globman3_UI.  
         RETURN.
      END.      
   END.   
END PROCEDURE.
PROCEDURE lvcmbar_UI :
   regar = INTEGER(CMB_AR:SCREEN-VALUE).
END PROCEDURE.
PROCEDURE btnvover_UI :
   antal_valda = BRW_AVD:NUM-SELECTED-ROWS NO-ERROR.  
   IF antal_valda = 0 THEN DO:      
      MESSAGE "Ingen " LC(Guru.Konstanter:gavdk) " är markerad" VIEW-AS ALERT-BOX.             
      RETURN.                
   END.
   ELSE DO:   
      antal_raknare = 1.
      DO WHILE antal_raknare LE antal_valda :
         RUN fselectfoc_UI.        
         FIND FIRST vavdelningtemp WHERE vavdelningtemp.AVDELNINGNR = avdelningtemp.AVDELNINGNR 
         NO-LOCK NO-ERROR.
         IF NOT AVAILABLE vavdelningtemp THEN DO:
            CREATE vavdelningtemp.
            ASSIGN           
            vavdelningtemp.AVDELNINGNR = avdelningtemp.AVDELNINGNR
            vavdelningtemp.AVDELNINGNAMN = avdelningtemp.AVDELNINGNAMN.         
         END.
         OPEN QUERY omrq FOR EACH omrtemp WHERE 
         omrtemp.AVDELNINGNR = avdelningtemp.AVDELNINGNR NO-LOCK.
         GET FIRST omrq NO-LOCK.
         DO WHILE AVAILABLE(omrtemp):
            FIND FIRST vomrtemp WHERE vomrtemp.OMRADE = omrtemp.OMRADE 
            NO-LOCK NO-ERROR.
            IF NOT AVAILABLE vomrtemp THEN DO:
               CREATE vomrtemp.
               ASSIGN           
               vomrtemp.OMRADE = omrtemp.OMRADE
               vomrtemp.NAMN = omrtemp.NAMN.         
            END.
            GET NEXT omrq NO-LOCK.
         END.                                    
         antal_raknare = antal_raknare + 1.
      END.
   END.      
   status-ok = BRW_AVD:DESELECT-ROWS(). 
   RUN openbdynspec_UI IN brwproc[7].               
   RUN openbdynspec_UI IN brwproc[8].               
   
END PROCEDURE.
PROCEDURE btnnda_UI :
   ASSIGN
   FILL-IN_DATUM:SCREEN-VALUE = STRING(DATE(FILL-IN_DATUM:SCREEN-VALUE) + 1). 
   RUN btnfda_UI (INPUT 2).
   
END PROCEDURE.
PROCEDURE btnfdas_UI :
   FILL-IN_DATUM:SCREEN-VALUE = STRING(DATE(FILL-IN_DATUM:SCREEN-VALUE) - 1).        
   RUN btnfda_UI (INPUT 1). 
END PROCEDURE.
PROCEDURE avb_UI :   
   ASSIGN Guru.Konstanter:globomr = sparomrade.
   MESSAGE "Du avslutar nu " + SUBSTRING(foretemp.VERSION,1,10)
   VIEW-AS ALERT-BOX QUESTION BUTTONS OK-CANCEL UPDATE val AS LOGICAL.   
   IF val = FALSE THEN RETURN NO-APPLY.
   RUN avb_UI IN huvprogh.   
END PROCEDURE.
PROCEDURE brwmark_UI :
   IF RAD_ALLTID:SCREEN-VALUE = STRING(3) THEN APPLY "CHOOSE" TO FBTN_REG.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(4) THEN APPLY "CHOOSE" TO FBTN_REG.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(5) THEN DO: 
      APPLY "CHOOSE" TO FBTN_TID.
      ASSIGN RAD_ALLTID:SCREEN-VALUE = STRING(5).
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(9) THEN APPLY "CHOOSE" TO FBTN_VTIDV.
END PROCEDURE.

PROCEDURE ladda_UI :
   regdatum = bdatum.    
   IF MONTH(avdatum) = 12 THEN avdatum = DATE(12,31,YEAR(avdatum)). 
   ELSE avdatum = DATE(MONTH(avdatum) + 1,01,YEAR(avdatum)) - 1.           
   IF FILL-IN-TDATUM-2:VISIBLE = TRUE THEN DO:
      IF RAD_TIDSVAL:SCREEN-VALUE = STRING(3) AND TOG_MAN:CHECKED = FALSE THEN DO:
         bdatum = DATE(regmnr,INTEGER(FILL-IN-TDATUM-2:SCREEN-VALUE),INTEGER(CMB_TARSL:SCREEN-VALUE)). 
         avdatum = DATE(regmnr,INTEGER(FILL-IN-TDATUM:SCREEN-VALUE),INTEGER(CMB_TARSL:SCREEN-VALUE)).
      END.      
   END.       
   FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
END PROCEDURE.

PROCEDURE visaut_UI :   
   DEFINE VARIABLE status-mus2 AS LOGICAL NO-UNDO.
   DEFINE VARIABLE dathj AS INTEGER NO-UNDO.
   DEFINE VARIABLE dathj2 AS INTEGER NO-UNDO.
   DEFINE VARIABLE cdathj  AS CHARACTER NO-UNDO.
   DEFINE VARIABLE cdathj2  AS CHARACTER NO-UNDO.
   IF musz = TRUE THEN DO:
      musz = FALSE.
      RETURN. 
   END.     
   {OMSTARTAVGURUH.I}
   RUN ladda_UI.
   IF NOT AVAILABLE tidpers THEN DO:     
      status-mus2 = SESSION:SET-WAIT-STATE("").
      MESSAGE "Du är inte behörig att ändra eller visa denna persons tidregistreringar."
      VIEW-AS ALERT-BOX.
   END.
   ELSE DO:           
      IF CMB_TARSL:SCREEN-VALUE = CMB_TARST:SCREEN-VALUE AND CMB_TMANADSL:SCREEN-VALUE = CMB_TMANADST:SCREEN-VALUE
      AND RAD_TIDSVAL:SCREEN-VALUE = STRING(3) AND TOG_MAN:CHECKED = FALSE THEN DO:
         ASSIGN
         dathj  = INTEGER(FILL-IN-TDATUM:SCREEN-VALUE)
         dathj2 = INTEGER(FILL-IN-TDATUM-2:SCREEN-VALUE)
         cdathj  = FILL-IN-TDAG:SCREEN-VALUE
         cdathj2 = FILL-IN-TDAG-2:SCREEN-VALUE.
         RUN EJDATUM.W (INPUT ejvisdatum,INPUT-OUTPUT dathj,INPUT-OUTPUT dathj2, 
                        INPUT-OUTPUT cdathj,INPUT-OUTPUT cdathj).         
         ASSIGN 
         FILL-IN-TDATUM:SCREEN-VALUE   = STRING(dathj)  
         FILL-IN-TDATUM-2:SCREEN-VALUE = STRING(dathj2) 
         FILL-IN-TDAG:SCREEN-VALUE   = cdathj  
         FILL-IN-TDAG-2:SCREEN-VALUE = cdathj2.

         IF musz = TRUE THEN DO:  
            ASSIGN
            musz = FALSE
            skrivut = FALSE.  
            RETURN.
         END.
         bdatum = DATE(regmnr,INTEGER(FILL-IN-TDATUM-2:SCREEN-VALUE),INTEGER(CMB_TARSL:SCREEN-VALUE)). 
         avdatum = DATE(regmnr,INTEGER(FILL-IN-TDATUM:SCREEN-VALUE),INTEGER(CMB_TARSL:SCREEN-VALUE)).
      END.
      IF skrivut = TRUE THEN DO:
         IF TOG_MAN:CHECKED = FALSE THEN RUN SKRIVVAL.W (INPUT TRUE).   
         ELSE RUN SKRIVVAL.W (INPUT FALSE).
         IF musz = TRUE THEN DO:  
            ASSIGN
            musz = FALSE
            skrivut = FALSE.  
            RETURN.
         END.
         ELSE DO:
            IF TOG_MAN:CHECKED = FALSE THEN DO:
                {PRINTLIGGANDE.I}
               {AVBGOM2.I}
               {AMERICANEUROPEAN.I}
               RUN TIDSEDL.W.
               {EUROPEANAMERICAN.I}
               {AVBFRAM2.I}               
               OUTPUT CLOSE.
            END.
            ELSE DO:   
                                               
               {AVBGOM2.I}
               RUN manadsl_UI IN huvprogh (INPUT CMB_TMANAD,INPUT CMB_TAR).
               RUN MANADSL.W.
               {AVBFRAM2.I}
               OUTPUT CLOSE.
            END.
         END.
      END.
      ELSE DO:
         {AVBGOM2.I}
         IF TOG_MAN:CHECKED = FALSE THEN DO:
            RUN tidsedel_UI.
                          
         END.
         ELSE DO:                          
            manvaxla = TRUE.            
            RUN manadsl_UI IN huvprogh (INPUT CMB_TMANAD,INPUT CMB_TAR).
            RUN MANADSL.W.
            manvaxla = FALSE.
         END.
         {AVBFRAM2.I}
      END.        
   END.
   {musarrow.i}   
END PROCEDURE.
PROCEDURE tidsedel_UI :
   {AMERICANEUROPEAN.I}
   RUN TIDSEDL.W.
   {EUROPEANAMERICAN.I}  
END PROCEDURE.
PROCEDURE godk_UI :
   DEFINE VARIABLE status-mus2 AS LOGICAL NO-UNDO.
   sok1 = "".
   IF Guru.Konstanter:appcon THEN DO: 
      RUN FLEXTIDH.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT 15,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
      INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
   END.
   ELSE DO:
      RUN FLEXTIDH.P 
      (INPUT 15,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
      INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
   END.
   IF sok1 = "KOR"  THEN DO:
      MESSAGE "Det går inte att ändra godkända tidsedlar," SKIP 
      "för att det pågår en ekonomi- och lönesammanställning."
      VIEW-AS ALERT-BOX.        
      status-mus2 = SESSION:SET-WAIT-STATE("").
      RETURN.      
   END.  
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
      RETURN.
   END.   
   regmannamn = CMB_MANAD:SCREEN-VALUE.
   RUN MANNR.P.
   regdatum = DATE(regmnr,01,INTEGER(CMB_AR:SCREEN-VALUE)).
   regar = INTEGER(CMB_AR:SCREEN-VALUE).
   bdatum = regdatum.  
   IF TODAY <= regdatum THEN DO:
      MESSAGE "Det går inte att godkänna kommande veckor."
      VIEW-AS ALERT-BOX.      
      status-mus2 = SESSION:SET-WAIT-STATE("").         
      RETURN.
   END.
   {AVBGOM2.I}   
   RUN GODKFN.W.
   RUN GODKFGN.W.
   RUN GODEJF.W.
   IF Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "misv"   OR Guru.Konstanter:globforetag = "snat" THEN DO:
      RUN atkdat_UI IN persapph (OUTPUT atkman).
      IF MONTH(TODAY) GE atkman  THEN DO:
         RUN GODATK.W (INPUT 1). 
      END.   
   END.       
   {AVBFRAM2.I}
END PROCEDURE.
PROCEDURE gransk_UI :
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
      RETURN.
   END.  
   regmannamn = CMB_MANAD:SCREEN-VALUE.
   RUN MANNR.P.
   regdatum = DATE(regmnr,01,INTEGER(CMB_AR:SCREEN-VALUE)).
   regar = INTEGER(CMB_AR:SCREEN-VALUE).
   bdatum = regdatum.
   {AVBGOM2.I}
   RUN GRANTILL.W.
   {AVBFRAM2.I}  
END PROCEDURE.
PROCEDURE kont_UI :   
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
      RETURN.
   END.   
   IF visaigen = TRUE THEN DO:
      regdatum = igendat.
   END.   
   IF visaigen = FALSE THEN DO:
      regmannamn = CMB_MANAD:SCREEN-VALUE.
      RUN MANNR.P.
      regdatum = DATE(regmnr,01,INTEGER(CMB_AR:SCREEN-VALUE)).
      regar = INTEGER(CMB_AR:SCREEN-VALUE).
      bdatum = regdatum.
   END.           
   RUN VALKTRLSU.W (INPUT-OUTPUT visaigen, OUTPUT igendat).
   IF visaigen = TRUE THEN DO:        
      IF RAD_LISTA =  1 THEN DO:      
         RUN KTRLTID.W.            
      END.
      IF RAD_LISTA =  2 THEN DO:            
         RUN KTRLSJUK.W.              
      END.
      IF RAD_LISTA =  3 THEN DO:           
         RUN KTRLMSKIFTE.W.            
      END.          
      IF RAD_LISTA =  4 THEN DO:           
         RUN KTRLBER.W.            
      END.
      IF RAD_LISTA =  5 THEN DO:            
         RUN KTRLABER.W.            
      END.     
      IF RAD_LISTA =  6 THEN DO:            
         RUN KTRLBARNEA.W.            
      END.    
      IF RAD_LISTA =  7 THEN DO:            
         RUN KTRLTJ.W.            
      END.
      IF RAD_LISTA =  8 THEN DO:
         manad = 1.                            
         RUN FLSALDO.W.                                 
      END.          
      IF RAD_LISTA =  9 THEN DO:                     
         RUN KTRLAFORK.W.              
      END.
      IF RAD_LISTA =  10 THEN DO:                     
         RUN KTRLOVEJF.W.              
      END.
      IF RAD_LISTA =  11 THEN DO:                               
         RUN OVMANAR.W.                    
      END.            
      IF RAD_LISTA =  12 THEN DO:                               
         RUN KTRLFRISK.W.         
      END.
      IF RAD_LISTA =  13 THEN DO:            
         RUN KTRLOBSJ.W.            
      END.
      IF RAD_LISTA =  14 THEN DO:            
         RUN KTRLSJLAK.W.            
      END.
      IF RAD_LISTA =  15 THEN DO:                     
         RUN KTRLEJOVF.W.              
      END.
      IF RAD_LISTA =  16 THEN DO:                               
         RUN OVAR.W.                    
      END.
      IF RAD_LISTA =  17 THEN DO:            
         RUN KTRLSAMMAN.W.            
      END.
      IF RAD_LISTA =  18 THEN DO:                               
         RUN EOVMANAR.W.                    
      END.
      IF RAD_LISTA =  19 THEN DO:                               
         RUN FTROMANAR.W.                    
      END.
      IF RAD_LISTA =  20 THEN DO:                               
         RUN TILLATOV.W.                    
      END.
      IF RAD_LISTA =  27 THEN DO:                               
         RUN ATTILLATOV.W.                    
      END.
      IF RAD_LISTA =  21 THEN DO:                               
         RUN KOMPMANAR.W.                    
      END.
      IF RAD_LISTA =  22 THEN DO:                               
         RUN KTRLEJNOLL.W.                    
      END.
      IF RAD_LISTA =  23 THEN DO:                                                                              
         RUN FLKOMP.W (INPUT RAD_ALLVAL:SCREEN-VALUE , INPUT regar,  INPUT regmnr , INPUT "GLOM" ,INPUT tomdat , INPUT "Glömd registrering vald månad") .
      END.
      IF RAD_LISTA =  24 THEN DO:                                                                              
         RUN KTRLOVBEORD.W.
      END.
      IF RAD_LISTA =  25 THEN DO:                                                                              
         RUN KOMPSALDO.W.
      END.
      IF RAD_LISTA =  26 THEN DO:                                                                              
         RUN TILLATNODF.W.
      END.         
   END.
   IF visaigen = TRUE THEN DO:
      RUN btnkont_UI.
      RETURN.
   END.         
END PROCEDURE.
PROCEDURE onmeny_UI :
   DEFINE VARIABLE status-mus2 AS LOGICAL NO-UNDO. 
   {OMSTARTAVGURUH.I}   
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.     
   END.
   ELSE DO:      
      FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
      IF NOT AVAILABLE tidpers THEN DO:      
         status-mus2 = SESSION:SET-WAIT-STATE("").
         MESSAGE 
         "Du är inte behörig att ändra eller visa denna persons tidregistreringar."
         VIEW-AS ALERT-BOX.         
      END.  
      ELSE DO:       
         IF Guru.Konstanter:appcon THEN DO:                           
            RUN GODKOLLA.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
            (INPUT tidpers.PERSONALKOD,INPUT regdatum,OUTPUT tillochmeddatum,OUTPUT TABLE felmeddtemp).
         END.
         ELSE DO:
            RUN GODKOLLA.P  
            (INPUT tidpers.PERSONALKOD,INPUT regdatum,OUTPUT tillochmeddatum,OUTPUT TABLE felmeddtemp).
         END.
         FIND FIRST felmeddtemp NO-LOCK NO-ERROR.
         IF AVAILABLE felmeddtemp THEN DO:
            MESSAGE felmeddtemp.FELMEDD VIEW-AS ALERT-BOX.
            DELETE felmeddtemp.
            RETURN NO-APPLY.      
         END.
         IF Guru.Konstanter:appcon THEN DO:                           
            RUN TIDSTOPP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
            (INPUT 1,INPUT tidpers.PERSONALKOD,INPUT Guru.Konstanter:globanv, OUTPUT lasanv,INPUT-OUTPUT TABLE felmeddtemp).
         END.
         ELSE DO:
            RUN TIDSTOPP.P 
            (INPUT 1,INPUT tidpers.PERSONALKOD,INPUT Guru.Konstanter:globanv, OUTPUT lasanv,INPUT-OUTPUT TABLE felmeddtemp).
         END.
         FIND FIRST felmeddtemp NO-LOCK NO-ERROR.
         IF AVAILABLE felmeddtemp THEN DO:
            IF Guru.Konstanter:globanv = lasanv THEN DO:    
               MESSAGE felmeddtemp.FELMEDD  VIEW-AS ALERT-BOX
               QUESTION BUTTONS YES-NO-CANCEL UPDATE val4 AS LOGICAL.
               DELETE felmeddtemp.
               CASE val4:                  
                  WHEN TRUE THEN DO:           
                     RUN lasupptid_UI IN persapph (INPUT  tidpers.PERSONALKOD, OUTPUT ptraff).
                     IF ptraff = TRUE THEN DO:
                        MESSAGE tidpers.PERSONALKOD + " är nu upplåst!."
                        VIEW-AS ALERT-BOX.
                     END.                         
                  END.                  
               END CASE.
            END.   
            ELSE DO:            
               MESSAGE felmeddtemp.FELMEDD VIEW-AS ALERT-BOX.
               DELETE felmeddtemp.   
               RETURN NO-APPLY.      
            END.
         END.   
         ELSE DO:           
            RUN selectfoc_UI.            
            allatidvar = TRUE.
            {AVBGOM2.I}       
            RUN findtp_UI (INPUT "ALLAAND.W (INPUT 1)",INPUT 4).
            {AVBFRAM2.I}         
            allatidvar = FALSE.
         END.   
      END.
   END.
   {musarrow.i}
END PROCEDURE.
PROCEDURE trakt_UI :
   {OMSTARTAVGURUH.I}          
   RUN rad_UI.
   IF musz = TRUE THEN DO:
      musz = FALSE.
      RETURN.
   END.
   RUN selectfoc_UI.   
   RUN findtp_UI (INPUT "ALLAAND.W (INPUT 4)",INPUT 4).

END PROCEDURE.
PROCEDURE dagkoll_UI :
   IF MONTH(ejvisdatum) = 12 THEN DO:
      datkoll = DATE(12,31,YEAR(ejvisdatum)).
   END.
   ELSE DO:   
      datkoll = DATE((MONTH(ejvisdatum) + 1),01,YEAR(ejvisdatum)) - 1.
   END.  
END PROCEDURE.
PROCEDURE dag_UI :
   regdatum = DATE(MONTH(ejvisdatum),INTEGER(FILL-IN-TDATUM:SCREEN-VALUE),YEAR(ejvisdatum)).
   RUN REGDAG.P.
   IF regdagnamn = "tor" THEN regdagnamn = regdagnamn + "s".
   FILL-IN-TDAG:SCREEN-VALUE = regdagnamn + "dag".
   regdatum = DATE(MONTH(ejvisdatum),INTEGER(FILL-IN-TDATUM-2:SCREEN-VALUE),YEAR(ejvisdatum)).
   RUN REGDAG.P.
   IF regdagnamn = "tor" THEN regdagnamn = regdagnamn + "s".
   FILL-IN-TDAG-2:SCREEN-VALUE = regdagnamn + "dag".
   
END PROCEDURE.
PROCEDURE hamten_UI :
   {OMSTARTAVGURUH.I}
   IF FILL-IN_EPERSONALKOD:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Sökbegreppet kan inte vara blankt." VIEW-AS ALERT-BOX.
      RETURN NO-APPLY.
   END.
   FIND FIRST markpers WHERE markpers.PERSONALKOD = FILL-IN_EPERSONALKOD:SCREEN-VALUE     
   NO-LOCK NO-ERROR. 
   IF NOT AVAILABLE markpers THEN DO:  
            
      FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = FILL-IN_EPERSONALKOD:SCREEN-VALUE
      NO-ERROR.
      IF AVAILABLE personaltemp THEN DO:
         CREATE markpers.
         ASSIGN  markpers.EFTERNAMN = personaltemp.EFTERNAMN 
         markpers.FORNAMN = personaltemp.FORNAMN 
         markpers.PERSONALKOD = personaltemp.PERSONALKOD.         
      END.
      ELSE DO:
         IF RAD_ALLTID:SCREEN-VALUE = STRING(9) THEN DO:
            /*phmt.p*/
            FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD =  FILL-IN_EPERSONALKOD:SCREEN-VALUE NO-LOCK NO-ERROR.
            IF NOT AVAILABLE  personaltemp THEN DO:               
               RUN persen_UI IN persapph (INPUT FILL-IN_EPERSONALKOD:SCREEN-VALUE,OUTPUT TABLE personaltemp APPEND).                  
            END.
            RUN openbdynspec_UI IN brwproc[5].
            FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = FILL-IN_EPERSONALKOD:SCREEN-VALUE
            NO-ERROR.
            IF AVAILABLE personaltemp THEN DO:
               CREATE markpers.
               ASSIGN  markpers.EFTERNAMN = personaltemp.EFTERNAMN 
               markpers.FORNAMN = personaltemp.FORNAMN 
               markpers.PERSONALKOD = personaltemp.PERSONALKOD.               
            END.
         END.
      END.
      FIND FIRST markpers WHERE markpers.PERSONALKOD = FILL-IN_EPERSONALKOD:SCREEN-VALUE     
      NO-LOCK NO-ERROR.             
   END.
   IF NOT AVAILABLE markpers THEN DO:
      MESSAGE "Du har inte behörighet för " + FILL-IN_EPERSONALKOD:SCREEN-VALUE + " eller så finns inte personen upplagd, eller är inaktiv! Är personen inaktiv går det ändå att visa tidsedel. " SKIP
      "Välj: Visa tidsedel, och hämta personen igen" VIEW-AS ALERT-BOX.
      RETURN NO-APPLY.    
   END.  
   persrec = RECID(markpers).
   RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(markpers)).
   RUN openbdynspec_UI IN brwproc[3].
   RUN lastselectdyn_UI IN brwproc[3].
   {musarrow.i}
END PROCEDURE.
PROCEDURE hamtgodpers_UI :   
   {OMSTARTAVGURUH.I}
   IF FILL-IN_ETIDSGODK:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Sökbegreppet kan inte vara blankt." VIEW-AS ALERT-BOX.
      RETURN NO-APPLY.
   END.         
   EMPTY TEMP-TABLE markpers NO-ERROR. 
   FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = FILL-IN_ETIDSGODK:SCREEN-VALUE   NO-ERROR.
   IF AVAILABLE personaltemp THEN DO:
      FIND FIRST markpers WHERE markpers.PERSONALKOD = personaltemp.PERSONALKOD   NO-LOCK NO-ERROR. 
      IF NOT AVAILABLE markpers THEN DO:
         CREATE markpers.
         ASSIGN  markpers.EFTERNAMN = personaltemp.EFTERNAMN 
         markpers.FORNAMN = personaltemp.FORNAMN 
         markpers.PERSONALKOD = personaltemp.PERSONALKOD.
      END.
   END.               
   FIND FIRST personaltemp WHERE personaltemp.TIDSGODK = FILL-IN_ETIDSGODK:SCREEN-VALUE   NO-ERROR.
   IF AVAILABLE personaltemp THEN DO:
      FOR EACH personaltemp WHERE personaltemp.TIDSGODK = FILL-IN_ETIDSGODK:SCREEN-VALUE :
         FIND FIRST markpers WHERE markpers.PERSONALKOD = personaltemp.PERSONALKOD   NO-LOCK NO-ERROR. 
         IF NOT AVAILABLE markpers THEN DO:
            CREATE markpers.
            ASSIGN  markpers.EFTERNAMN = personaltemp.EFTERNAMN 
            markpers.FORNAMN = personaltemp.FORNAMN 
            markpers.PERSONALKOD = personaltemp.PERSONALKOD.
         END.            
      END.
   END.   
   FIND FIRST markpers NO-LOCK NO-ERROR.                
   IF NOT AVAILABLE markpers THEN DO:
      MESSAGE FILL-IN_ETIDSGODK:SCREEN-VALUE + " finns inte, eller har ingen personal att godkänna, eller är inaktiv! Är personen inaktiv går det ändå att visa tidsedel. " SKIP
      "Välj: Visa tidsedel, och hämta personen igen" VIEW-AS ALERT-BOX.     
   END.  
   persrec = RECID(markpers).
   RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(markpers)).
   RUN openbdynspec_UI IN brwproc[3].
   RUN lastselectdyn_UI IN brwproc[3].
   {musarrow.i}
END PROCEDURE.
PROCEDURE mangoma_UI :
   RUN goma2_UI.
   ASSIGN
   BTN_FDA:HIDDEN  = TRUE 
   BTN_NDA:HIDDEN  = TRUE 
   FILL-IN_DATUM:HIDDEN  = TRUE
   CMB_MANAD:HIDDEN  = TRUE
   CMB_AR:HIDDEN  = TRUE
   RAD_TIDSVAL:HIDDEN  = TRUE                           
   CMB_TMANADST:HIDDEN  = TRUE 
   CMB_TARST:HIDDEN  = TRUE 
   CMB_TMANADSL:HIDDEN  = TRUE 
   CMB_TARSL:HIDDEN  = TRUE
   CMB_TAR:HIDDEN  = TRUE
   CMB_TMANAD:HIDDEN  = TRUE.
   IF TOG_MAN:CHECKED = TRUE THEN DO:
      ASSIGN 
      CMB_TAR:HIDDEN  = FALSE
      CMB_TMANAD:HIDDEN  = FALSE.      
   END.
   ELSE DO:    
      ASSIGN
      RAD_TIDSVAL:HIDDEN  = FALSE     
      CMB_TMANADST:HIDDEN  = FALSE 
      CMB_TARST:HIDDEN  = FALSE 
      CMB_TMANADSL:HIDDEN  = FALSE 
      CMB_TARSL:HIDDEN  = FALSE     
      RAD_TIDSVAL:HIDDEN  = FALSE 
      CMB_TMANADST:HIDDEN  = FALSE 
      CMB_TARST:HIDDEN  = FALSE
      CMB_TMANADSL:HIDDEN  = FALSE 
      CMB_TARSL:HIDDEN  = FALSE.      
   END.
   ASSIGN
   TOG_MAN:HIDDEN  = FALSE
   FBTN_SKR:HIDDEN  = FALSE
   FBTN_VTIDV:HIDDEN  = FALSE
   FBTN_VTID:HIDDEN  = TRUE
   TOG_MAN:HIDDEN  = FALSE
   FBTN_SKR:HIDDEN  = FALSE 
   FBTN_VTIDV:HIDDEN  = FALSE.   
END PROCEDURE.

PROCEDURE andgod_UI :
   DEFINE VARIABLE status-mus2 AS LOGICAL NO-UNDO.
   sok1 = "".
   IF Guru.Konstanter:appcon THEN DO: 
      RUN FLEXTIDH.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT 15,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
      INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
   END.
   ELSE DO:
      RUN FLEXTIDH.P 
      (INPUT 15,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
      INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
   END.
   IF sok1 = "KOR"  THEN DO:
      MESSAGE "Det går inte att ändra godkända tidsedlar nu." SKIP 
      "för det pågår en ekonomi- och lönesammanställning."
      VIEW-AS ALERT-BOX.        
      status-mus2 = SESSION:SET-WAIT-STATE("").
      RETURN.      
   END.  
   regmannamn = CMB_MANAD:SCREEN-VALUE.
   RUN MANNR.P.                                         
   regdatum = DATE(regmnr,01,INTEGER(CMB_AR:SCREEN-VALUE)).
   andvisdatum = DATE(regmnr,01,INTEGER(CMB_AR:SCREEN-VALUE)).
   bdatum = regdatum.
   MESSAGE "Vill du ändra en godkänd tidsedel svara JA." skip
           "Vill du ändra en sammanställd (veckokörd) tidsedel svara NEJ."
           VIEW-AS ALERT-BOX QUESTION BUTTONS YES-NO-CANCEL 
           TITLE "Ändra godkänd/sammanställd tidsedel "
           UPDATE valet AS LOGICAL.
   CASE valet:
      WHEN TRUE THEN DO:         
         RUN rad_UI.
         IF musz = TRUE THEN DO:
            musz = FALSE.     
            RETURN.
         END.
         
         RUN findtp_UI (INPUT "ANDGODK.W",INPUT 2).         
      END.
      WHEN FALSE THEN DO:         
         RUN sekervalda_UI.  /*?????*/
         IF musz = TRUE THEN DO:
            musz = FALSE.     
         END.
         {AVBGOM2.I}
         IF Guru.Konstanter:globforetag = "ELPA" OR Guru.Konstanter:globforetag = "SUND"  OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "ESMA"
         OR Guru.Konstanter:globforetag = "ETA" OR Guru.Konstanter:globforetag = "GRAN" 
          OR Guru.Konstanter:globforetag = "GKAL"  OR Guru.Konstanter:globforetag = "LULE"  THEN DO:            
            RUN TIDFEL.W.         
         END.   
         ELSE DO:
            status-mus2 = CURRENT-WINDOW:LOAD-MOUSE-POINTER("ARROW").            
         END.    
         {AVBFRAM2.I}      
      END.                   
      OTHERWISE DO:
         status-mus2 = CURRENT-WINDOW:LOAD-MOUSE-POINTER("ARROW").
         RETURN.
      END. 
   END CASE.      
END PROCEDURE.
PROCEDURE psek_UI :
   DEFINE INPUT PARAMETER pkodvar AS CHARACTER NO-UNDO.
   {SOKSTART.I}
   ASSIGN
   soktemp.SOKVAL = 60
   soktemp.SOKINT[1] = Guru.Konstanter:globniv
   soktemp.SOKCHAR[1] = pkodvar
   soktemp.SOKCHAR[2] = Guru.Konstanter:globanv
   soktemp.SOKLOG[1] = FALSE
   soktemp.SOKLOG[2] = FALSE.
   {SOKANROP.I}      
   ASSIGN
   musz   = soktemp.SOKLOG[1]
   medvar = soktemp.SOKLOG[2].
END PROCEDURE.

PROCEDURE findtp_UI :
   DEFINE INPUT PARAMETER progval AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER kollvar AS INTEGER NO-UNDO.
   alltidspar = INTEGER(RAD_ALLTID:SCREEN-VALUE).
   FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
   IF NOT AVAILABLE tidpers THEN DO:    
      MESSAGE 
      "Du är inte behörig att ändra eller visa denna persons tidregistreringar." SKIP
      "eller så har personen i fråga inte flextidsavtal."
      VIEW-AS ALERT-BOX.
   END.  
   ELSE DO:      
      IF progval = "XXXX.W" THEN RETURN.      
      IF kollvar = 1 THEN DO: 
         {AVBGOM2.I}        
         RUN VALUE(progval).
         {AVBFRAM2.I}
      END.
      ELSE IF kollvar = 2 THEN DO:
         IF AVAILABLE markpers THEN DO:
            FIND FIRST tidpers WHERE tidpers.PERSONALKOD = markpers.PERSONALKOD NO-ERROR.
            IF NOT AVAILABLE tidpers THEN DO:
               FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
            END.
         END.
         IF progval = "ARBETSTID2.W" THEN DO:            
            EMPTY TEMP-TABLE valperstemp  NO-ERROR.            
            RUN psek_UI (INPUT tidpers.PERSONALKOD).
            IF musz = TRUE THEN DO:
               musz = FALSE.
               medvar = FALSE.
               MESSAGE "Du har inte behörighet att göra ändringar på denna person" VIEW-AS ALERT-BOX TITLE "Meddelande".               
               RETURN NO-APPLY.               
            END.
            IF Guru.Konstanter:appcon THEN DO:                           
               RUN PHMTAEN.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
               (INPUT tidpers.PERSONALKOD ,OUTPUT TABLE valperstemp).
            END.
            ELSE DO:
               RUN PHMTAEN.P  
               (INPUT tidpers.PERSONALKOD ,OUTPUT TABLE valperstemp).
            END.                  
         END.
         {AVBGOM2.I}         
         RUN VALUE(progval) (INPUT tidpers.PERSONALKOD). 
         {AVBFRAM2.I}
      END.   
      ELSE IF kollvar = 3 THEN DO:
         IF AVAILABLE markpers THEN DO:
            FIND FIRST tidpers WHERE tidpers.PERSONALKOD = markpers.PERSONALKOD NO-ERROR.
            IF NOT AVAILABLE tidpers THEN DO:
               FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
            END.
         END.        
         {AVBGOMD2.I}
         IF progval = "TJANAST.W (INPUT ?, INPUT 1)" THEN RUN TJANAST.W (INPUT ?, INPUT 1,INPUT tidpers.PERSONALKOD, INPUT "", INPUT 0).                   
         ELSE IF progval = "RESBORT.W (INPUT ?, INPUT 1)" THEN RUN RESBORT.W (INPUT ?, INPUT 1,INPUT tidpers.PERSONALKOD).                   
         ELSE IF progval = "UTLRESR.W (INPUT ?, INPUT 1)" THEN RUN UTLRESR.W (INPUT ?, INPUT 1,INPUT tidpers.PERSONALKOD, INPUT "", INPUT 0).                   
         ELSE DO:
            {AVBGOM2.I}         
            IF progval = "VFLLIST.W (INPUT RAD_ALLVAL:SCREEN-VALUE)" THEN RUN VFLLIST.W (INPUT RAD_ALLVAL:SCREEN-VALUE).                                    
            {AVBFRAM2.I}
         END.
         {AVBFRAM2.I}
      END.                      
      ELSE IF kollvar = 4 THEN DO:
         IF AVAILABLE markpers THEN DO:
            FIND FIRST tidpers WHERE tidpers.PERSONALKOD = markpers.PERSONALKOD NO-ERROR.
            IF NOT AVAILABLE tidpers THEN DO:
               FIND FIRST tidpers USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
            END.
         END.                 
         {AVBGOM2.I}
         IF progval = "ALLAAND.W (INPUT 1)" THEN RUN ALLAAND.W (INPUT 1,INPUT tidpers.PERSONALKOD).         
         ELSE IF progval = "ALLAAND.W (INPUT 2)" THEN RUN ALLAAND.W (INPUT 2,INPUT tidpers.PERSONALKOD).                                              
         ELSE IF progval = "ALLAAND.W (INPUT 3)" THEN RUN ALLAAND.W (INPUT 3,INPUT tidpers.PERSONALKOD).                                     
         ELSE IF progval = "ALLAAND.W (INPUT 4)" THEN RUN ALLAAND.W (INPUT 4,INPUT tidpers.PERSONALKOD).                                     
         ELSE IF progval = "ALLAAND.W (INPUT 5)" THEN RUN ALLAAND.W (INPUT 5,INPUT tidpers.PERSONALKOD).                                                       
         {AVBFRAM2.I}
      END.
      ELSE IF kollvar = 5 THEN DO:
         {AVBGOM2.I}
         DEFINE VARIABLE valvar AS INTEGER NO-UNDO.              
         EMPTY TEMP-TABLE valtemp  NO-ERROR.
         valvar = 29.                     
         CREATE valtemp.
         ASSIGN       
         valtemp.STARTDATUM = DATE(01,01,YEAR(TODAY))
         valtemp.SLUTDATUM  = TODAY
         valtemp.VALDLISTA = "Godkänn övertid per övertidbeordrare"
         valtemp.BAVAL = 1.                                 
         RUN OTBURVALU.W (INPUT-OUTPUT valvar,INPUT-OUTPUT TABLE valtemp, INPUT-OUTPUT TABLE otidbeordtemp,INPUT-OUTPUT TABLE vispers).
         {AVBFRAM2.I}               
      END.     
      RAD_ALLTID:SCREEN-VALUE = STRING(alltidspar).          
      APPLY "ENTRY" TO C-WIN.     
   END.
  {musarrow.i}
END PROCEDURE.

PROCEDURE sekerpers_UI :
   IF Guru.Konstanter:globallm = FALSE THEN RETURN.   
   {AVBGOM2.I}
   RUN GURU.W.
   {AVBFRAM2.I}
   
   EMPTY TEMP-TABLE utsokaonr NO-ERROR. 
   FIND FIRST uppvaltemp WHERE NO-LOCK NO-ERROR.
   
   IF NOT AVAILABLE uppvaltemp THEN DO:
      RUN extraaonrh_UI.
   END.
   ELSE DO:
      uppvaltemp.ANVANDARE = Guru.Konstanter:globanv.
      IF appprogok = TRUE THEN DO:
         RUN AOHMTALLT.P ON apphandass TRANSACTION DISTINCT ASYNCHRONOUS SET apphandklar
         EVENT-PROCEDURE "laddatempao_UI" IN THIS-PROCEDURE
         (INPUT " " ,INPUT-OUTPUT TABLE uppvaltemp, INPUT-OUTPUT TABLE utsokaonr , INPUT TABLE valsoktemp).      
      END.
      ELSE DO:
         IF Guru.Konstanter:appcon THEN DO:                           
            RUN AOHMTALLT.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
            (INPUT " " ,INPUT-OUTPUT TABLE uppvaltemp, INPUT-OUTPUT TABLE utsokaonr , INPUT TABLE valsoktemp).
         END.
         ELSE DO:
            RUN AOHMTALLT.P  
            (INPUT " " ,INPUT-OUTPUT TABLE uppvaltemp, INPUT-OUTPUT TABLE utsokaonr, INPUT TABLE valsoktemp).                  
         END.   
      END.
   END.
   IF Guru.Konstanter:globniv = 0 THEN DO:
      ASSIGN
      Guru.Konstanter:globallpers = TRUE
      Guru.Konstanter:globallao = TRUE.
   END.   
   Guru.Konstanter:globomr = "".
   
    
   IF NOT AVAILABLE personaltemp THEN DO:
      FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = Guru.Konstanter:globanvpkod
      USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
   END.
   IF AVAILABLE personaltemp THEN DO:
      ASSIGN
      Guru.Konstanter:globanvpkod = personaltemp.PERSONALKOD
      Guru.Konstanter:globomr = personaltemp.OMRADE.
      
   END.      
   IF Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" THEN DO:
      IF Guru.Konstanter:globanvavdnr NE 0 THEN DO:
         FIND FIRST omrtemp WHERE omrtemp.OMRADE = SUBSTRING(STRING(Guru.Konstanter:globanvavdnr,"9999"),1,4)
         NO-LOCK NO-ERROR.
         IF AVAILABLE omrtemp THEN Guru.Konstanter:globomr = SUBSTRING(STRING(Guru.Konstanter:globanvavdnr,"9999"),1,4).
      END.
   END.
   sekertid = TIME.         
END PROCEDURE.

PROCEDURE sekervalda_UI :
   IF Guru.Konstanter:globallm = TRUE THEN DO:
      EMPTY TEMP-TABLE tidpers NO-ERROR. 
      
      IF AVAILABLE markpers THEN DO:
         FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = markpers.PERSONALKOD
         NO-LOCK NO-ERROR.
      END.
      IF AVAILABLE personaltemp THEN DO:
         IF sekertid <= TIME - 20 THEN DO:
            RUN sekerpers_UI.           
         END.
         ELSE IF Guru.Konstanter:globanvpkod NE personaltemp.PERSONALKOD THEN DO:
            RUN sekerpers_UI.
         END.
            
      END.
      ELSE DO:
         RUN sekerpers_UI.          
      END.      
      IF AVAILABLE personaltemp THEN musz = musz.
      ELSE DO:
         musz = TRUE.
         RETURN.
      END.   
      IF Guru.Konstanter:globanvpkod = personaltemp.PERSONALKOD THEN DO:
         persrec = RECID(personaltemp).
         persrec2 = RECID(personaltemp).      
         CREATE tidpers.
         ASSIGN 
         tidpers.OMRADE = personaltemp.OMRADE 
         tidpers.TIDPERSREC = RECID(personaltemp)
         tidpers.PERSONALKOD = personaltemp.PERSONALKOD
         tidpers.EFTERNAMN = personaltemp.EFTERNAMN
         tidpers.FORNAMN = personaltemp.FORNAMN.
      END.
      ELSE musz = TRUE.
      RETURN.      
   END.
   
END PROCEDURE.
PROCEDURE rad_UI :
   
   RUN sekervalda_UI.
   EMPTY TEMP-TABLE tidpers NO-ERROR. 
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(1) OR RAD_ALLVAL:SCREEN-VALUE = STRING(4) OR RAD_ALLVAL:SCREEN-VALUE = STRING(6) THEN DO:      
      IF appprogok = TRUE THEN DO:
         RUN assklar_UI.
         IF musz = TRUE THEN RETURN.      
      END.      
      RUN selectfoc_UI.      
      IF NOT AVAILABLE markpers THEN DO:
         MESSAGE "Du måste välja någon!" VIEW-AS ALERT-BOX.
         musz = TRUE.
         RETURN.
      END.
      FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = markpers.PERSONALKOD NO-ERROR.
      IF NOT AVAILABLE personaltemp THEN DO:
         IF RAD_ALLTID:SCREEN-VALUE = STRING(9) AND RAD_ALLVAL:SCREEN-VALUE= STRING(4) THEN DO:         
            /*phmt.p*/
            FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD =  markpers.PERSONALKOD NO-LOCK NO-ERROR.
            IF NOT AVAILABLE  personaltemp THEN DO:               
               RUN persen_UI IN persapph (INPUT markpers.PERSONALKOD,OUTPUT TABLE personaltemp APPEND).                  
            END.
            RUN openbdynspec_UI IN brwproc[5].            
         END.
         ELSE IF RAD_ALLVAL:SCREEN-VALUE = STRING(6) THEN musz = musz.
         ELSE DO:
            MESSAGE "Personen du valt är troligen inaktiv! Det går ändå att visa tidsedel , välj meny: Visa tidsedel. " VIEW-AS ALERT-BOX.
            musz = TRUE.
            RETURN.
         END.
      END.
   END.
   ELSE IF RAD_ALLVAL:SCREEN-VALUE = STRING(2) THEN DO:
      IF appprogok = TRUE THEN DO:
         RUN assklar_UI.
         IF musz = TRUE THEN RETURN.      
      END.
      FIND FIRST vomrtemp NO-LOCK NO-ERROR.
      IF NOT AVAILABLE vomrtemp THEN DO:
         MESSAGE "Du måste välja någon!" VIEW-AS ALERT-BOX.
         musz = TRUE.
         RETURN.
      END.
   END.    
   IF Guru.Konstanter:appcon THEN DO:                           
      RUN TIDMVALP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT "",INPUT FALSE,INPUT Guru.Konstanter:globanv,INPUT Guru.Konstanter:globniv,INPUT RAD_ALLVAL:SCREEN-VALUE,
      INPUT TABLE markpers,INPUT TABLE vomrtemp,OUTPUT TABLE tidpers).
   END.
   ELSE DO:
      RUN TIDMVALP.P 
      (INPUT "",INPUT FALSE,INPUT Guru.Konstanter:globanv,INPUT Guru.Konstanter:globniv,INPUT RAD_ALLVAL:SCREEN-VALUE,
      INPUT TABLE markpers,INPUT TABLE vomrtemp,OUTPUT TABLE tidpers).                  
   END.      
   regmannamn = CMB_MANAD:SCREEN-VALUE.
   RUN MANNR.P.
   regdatum = DATE(regmnr,01,INTEGER(CMB_AR:SCREEN-VALUE)).
   bdatum = regdatum.
   IF MONTH(regdatum) = 12 THEN avdatum = DATE(12,31,YEAR(regdatum)). 
   ELSE avdatum = DATE((MONTH(regdatum) + 1),01,YEAR(regdatum)) - 1.           
   
END PROCEDURE.

PROCEDURE assklar_UI :
   IF apphandklar:COMPLETE = FALSE THEN DO: 
      MESSAGE "Du måste vänta lite innan du kan köra denna funktion!" VIEW-AS ALERT-BOX.
      musz = TRUE.
      RETURN.
   END.              
END PROCEDURE.
PROCEDURE main_UI :
   {OMSTARTAVGURUH.I}      
    c-win:TITLE = "Tidredovisning" + "-" + "Systemsupport 090/184540    elpool.ume@elpool.se  " + foretemp.ATRHOME.
   
   {ALLSTARTDYN.I} 
   {musarrow.i}
   IF musz = TRUE THEN DO:
      musz = FALSE.
      RETURN.
   END.   
   /*Dummy */
   status-ok = BRW_PERS:SELECT-FOCUSED-ROW() NO-ERROR.
   status-ok = BRW_PERS:DESELECT-FOCUSED-ROW() NO-ERROR.   
   
   
END PROCEDURE.
PROCEDURE btnfda_UI :
   DEFINE INPUT PARAMETER minpluvar AS INTEGER NO-UNDO.
   IF NOT AVAILABLE personaltemp  THEN DO:
      FIND FIRST personaltemp NO-LOCK NO-ERROR.
   END.
   FIND FIRST flexavttemp WHERE flexavttemp.PERSONALKOD = personaltemp.PERSONALKOD NO-LOCK NO-ERROR.
   FIND FIRST ansttemp WHERE ansttemp.ANSTALLNING = personaltemp.ANSTALLNING
   USE-INDEX ANSTF NO-LOCK NO-ERROR.  
   REPEAT:
      ASSIGN
      sok1 = ansttemp.KOD
      sok4 = FILL-IN_DATUM:SCREEN-VALUE.
      IF Guru.Konstanter:appcon THEN DO: 
         RUN FLEXTIDH.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
         (INPUT 8,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
         INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
      END.
      ELSE DO:
         RUN FLEXTIDH.P 
         (INPUT 8,INPUT-OUTPUT sok1,INPUT-OUTPUT sok2,INPUT-OUTPUT sok3,
         INPUT-OUTPUT sok4,INPUT-OUTPUT sok5).            
      END.      
      IF sok2 = 0 THEN dagnr = WEEKDAY(DATE(FILL-IN_DATUM:SCREEN-VALUE)).
      ELSE dagnr = sok2.           
      IF dagnr = 1 OR dagnr = 7 THEN DO:
         IF minpluvar = 1 THEN FILL-IN_DATUM:SCREEN-VALUE = STRING(DATE(FILL-IN_DATUM:SCREEN-VALUE) - 1). 
         IF minpluvar = 2 THEN FILL-IN_DATUM:SCREEN-VALUE = STRING(DATE(FILL-IN_DATUM:SCREEN-VALUE) + 1). 
      END.
      ELSE LEAVE.         
   END.      
END PROCEDURE.
PROCEDURE slutdat_UI :
   IF INTEGER(CMB_TARST:SCREEN-VALUE) > INTEGER(CMB_TARSL:SCREEN-VALUE) THEN CMB_TARSL:SCREEN-VALUE = CMB_TARST:SCREEN-VALUE.
   regmannamn = CMB_TMANADST:SCREEN-VALUE.
   RUN MANNR.P.
   bdatum = DATE(regmnr,01,INTEGER(CMB_TARST:SCREEN-VALUE)).
   regmannamn = CMB_TMANADSL:SCREEN-VALUE.
   RUN MANNR.P.     
   avdatum = DATE(regmnr,01,INTEGER(CMB_TARSL:SCREEN-VALUE)).
   IF bdatum > avdatum THEN CMB_TMANADSL:SCREEN-VALUE = CMB_TMANADST:SCREEN-VALUE.
   regmannamn = CMB_TMANADSL:SCREEN-VALUE.
   RUN MANNR.P.     
   avdatum = DATE(regmnr,01,INTEGER(CMB_TARSL:SCREEN-VALUE)).
END PROCEDURE.
PROCEDURE radflex_UI :
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(1) OR RAD_ALLVAL:SCREEN-VALUE = STRING(4) OR 
      RAD_ALLVAL:SCREEN-VALUE = STRING(6) THEN DO:
      IF appprogok = TRUE THEN DO:
         RUN assklar_UI.
         IF musz = TRUE THEN RETURN.      
      END.
      FIND FIRST markpers NO-LOCK NO-ERROR.
      IF NOT AVAILABLE markpers THEN DO:
         MESSAGE "Du måste välja någon!" VIEW-AS ALERT-BOX.
         musz = TRUE.
         RETURN.
      END.
   END.
   ELSE IF RAD_ALLVAL:SCREEN-VALUE = STRING(2) THEN DO:
      IF appprogok = TRUE THEN DO:
         RUN assklar_UI.
         IF musz = TRUE THEN RETURN.      
      END.
      FIND FIRST vomrtemp NO-LOCK NO-ERROR.
      IF NOT AVAILABLE vomrtemp THEN DO:
         MESSAGE "Du måste välja någon!" VIEW-AS ALERT-BOX.
         musz = TRUE.
         RETURN.
      END.
   END.
   IF Guru.Konstanter:appcon THEN DO:                           
      RUN TIDMVALP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT "",INPUT TRUE,INPUT Guru.Konstanter:globanv,INPUT Guru.Konstanter:globniv,INPUT RAD_ALLVAL:SCREEN-VALUE,
      INPUT TABLE markpers,INPUT TABLE vomrtemp,OUTPUT TABLE tidpers).
   END.
   ELSE DO:
      RUN TIDMVALP.P 
      (INPUT "",INPUT TRUE,INPUT Guru.Konstanter:globanv,INPUT Guru.Konstanter:globniv,INPUT RAD_ALLVAL:SCREEN-VALUE,
      INPUT TABLE markpers,INPUT TABLE vomrtemp,OUTPUT TABLE tidpers).                  
   END.
               
END PROCEDURE.
PROCEDURE slutdat2_UI :
   IF INTEGER(CMB_TARST:SCREEN-VALUE) > INTEGER(CMB_TARSL:SCREEN-VALUE) THEN CMB_TARST:SCREEN-VALUE = CMB_TARSL:SCREEN-VALUE.
   regmannamn = CMB_TMANADST:SCREEN-VALUE.
   RUN MANNR.P.
   bdatum = DATE(regmnr,01,INTEGER(CMB_TARST:SCREEN-VALUE)).
   regmannamn = CMB_TMANADSL:SCREEN-VALUE.
   RUN MANNR.P.     
   avdatum = DATE(regmnr,01,INTEGER(CMB_TARSL:SCREEN-VALUE)).
   IF bdatum > avdatum THEN CMB_TMANADST:SCREEN-VALUE = CMB_TMANADSL:SCREEN-VALUE.   
   
END PROCEDURE.
PROCEDURE tomdat_UI :
   
   IF CMB_TARSL:SCREEN-VALUE = CMB_TARST:SCREEN-VALUE AND 
   CMB_TMANADSL:SCREEN-VALUE = CMB_TMANADST:SCREEN-VALUE AND RAD_TIDSVAL:SCREEN-VALUE = "3" AND 
   TOG_MAN:CHECKED = FALSE THEN DO:
      regmannamn = CMB_TMANADSL:SCREEN-VALUE.
      RUN MANNR.P.     
      ejvisdatum = DATE(regmnr,01,INTEGER(CMB_TARSL:SCREEN-VALUE)).
      IF MONTH(ejvisdatum) = 12 THEN DO:
         FILL-IN-TDATUM:SCREEN-VALUE = STRING(31).
      END.
      ELSE DO:   
         FILL-IN-TDATUM:SCREEN-VALUE = STRING( DAY(DATE((MONTH(ejvisdatum ) + 1),01,YEAR(ejvisdatum)) - 1)).
      END.      
      FILL-IN-TDATUM-2:SCREEN-VALUE = STRING(1).
      RUN dag_UI.      
   END.
   ELSE DO:
      ASSIGN
      FILL-IN-TDATUM-2:HIDDEN  = TRUE 
      FILL-IN-TDAG-2:HIDDEN  = TRUE
      FILL-IN-TDAG:HIDDEN  = TRUE 
      FILL-IN-TDATUM:HIDDEN  = TRUE.     
   END.
   RUN allman_UI IN huvprogh (INPUT "RADTIDSVAL", INPUT RAD_TIDSVAL:SCREEN-VALUE).
END PROCEDURE.


PROCEDURE sparaaofavoriter_UI :
   tthandle = TEMP-TABLE markpers:HANDLE.
   FIND FIRST sparaladdatemp NO-ERROR.
   IF NOT AVAILABLE sparaladdatemp THEN CREATE sparaladdatemp.
   ASSIGN
   sparaladdatemp.GLOBANV = Guru.Konstanter:globanv /*Användare, i detta fall ELPAO*/
   sparaladdatemp.BENAMNING = "TID" /*Benämnings sufix, i detta fall ELPAO$STOR*/
   sparaladdatemp.TABVAL = "PERSONALTAB" /*Tabellnamn*/
   sparaladdatemp.FALTVALAO = "PERSONALKOD" /*CHARACTER field*/
   sparaladdatemp.FALTVALDEL = "" /*Integer field*/
   sparaladdatemp.FALTVALDATE = "".  /*DATE field*/
   RUN sparabrw_UI IN brwproc[3] 
      (INPUT TABLE-HANDLE tthandle, INPUT TABLE sparaladdatemp).
END PROCEDURE.
PROCEDURE allstartbrw_UI :
   DEFINE VARIABLE korextra AS LOGICAL NO-UNDO.
   korextra = FALSE.
   IF NOT VALID-HANDLE(brwproc[1]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[1] (INPUT BRW_ANSV).
   IF NOT VALID-HANDLE(brwproc[2]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[2] (INPUT BRW_GODK).
   IF NOT VALID-HANDLE(brwproc[3]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[3] (INPUT BRW_MARK).
   IF NOT VALID-HANDLE(brwproc[4]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[4] (INPUT BRW_OMR).
   IF NOT VALID-HANDLE(brwproc[5]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[5] (INPUT BRW_PERS).
   IF NOT VALID-HANDLE(brwproc[6]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[6] (INPUT BRW_AVD).
   IF NOT VALID-HANDLE(brwproc[7]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[7] (INPUT BRW_VAVD).
   IF NOT VALID-HANDLE(brwproc[8]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[8] (INPUT BRW_VOMR).
   IF NOT VALID-HANDLE(brwproc[9]) THEN RUN DYNARROW.P PERSISTENT SET brwproc[9]
      (INPUT BRW_OMR, INPUT BRW_VOMR ,INPUT BTN_VVOVER, INPUT BTN_ALLOVER,INPUT BTN_ALLBACK, INPUT BTN_BACK).
   IF NOT VALID-HANDLE(brwproc[10]) THEN RUN DYNARROW.P PERSISTENT SET brwproc[10]
      (INPUT BRW_AVD, INPUT BRW_VAVD ,INPUT ?, INPUT ?, INPUT ?, INPUT BTN_VBACK).
   IF NOT VALID-HANDLE(brwproc[11]) THEN DO:
      RUN DYNARROW.P PERSISTENT SET brwproc[11]
      (INPUT BRW_PERS, INPUT BRW_MARK,INPUT BTN_PVVOVER, INPUT BTN_PALLOVER,INPUT BTN_PALLBACK, INPUT BTN_PBACK).
      RUN addfillin_UI IN brwproc[11] 
         (INPUT FILL-IN_SPERSONALKOD, INPUT "PERSONALKOD").  
      RUN addfillin_UI IN brwproc[11]
         (INPUT FILL-IN_SFORNAMN, INPUT "FORNAMN").
      RUN addfillin_UI IN brwproc[11]
         (INPUT FILL-IN_SEFTERNAMN, INPUT "EFTERNAMN"). 
   END.
   IF NOT VALID-HANDLE(persapph) THEN korextra = TRUE.
   IF Guru.Konstanter:appcon THEN DO:      
      IF NOT VALID-HANDLE(persapph)   THEN RUN PHMTAPP.P PERSISTENT SET persapph ON Guru.Konstanter:apphand TRANSACTION DISTINCT. 
      IF NOT VALID-HANDLE(nyttaoapph) THEN DO:
         RUN laddspers_UI.
         RUN NYTTAOAPP.P PERSISTENT SET nyttaoapph ON Guru.Konstanter:apphand TRANSACTION DISTINCT. 
         ASSIGN sparomrade = Guru.Konstanter:globomr.
         RUN huvud_UI.       
         RUN menyrad_UI.  
         RUN startvard_UI.
      END.
      ELSE RUN extraaonrh_UI.
      
   END.
   ELSE DO:
      IF NOT VALID-HANDLE(persapph) THEN RUN PHMTAPP.P PERSISTENT SET persapph.
      IF NOT VALID-HANDLE(nyttaoapph) THEN DO:
         RUN laddspers_UI.
         RUN NYTTAOAPP.P PERSISTENT SET nyttaoapph.
         ASSIGN sparomrade = Guru.Konstanter:globomr.
         RUN huvud_UI.       
         RUN menyrad_UI.   
         RUN startvard_UI.
      END.
      ELSE RUN extraaonrh_UI.
      
   END.
   
   IF korextra = TRUE THEN DO:
      FBTN_REG:LOAD-IMAGE ("BILDER\xbtn_regtj2.gif") NO-ERROR. 
      RUN storlek_UI (INPUT FBTN_REG).
      FBTN_TBRES:LOAD-IMAGE ("BILDER\xbtn_radtj2.gif") NO-ERROR.        
      RUN storlek_UI (INPUT FBTN_TBRES).
      FBTN_UTRES:LOAD-IMAGE ("BILDER\xbtn_regut2.gif") NO-ERROR.        
      RUN storlek_UI (INPUT FBTN_UTRES).
      FBTN_TID:LOAD-IMAGE ("BILDER\xbtn_tidregi.gif") NO-ERROR.        
      RUN storlek_UI (INPUT FBTN_TID).
      FBTN_LON:LOAD-IMAGE ("BILDER\xbtn_lon2.gif") NO-ERROR.         
      RUN storlek_UI (INPUT FBTN_LON).
      FBTN_BER:LOAD-IMAGE ("BILDER\xbtn_beredskap2.gif") NO-ERROR.
      RUN storlek_UI (INPUT FBTN_BER).
      FBTN_TRA:LOAD-IMAGE ("BILDER\xbtn_trakt2.gif") NO-ERROR.
      RUN storlek_UI (INPUT FBTN_TRA).
      FBTN_OVER:LOAD-IMAGE ("BILDER\xbtn_overtid2.gif") NO-ERROR.
      RUN storlek_UI (INPUT FBTN_OVER).
      
      korextra = FALSE.
      RUN korextra_UI.
      RUN hmtfavoriter_UI.
   END.
   
END PROCEDURE.

PROCEDURE storlek_UI :   
   DEFINE INPUT PARAMETER vh AS HANDLE NO-UNDO.
   vh:HEIGHT-CHARS = vh:HEIGHT-CHARS + 0.05.
   IF vh:ROW - 0.04 > 1 THEN vh:ROW = vh:ROW - 0.04.
   vh:COLUMN = vh:COLUMN - 0.08.
   vh:WIDTH-CHARS = vh:WIDTH-CHARS + 0.25.       
   
END PROCEDURE.


PROCEDURE korextra_UI :
END PROCEDURE.
PROCEDURE startvard_UI :
   ASSIGN
   TOG_MAN:CHECKED = TRUE.
END PROCEDURE.
PROCEDURE extraaonrh_UI :
   FIND FIRST foretemp NO-LOCK NO-ERROR.
   EMPTY TEMP-TABLE uppvaltemp NO-ERROR. 
   CREATE uppvaltemp.
   ASSIGN         
   uppvaltemp.ENDBEST = ?  
   uppvaltemp.DELNRKOLL = TRUE
   uppvaltemp.VISPERAR = TRUE
   uppvaltemp.STARTDATUM = DATE(01,01,YEAR(TODAY))
   uppvaltemp.SLUTDATUM  = TODAY
   uppvaltemp.AVSLUTSTART = DATE(01,01,YEAR(TODAY))
   uppvaltemp.AVSLUTSLUT = TODAY + 30
   uppvaltemp.TILLFALLFAST = 3
   SUBSTRING(uppvaltemp.PROJEKTOR,1,20) = "ALLA"
   uppvaltemp.BEREDARE = "ALLA"
   uppvaltemp.ARBANSVARIG = "ALLA"
   uppvaltemp.BESTNAMN = "ALLA"
   uppvaltemp.OMRNAMN = ""
   uppvaltemp.OMRADE = "Alla"
   uppvaltemp.BESTID = "ALLA"
   uppvaltemp.AVDNAMN = "ALLA"
   uppvaltemp.AVDNR = "ALLA"
   uppvaltemp.FAKTTYP = "ALLA"
   uppvaltemp.PAAV = 1.
    
   IF Guru.Konstanter:appcon = TRUE AND Guru.Konstanter:globanv = "celpao" THEN DO:
      RUN ASSYNAPP.P (INPUT 1,OUTPUT appprogok,INPUT-OUTPUT apphandass).
   END.
   EMPTY TEMP-TABLE utsokaonr NO-ERROR. 
   uppvaltemp.ANVANDARE = Guru.Konstanter:globanv.
   IF appprogok = TRUE THEN DO:
      RUN AOHMTALLT.P ON apphandass TRANSACTION DISTINCT ASYNCHRONOUS SET apphandklar
      EVENT-PROCEDURE "laddatempao_UI" IN THIS-PROCEDURE
      (INPUT " " ,INPUT-OUTPUT TABLE uppvaltemp, INPUT-OUTPUT TABLE utsokaonr , INPUT TABLE valsoktemp).      
   END.
   ELSE DO:
      IF Guru.Konstanter:appcon THEN DO:                           
         RUN AOHMTALLT.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
         (INPUT " " ,INPUT-OUTPUT TABLE uppvaltemp, INPUT-OUTPUT TABLE utsokaonr , INPUT TABLE valsoktemp).
      END.
      ELSE DO:
         RUN AOHMTALLT.P  
         (INPUT " " ,INPUT-OUTPUT TABLE uppvaltemp, INPUT-OUTPUT TABLE utsokaonr, INPUT TABLE valsoktemp).                  
      END.   
   END.
END PROCEDURE.
PROCEDURE huvud_UI :
   obeordg = FALSE .
   RUN obeordsatt_UI IN nyttaoapph (INPUT Guru.Konstanter:GForetag, OUTPUT obeordg).   
   FIND FIRST foretemp NO-LOCK NO-ERROR.
   {OMSTARTAVGURUH.I}
   RUN extraaonrh_UI. 
   IF Guru.Konstanter:appcon THEN DO:                           
      RUN FLEXTAB.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT 4,INPUT "",INPUT-OUTPUT TABLE ansttemp,INPUT-OUTPUT TABLE flexregtemp,
      INPUT-OUTPUT TABLE flexavttemp,INPUT-OUTPUT TABLE flexsaldotemp,INPUT-OUTPUT TABLE utryckningtemp).         
   END.
   ELSE DO:
      RUN FLEXTAB.P 
      (INPUT 4,INPUT "",INPUT-OUTPUT TABLE ansttemp,INPUT-OUTPUT TABLE flexregtemp,
      INPUT-OUTPUT TABLE flexavttemp,INPUT-OUTPUT TABLE flexsaldotemp,INPUT-OUTPUT TABLE utryckningtemp).      
   END.
   IF Guru.Konstanter:appcon THEN DO:                           
      RUN UPPGHMT.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (OUTPUT TABLE automregtemp,OUTPUT TABLE befattningstemp,OUTPUT TABLE overkodtemp,OUTPUT TABLE beredskapstarttemp,OUTPUT TABLE beredskaptabtemp).  
   END.
   ELSE DO:
      RUN UPPGHMT.P 
      (OUTPUT TABLE automregtemp,OUTPUT TABLE befattningstemp,OUTPUT TABLE overkodtemp,OUTPUT TABLE beredskapstarttemp,
       OUTPUT TABLE beredskaptabtemp).  
   END.
   ASSIGN   
   TOG_MAN:CHECKED = FALSE
   vaxla = FALSE.
   CMB_TAR:LIST-ITEMS = "".
   ASSIGN  /*LADDAR ÅR I CMB_TAR*/
   status-ok = CMB_TAR:ADD-LAST(STRING(YEAR(TODAY) - 5,"9999"))  
   status-ok = CMB_TAR:ADD-LAST(STRING(YEAR(TODAY) - 4,"9999"))  
   status-ok = CMB_TAR:ADD-LAST(STRING(YEAR(TODAY) - 3,"9999"))  
   status-ok = CMB_TAR:ADD-LAST(STRING(YEAR(TODAY) - 2,"9999"))
   status-ok = CMB_TAR:ADD-LAST(STRING(YEAR(TODAY) - 1,"9999"))
   status-ok = CMB_TAR:ADD-LAST(STRING(YEAR(TODAY),"9999"))
   status-ok = CMB_TAR:DELETE("0")
   CMB_TAR:SCREEN-VALUE = STRING(YEAR(TODAY),"9999").
   RAD_TIDSVAL:SCREEN-VALUE = STRING(1).
   IF Guru.Konstanter:globforetag = "cELPA" THEN DO:           
      RAD_TIDSVAL:SCREEN-VALUE = STRING(3).          
   END.
   gvisatidpermanad = TRUE.
   status-ok = CMB_OMR:ADD-LAST(Guru.Konstanter:gomrk + " : alla").
   {OMRHMT.I}   
   /*visa bara eget bolags områden*/      
   RUN anvavdhmt IN nyttaoapph (INPUT Guru.Konstanter:globanv,INPUT "",INPUT "",OUTPUT jid, OUTPUT TABLE eavdtemp ).                         
   IF Guru.Konstanter:varforetypval[39] = 1 THEN DO:   
      FIND FIRST eavdtemp NO-ERROR.           
   END.
   IF AVAILABLE eavdtemp AND Guru.Konstanter:varforetypval[39] = 1 THEN DO:    
      FOR EACH omrtemp BY omrtemp.NAMN: 
         FIND FIRST eavdtemp WHERE eavdtemp.AVDELNINGNR = omrtemp.AVDELNINGNR NO-LOCK NO-ERROR.  
         IF AVAILABLE eavdtemp THEN status-ok = CMB_OMR:ADD-LAST(omrtemp.NAMN).                        
      END.
   END.
   ELSE DO:   
      FOR EACH eavdtemp,         
      EACH omrtemp WHERE omrtemp.AVDELNINGNR = eavdtemp.AVDELNINGNR.
         status-ok = CMB_OMR:ADD-LAST(omrtemp.NAMN).                        
      END.  
   END.
   FIND FIRST omrtemp WHERE omrtemp.OMRADE = Guru.Konstanter:globomr 
   USE-INDEX OMR NO-LOCK NO-ERROR.
   IF NOT AVAILABLE omrtemp THEN DO:
      FIND FIRST omrtemp USE-INDEX OMR NO-LOCK NO-ERROR.
   END.
   IF NOT AVAILABLE omrtemp THEN ASSIGN CMB_OMR:SCREEN-VALUE = "Alla".
   ELSE ASSIGN CMB_OMR:SCREEN-VALUE = omrtemp.NAMN.
   IF CMB_OMR:SCREEN-VALUE = ? THEN DO:
      CMB_OMR:SCREEN-VALUE = Guru.Konstanter:gomrk + " : alla".
   END.
   IF Guru.Konstanter:globomr = "" OR Guru.Konstanter:globallpers = TRUE THEN DO:
      ASSIGN CMB_OMR:SCREEN-VALUE = Guru.Konstanter:gomrk + " : alla".
   END.    
   APPLY "VALUE-CHANGED" TO CMB_OMR.
   /*phmt.p*/
   /*hämta bara de personer användaren har behörighet för Lena 20180108*/
   DEBUGGER:SET-BREAK().
   RUN allpers_UI IN persapph (INPUT Guru.Konstanter:globanv,INPUT Guru.Konstanter:globniv,OUTPUT TABLE personaltemp,OUTPUT TABLE godkannartemp,OUTPUT TABLE avdelningtemp).  
   FOR EACH personaltemp :
      ASSIGN personaltemp.AKTIV = FALSE.
   END.
   FOR EACH eavdtemp,         
   EACH omrtemp WHERE omrtemp.AVDELNINGNR = eavdtemp.AVDELNINGNR,
   EACH personaltemp WHERE personaltemp.OMRADE = omrtemp.OMRADE. 
      ASSIGN personaltemp.AKTIV = TRUE.   
   END.            
   FOR EACH personaltemp WHERE personaltemp.AKTIV = FALSE:
      DELETE personaltemp.
   END.       
   /*20180423 Lena personaltemp är redan sekretessstyrd.
    Det ska kunna se en godkännare om de har behörighet för någon person kopplad till godkännaren*/ 
   /*Ta bort godkännare som ej hör till eget bolag*/
   /*FOR EACH godkannartemp:
      FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = godkannartemp.PERSONALKOD NO-LOCK NO-ERROR.
      IF NOT AVAILABLE personaltemp THEN DO:
         DELETE godkannartemp.
      END.
   END.*/
   /*Ta bort avdelningar som ej hör till eget bolag*/
   FOR EACH avdelningtemp:
      FIND FIRST eavdtemp WHERE eavdtemp.AVDELNINGNR = avdelningtemp.AVDELNINGNR NO-LOCK NO-ERROR.
      IF NOT AVAILABLE eavdtemp THEN DO:
         DELETE avdelningtemp.
      END.
   END.
   FOR EACH omrtemp:
      FIND FIRST eavdtemp WHERE eavdtemp.AVDELNINGNR = omrtemp.AVDELNINGNR NO-LOCK NO-ERROR.
      IF NOT AVAILABLE eavdtemp THEN DO:
         DELETE omrtemp.
      END.
   END.   
   ASSIGN
   BRW_AVD:TITLE = Guru.Konstanter:gavdl
   BRW_VAVD:TITLE = "Valda " + LC(Guru.Konstanter:gavdk)
   BRW_VOMR:TITLE = "Valda " + LC(Guru.Konstanter:gomrk)
   BRW_OMR:TITLE = Guru.Konstanter:gomrk 
   BTN_ALLBACK:TOOLTIP = "Alla valda " + LC(Guru.Konstanter:gomrk) + " tas bort"   
   BTN_ALLOVER:TOOLTIP = "Alla " + LC(Guru.Konstanter:gomrk) + " väljs"
   FBTN_AND:LABEL = "Ändra flextid".
   status-ok = RAD_ALLVAL:DELETE(" ").   
   status-ok = RAD_ALLVAL:ADD-LAST("Enhet/Sign",4).
   status-ok = RAD_ALLVAL:ADD-LAST("Godkänner tid", 6).
   status-ok = RAD_ALLVAL:ADD-LAST(Guru.Konstanter:gomrk, 2).
   status-ok = RAD_ALLVAL:ADD-LAST("Alla", 3).   
   status-ok = RAD_TIDSVAL:DELETE("Ej godkända").
   status-ok = RAD_TIDSVAL:ADD-LAST("Ej godkänd/färdig",3).   
   RAD_ALLVAL:SCREEN-VALUE = STRING(4).
   RUN radallval_UI.
   FILL-IN_DATUM:SCREEN-VALUE = STRING(TODAY - 1).     
   RUN manad_UI.      
   TOG_MAN:HIDDEN = TRUE.

   IF Guru.Konstanter:globforetag = "GRAN" OR Guru.Konstanter:globforetag = "GKAL" THEN DO:
      andvisdatum = TODAY.
      regdatum = TODAY.
   END.   
   ELSE IF Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "elpa" THEN DO:
      hjdat = DATE(MONTH(TODAY),01,YEAR(TODAY)).
      hjrak = 0.
      RUN kolldatum_UI IN persapph (INPUT hjdat,OUTPUT hjrak).        
      andvisdatum = TODAY - hjrak.
      regdatum = TODAY - hjrak.   
   END.
   ELSE IF Guru.Konstanter:globforetag = "ETA" THEN DO:
      andvisdatum = TODAY - 11.
      regdatum = TODAY - 11.
   END.
   ELSE IF Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" THEN DO:
      andvisdatum = TODAY - 5.
      regdatum = TODAY - 5.
   END.
   ELSE DO:
      andvisdatum = TODAY - 7.
      regdatum = TODAY - 7.   
   END.   
   
   RUN REGVEC.P.       
   andvisvnr = regvnr.
   RUN globman_UI.   
   RUN VISMEDDU.W.                
   RUN sek_UI.
   status-ok = RAD_ALLTID:DELETE("").  
   RAD_ALLTID:SCREEN-VALUE = ?.    
   IF CMB_OMR:SCREEN-VALUE = Guru.Konstanter:gomrk + " : alla" THEN musz = musz.
   ELSE DO:   
      IF Guru.Konstanter:globallm = FALSE AND markladdad = FALSE THEN DO:
         /*LÄGGER UT DIG SOM FÖRVALD*/
         FIND FIRST personaltemp WHERE personaltemp.PERSONALKOD = Guru.Konstanter:globanvpkod AND 
         personaltemp.AKTIV = TRUE NO-LOCK NO-ERROR.
         IF AVAILABLE personaltemp THEN DO:
            CREATE markpers.
            ASSIGN  markpers.EFTERNAMN = personaltemp.EFTERNAMN 
            markpers.FORNAMN = personaltemp.FORNAMN 
            markpers.PERSONALKOD = personaltemp.PERSONALKOD.            
            OPEN QUERY BRW_MARK FOR EACH markpers NO-LOCK .
         END.
      END.      
   END.      
   RUN brwopen_UI.    
   markladdad = FALSE.
   RAD_ALLTID:HIDDEN = TRUE.      
   IF obeordg = TRUE  THEN  FBTN_VISA:LABEL = "Godkänn övertid".
END PROCEDURE.
PROCEDURE laddatempao_UI :
   DEFINE INPUT PARAMETER TABLE FOR uppvaltemp.
   DEFINE INPUT PARAMETER TABLE FOR utsokaonr.
   IF appprogok = TRUE THEN DO:
      RUN ASSYNAPP.P (INPUT 2,OUTPUT appprogok,INPUT-OUTPUT apphandass).
   END.
   MESSAGE "ao klart1
      " VIEW-AS ALERT-BOX.
END PROCEDURE.
PROCEDURE brwopen_UI :
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(1) THEN DO:            
      /*ANSVARIG*/
      RUN changebrwh_UI IN brwproc[11] (INPUT BRW_ANSV, INPUT BRW_MARK).
      RUN openbdynspec_UI IN brwproc[1].               
   END.
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(2) THEN DO:
      /*OMRADE*/ 
      RUN openbdynspec_UI IN brwproc[4].               
      RUN openbdynspec_UI IN brwproc[6].               
   END.        
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(3) THEN DO:
      /*ALLA*/   
   END. 
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(4) THEN DO:
      /*PERSONER*/
      RUN changebrwh_UI IN brwproc[11] (INPUT BRW_PERS, INPUT BRW_MARK).
      RUN openbdynspec_UI IN brwproc[5].               
   END.   
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(6) THEN DO:  
      /*GODKANNARE*/
      RUN changebrwh_UI IN brwproc[11] (INPUT BRW_GODK, INPUT BRW_MARK).
      RUN openbdynspec_UI IN brwproc[2].               
   END.
END PROCEDURE.

PROCEDURE globman_UI :
   ASSIGN  /*LADDAR ÅR I CMB_AR*/
   status-ok = CMB_AR:ADD-LAST(STRING(YEAR(TODAY) - 5,"9999")) 
   status-ok = CMB_AR:ADD-LAST(STRING(YEAR(TODAY) - 4,"9999")) 
   status-ok = CMB_AR:ADD-LAST(STRING(YEAR(TODAY) - 3,"9999")) 
   status-ok = CMB_AR:ADD-LAST(STRING(YEAR(TODAY) - 2,"9999"))
   status-ok = CMB_AR:ADD-LAST(STRING(YEAR(TODAY) - 1,"9999"))
   status-ok = CMB_AR:ADD-LAST(STRING(YEAR(TODAY),"9999"))
   status-ok = CMB_AR:ADD-LAST(STRING(YEAR(TODAY) + 1,"9999"))
   status-ok = CMB_AR:DELETE("0").
   RUN globman3_UI.   
   RUN globman2_UI.
END PROCEDURE.
PROCEDURE globman3_UI :
   ASSIGN
   CMB_AR:SCREEN-VALUE = STRING(YEAR(andvisdatum),"9999")
   regar = INTEGER(CMB_AR:SCREEN-VALUE).                   
   IF MONTH(andvisdatum) = 01 THEN DO:
      CMB_MANAD:SCREEN-VALUE  = STRING("januari").      
   END.   
   ELSE IF MONTH(andvisdatum) = 02 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("februari").      
   END.  
   ELSE IF MONTH(andvisdatum) = 03 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("mars").
   END.
   ELSE IF MONTH(andvisdatum) = 04 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("april").      
   END.  
   ELSE IF MONTH(andvisdatum) = 05 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("maj").      
   END.
   ELSE IF MONTH(andvisdatum) = 06 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("juni").      
   END.  
   ELSE IF MONTH(andvisdatum) = 07 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("juli").      
   END.
   ELSE IF MONTH(andvisdatum) = 08 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("augusti").      
   END.  
   ELSE IF MONTH(andvisdatum) = 09 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("september").      
   END.
   ELSE IF MONTH(andvisdatum) = 10 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("oktober").      
   END.  
   ELSE IF MONTH(andvisdatum) = 11 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("november").      
   END.
   ELSE IF MONTH(andvisdatum) = 12 THEN DO:
      CMB_MANAD:SCREEN-VALUE = STRING("december").          
      regar = INTEGER(CMB_AR:SCREEN-VALUE).
   END.      
END PROCEDURE.
PROCEDURE globman2_UI :
   ASSIGN  /*LADDAR ÅR I CMB_TAR*/
   status-ok = CMB_TARST:ADD-LAST(STRING(YEAR(TODAY) - 5,"9999"))
   status-ok = CMB_TARST:ADD-LAST(STRING(YEAR(TODAY) - 4,"9999"))
   status-ok = CMB_TARST:ADD-LAST(STRING(YEAR(TODAY) - 3,"9999"))
   status-ok = CMB_TARST:ADD-LAST(STRING(YEAR(TODAY) - 2,"9999"))
   status-ok = CMB_TARST:ADD-LAST(STRING(YEAR(TODAY) - 1,"9999"))
   status-ok = CMB_TARST:ADD-LAST(STRING(YEAR(TODAY),"9999"))
   status-ok = CMB_TARST:ADD-LAST(STRING(YEAR(TODAY) + 1,"9999"))
   status-ok = CMB_TARST:DELETE("0")      
   status-ok = CMB_TARSL:ADD-LAST(STRING(YEAR(TODAY) - 5,"9999"))
   status-ok = CMB_TARSL:ADD-LAST(STRING(YEAR(TODAY) - 4,"9999"))
   status-ok = CMB_TARSL:ADD-LAST(STRING(YEAR(TODAY) - 3,"9999"))
   status-ok = CMB_TARSL:ADD-LAST(STRING(YEAR(TODAY) - 2,"9999"))
   status-ok = CMB_TARSL:ADD-LAST(STRING(YEAR(TODAY) - 1,"9999"))
   status-ok = CMB_TARSL:ADD-LAST(STRING(YEAR(TODAY),"9999"))
   status-ok = CMB_TARSL:ADD-LAST(STRING(YEAR(TODAY) + 1,"9999"))
   status-ok = CMB_TARSL:DELETE("0").      
   CMB_TARST:SCREEN-VALUE = STRING(YEAR(andvisdatum),"9999"). 
   regar = INTEGER(CMB_TARST:SCREEN-VALUE).                   
   IF MONTH(andvisdatum) = 01 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("januari").    
   END.   
   ELSE IF MONTH(andvisdatum) = 02 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("februari").      
   END.  
   ELSE IF MONTH(andvisdatum) = 03 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("mars").      
   END.
   ELSE IF MONTH(andvisdatum) = 04 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("april").      
   END.  
   ELSE IF MONTH(andvisdatum) = 05 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("maj").      
   END.
   ELSE IF MONTH(andvisdatum) = 06 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("juni").      
   END.  
   ELSE IF MONTH(andvisdatum) = 07 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("juli").      
   END.
   ELSE IF MONTH(andvisdatum) = 08 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("augusti").      
   END.  
   ELSE IF MONTH(andvisdatum) = 09 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("september").      
   END.
   ELSE IF MONTH(andvisdatum) = 10 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("oktober").      
   END.  
   ELSE IF MONTH(andvisdatum) = 11 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("november").      
   END.
   ELSE IF MONTH(andvisdatum) = 12 THEN DO:
      CMB_TMANADST:SCREEN-VALUE = STRING("december").
      regar = INTEGER(CMB_TARST:SCREEN-VALUE).
   END.        
   ASSIGN
   CMB_TMANADSL:SCREEN-VALUE = CMB_TMANADST:SCREEN-VALUE
   CMB_TARSL:SCREEN-VALUE = CMB_TARST:SCREEN-VALUE.   
   
END PROCEDURE.

PROCEDURE manad_UI :
   IF MONTH(TODAY) - 1 = 1 THEN DO:
      CMB_TMANAD:SCREEN-VALUE  = STRING("januari").     
   END.   
   ELSE IF MONTH(TODAY) - 1 = 02 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("februari").      
   END.  
   ELSE IF MONTH(TODAY) - 1 = 03 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("mars").      
   END.
   ELSE IF MONTH(TODAY) - 1 = 04 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("april").      
   END.  
   ELSE IF MONTH(TODAY) - 1 = 05 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("maj").      
   END.
   ELSE IF MONTH(TODAY) - 1 = 06 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("juni").      
   END.  
   ELSE IF MONTH(TODAY) - 1 = 07 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("juli").     
   END.
   ELSE IF MONTH(TODAY) - 1 = 08 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("augusti").   
   END.  
   ELSE IF MONTH(TODAY) - 1 = 09 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("september").      
   END.
   ELSE IF MONTH(TODAY) - 1 = 10 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("oktober").      
   END.  
   ELSE IF MONTH(TODAY) - 1 = 11 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("november").      
   END.
   ELSE IF MONTH(TODAY) - 1 = 0 THEN DO:
      CMB_TMANAD:SCREEN-VALUE = STRING("december").
      CMB_TAR:SCREEN-VALUE = STRING((YEAR(TODAY) - 1),"9999").
   END.        
END PROCEDURE.

PROCEDURE laddspers_UI :
   DEFINE VARIABLE numresult AS INTEGER NO-UNDO. 
   FIND FIRST sparaladdatemp WHERE NO-LOCK NO-ERROR.
   IF NOT AVAILABLE sparaladdatemp THEN DO:
      RUN hmtfavoriter_UI.
   END.   
   
   tthandle = TEMP-TABLE markpers:HANDLE.
   RUN laddabrw_UI IN brwproc[3]
      (INPUT TABLE-HANDLE tthandle, INPUT TABLE sparaladdatemp).  
   RUN getnumresult_UI IN brwproc[3] (OUTPUT numresult).    
   IF numresult NE 0 THEN markladdad = TRUE.        
END PROCEDURE.

PROCEDURE PlaceraKnapp_UI :
   Guru.GlobalaVariabler:StartRadForKnappar = BRW_PERS:ROW.
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_TID).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_LON).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_BER).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_TRA).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_OVER).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_VISA).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_ARB).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_LASUPPT).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_ARES).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_REG).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_TBRES).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_UTRES).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_KONT).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_GRAN).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_GOD).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_ANDGOD).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_LGOD).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_VECK).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_LONA).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_AND).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_PERIOD).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_FRAMAN).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_FRAPP).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_AVVIK).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_ANOV).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_SALDO).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_MANSAL).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_KONTROLL).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_SALMAN).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_VTIDV).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_SKR).
   Guru.Konstanter:PlaceraKnapparLodratt(FBTN_VTID).
   Guru.Konstanter:PlaceraKnapparLodratt(BTN_HAOF).
   Guru.Konstanter:PlaceraKnapparLodratt(BTN_AOF).   
   FILL-IN_EPERSONALKOD:ROW = FILL-IN_ETIDSGODK:ROW.
   Guru.Konstanter:LabelFlytt(FILL-IN_EPERSONALKOD). 
END PROCEDURE.

PROCEDURE menyrad_UI :
   IF MBTN_TILLAGG:IMAGE = "" THEN DO:
      MBTN_TILLAGG:LOAD-IMAGE("BILDER\xbtn_tillagg.gif") NO-ERROR.
      MBTN_TIDSEDEL:LOAD-IMAGE("BILDER\xbtn_tidsedel.gif") NO-ERROR.
      MBTN_TJANSTERESA:LOAD-IMAGE("BILDER\xbtn_resor.gif") NO-ERROR.
      MBTN_TIDADM:LOAD-IMAGE("BILDER\xbtn_tidadm.gif") NO-ERROR.
      MBTN_FLEXADM:LOAD-IMAGE("BILDER\xbtn_flexadm.gif") NO-ERROR.      
   END.
   ASSIGN
   MBTN_TILLAGG:HIDDEN  = TRUE
   MBTN_TIDSEDEL:HIDDEN  = TRUE   
   MBTN_TJANSTERESA:HIDDEN  = TRUE
   MBTN_STANSA:HIDDEN  = TRUE
   MBTN_TIDADM:HIDDEN  = TRUE
   MBTN_FLEXADM:HIDDEN  = TRUE.
   ASSIGN
   MBTN_TILLAGG:COLUMN = 1
   MBTN_TIDSEDEL:COLUMN = 1   
   MBTN_TJANSTERESA:COLUMN = 1
   MBTN_STANSA:COLUMN = 1
   MBTN_TIDADM:COLUMN = 1
   MBTN_FLEXADM:COLUMN = 1.   
   Guru.GlobalaVariabler:collefth = ?.   
   IF Guru.Konstanter:tidsekvar[6] = TRUE THEN DO:      
      status-ok = RAD_ALLTID:ADD-LAST("Tid och tillägg", 5).
      IF RAD_ALLTID:SCREEN-VALUE  = ? THEN RAD_ALLTID:SCREEN-VALUE = STRING(5).
      MBTN_TILLAGG:HIDDEN  = FALSE.
      IF Guru.GlobalaVariabler:collefth = ? THEN DO:
         Guru.GlobalaVariabler:colrighth = MBTN_TILLAGG:HANDLE.           
         Guru.GlobalaVariabler:collefth = Guru.GlobalaVariabler:colrighth.          
      END.
      ELSE DO:
         Guru.GlobalaVariabler:colrighth = MBTN_TIDSEDEL:HANDLE.           
         RUN buttcol_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).
      END.
      
   END.
   IF Guru.Konstanter:tidsekvar[5] = TRUE THEN DO:
      status-ok = RAD_ALLTID:ADD-LAST("Visa tidsedel", 9).
      IF RAD_ALLTID:SCREEN-VALUE = ? THEN RAD_ALLTID:SCREEN-VALUE = STRING(9).
      MBTN_TIDSEDEL:HIDDEN  = FALSE.
      IF Guru.GlobalaVariabler:collefth = ? THEN DO:
         Guru.GlobalaVariabler:colrighth = MBTN_TIDSEDEL:HANDLE.           
         Guru.GlobalaVariabler:collefth = Guru.GlobalaVariabler:colrighth.          
      END.
      ELSE DO:
         Guru.GlobalaVariabler:colrighth = MBTN_TIDSEDEL:HANDLE.           
         RUN buttcol_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).
      END.
   END.
   IF Guru.Konstanter:tidsekvar[4] = TRUE THEN DO:
      status-ok = RAD_ALLTID:ADD-LAST("Tjänsteresor", 4).  
      IF RAD_ALLTID:SCREEN-VALUE = ? THEN RAD_ALLTID:SCREEN-VALUE = STRING(4).
      MBTN_TJANSTERESA:HIDDEN  = FALSE.
      IF Guru.GlobalaVariabler:collefth = ? THEN DO:
         Guru.GlobalaVariabler:colrighth = MBTN_TJANSTERESA:HANDLE.           
         Guru.GlobalaVariabler:collefth = Guru.GlobalaVariabler:colrighth.          
      END.
      ELSE DO:
         Guru.GlobalaVariabler:colrighth = MBTN_TJANSTERESA:HANDLE.           
         RUN buttcol_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).
      END.
   END. 
   IF Guru.Konstanter:tidsekvar[9] = TRUE AND Guru.Konstanter:globforetag = "celpa" THEN DO:
       status-ok = RAD_ALLTID:ADD-LAST("Stansa upp.", 6).
       IF RAD_ALLTID:SCREEN-VALUE = ? THEN RAD_ALLTID:SCREEN-VALUE = STRING(6).
        MBTN_STANSA:LOAD-IMAGE("BILDER\btn_stansa.gif")  NO-ERROR.
        MBTN_STANSA:LOAD-IMAGE-UP("BILDER\btn_stansa.gif")  NO-ERROR.
        MBTN_STANSA:LOAD-IMAGE-DOWN("BILDER\btn_stansa_over.gif")  NO-ERROR.
       MBTN_STANSA:HIDDEN  = FALSE.
       Guru.GlobalaVariabler:colrighth = MBTN_STANSA:HANDLE.
       RUN buttcol_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).

   END.

   IF Guru.Konstanter:tidsekvar[7] = TRUE THEN DO:
      status-ok = RAD_ALLTID:ADD-LAST("Tidadm.", 7).
      IF RAD_ALLTID:SCREEN-VALUE = ? THEN RAD_ALLTID:SCREEN-VALUE = STRING(7).
      MBTN_TIDADM:HIDDEN  = FALSE.
      IF Guru.GlobalaVariabler:collefth = ? THEN DO:
         Guru.GlobalaVariabler:colrighth = MBTN_TIDADM:HANDLE.           
         Guru.GlobalaVariabler:collefth = Guru.GlobalaVariabler:colrighth.          
      END.
      ELSE DO:
         Guru.GlobalaVariabler:colrighth = MBTN_TIDADM:HANDLE.           
         RUN buttcol_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).
      END.
   END.
   IF Guru.Konstanter:tidsekvar[8] = TRUE THEN DO:
      status-ok = RAD_ALLTID:ADD-LAST("Flexadm.", 8).
      IF RAD_ALLTID:SCREEN-VALUE = ? THEN RAD_ALLTID:SCREEN-VALUE = STRING(8).
      MBTN_FLEXADM:HIDDEN  = FALSE.           
      IF Guru.GlobalaVariabler:collefth = ? THEN DO:
         Guru.GlobalaVariabler:colrighth = MBTN_FLEXADM:HANDLE.           
         Guru.GlobalaVariabler:collefth = Guru.GlobalaVariabler:colrighth.          
      END.
      ELSE DO:
         Guru.GlobalaVariabler:colrighth = MBTN_FLEXADM:HANDLE.           
         RUN buttcol_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).
      END.
   END.  
   IF Guru.Konstanter:tidsekvar[6] = TRUE THEN RAD_ALLTID:SCREEN-VALUE = STRING(5).
   IF RAD_ALLTID = ? THEN DO:
      musz = TRUE.
      MESSAGE "Du har ingen behörighet att köra detta program kontakta ansvarig."
      VIEW-AS ALERT-BOX.
      RETURN.
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(5) THEN DO:      
      APPLY "CHOOSE" TO MBTN_TILLAGG.           
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(9) THEN DO:
      APPLY "CHOOSE" TO MBTN_TIDSEDEL.                 
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(4) THEN DO:
      APPLY "CHOOSE" TO MBTN_TJANSTERESA.                 
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(6) THEN DO: 
       APPLY "CHOOSE" TO MBTN_STANSA.               
    END.                                            

   IF RAD_ALLTID:SCREEN-VALUE = STRING(7) THEN DO:
      APPLY "CHOOSE" TO MBTN_TIDADM.                 
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(8) THEN DO:
      APPLY "CHOOSE" TO MBTN_FLEXADM.                 
   END.        
   RUN radallatid_UI.

END PROCEDURE.
PROCEDURE goma2_UI :
   ASSIGN
   /*FLEX*/
   BTN_FDA:HIDDEN  = TRUE 
   BTN_NDA:HIDDEN  = TRUE 
   FILL-IN_DATUM:HIDDEN  = TRUE
   FBTN_AND:HIDDEN  = TRUE  
   FBTN_PERIOD:HIDDEN  = TRUE
   FBTN_FRAPP:HIDDEN  = TRUE
   FBTN_FRAMAN:HIDDEN  = TRUE
   FBTN_AVVIK:HIDDEN  = TRUE
   FBTN_ANOV:HIDDEN  = TRUE  
   FBTN_SALDO:HIDDEN  = TRUE
   FBTN_MANSAL:HIDDEN  = TRUE
   FBTN_KONTROLL:HIDDEN  = TRUE
   FBTN_FLKORN:HIDDEN  = TRUE
   FBTN_SALMAN:HIDDEN  = TRUE
   /*FLEX*/
   FBTN_KONT:HIDDEN  = TRUE
   FBTN_GRAN:HIDDEN  = TRUE
   FBTN_GOD:HIDDEN  = TRUE
   FBTN_ANDGOD:HIDDEN  = TRUE
   FBTN_LGOD:HIDDEN  = TRUE
   FBTN_VECK:HIDDEN  = TRUE
   FBTN_LONA:HIDDEN  = TRUE
   /*ÄNDRING TJRES MM*/
   FBTN_ARES:HIDDEN  = TRUE
   FBTN_UTRES:HIDDEN  = TRUE 
   FBTN_BER:HIDDEN  = TRUE 
   FBTN_LON:HIDDEN  = TRUE 
   FBTN_OVER:HIDDEN  = TRUE 
   FBTN_REG:HIDDEN  = TRUE 
   FBTN_TBRES:HIDDEN  = TRUE 
   FBTN_TID:HIDDEN  = TRUE 
   FBTN_TRA:HIDDEN  = TRUE 
   FBTN_VISA:HIDDEN  = TRUE 
   FBTN_VTID:HIDDEN  = TRUE.  
   FBTN_ARB:HIDDEN  = TRUE.
   FBTN_LASUPPT:HIDDEN  = TRUE.  
END PROCEDURE.
 
PROCEDURE goma3_UI :
   ASSIGN
   RAD_TIDSVAL:HIDDEN  = TRUE
   FBTN_SKR:HIDDEN  = TRUE
   FBTN_VTIDV:HIDDEN  = TRUE   
   CMB_TAR:HIDDEN  = TRUE 
   CMB_TARSL:HIDDEN  = TRUE 
   CMB_TARST:HIDDEN  = TRUE 
   CMB_TMANAD:HIDDEN  = TRUE 
   CMB_TMANADSL:HIDDEN  = TRUE 
   CMB_TMANADST:HIDDEN  = TRUE 
   FILL-IN-TDAG:HIDDEN  = TRUE 
   FILL-IN-TDAG-2:HIDDEN  = TRUE 
   FILL-IN-TDATUM:HIDDEN  = TRUE 
   FILL-IN-TDATUM-2:HIDDEN  = TRUE 
   TOG_MAN:HIDDEN  = TRUE.
END PROCEDURE.

PROCEDURE goma_UI :
   ASSIGN
   BTN_ALLBACK:HIDDEN  = TRUE 
   BTN_ALLOVER:HIDDEN  = TRUE 
   BTN_BACK:HIDDEN  = TRUE 
   BTN_VBACK:HIDDEN  = TRUE 
   BTN_VOVER:HIDDEN  = TRUE 
   BTN_VVOVER:HIDDEN  = TRUE
   BTN_PALLBACK:HIDDEN  = TRUE 
   BTN_PALLOVER:HIDDEN  = TRUE 
   BTN_PBACK:HIDDEN  = TRUE 
   BTN_PVVOVER:HIDDEN  = TRUE
   BRW_ANSV:HIDDEN  = TRUE 
   BRW_GODK:HIDDEN  = TRUE 
   BRW_PERS:HIDDEN  = TRUE 
   BRW_MARK:HIDDEN  = TRUE 
   BRW_AVD:HIDDEN  = TRUE 
   BRW_OMR:HIDDEN  = TRUE 
   BRW_VAVD:HIDDEN  = TRUE 
   BRW_VOMR:HIDDEN  = TRUE         
   CMB_OMR:HIDDEN = TRUE 
   FILL-IN-VP:HIDDEN = TRUE
   FILL-IN-SOKPA:HIDDEN = TRUE
   FILL-IN_SEFTERNAMN:HIDDEN = TRUE
   FILL-IN_SFORNAMN:HIDDEN = TRUE 
   FILL-IN_SPERSONALKOD:HIDDEN = TRUE 
   FILL-IN-HAMTA:HIDDEN = TRUE
   FILL-IN_EPERSONALKOD:HIDDEN = TRUE
   FILL-IN_ETIDSGODK:HIDDEN = TRUE   
   RECT-H:HIDDEN = TRUE 
   RECT-S:HIDDEN = TRUE.   
END PROCEDURE.
PROCEDURE radallval_UI :
   RUN goma_UI.   
   BTN_HAOF:HIDDEN = TRUE.
   BTN_AOF:HIDDEN = TRUE.
   FBTN_LASUPPT:HIDDEN = TRUE.   
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(1) THEN DO:
      IF markladdad = FALSE THEN DO:
         EMPTY TEMP-TABLE markpers NO-ERROR.          
      END.      
      ASSIGN
      BTN_PALLBACK:HIDDEN  = FALSE 
      BTN_PALLOVER:HIDDEN  = FALSE 
      BTN_PBACK:HIDDEN  = FALSE 
      BTN_PVVOVER:HIDDEN  = FALSE
      BRW_MARK:HIDDEN = FALSE
      BRW_ANSV:HIDDEN = FALSE.    
      RUN refreshbrw_UI IN brwproc[3].
   END.
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(2) THEN DO:  
      ASSIGN
      BTN_ALLBACK:HIDDEN  = FALSE 
      BTN_ALLOVER:HIDDEN  = FALSE 
      BTN_BACK:HIDDEN  = FALSE 
      BTN_VBACK:HIDDEN  = FALSE 
      BTN_VOVER:HIDDEN  = FALSE 
      BTN_VVOVER:HIDDEN  = FALSE
      BRW_AVD:HIDDEN  = FALSE 
      BRW_OMR:HIDDEN  = FALSE 
      BRW_VAVD:HIDDEN  = FALSE 
      BRW_VOMR:HIDDEN  = FALSE.                  
   END.        
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(3) THEN DO:
   END. 
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(4) THEN DO:      
      BRW_PERS:HIDDEN = FALSE.
      IF markladdad = FALSE THEN DO:
         EMPTY TEMP-TABLE markpers NO-ERROR.          
      END.      
      ASSIGN
      FILL-IN-VP:HIDDEN = FALSE 
      CMB_OMR:HIDDEN = FALSE
      FILL-IN-SOKPA:HIDDEN = FALSE
      FILL-IN_SEFTERNAMN:HIDDEN = FALSE 
      FILL-IN_SFORNAMN:HIDDEN = FALSE 
      FILL-IN_SPERSONALKOD:HIDDEN = FALSE 
      FILL-IN_SPERSONALKOD:HIDDEN = FALSE 
      FILL-IN-HAMTA:HIDDEN = FALSE
      FILL-IN_EPERSONALKOD:HIDDEN = FALSE
      FILL-IN_ETIDSGODK:HIDDEN = FALSE 
      RECT-H:HIDDEN = FALSE
      RECT-S:HIDDEN = FALSE   
      BTN_PALLBACK:HIDDEN  = FALSE 
      BTN_PALLOVER:HIDDEN  = FALSE 
      BTN_PBACK:HIDDEN  = FALSE 
      BTN_PVVOVER:HIDDEN  = FALSE
      BRW_PERS:HIDDEN = FALSE
      BRW_MARK:HIDDEN = FALSE
      FILL-IN-HAMTA:SCREEN-VALUE = "Hämta person:"
      FILL-IN-SOKPA:SCREEN-VALUE = "Sök på:".
      RUN refreshbrw_UI IN brwproc[3].
      BTN_HAOF:HIDDEN = FALSE.
      BTN_AOF:HIDDEN = FALSE.
      FBTN_LASUPPT:HIDDEN = FALSE.
    END.                 
   IF RAD_ALLVAL:SCREEN-VALUE = STRING(6) THEN DO:            
      IF markladdad = FALSE THEN DO:
         EMPTY TEMP-TABLE markpers NO-ERROR.          
      END.
      ASSIGN
      BTN_PALLBACK:HIDDEN  = FALSE 
      BTN_PALLOVER:HIDDEN  = FALSE 
      BTN_PBACK:HIDDEN  = FALSE 
      BTN_PVVOVER:HIDDEN  = FALSE
      BRW_MARK:HIDDEN = FALSE    
      BRW_GODK:HIDDEN = FALSE.        
      RUN refreshbrw_UI IN brwproc[3].
   END.
   RUN brwopen_UI.  
END PROCEDURE.
PROCEDURE radallatid_UI :

   RUN goma2_UI.
   RUN goma3_UI. 
   IF RAD_ALLTID:SCREEN-VALUE = STRING(5) THEN DO:
      xhop = "TIDA".  
      Guru.GlobalaVariabler:collefth = ?. 
      IF Guru.Konstanter:tidasekvar[1] = TRUE THEN DO:
         FBTN_TID:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_TID:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_TID:HIDDEN = TRUE.
      IF Guru.Konstanter:tidasekvar[2] = TRUE THEN DO:
         FBTN_LON:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_LON:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_LON:HIDDEN = TRUE.
      IF Guru.Konstanter:tidasekvar[3] = TRUE THEN DO:
         FBTN_BER:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_BER:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_BER:HIDDEN = TRUE.
      IF Guru.Konstanter:tidasekvar[4] = TRUE THEN DO:
         FBTN_TRA:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_TRA:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).            
      END.
      ELSE FBTN_TRA:HIDDEN = TRUE.
      IF Guru.Konstanter:tidasekvar[5] = TRUE THEN DO:
         FBTN_OVER:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_OVER:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_OVER:HIDDEN = TRUE.
      IF Guru.Konstanter:tidrsekvar[2] = TRUE THEN DO:
         FBTN_VISA:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_VISA:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_VISA:HIDDEN = TRUE.
      IF Guru.Konstanter:persekvar[7] = TRUE THEN DO:
         FBTN_ARB:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_ARB:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_ARB:HIDDEN = TRUE.
      IF Guru.Konstanter:tidasekvar[1] = TRUE THEN DO:
         FBTN_LASUPPT:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_LASUPPT:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_LASUPPT:HIDDEN = TRUE.      
      BTN_HAOF:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = BTN_HAOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).      
      Guru.GlobalaVariabler:colrighth = BTN_AOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
      IF RAD_ALLVAL:SCREEN-VALUE = STRING(4) THEN DO:      
         BTN_HAOF:HIDDEN = FALSE.
         BTN_AOF:HIDDEN = FALSE.
      END.
      ELSE DO:
         BTN_AOF:HIDDEN = TRUE.
         BTN_HAOF:HIDDEN = TRUE.
      END.
   END.        
   IF RAD_ALLTID:SCREEN-VALUE = STRING(4) THEN DO:
      Guru.GlobalaVariabler:collefth = ?.
      FBTN_ARES:HIDDEN = TRUE.
      IF Guru.Konstanter:tidtsekvar[1] = TRUE THEN DO: 
         FBTN_REG:LABEL = "Reg. tjänsteresa".         
         FBTN_REG:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_REG:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_REG:HIDDEN = TRUE.
      IF Guru.Konstanter:tidtsekvar[2] = TRUE THEN DO: 
         FBTN_TBRES:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_TBRES:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_TBRES:HIDDEN = TRUE.
      IF Guru.Konstanter:tidtsekvar[6] = TRUE THEN DO: 
         FBTN_UTRES:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_UTRES:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_UTRES:HIDDEN = TRUE.     
      BTN_HAOF:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = BTN_HAOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).      
      Guru.GlobalaVariabler:colrighth = BTN_AOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
      IF RAD_ALLVAL:SCREEN-VALUE = STRING(4) THEN DO:      
         BTN_HAOF:HIDDEN = FALSE.
         BTN_AOF:HIDDEN = FALSE.
      END.
      ELSE DO:
         BTN_AOF:HIDDEN = TRUE.
         BTN_HAOF:HIDDEN = TRUE.
      END.
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(7) THEN DO:                       
      Guru.GlobalaVariabler:collefth = ?.
      IF Guru.Konstanter:tadmsekvar[1] = TRUE THEN DO:
         FBTN_KONT:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_KONT:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_KONT:HIDDEN = TRUE. 
      IF Guru.Konstanter:tadmsekvar[2] = TRUE THEN DO:
         FBTN_GRAN:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_GRAN:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_GRAN:HIDDEN = TRUE.
      IF Guru.Konstanter:tadmsekvar[3] = TRUE THEN DO:
         FBTN_GOD:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_GOD:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_GOD:HIDDEN = TRUE.
      IF Guru.Konstanter:tadmsekvar[4] = TRUE THEN DO:
         FBTN_ANDGOD:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_ANDGOD:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_ANDGOD:HIDDEN = TRUE.
      IF Guru.Konstanter:tadmsekvar[5] = TRUE THEN DO:
         FBTN_LGOD:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_LGOD:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_LGOD:HIDDEN = TRUE.
      IF Guru.Konstanter:tadmsekvar[6] = TRUE THEN DO:
         FBTN_VECK:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_VECK:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_VECK:HIDDEN = TRUE.
      IF Guru.Konstanter:tadmsekvar[7] = TRUE THEN DO:
         FBTN_LONA:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_LONA:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      END.
      ELSE FBTN_LONA:HIDDEN = TRUE.
      BTN_HAOF:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = BTN_HAOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).      
      Guru.GlobalaVariabler:colrighth = BTN_AOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
      IF RAD_ALLVAL:SCREEN-VALUE = STRING(4) THEN DO:      
         BTN_HAOF:HIDDEN = FALSE.
         BTN_AOF:HIDDEN = FALSE.
      END.
      ELSE DO:
         BTN_AOF:HIDDEN = TRUE.
         BTN_HAOF:HIDDEN = TRUE.
      END.
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(8) THEN DO:   
      ASSIGN
      BTN_FDA:HIDDEN = FALSE 
      BTN_NDA:HIDDEN = FALSE 
      FILL-IN_DATUM:HIDDEN = FALSE. 
      Guru.GlobalaVariabler:collefth = ?.
      FBTN_AND:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = FBTN_AND:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      FBTN_PERIOD:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = FBTN_PERIOD:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      FBTN_FRAMAN:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = FBTN_FRAMAN:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      FBTN_FRAPP:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = FBTN_FRAPP:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      FBTN_AVVIK:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = FBTN_AVVIK:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      FBTN_ANOV:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = FBTN_ANOV:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      FBTN_SALDO:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = FBTN_SALDO:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
      uppsal = FALSE.
      IF Guru.Konstanter:globforetag = "SUND"  THEN DO:              
         /*KATHARINA WIKSTRÖM  JARMO KLINT*/         
         IF Guru.Konstanter:globniv = 15  OR Guru.Konstanter:globniv = 17  OR Guru.Konstanter:globniv = 0 THEN uppsal = TRUE.
      END.
      IF  Guru.Konstanter:globforetag = "SNAT"  THEN DO:              
         /*VICTORIA ROSENGREN HANS FORMAN*/         
         IF Guru.Konstanter:globniv = 15  OR Guru.Konstanter:globniv = 17 OR Guru.Konstanter:globniv = 38  OR Guru.Konstanter:globniv = 0 THEN uppsal = TRUE.
      END.
      IF  Guru.Konstanter:globforetag = "MISV" THEN DO:              
         /*mittsverige lotta ulrika  Maria*/         
         IF Guru.Konstanter:globniv = 1 OR Guru.Konstanter:globniv = 0 THEN uppsal = TRUE.      
      END.  
      IF uppsal = TRUE THEN DO:
         FBTN_MANSAL:HIDDEN = FALSE.
         Guru.GlobalaVariabler:colrighth = FBTN_MANSAL:HANDLE.           
         RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).
      END.     
      FBTN_KONTROLL:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = FBTN_KONTROLL:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).         
      FBTN_SALMAN:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = FBTN_SALMAN:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
      IF Guru.Konstanter:globforetag = "ESAN" OR Guru.Konstanter:globforetag = "ESMA" OR Guru.Konstanter:globforetag = "ETA"OR 
         Guru.Konstanter:globforetag = "CELPA" THEN DO:
         ASSIGN 
         FBTN_AND:HIDDEN = TRUE
         FBTN_PERIOD:HIDDEN = TRUE
         FBTN_FRAPP:HIDDEN = TRUE
         FBTN_FRAMAN:HIDDEN = TRUE
         FBTN_AVVIK:HIDDEN = TRUE
         FBTN_ANOV:HIDDEN = TRUE
         FBTN_SALDO:HIDDEN = TRUE
         FBTN_KONTROLL:HIDDEN = TRUE
         FBTN_FLKORN:HIDDEN = TRUE
         FBTN_SALMAN:HIDDEN = TRUE.
      END.   
      IF Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "LULE"  THEN DO:
         ASSIGN 
         FBTN_AND:HIDDEN = TRUE
         FBTN_PERIOD:HIDDEN = TRUE
         FBTN_FRAPP:HIDDEN = TRUE
         FBTN_FRAMAN:HIDDEN = TRUE
         FBTN_AVVIK:HIDDEN = TRUE
         FBTN_ANOV:HIDDEN = TRUE
         FBTN_FLKORN:HIDDEN = TRUE
         FBTN_SALMAN:HIDDEN = TRUE.
      END.   
      IF Guru.Konstanter:globforetag = "ELPA" THEN ASSIGN FBTN_SALMAN:HIDDEN = FALSE.
      ELSE ASSIGN FBTN_SALMAN:HIDDEN = TRUE. 
      BTN_HAOF:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = BTN_HAOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).      
      Guru.GlobalaVariabler:colrighth = BTN_AOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
      IF RAD_ALLVAL:SCREEN-VALUE = STRING(4) THEN DO:      
         BTN_HAOF:HIDDEN = FALSE.
         BTN_AOF:HIDDEN = FALSE.
      END.
      ELSE DO:
         BTN_AOF:HIDDEN = TRUE.
         BTN_HAOF:HIDDEN = TRUE.
      END.
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(9) THEN DO:
     Guru.GlobalaVariabler:collefth = ?.
     FBTN_VTIDV:HIDDEN = FALSE.
     Guru.GlobalaVariabler:colrighth = FBTN_VTIDV:HANDLE.           
     RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).   
     FBTN_SKR:HIDDEN = FALSE.
     Guru.GlobalaVariabler:colrighth = FBTN_SKR:HANDLE.           
     RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).         
     FBTN_VTID:HIDDEN = TRUE.
     BTN_HAOF:HIDDEN = FALSE.
      Guru.GlobalaVariabler:colrighth = BTN_HAOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).      
      Guru.GlobalaVariabler:colrighth = BTN_AOF:HANDLE.           
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
      IF RAD_ALLVAL:SCREEN-VALUE = STRING(4) THEN DO:      
         BTN_HAOF:HIDDEN = FALSE.
         BTN_AOF:HIDDEN = FALSE.
      END.
      ELSE DO:
         BTN_AOF:HIDDEN = TRUE.
         BTN_HAOF:HIDDEN = TRUE.
      END.
      APPLY "CHOOSE" TO FBTN_VTID.
     
   END.
   IF RAD_ALLTID:SCREEN-VALUE = STRING(8) OR RAD_ALLTID:SCREEN-VALUE = STRING(9) THEN DO:
      ASSIGN
      CMB_MANAD:HIDDEN = TRUE 
      CMB_AR:HIDDEN = TRUE.
   END.
   ELSE DO:
      ASSIGN
      CMB_MANAD:HIDDEN = FALSE 
      CMB_AR:HIDDEN = FALSE.
   END.   
   RAD_ALLTID:HIDDEN  = TRUE.    
END PROCEDURE.  


PROCEDURE sek_UI :
 
/* ALLT ÄR REDAN HÄMTAT VID INLOGGNING.
   {TIDSEK2.I}
   */
END PROCEDURE.

 PROCEDURE borthand_UI :
   marktemph:EMPTY-TEMP-TABLE() NO-ERROR.    
   IF VALID-HANDLE(marktemph) THEN   DELETE OBJECT marktemph NO-ERROR.
   marktemph = ?.
   vavdelemph:EMPTY-TEMP-TABLE() NO-ERROR.    
   IF VALID-HANDLE(vavdelemph) THEN   DELETE OBJECT vavdelemph NO-ERROR.
   vavdelemph = ?.
   avdelemph:EMPTY-TEMP-TABLE() NO-ERROR.    
   IF VALID-HANDLE(avdelemph) THEN   DELETE OBJECT avdelemph NO-ERROR.
   avdelemph = ?.
   {BORTBRWPROC.I}   
   IF VALID-HANDLE(nyttaoapph) THEN DO:
      RUN borthandle_UI IN nyttaoapph NO-ERROR.
      DELETE PROCEDURE nyttaoapph.
      nyttaoapph = ?.
   END.      
   IF VALID-HANDLE(persapph) THEN DELETE PROCEDURE persapph NO-ERROR.      
END PROCEDURE.  
