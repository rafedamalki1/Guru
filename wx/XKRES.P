DEFINE TEMP-TABLE persres 
   FIELD PERSONALKOD LIKE TIDREGITAB.PERSONALKOD
   FIELD tidres AS DECIMAL   
   FIELD sumares AS DECIMAL   
   FIELD sumdagres AS DECIMAL
   INDEX RES PERSONALKOD.   
DEFINE VARIABLE ressumar AS DECIMAL NO-UNDO.        
DEFINE VARIABLE ressumdag AS DECIMAL NO-UNDO. 
DEFINE VARIABLE restidreg AS DECIMAL NO-UNDO.  
DEFINE VARIABLE resaonr LIKE tidregitab.AONR NO-UNDO.   
DEFINE QUERY tq FOR TIDREGITAB.
DEFINE QUERY saq FOR SUMTID.    
DEFINE QUERY sdq FOR SUMTIDDAG.                   
UPDATE resaonr WITH FRAME CC7.                           
OPEN QUERY tq FOR EACH TIDREGITAB WHERE TIDREGITAB.AONR = resaonr AND 
TIDREGITAB.DELNR = 0 AND TIDREGITAB.PRISTYP = "RESTID..." USE-INDEX AONR NO-LOCK. 
GET FIRST tq.
DO WHILE AVAILABLE(TIDREGITAB): 
   IF YEAR(TIDREGITAB.DATUM) = 1997 THEN DO:
      IF TIDREGITAB.VECKOKORD NE "" THEN DO:
         FIND FIRST persres WHERE persres.PERSONALKOD = TIDREGITAB.PERSONALKOD 
         USE-INDEX RES NO-ERROR.
         IF NOT AVAILABLE persres THEN CREATE persres.
         ASSIGN
         persres.PERSONALKOD = TIDREGITAB.PERSONALKOD      
         persres.tidres = persres.tidres + DECIMAL(SUBSTRING(STRING(TIDREGITAB.TOTALT,"99.99"),1,2)) +
         (DECIMAL(SUBSTRING(STRING(TIDREGITAB.TOTALT,"99.99"),4,2)) / 60).
         restidreg = restidreg + DECIMAL(SUBSTRING(STRING(TIDREGITAB.TOTALT,"99.99"),1,2)) +
         (DECIMAL(SUBSTRING(STRING(TIDREGITAB.TOTALT,"99.99"),4,2)) / 60).
      END. 
   END.
   GET NEXT tq.
END. 
OPEN QUERY sdq FOR EACH SUMTIDDAG WHERE SUMTIDDAG.AONR = resaonr AND  
SUMTIDDAG.DELNR = 0 AND SUMTIDDAG.PRISTYP = "RESTID..." USE-INDEX BARAAONR NO-LOCK. 
GET FIRST sdq.
DO WHILE AVAILABLE(SUMTIDDAG):
   IF YEAR(SUMTIDDAG.DATUM) = 1997 THEN DO:
      IF SUMTIDDAG.VECKOKORD NE "" THEN DO: 
         FIND FIRST persres WHERE persres.PERSONALKOD = SUMTIDDAG.PERSONALKOD 
         USE-INDEX RES NO-ERROR.
         IF NOT AVAILABLE persres THEN CREATE persres.
         ASSIGN
         persres.PERSONALKOD = SUMTIDDAG.PERSONALKOD      
         persres.sumdagres = persres.sumdagres + SUMTIDDAG.TIMMAR.
         ressumdag = ressumdag + SUMTIDDAG.TIMMAR.
      END. 
   END.
   GET NEXT sdq.
END.       
OPEN QUERY saq FOR EACH SUMTID WHERE SUMTID.AONR = resaonr AND   
SUMTID.DELNR = 0 AND SUMTID.PRISTYP = "RESTID..." USE-INDEX AONR NO-LOCK. 
GET FIRST saq.
DO WHILE AVAILABLE(SUMTID):
   IF YEAR(SUMTID.DATUM) = 1997 THEN DO:
      IF SUMTID.VECKOKORD NE "" THEN DO:
         FIND FIRST persres WHERE persres.PERSONALKOD = SUMTID.PERSONALKOD 
         USE-INDEX RES NO-ERROR.
         IF NOT AVAILABLE persres THEN CREATE persres.
         ASSIGN
         persres.PERSONALKOD = SUMTID.PERSONALKOD      
         persres.sumares = persres.sumares + SUMTID.TIMMAR.
         ressumar = ressumar + SUMTID.TIMMAR.
      END. 
   END.
   GET NEXT saq.   
END.    
DISPLAY restidreg ressumdag ressumar WITH FRAME CC.
FOR EACH persres:
   display persres WITH FRAME C1 DOWN.
   DOWN 1 WITH FRAME C1.
END.   
   
   
