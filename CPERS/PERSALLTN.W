&ANALYZE-SUSPEND _VERSION-NUMBER AB_v10r12 GUI
&ANALYZE-RESUME
/* Connected Databases 
          temp-db          PROGRESS
*/
&Scoped-define WINDOW-NAME C-Win


/* Temp-Table and Buffer definitions                                    */



&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CUSTOM _DEFINITIONS C-Win 
/*------------------------------------------------------------------------

  File: 

  Description: 

  Input Parameters:
      <none>

  Output Parameters:
      <none>

  Author: 

  Created: 

------------------------------------------------------------------------*/
/*          This .W file was created with the Progress AppBuilder.      */
/*----------------------------------------------------------------------*/

/* Create an unnamed pool to store all the widgets created 
     by this procedure. This is a good default which assures
     that this procedure's triggers and internal procedures 
     will execute in this procedure's storage, and that proper
     cleanup will occur on deletion of the procedure. */

CREATE WIDGET-POOL.

/* ***************************  Definitions  ************************** */

/* Parameters Definitions ---                                           */
DEFINE INPUT PARAMETER varifran AS INTEGER NO-UNDO.
DEFINE INPUT-OUTPUT PARAMETER pkod AS CHARACTER NO-UNDO.
DEFINE VARIABLE restuserh AS HANDLE NO-UNDO.
/* Local Variable Definitions ---                                       */
/* varifran = 0 endast puppgifter
   varifran = 1 ny pers
   varifran = 2 ändra*/ 

{ALLDEF.I}
&Scoped-define NEW 
&Scoped-define SHARED SHARED
{REGVAR.I}
{GLOBVAR2DEL1.I}
{SOKDEF.I}
{PHMT.I}
{PHMTA.I}

{UPPGHMT.I} 
{OMRTEMPW.I}                 
DEFINE SHARED VARIABLE musz AS LOGICAL NO-UNDO.
DEFINE VARIABLE status-ok AS LOGICAL NO-UNDO.
DEFINE VARIABLE lopkollk AS LOGICAL EXTENT 10 NO-UNDO.
DEFINE VARIABLE FILL-IN-FAVTAL AS CHARACTER NO-UNDO.
DEFINE VARIABLE persnr AS INTEGER EXTENT 10 FORMAT "99" NO-UNDO.
DEFINE VARIABLE varsechema AS INTEGER NO-UNDO.
DEFINE VARIABLE tal1 AS INTEGER NO-UNDO.
DEFINE VARIABLE tal2 AS INTEGER NO-UNDO.
DEFINE VARIABLE ksiffran AS INTEGER NO-UNDO.
DEFINE VARIABLE ansvgamla AS CHARACTER NO-UNDO.
DEFINE VARIABLE tidggamla AS CHARACTER NO-UNDO.
DEFINE VARIABLE avkfaktor AS DECIMAL NO-UNDO.
DEFINE VARIABLE sefaktor AS DECIMAL NO-UNDO.
DEFINE VARIABLE asfaktapph AS HANDLE NO-UNDO.                     /**/
DEFINE VARIABLE dispens AS LOGICAL NO-UNDO.
DEFINE VARIABLE dmandatum AS DATE  NO-UNDO.
DEFINE VARIABLE dmangodk AS CHARACTER NO-UNDO.
DEFINE VARIABLE dardatum AS DATE  NO-UNDO.
DEFINE VARIABLE dargodk AS CHARACTER NO-UNDO.
DEFINE VARIABLE d48datum AS DATE  NO-UNDO.
DEFINE VARIABLE d48godk AS CHARACTER NO-UNDO.
DEFINE VARIABLE a50datum AS DATE  NO-UNDO.
DEFINE VARIABLE a50godk AS CHARACTER NO-UNDO.   
DEFINE VARIABLE a50tim AS INTEGER NO-UNDO.
DEFINE VARIABLE dispensm AS LOGICAL NO-UNDO.
DEFINE VARIABLE dispens48 AS LOGICAL NO-UNDO.
DEFINE VARIABLE lakdispens AS LOGICAL NO-UNDO.
DEFINE VARIABLE lonvaxatk AS LOGICAL NO-UNDO.
DEFINE VARIABLE avarfor AS INTEGER NO-UNDO.
DEFINE VARIABLE spafr AS LOGICAL NO-UNDO.

DEFINE VARIABLE ftro AS LOGICAL NO-UNDO.
DEFINE VARIABLE tillit AS LOGICAL NO-UNDO.
DEFINE VARIABLE foremaxarbkort AS DECIMAL NO-UNDO.
DEFINE VARIABLE spomr AS CHARACTER NO-UNDO.
DEFINE VARIABLE judbyt AS LOGICAL NO-UNDO.
DEFINE VARIABLE finnstid AS LOGICAL NO-UNDO.
DEFINE VARIABLE eorgnr AS CHARACTER NO-UNDO.
DEFINE VARIABLE eforetag AS CHARACTER NO-UNDO.
DEFINE VARIABLE plfanns AS LOGICAL NO-UNDO.

DEFINE VARIABLE forstdat AS DATE  NO-UNDO.
DEFINE VARIABLE sistdat AS DATE  NO-UNDO.
DEFINE VARIABLE flst AS DATE  NO-UNDO.
DEFINE VARIABLE flsl AS DATE  NO-UNDO.
DEFINE VARIABLE ovgrans AS INTEGER NO-UNDO.
DEFINE VARIABLE ater50 AS LOGICAL NO-UNDO.
DEFINE VARIABLE sealltid AS LOGICAL NO-UNDO.
DEFINE VARIABLE sedatum AS DATE  NO-UNDO.
DEFINE VARIABLE seanv AS CHARACTER NO-UNDO.
DEFINE VARIABLE nofall AS LOGICAL NO-UNDO.
DEFINE VARIABLE nodatum AS DATE NO-UNDO.
DEFINE VARIABLE nogodk AS CHARACTER NO-UNDO.  

DEFINE TEMP-TABLE valperskolltemp NO-UNDO LIKE valperstemp.
 DEFINE TEMP-TABLE rgrtemp NO-UNDO
   FIELD RGR AS CHARACTER
   FIELD ORDNING AS INTEGER
   INDEX ORDNING ORDNING.
DEFINE TEMP-TABLE persextra NO-UNDO
   FIELD PERSONALKOD AS CHARACTER
   FIELD FORNAMN AS CHARACTER
   FIELD EFTERNAMN AS CHARACTER
   INDEX PKOD PERSONALKOD. 
   
 DEFINE TEMP-TABLE epersextra NO-UNDO LIKE persextra.
 DEFINE TEMP-TABLE bortpersextra NO-UNDO LIKE persextra.    


/* Local Variable Definitions ---                                       */

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-PREPROCESSOR-BLOCK 

/* ********************  Preprocessor Definitions  ******************** */

&Scoped-define PROCEDURE-TYPE Window
&Scoped-define DB-AWARE no

/* Name of designated FRAME-NAME and/or first browse and/or first query */
&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define BROWSE-NAME BRW_GODK

/* Internal Tables (found by Frame, Query & Browse Queries)             */
&Scoped-define INTERNAL-TABLES godkannartemp persextra

/* Definitions for BROWSE BRW_GODK                                      */
&Scoped-define FIELDS-IN-QUERY-BRW_GODK godkannartemp.PERSONALKOD ~
godkannartemp.FORNAMN godkannartemp.EFTERNAMN 
&Scoped-define ENABLED-FIELDS-IN-QUERY-BRW_GODK godkannartemp.PERSONALKOD 
&Scoped-define ENABLED-TABLES-IN-QUERY-BRW_GODK godkannartemp
&Scoped-define FIRST-ENABLED-TABLE-IN-QUERY-BRW_GODK godkannartemp
&Scoped-define QUERY-STRING-BRW_GODK FOR EACH godkannartemp NO-LOCK
&Scoped-define OPEN-QUERY-BRW_GODK OPEN QUERY BRW_GODK FOR EACH godkannartemp NO-LOCK.
&Scoped-define TABLES-IN-QUERY-BRW_GODK godkannartemp
&Scoped-define FIRST-TABLE-IN-QUERY-BRW_GODK godkannartemp


/* Definitions for BROWSE BRW_PERS                                      */
&Scoped-define FIELDS-IN-QUERY-BRW_PERS persextra.PERSONALKOD ~
persextra.FORNAMN persextra.EFTERNAMN 
&Scoped-define ENABLED-FIELDS-IN-QUERY-BRW_PERS 
&Scoped-define QUERY-STRING-BRW_PERS FOR EACH persextra NO-LOCK INDEXED-REPOSITION
&Scoped-define OPEN-QUERY-BRW_PERS OPEN QUERY BRW_PERS FOR EACH persextra NO-LOCK INDEXED-REPOSITION.
&Scoped-define TABLES-IN-QUERY-BRW_PERS persextra
&Scoped-define FIRST-TABLE-IN-QUERY-BRW_PERS persextra


/* Definitions for FRAME FRAME-TIDSKRIVNING                             */

/* Standard List Definitions                                            */
&Scoped-Define ENABLED-OBJECTS FILL-IN_PERSONALKOD FILL-IN_ANSTNR ~
FILL-IN_PERSONNUMMER FILL-IN_FORNAMN FILL-IN_EFTERNAMN CMB_OMR RAD_PERS ~
BTN_OK Btn_AVB 
&Scoped-Define DISPLAYED-OBJECTS FILL-IN_PERSONALKOD FILL-IN_ANSTNR ~
FILL-IN_PERSONNUMMER FILL-IN_FORNAMN FILL-IN_EFTERNAMN CMB_OMR RAD_PERS 

/* Custom List Definitions                                              */
/* List-1,List-2,List-3,List-4,List-5,List-6                            */

/* _UIB-PREPROCESSOR-BLOCK-END */
&ANALYZE-RESUME


/* ************************  Function Prototypes ********************** */

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _FUNCTION-FORWARD tabortblanka C-Win 
FUNCTION tabortblanka RETURNS CHARACTER
  (  INPUT namnblanka AS CHARACTER )  FORWARD.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


/* ***********************  Control Definitions  ********************** */

/* Define the widget handle for the window                              */
DEFINE VAR C-Win AS WIDGET-HANDLE NO-UNDO.

/* Definitions of the field level widgets                               */
DEFINE BUTTON Btn_AVB AUTO-END-KEY 
     LABEL "Avbryt" 
     SIZE 14 BY 1
     BGCOLOR 8 .

DEFINE BUTTON BTN_OK AUTO-GO 
     LABEL "Ok":L 
     SIZE 14 BY 1.

DEFINE VARIABLE CMB_OMR AS CHARACTER FORMAT "X(16)" 
     LABEL "Område" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 26 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN_ANSTNR AS CHARACTER FORMAT "x(12)" 
     LABEL "Anställningsnr" 
     VIEW-AS FILL-IN 
     SIZE 10.5 BY 1.

DEFINE VARIABLE FILL-IN_EFTERNAMN AS CHARACTER FORMAT "x(256)" 
     LABEL "Efternamn" 
     VIEW-AS FILL-IN 
     SIZE 26 BY 1.

DEFINE VARIABLE FILL-IN_FORNAMN AS CHARACTER FORMAT "x(256)" 
     LABEL "Förnamn" 
     VIEW-AS FILL-IN 
     SIZE 26 BY 1.

DEFINE VARIABLE FILL-IN_OVERTIDUTTAG AS CHARACTER FORMAT "x(1)" INITIAL "K" 
     LABEL "Övertiduttag" 
     VIEW-AS FILL-IN 
     SIZE 2.5 BY 1.

DEFINE VARIABLE FILL-IN_PERSONALKOD AS CHARACTER FORMAT "x(256)" 
     LABEL "Enhet/Sign" 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1.

DEFINE VARIABLE FILL-IN_PERSONNUMMER AS CHARACTER FORMAT "999999-9999" INITIAL "0000000000" 
     LABEL "Personnummer" 
     VIEW-AS FILL-IN 
     SIZE 15 BY 1.

DEFINE VARIABLE RAD_PERS AS INTEGER 
     VIEW-AS RADIO-SET HORIZONTAL
     RADIO-BUTTONS 
          "Adress-tele", 1,
"Tidskrivning", 2,
"Avtal", 3,
"Arbetstider", 4
     SIZE 84 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN_BOXEN AS CHARACTER FORMAT "x(8)" 
     LABEL "Box" 
     VIEW-AS FILL-IN 
     SIZE 10 BY 1.

DEFINE VARIABLE FILL-IN_EPOST AS CHARACTER FORMAT "x(256)" 
     LABEL "E-post" 
     VIEW-AS FILL-IN 
     SIZE 25 BY 1.

DEFINE VARIABLE FILL-IN_GATUADRESS AS CHARACTER FORMAT "X(25)" 
     LABEL "Gatuadress" 
     VIEW-AS FILL-IN 
     SIZE 26 BY 1.

DEFINE VARIABLE FILL-IN_MOBILRADIO AS CHARACTER FORMAT "x(256)" 
     LABEL "Mobilradio" 
     VIEW-AS FILL-IN 
     SIZE 13 BY 1.

DEFINE VARIABLE FILL-IN_MOBILTEL AS CHARACTER FORMAT "x(256)" 
     LABEL "Mobiltel" 
     VIEW-AS FILL-IN 
     SIZE 13 BY 1.

DEFINE VARIABLE FILL-IN_PERSONSOK AS CHARACTER FORMAT "x(256)" 
     LABEL "Personsökare" 
     VIEW-AS FILL-IN 
     SIZE 13 BY 1.

DEFINE VARIABLE FILL-IN_POSTADRESS AS CHARACTER FORMAT "X(20)" 
     LABEL "Postadress" 
     VIEW-AS FILL-IN 
     SIZE 23 BY 1.

DEFINE VARIABLE FILL-IN_POSTNUMMER AS CHARACTER FORMAT "XXX XX" 
     LABEL "Postnummer" 
     VIEW-AS FILL-IN 
     SIZE 10 BY 1.

DEFINE VARIABLE FILL-IN_TELEFON AS CHARACTER FORMAT "x(256)" 
     LABEL "Telefon" 
     VIEW-AS FILL-IN 
     SIZE 13 BY 1.

DEFINE VARIABLE FILL-IN_TELEFON2 AS CHARACTER FORMAT "x(256)" 
     LABEL "Telefon2" 
     VIEW-AS FILL-IN 
     SIZE 13 BY 1.

DEFINE VARIABLE FILL-IN_TELEFONSEM AS CHARACTER FORMAT "x(256)" 
     LABEL "Semestertele" 
     VIEW-AS FILL-IN 
     SIZE 13 BY 1.

DEFINE VARIABLE CMB_VECKO AS INTEGER FORMAT ">99":U INITIAL 0 
     LABEL "Veckoschema" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     LIST-ITEMS "0" 
     DROP-DOWN-LIST
     SIZE 6.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BORJ1 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     LABEL "Börjar" 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BORJ2 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BORJ3 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BORJ4 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BORJ5 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BORJ6 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-BORJ7 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DSCH1 AS INTEGER FORMAT ">99":U INITIAL 0 
     LABEL "Dagschema" 
     VIEW-AS FILL-IN 
     SIZE 4.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DSCH2 AS INTEGER FORMAT ">99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 4.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DSCH3 AS INTEGER FORMAT ">99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 4.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DSCH4 AS INTEGER FORMAT ">99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DSCH5 AS INTEGER FORMAT ">99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 4.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DSCH6 AS INTEGER FORMAT ">99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 4.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DSCH7 AS INTEGER FORMAT ">99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 4.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-FRE AS CHARACTER FORMAT "X(8)":U 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-LOR AS CHARACTER FORMAT "X(8)":U 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-MAN AS CHARACTER FORMAT "X(8)":U 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-ONS AS CHARACTER FORMAT "X(8)":U 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SLU1 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     LABEL "Slutar" 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SLU2 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SLU3 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SLU4 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SLU5 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SLU6 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SLU7 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SON AS CHARACTER FORMAT "X(8)":U 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TIM1 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     LABEL "Tim/Dag" 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TIM2 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TIM3 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TIM4 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TIM5 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TIM6 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TIM7 AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TIS AS CHARACTER FORMAT "X(8)":U 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TOR AS CHARACTER FORMAT "X(8)":U 
     VIEW-AS FILL-IN 
     SIZE 8 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TOT AS CHARACTER FORMAT "X(8)":U 
     VIEW-AS FILL-IN 
     SIZE 9 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-TOTV AS DECIMAL FORMAT "99.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1 NO-UNDO.

DEFINE VARIABLE CMB_ANST AS CHARACTER FORMAT "X(256)":U 
     LABEL "Anst.form" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 40.5 BY 1 NO-UNDO.

DEFINE VARIABLE CMB_BEF AS CHARACTER FORMAT "X(256)":U 
     LABEL "Befattning" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 25 BY 1 NO-UNDO.

DEFINE VARIABLE CMB_BEF2 AS CHARACTER FORMAT "X(256)":U 
     LABEL "Befattning" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 25 BY 1 NO-UNDO.

DEFINE VARIABLE CMB_BER AS CHARACTER FORMAT "X(256)":U 
     LABEL "Beredskapsalt." 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 40 BY 1 NO-UNDO.

DEFINE VARIABLE CMB_FAVTAL AS CHARACTER FORMAT "X(256)":U 
     LABEL "Flexavtal" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 25 BY 1 NO-UNDO.

DEFINE VARIABLE CMB_ORGCHEF AS CHARACTER FORMAT "X(256)":U 
     LABEL "Rörelsegren" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 25 BY 1 NO-UNDO.

DEFINE VARIABLE CMB_TRA AS CHARACTER FORMAT "X(256)":U 
     LABEL "Trakt.avtal" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     DROP-DOWN-LIST
     SIZE 25 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-AKFAKTOR AS DECIMAL FORMAT ">9.99":U INITIAL 1 
     LABEL "Kal.faktor" 
     VIEW-AS FILL-IN 
     SIZE 8 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-ATERFOR50 AS LOGICAL FORMAT "Ja/Nej":U INITIAL NO 
     LABEL "Återför 50 tim" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-ATERTIM AS INTEGER FORMAT ">9":U INITIAL 50 
     LABEL "Återför timmar" 
     VIEW-AS FILL-IN 
     SIZE 3.5 BY 1 TOOLTIP "Återför de timmar som tagits ut som kompledighet. Max 50 tim" NO-UNDO.

DEFINE VARIABLE FILL-IN-AVAFOR AS INTEGER FORMAT ">>9":U INITIAL 0 
     LABEL "Avvik ATK" 
     VIEW-AS FILL-IN 
     SIZE 8 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DISPELAK AS LOGICAL FORMAT "Ja/Nej":U INITIAL NO 
     LABEL "Disp.läk.besök" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DISPENS AS LOGICAL FORMAT "Ja/Nej":U INITIAL NO 
     LABEL "Tillåt > 350 tim/år ÖV" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DISPENS48 AS LOGICAL FORMAT "Ja/Nej":U INITIAL NO 
     LABEL "Tillåt > 48 tim/4v ÖV" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-DISPENSM AS LOGICAL FORMAT "Ja/Nej":U INITIAL NO 
     LABEL "Tillåt > 50 tim/mån ÖV" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-FLEXSLUT AS DATE FORMAT "9999/99/99":U 
     LABEL "Flex slutdat" 
     VIEW-AS FILL-IN 
     SIZE 12 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-FLEXSTART AS DATE FORMAT "9999/99/99":U 
     LABEL "Flex startdat" 
     VIEW-AS FILL-IN 
     SIZE 12 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-NODF AS LOGICAL FORMAT "Ja/Nej":U INITIAL NO 
     LABEL "Tillåt nödfallsövertid" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SFAKTOR AS DECIMAL FORMAT ">9.99":U INITIAL 1 
     LABEL "Sem.faktor" 
     VIEW-AS FILL-IN 
     SIZE 8 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SPARRFR AS LOGICAL FORMAT "Ja/Nej":U INITIAL NO 
     LABEL "Spärr Friskv" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN_AKTIV AS LOGICAL FORMAT "Aktiv/Inaktiv" INITIAL NO 
     LABEL "Tidskrivning" 
     VIEW-AS FILL-IN 
     SIZE 8 BY 1.

DEFINE VARIABLE FILL-IN_DELTID AS LOGICAL FORMAT "Ja/Nej" INITIAL NO 
     LABEL "Deltid" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1.

DEFINE VARIABLE FILL-IN_FLEXTID AS LOGICAL FORMAT "Ja/Nej" INITIAL NO 
     LABEL "Flextid" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN_FORTRO AS LOGICAL FORMAT "Ja/Nej" INITIAL NO 
     LABEL "Förtroendetid" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1.

DEFINE VARIABLE FILL-IN_LAGBAS AS LOGICAL FORMAT "Ja/Nej" INITIAL NO 
     LABEL "Lagbas" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1.

DEFINE VARIABLE FILL-IN_LONVATK AS LOGICAL FORMAT "Ja/Nej" INITIAL NO 
     LABEL "Löneväxla ATK" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1.

DEFINE VARIABLE FILL-IN_SEMFOR AS LOGICAL FORMAT "Ja/Nej" INITIAL NO 
     LABEL "Spärr ATK" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1.

DEFINE VARIABLE FILL-IN_TILLIT AS LOGICAL FORMAT "Ja/Nej" INITIAL NO 
     LABEL "Tillit" 
     VIEW-AS FILL-IN 
     SIZE 4 BY 1.

DEFINE BUTTON BTN_GPLAVREG 
     LABEL "Avregistrera GPL" 
     SIZE 28 BY 1.13.

DEFINE BUTTON BTN_GPLREG 
     LABEL "Registrera GPL" 
     SIZE 28 BY 1.13.

DEFINE VARIABLE FILL-IN-FORETAG AS CHARACTER FORMAT "X(256)":U 
     LABEL "Företag" 
     VIEW-AS FILL-IN 
     SIZE 28 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-ORGNR AS CHARACTER FORMAT "999999-9999" INITIAL "0000000000" 
     LABEL "Orgnr" 
     VIEW-AS FILL-IN 
     SIZE 14 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-PLREG AS CHARACTER FORMAT "X(256)":U INITIAL "Användaren är inte registrerad för GPL" 
      VIEW-AS TEXT 
     SIZE 40.75 BY .63 NO-UNDO.

DEFINE BUTTON BTN_BACK 
     IMAGE-UP FILE "BILDER\prev-u.bmp":U
     LABEL "" 
     SIZE 4 BY 1.21 TOOLTIP "Lägg upp tidsedelgodkännare".

DEFINE BUTTON BTN_OVER 
     IMAGE-UP FILE "BILDER\next-u":U NO-FOCUS FLAT-BUTTON
     LABEL "":L 
     SIZE 4 BY 1.21 TOOLTIP "Ta bort tidsedelgodkännare".

DEFINE VARIABLE CMB_OVERUT AS CHARACTER FORMAT "X(4)":U 
     LABEL "Övertiduttag" 
     VIEW-AS COMBO-BOX INNER-LINES 5
     LIST-ITEMS "Komp","Över","Flex","Ejöv" 
     DROP-DOWN-LIST
     SIZE 7.5 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-FTID AS DATE FORMAT "9999/99/99":U 
     LABEL "Första tidreg" 
     VIEW-AS FILL-IN 
     SIZE 12 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN-SEALLTID AS LOGICAL FORMAT "Ja/Nej":U INITIAL NO 
     LABEL "Uppföljning - se all personals tid" 
     VIEW-AS FILL-IN 
     SIZE 5 BY 1 TOOLTIP "Tex för projektledare som ej har tidbehörighet för personal" NO-UNDO.

DEFINE VARIABLE FILL-IN-STID AS DATE FORMAT "9999/99/99":U 
     LABEL "Senaste tidreg" 
     VIEW-AS FILL-IN 
     SIZE 12 BY 1 NO-UNDO.

DEFINE VARIABLE FILL-IN_TIDSGODK AS CHARACTER FORMAT "x(256)" 
     LABEL "Godkänner tid" 
     VIEW-AS FILL-IN 
     SIZE 7 BY 1.

/* Query definitions                                                    */
&ANALYZE-SUSPEND
DEFINE QUERY BRW_GODK FOR 
      godkannartemp SCROLLING.

DEFINE QUERY BRW_PERS FOR 
      persextra SCROLLING.
&ANALYZE-RESUME

/* Browse definitions                                                   */
DEFINE BROWSE BRW_GODK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _DISPLAY-FIELDS BRW_GODK C-Win _STRUCTURED
  QUERY BRW_GODK NO-LOCK DISPLAY
      godkannartemp.PERSONALKOD COLUMN-LABEL "Enhet/!Sign" FORMAT "x(6)":U
            WIDTH 7
      godkannartemp.FORNAMN COLUMN-LABEL "Förnamn" FORMAT "x(256)":U
            WIDTH 12
      godkannartemp.EFTERNAMN COLUMN-LABEL "Efternamn" FORMAT "x(256)":U
            WIDTH 22
  ENABLE
      godkannartemp.PERSONALKOD
/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME
    WITH NO-ROW-MARKERS NO-COLUMN-SCROLLING MULTIPLE SIZE 38.5 BY 11.75
         TITLE "Godkänner tidsedlar".

DEFINE BROWSE BRW_PERS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _DISPLAY-FIELDS BRW_PERS C-Win _STRUCTURED
  QUERY BRW_PERS NO-LOCK DISPLAY
      persextra.PERSONALKOD COLUMN-LABEL "Enhet/!Sign" FORMAT "x(5)":U
            WIDTH 7
      persextra.FORNAMN COLUMN-LABEL "Förnamn" FORMAT "x(256)":U
            WIDTH 15
      persextra.EFTERNAMN COLUMN-LABEL "Efternamn" FORMAT "x(256)":U
            WIDTH 10.13
/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME
    WITH NO-ROW-MARKERS NO-COLUMN-SCROLLING SIZE 36 BY 11.75
         TITLE "All aktiv personal".


/* ************************  Frame Definitions  *********************** */

DEFINE FRAME DEFAULT-FRAME
     FILL-IN_PERSONALKOD AT ROW 3.33 COL 12 COLON-ALIGNED WIDGET-ID 12
     FILL-IN_ANSTNR AT ROW 3.33 COL 49 COLON-ALIGNED WIDGET-ID 4
     FILL-IN_PERSONNUMMER AT ROW 3.33 COL 73.75 COLON-ALIGNED WIDGET-ID 14
     FILL-IN_FORNAMN AT ROW 4.96 COL 12 COLON-ALIGNED WIDGET-ID 8
     FILL-IN_EFTERNAMN AT ROW 4.96 COL 49 COLON-ALIGNED WIDGET-ID 6
     CMB_OMR AT ROW 6.58 COL 12 COLON-ALIGNED WIDGET-ID 2
     RAD_PERS AT ROW 8.08 COL 7.5 NO-LABEL WIDGET-ID 16
     FILL-IN_OVERTIDUTTAG AT ROW 20.5 COL 68 COLON-ALIGNED WIDGET-ID 10
     BTN_OK AT ROW 28.25 COL 87.25 WIDGET-ID 24
     Btn_AVB AT ROW 28.25 COL 101.75 WIDGET-ID 22
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 1
         SIZE 115.63 BY 28.29 WIDGET-ID 100.

DEFINE FRAME FRAME-AVTAL
     FILL-IN_AKTIV AT ROW 1.29 COL 15 COLON-ALIGNED WIDGET-ID 2
     CMB_BEF AT ROW 2.46 COL 15 COLON-ALIGNED WIDGET-ID 4
     CMB_ORGCHEF AT ROW 2.46 COL 62 COLON-ALIGNED WIDGET-ID 40
     CMB_ANST AT ROW 3.71 COL 15 COLON-ALIGNED WIDGET-ID 6
     CMB_TRA AT ROW 4.96 COL 15 COLON-ALIGNED WIDGET-ID 8
     CMB_BEF2 AT ROW 5.25 COL 61 COLON-ALIGNED WIDGET-ID 44
     CMB_BER AT ROW 6.21 COL 15 COLON-ALIGNED WIDGET-ID 10
     FILL-IN_DELTID AT ROW 7.5 COL 15 COLON-ALIGNED WIDGET-ID 12
     FILL-IN_FORTRO AT ROW 7.5 COL 35.5 COLON-ALIGNED WIDGET-ID 36
     FILL-IN_TILLIT AT ROW 7.5 COL 52.25 COLON-ALIGNED WIDGET-ID 58
     FILL-IN-FLEXSLUT AT ROW 8.5 COL 100 COLON-ALIGNED WIDGET-ID 48
     FILL-IN_FLEXTID AT ROW 8.54 COL 15 COLON-ALIGNED WIDGET-ID 14
     CMB_FAVTAL AT ROW 8.54 COL 31.13 COLON-ALIGNED WIDGET-ID 42
     FILL-IN-FLEXSTART AT ROW 8.54 COL 73.63 COLON-ALIGNED WIDGET-ID 46
     FILL-IN_SEMFOR AT ROW 9.58 COL 15 COLON-ALIGNED WIDGET-ID 16
     FILL-IN_LONVATK AT ROW 9.58 COL 35.5 COLON-ALIGNED WIDGET-ID 32
     FILL-IN-AVAFOR AT ROW 9.58 COL 53.38 COLON-ALIGNED WIDGET-ID 20
     FILL-IN-SPARRFR AT ROW 10.63 COL 15 COLON-ALIGNED WIDGET-ID 18
     FILL-IN-DISPELAK AT ROW 11.75 COL 15 COLON-ALIGNED WIDGET-ID 22
     FILL-IN_LAGBAS AT ROW 11.75 COL 53.38 COLON-ALIGNED WIDGET-ID 34
     FILL-IN-AKFAKTOR AT ROW 12.75 COL 89 COLON-ALIGNED WIDGET-ID 28
     FILL-IN-DISPENS AT ROW 12.88 COL 23.5 COLON-ALIGNED WIDGET-ID 24
     FILL-IN-ATERFOR50 AT ROW 12.88 COL 45.88 COLON-ALIGNED WIDGET-ID 50
     FILL-IN-ATERTIM AT ROW 12.88 COL 66.25 COLON-ALIGNED WIDGET-ID 52
     FILL-IN-SFAKTOR AT ROW 13.83 COL 89 COLON-ALIGNED WIDGET-ID 38
     FILL-IN-DISPENSM AT ROW 13.96 COL 23.5 COLON-ALIGNED WIDGET-ID 30
     FILL-IN-DISPENS48 AT ROW 15 COL 23.5 COLON-ALIGNED WIDGET-ID 26
     FILL-IN-NODF AT ROW 16.04 COL 23.5 COLON-ALIGNED WIDGET-ID 56
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 10.25
         SIZE 115.5 BY 17.75 WIDGET-ID 400.

DEFINE FRAME FRAME-TIDSKRIVNING
     BRW_GODK AT ROW 1.25 COL 29.38 WIDGET-ID 300
     BRW_PERS AT ROW 1.25 COL 76 WIDGET-ID 700
     BTN_OVER AT ROW 7.25 COL 69 WIDGET-ID 12
     FILL-IN_TIDSGODK AT ROW 2.5 COL 15 COLON-ALIGNED WIDGET-ID 2
     CMB_OVERUT AT ROW 3.75 COL 15 COLON-ALIGNED WIDGET-ID 4
     FILL-IN-FTID AT ROW 5 COL 15 COLON-ALIGNED WIDGET-ID 6
     BTN_BACK AT ROW 5.5 COL 69 WIDGET-ID 10
     FILL-IN-STID AT ROW 6.25 COL 15 COLON-ALIGNED WIDGET-ID 8
     FILL-IN-SEALLTID AT ROW 15.38 COL 35.38 COLON-ALIGNED WIDGET-ID 14
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 10.25
         SIZE 115.5 BY 17.75 WIDGET-ID 300.

DEFINE FRAME FRAME-PERSONALLIGGARE
     FILL-IN-ORGNR AT ROW 2.13 COL 9 COLON-ALIGNED WIDGET-ID 48
     FILL-IN-FORETAG AT ROW 2.13 COL 35.5 COLON-ALIGNED WIDGET-ID 46
     BTN_GPLREG AT ROW 4 COL 6.25 WIDGET-ID 50
     BTN_GPLAVREG AT ROW 5.75 COL 6.25 WIDGET-ID 52
     FILL-IN-PLREG AT ROW 4 COL 33.25 COLON-ALIGNED NO-LABEL WIDGET-ID 54
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 10.25
         SIZE 115.5 BY 17.75 WIDGET-ID 600.

DEFINE FRAME FRAME-ARBETSTIDER
     CMB_VECKO AT ROW 1.17 COL 40 COLON-ALIGNED WIDGET-ID 2
     FILL-IN-MAN AT ROW 2.29 COL 10.25 COLON-ALIGNED NO-LABEL WIDGET-ID 46
     FILL-IN-TIS AT ROW 2.29 COL 20.5 NO-LABEL WIDGET-ID 48
     FILL-IN-ONS AT ROW 2.29 COL 29 NO-LABEL WIDGET-ID 50
     FILL-IN-TOR AT ROW 2.29 COL 37.5 NO-LABEL WIDGET-ID 52
     FILL-IN-FRE AT ROW 2.29 COL 47.13 NO-LABEL WIDGET-ID 54
     FILL-IN-LOR AT ROW 2.29 COL 56 NO-LABEL WIDGET-ID 56
     FILL-IN-SON AT ROW 2.29 COL 62.88 COLON-ALIGNED NO-LABEL WIDGET-ID 58
     FILL-IN-TOT AT ROW 2.29 COL 74.13 COLON-ALIGNED NO-LABEL WIDGET-ID 74
     FILL-IN-DSCH1 AT ROW 3.5 COL 10.25 COLON-ALIGNED WIDGET-ID 60
     FILL-IN-DSCH2 AT ROW 3.5 COL 20.5 NO-LABEL WIDGET-ID 62
     FILL-IN-DSCH3 AT ROW 3.5 COL 29 NO-LABEL WIDGET-ID 64
     FILL-IN-DSCH4 AT ROW 3.5 COL 37.5 NO-LABEL WIDGET-ID 66
     FILL-IN-DSCH5 AT ROW 3.5 COL 47.13 NO-LABEL WIDGET-ID 68
     FILL-IN-DSCH6 AT ROW 3.5 COL 56 NO-LABEL WIDGET-ID 70
     FILL-IN-DSCH7 AT ROW 3.5 COL 62.88 COLON-ALIGNED NO-LABEL WIDGET-ID 72
     FILL-IN-TOTV AT ROW 3.5 COL 74 COLON-ALIGNED NO-LABEL WIDGET-ID 76
     FILL-IN-BORJ1 AT ROW 4.83 COL 10.25 COLON-ALIGNED WIDGET-ID 4
     FILL-IN-BORJ2 AT ROW 4.83 COL 18.5 COLON-ALIGNED NO-LABEL WIDGET-ID 6
     FILL-IN-BORJ3 AT ROW 4.83 COL 27 COLON-ALIGNED NO-LABEL WIDGET-ID 8
     FILL-IN-BORJ4 AT ROW 4.83 COL 35.5 COLON-ALIGNED NO-LABEL WIDGET-ID 10
     FILL-IN-BORJ5 AT ROW 4.83 COL 45.13 COLON-ALIGNED NO-LABEL WIDGET-ID 12
     FILL-IN-BORJ6 AT ROW 4.83 COL 54 COLON-ALIGNED NO-LABEL WIDGET-ID 14
     FILL-IN-BORJ7 AT ROW 4.83 COL 62.88 COLON-ALIGNED NO-LABEL WIDGET-ID 16
     FILL-IN-SLU1 AT ROW 6.33 COL 10.25 COLON-ALIGNED WIDGET-ID 18
     FILL-IN-SLU2 AT ROW 6.33 COL 18.5 COLON-ALIGNED NO-LABEL WIDGET-ID 20
     FILL-IN-SLU3 AT ROW 6.33 COL 27 COLON-ALIGNED NO-LABEL WIDGET-ID 22
     FILL-IN-SLU4 AT ROW 6.33 COL 35.5 COLON-ALIGNED NO-LABEL WIDGET-ID 24
     FILL-IN-SLU5 AT ROW 6.33 COL 45.13 COLON-ALIGNED NO-LABEL WIDGET-ID 26
     FILL-IN-SLU6 AT ROW 6.33 COL 54 COLON-ALIGNED NO-LABEL WIDGET-ID 28
     FILL-IN-SLU7 AT ROW 6.33 COL 62.88 COLON-ALIGNED NO-LABEL WIDGET-ID 30
     FILL-IN-TIM1 AT ROW 7.5 COL 10.25 COLON-ALIGNED WIDGET-ID 32
     FILL-IN-TIM2 AT ROW 7.5 COL 18.5 COLON-ALIGNED NO-LABEL WIDGET-ID 34
     FILL-IN-TIM3 AT ROW 7.5 COL 27 COLON-ALIGNED NO-LABEL WIDGET-ID 36
     FILL-IN-TIM4 AT ROW 7.5 COL 35.5 COLON-ALIGNED NO-LABEL WIDGET-ID 38
     FILL-IN-TIM5 AT ROW 7.5 COL 45.13 COLON-ALIGNED NO-LABEL WIDGET-ID 40
     FILL-IN-TIM6 AT ROW 7.5 COL 54 COLON-ALIGNED NO-LABEL WIDGET-ID 42
     FILL-IN-TIM7 AT ROW 7.5 COL 62.88 COLON-ALIGNED NO-LABEL WIDGET-ID 44
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 10.25
         SIZE 115.5 BY 17.75 WIDGET-ID 500.

DEFINE FRAME FRAME-ADRESS
     FILL-IN_GATUADRESS AT ROW 2.25 COL 13.5 COLON-ALIGNED WIDGET-ID 2
     FILL-IN_BOXEN AT ROW 3.58 COL 13.5 COLON-ALIGNED WIDGET-ID 6
     FILL-IN_POSTNUMMER AT ROW 4.92 COL 13.5 COLON-ALIGNED WIDGET-ID 4
     FILL-IN_POSTADRESS AT ROW 4.92 COL 55.25 COLON-ALIGNED WIDGET-ID 16
     FILL-IN_TELEFON AT ROW 6.25 COL 13.5 COLON-ALIGNED HELP
          "HEMTELE" WIDGET-ID 22
     FILL-IN_TELEFON2 AT ROW 6.25 COL 55.25 COLON-ALIGNED HELP
          "ARB.TELE" WIDGET-ID 20
     FILL-IN_MOBILTEL AT ROW 7.58 COL 13.5 COLON-ALIGNED WIDGET-ID 12
     FILL-IN_TELEFONSEM AT ROW 7.58 COL 55.25 COLON-ALIGNED WIDGET-ID 18
     FILL-IN_EPOST AT ROW 8.92 COL 13.5 COLON-ALIGNED WIDGET-ID 8
     FILL-IN_MOBILRADIO AT ROW 8.92 COL 55.25 COLON-ALIGNED WIDGET-ID 10
     FILL-IN_PERSONSOK AT ROW 10.25 COL 13.5 COLON-ALIGNED WIDGET-ID 14
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 10.25
         SIZE 115.5 BY 17.75 WIDGET-ID 200.


/* *********************** Procedure Settings ************************ */

&ANALYZE-SUSPEND _PROCEDURE-SETTINGS
/* Settings for THIS-PROCEDURE
   Type: Window
   Allow: Basic,Browse,DB-Fields,Window,Query
   Temp-Tables and Buffers:
      TABLE: ansvarigtemp T "?" NO-UNDO temp-db ansvarigtemp
      TABLE: godkannartemp T "?" NO-UNDO temp-db godkannartemp
      TABLE: persextra T "?" NO-UNDO temp-db persextra
      TABLE: personaltemp T "?" NO-UNDO temp-db personaltemp
   END-TABLES.
 */
&ANALYZE-RESUME _END-PROCEDURE-SETTINGS

/* *************************  Create Window  ************************** */

&ANALYZE-SUSPEND _CREATE-WINDOW
IF SESSION:DISPLAY-TYPE = "GUI":U THEN
  CREATE WINDOW C-Win ASSIGN
         HIDDEN             = YES
         TITLE              = "Personal"
         HEIGHT             = 28.63
         WIDTH              = 116
         MAX-HEIGHT         = 31.58
         MAX-WIDTH          = 116
         VIRTUAL-HEIGHT     = 31.58
         VIRTUAL-WIDTH      = 116
         RESIZE             = yes
         SCROLL-BARS        = no
         STATUS-AREA        = no
         BGCOLOR            = ?
         FGCOLOR            = ?
         KEEP-FRAME-Z-ORDER = yes
         THREE-D            = yes
         MESSAGE-AREA       = no
         SENSITIVE          = yes.
ELSE {&WINDOW-NAME} = CURRENT-WINDOW.
/* END WINDOW DEFINITION                                                */
&ANALYZE-RESUME



/* ***********  Runtime Attributes and AppBuilder Settings  *********** */

&ANALYZE-SUSPEND _RUN-TIME-ATTRIBUTES
/* SETTINGS FOR WINDOW C-Win
  VISIBLE,,RUN-PERSISTENT                                               */
/* REPARENT FRAME */
ASSIGN FRAME FRAME-ADRESS:FRAME = FRAME DEFAULT-FRAME:HANDLE
       FRAME FRAME-ARBETSTIDER:FRAME = FRAME DEFAULT-FRAME:HANDLE
       FRAME FRAME-AVTAL:FRAME = FRAME DEFAULT-FRAME:HANDLE
       FRAME FRAME-PERSONALLIGGARE:FRAME = FRAME DEFAULT-FRAME:HANDLE
       FRAME FRAME-TIDSKRIVNING:FRAME = FRAME DEFAULT-FRAME:HANDLE.

/* SETTINGS FOR FRAME DEFAULT-FRAME
   FRAME-NAME                                                           */

DEFINE VARIABLE XXTABVALXX AS LOGICAL NO-UNDO.

ASSIGN XXTABVALXX = FRAME FRAME-ADRESS:MOVE-AFTER-TAB-ITEM (RAD_PERS:HANDLE IN FRAME DEFAULT-FRAME)
       XXTABVALXX = FRAME FRAME-AVTAL:MOVE-BEFORE-TAB-ITEM (FILL-IN_OVERTIDUTTAG:HANDLE IN FRAME DEFAULT-FRAME)
       XXTABVALXX = FRAME FRAME-TIDSKRIVNING:MOVE-BEFORE-TAB-ITEM (FRAME FRAME-AVTAL:HANDLE)
       XXTABVALXX = FRAME FRAME-PERSONALLIGGARE:MOVE-BEFORE-TAB-ITEM (FRAME FRAME-TIDSKRIVNING:HANDLE)
       XXTABVALXX = FRAME FRAME-ARBETSTIDER:MOVE-BEFORE-TAB-ITEM (FRAME FRAME-PERSONALLIGGARE:HANDLE)
       XXTABVALXX = FRAME FRAME-ADRESS:MOVE-BEFORE-TAB-ITEM (FRAME FRAME-ARBETSTIDER:HANDLE)
/* END-ASSIGN-TABS */.

/* SETTINGS FOR FILL-IN FILL-IN_OVERTIDUTTAG IN FRAME DEFAULT-FRAME
   NO-DISPLAY NO-ENABLE                                                 */
ASSIGN 
       FILL-IN_OVERTIDUTTAG:HIDDEN IN FRAME DEFAULT-FRAME           = TRUE.

/* SETTINGS FOR FRAME FRAME-ADRESS
                                                                        */
/* SETTINGS FOR FRAME FRAME-ARBETSTIDER
                                                                        */
/* SETTINGS FOR COMBO-BOX CMB_VECKO IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-BORJ1 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-BORJ2 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-BORJ3 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-BORJ4 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-BORJ5 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-BORJ6 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-BORJ7 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-DSCH1 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-DSCH2 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-DSCH3 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-DSCH4 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-DSCH5 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-DSCH6 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-DSCH7 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-FRE IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-LOR IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-MAN IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-ONS IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-SLU1 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-SLU2 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-SLU3 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-SLU4 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-SLU5 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-SLU6 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-SLU7 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-SON IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-TIM1 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-TIM2 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-TIM3 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-TIM4 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-TIM5 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-TIM6 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-TIM7 IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-TIS IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-TOR IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY ALIGN-L                                                   */
/* SETTINGS FOR FILL-IN FILL-IN-TOT IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-TOTV IN FRAME FRAME-ARBETSTIDER
   NO-DISPLAY                                                           */
/* SETTINGS FOR FRAME FRAME-AVTAL
                                                                        */
/* SETTINGS FOR COMBO-BOX CMB_FAVTAL IN FRAME FRAME-AVTAL
   NO-DISPLAY                                                           */
/* SETTINGS FOR FILL-IN FILL-IN-FLEXSLUT IN FRAME FRAME-AVTAL
   NO-DISPLAY                                                           */
ASSIGN 
       FILL-IN-FLEXSLUT:HIDDEN IN FRAME FRAME-AVTAL           = TRUE.

/* SETTINGS FOR FILL-IN FILL-IN-FLEXSTART IN FRAME FRAME-AVTAL
   NO-DISPLAY                                                           */
ASSIGN 
       FILL-IN-FLEXSTART:HIDDEN IN FRAME FRAME-AVTAL           = TRUE.

/* SETTINGS FOR FRAME FRAME-PERSONALLIGGARE
                                                                        */
/* SETTINGS FOR FILL-IN FILL-IN-FORETAG IN FRAME FRAME-PERSONALLIGGARE
   NO-DISPLAY                                                           */
ASSIGN 
       FILL-IN-FORETAG:HIDDEN IN FRAME FRAME-PERSONALLIGGARE           = TRUE.

/* SETTINGS FOR FILL-IN FILL-IN-ORGNR IN FRAME FRAME-PERSONALLIGGARE
   NO-DISPLAY                                                           */
ASSIGN 
       FILL-IN-ORGNR:HIDDEN IN FRAME FRAME-PERSONALLIGGARE           = TRUE.

/* SETTINGS FOR FRAME FRAME-TIDSKRIVNING
                                                                        */
/* BROWSE-TAB BRW_GODK 1 FRAME-TIDSKRIVNING */
/* BROWSE-TAB BRW_PERS BRW_GODK FRAME-TIDSKRIVNING */
ASSIGN 
       BRW_GODK:MAX-DATA-GUESS IN FRAME FRAME-TIDSKRIVNING         = 300
       BRW_GODK:ALLOW-COLUMN-SEARCHING IN FRAME FRAME-TIDSKRIVNING = TRUE
       BRW_GODK:COLUMN-RESIZABLE IN FRAME FRAME-TIDSKRIVNING       = TRUE.

/* SETTINGS FOR FILL-IN FILL-IN-FTID IN FRAME FRAME-TIDSKRIVNING
   NO-ENABLE                                                            */
/* SETTINGS FOR FILL-IN FILL-IN-STID IN FRAME FRAME-TIDSKRIVNING
   NO-ENABLE                                                            */
IF SESSION:DISPLAY-TYPE = "GUI":U AND VALID-HANDLE(C-Win)
THEN C-Win:HIDDEN = yes.

/* _RUN-TIME-ATTRIBUTES-END */
&ANALYZE-RESUME


/* Setting information for Queries and Browse Widgets fields            */

&ANALYZE-SUSPEND _QUERY-BLOCK BROWSE BRW_GODK
/* Query rebuild information for BROWSE BRW_GODK
     _TblList          = "Temp-Tables.godkannartemp"
     _Options          = "NO-LOCK"
     _FldNameList[1]   > Temp-Tables.godkannartemp.PERSONALKOD
"godkannartemp.PERSONALKOD" "Enhet/!Sign" ? "character" ? ? ? ? ? ? yes ? no no "7" yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _FldNameList[2]   > Temp-Tables.godkannartemp.FORNAMN
"godkannartemp.FORNAMN" "Förnamn" "x(256)" "character" ? ? ? ? ? ? no ? no no "12" yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _FldNameList[3]   > Temp-Tables.godkannartemp.EFTERNAMN
"godkannartemp.EFTERNAMN" "Efternamn" "x(256)" "character" ? ? ? ? ? ? no ? no no "22" yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _Query            is NOT OPENED
*/  /* BROWSE BRW_GODK */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK BROWSE BRW_PERS
/* Query rebuild information for BROWSE BRW_PERS
     _TblList          = "Temp-Tables.persextra"
     _Options          = "NO-LOCK INDEXED-REPOSITION"
     _FldNameList[1]   > Temp-Tables.persextra.PERSONALKOD
"persextra.PERSONALKOD" "Enhet/!Sign" ? "character" ? ? ? ? ? ? no ? no no "7" yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _FldNameList[2]   > Temp-Tables.persextra.FORNAMN
"persextra.FORNAMN" "Förnamn" "x(256)" "character" ? ? ? ? ? ? no ? no no "15" yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _FldNameList[3]   > Temp-Tables.persextra.EFTERNAMN
"persextra.EFTERNAMN" "Efternamn" "x(256)" "character" ? ? ? ? ? ? no ? no no "10.13" yes no no "U" "" "" "" "" "" "" 0 no 0 no no
     _Query            is NOT OPENED
*/  /* BROWSE BRW_PERS */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK FRAME FRAME-ADRESS
/* Query rebuild information for FRAME FRAME-ADRESS
     _Query            is NOT OPENED
*/  /* FRAME FRAME-ADRESS */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK FRAME FRAME-ARBETSTIDER
/* Query rebuild information for FRAME FRAME-ARBETSTIDER
     _Query            is NOT OPENED
*/  /* FRAME FRAME-ARBETSTIDER */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK FRAME FRAME-AVTAL
/* Query rebuild information for FRAME FRAME-AVTAL
     _Query            is NOT OPENED
*/  /* FRAME FRAME-AVTAL */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK FRAME FRAME-PERSONALLIGGARE
/* Query rebuild information for FRAME FRAME-PERSONALLIGGARE
     _Query            is NOT OPENED
*/  /* FRAME FRAME-PERSONALLIGGARE */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _QUERY-BLOCK FRAME FRAME-TIDSKRIVNING
/* Query rebuild information for FRAME FRAME-TIDSKRIVNING
     _Query            is NOT OPENED
*/  /* FRAME FRAME-TIDSKRIVNING */
&ANALYZE-RESUME

 



/* ************************  Control Triggers  ************************ */

&Scoped-define SELF-NAME C-Win
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL C-Win C-Win
ON END-ERROR OF C-Win /* Personal */
OR ENDKEY OF {&WINDOW-NAME} ANYWHERE DO:
  /* This case occurs when the user presses the "Esc" key.
     In a persistently run window, just ignore this.  If we did not, the
     application would exit. */
  IF THIS-PROCEDURE:PERSISTENT THEN RETURN NO-APPLY.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL C-Win C-Win
ON WINDOW-CLOSE OF C-Win /* Personal */
DO:
  /* This event will close the window and terminate the procedure.  */
  APPLY "CLOSE":U TO THIS-PROCEDURE.
  RETURN NO-APPLY.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define BROWSE-NAME BRW_GODK
&Scoped-define FRAME-NAME FRAME-TIDSKRIVNING
&Scoped-define SELF-NAME BRW_GODK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BRW_GODK C-Win
ON ANY-PRINTABLE OF BRW_GODK IN FRAME FRAME-TIDSKRIVNING /* Godkänner tidsedlar */
DO:
   RUN hittadyn_UI IN brwproc[1]. 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BRW_GODK C-Win
ON START-SEARCH OF BRW_GODK IN FRAME FRAME-TIDSKRIVNING /* Godkänner tidsedlar */
DO:
   RUN colsortdynbrw_UI IN brwproc[1] (INPUT "").
   RUN lastselectdyn_UI IN brwproc[1].
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BRW_GODK C-Win
ON VALUE-CHANGED OF BRW_GODK IN FRAME FRAME-TIDSKRIVNING /* Godkänner tidsedlar */
DO:
   RUN fetchselrowid_UI IN brwproc[1].  
   IF AVAILABLE godkannartemp THEN DO:
      ASSIGN FILL-IN_TIDSGODK  = godkannartemp.PERSONALKOD.
      DISPLAY FILL-IN_TIDSGODK WITH FRAME {&FRAME-NAME}.
   END.     
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME Btn_AVB
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL Btn_AVB C-Win
ON CHOOSE OF Btn_AVB IN FRAME DEFAULT-FRAME /* Avbryt */
DO:
   musz = TRUE.
   FOR EACH bortpersextra:   
      FIND FIRST godkannartemp WHERE godkannartemp.PERSONALKOD = bortpersextra.PERSONALKOD NO-ERROR.
      IF AVAILABLE godkannartemp THEN DO:
         DELETE godkannartemp.
      END.
   END.      
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-TIDSKRIVNING
&Scoped-define SELF-NAME BTN_BACK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_BACK C-Win
ON CHOOSE OF BTN_BACK IN FRAME FRAME-TIDSKRIVNING
DO:
   DEBUGGER:SET-BREAK().
   status-ok = BRW_PERS:SELECT-FOCUSED-ROW() IN FRAME {&FRAME-NAME} NO-ERROR.
   IF status-ok THEN DO:
      IF AVAILABLE persextra THEN DO: 
         FIND FIRST godkannartemp WHERE godkannartemp.PERSONALKOD = persextra.PERSONALKOD NO-LOCK NO-ERROR.
         IF NOT AVAILABLE godkannartemp THEN DO:
            CREATE godkannartemp.
            BUFFER-COPY persextra TO godkannartemp.
            CREATE bortpersextra.
            BUFFER-COPY persextra TO bortpersextra.
            
            RUN setlastrowid_UI IN brwproc[1] (INPUT ROWID(godkannartemp)).        
            RUN openbdynspec_UI IN brwproc[1].
            RUN lastselectdyn_UI IN brwproc[1].
            FILL-IN_TIDSGODK =  godkannartemp.PERSONALKOD.
            DISPLAY FILL-IN_TIDSGODK WITH FRAME {&FRAME-NAME}.
                        
         END.
      END.        
      
              
   END.
   
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-PERSONALLIGGARE
&Scoped-define SELF-NAME BTN_GPLAVREG
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_GPLAVREG C-Win
ON CHOOSE OF BTN_GPLAVREG IN FRAME FRAME-PERSONALLIGGARE /* Avregistrera GPL */
DO:
     IF NOT VALID-HANDLE(restuserh) THEN DO:
         IF Guru.Konstanter:appcon THEN DO:
             RUN RESTUSERS.P PERSISTENT SET restuserh ON Guru.Konstanter:apphand TRANSACTION DISTINCT.
         END.
         ELSE DO:      
            RUN RESTUSERS.P PERSISTENT SET restuserh.
         END.   
     END.  
     
     RUN restTabortUser_UI IN restuserh(INPUT pkod, OUTPUT TABLE felmeddtemp).
     FIND FIRST felmeddtemp WHERE felmeddtemp.FELMEDD BEGINS "GPL-Användare för" NO-LOCK NO-ERROR.
     IF AVAILABLE felmeddtemp THEN DO:
        FILL-IN-PLREG =   "Användare är inte registrerad för GPL" .      
        DISPLAY FILL-IN-PLREG WITH FRAME FRAME-PERSONALLIGGARE.
     END.
     FOR EACH felmeddtemp:
        MESSAGE felmeddtemp.FELMEDD VIEW-AS ALERT-BOX.
     DELETE felmeddtemp.
  END.  
   END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME BTN_GPLREG
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_GPLREG C-Win
ON CHOOSE OF BTN_GPLREG IN FRAME FRAME-PERSONALLIGGARE /* Registrera GPL */
DO:
  IF NOT VALID-HANDLE(restuserh) THEN DO:
   IF Guru.Konstanter:appcon THEN DO:
       RUN RESTUSERS.P PERSISTENT SET restuserh ON Guru.Konstanter:apphand TRANSACTION DISTINCT.
   END.
   ELSE DO:      
      RUN RESTUSERS.P PERSISTENT SET restuserh.
   END.   
  END.
  
  RUN restSkapaUser_UI IN restuserh(INPUT pkod, OUTPUT TABLE felmeddtemp).
  FIND FIRST felmeddtemp WHERE felmeddtemp.FELMEDD BEGINS "GPL-Användare för" NO-LOCK NO-ERROR.
  IF AVAILABLE felmeddtemp THEN DO:
      FILL-IN-PLREG =   "Användare är registrerad för GPL" .      
      DISPLAY FILL-IN-PLREG WITH FRAME FRAME-PERSONALLIGGARE.
      FIND FIRST valperstemp WHERE valperstemp.PERSONALKOD = pkod NO-ERROR.
      /*
      ASSIGN
      FILL-IN_AKTIV = valperstemp.AKTIV
      FILL-IN_DELTID = valperstemp.DELTID
      FILL-IN_ANSTNR = valperstemp.ANSTNR
      /*FILL-IN_ANSVARIGTIDR = valperstemp.ANSVARIGTIDR*/
      FILL-IN_BOXEN = valperstemp.BOXEN
      FILL-IN_EFTERNAMN = valperstemp.EFTERNAMN
      FILL-IN_FORNAMN = valperstemp.FORNAMN
      FILL-IN_GATUADRESS = valperstemp.GATUADRESS
      FILL-IN_MOBILRADIO = valperstemp.MOBILRADIO
      FILL-IN_MOBILTEL = valperstemp.MOBILTEL
      FILL-IN_PERSONALKOD = valperstemp.PERSONALKOD
      FILL-IN_PERSONNUMMER = valperstemp.PERSONNUMMER
      FILL-IN_PERSONSOK = SUBSTRING(valperstemp.PERSONSOK,1,19)
      FILL-IN_EPOST = SUBSTRING(valperstemp.PERSONSOK,20)
      */
      RUN SPECIALMAPITO.P (INPUT "elpool.ume@elpool.se", 
                           INPUT "Ny GPL-användare: " + valperstemp.FORNAMN + " " + valperstemp.EFTERNAMN + "( " + Guru.Konstanter:globforetag + " )", 
                           INPUT  "Jag önskar att att ni skickar en mobilappsinbjudan till epost: " + SUBSTRING(valperstemp.PERSONSOK,20) + " (Personens personalkod är: " + valperstemp.PERSONALKOD + ")", 
                           INPUT "").
  END.
  FOR EACH felmeddtemp:
      MESSAGE felmeddtemp.FELMEDD VIEW-AS ALERT-BOX.
      DELETE felmeddtemp.
  END.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME BTN_OK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_OK C-Win
ON CHOOSE OF BTN_OK IN FRAME DEFAULT-FRAME /* Ok */
DO:    
   
   {muswait.i}      
   RUN btnok_UI.
   {musarrow.i}
   
   
        
   IF musz = TRUE THEN DO:
      musz = FALSE.
      RETURN NO-APPLY.
   END.
   ELSE DO:
      {BORTBRWPROC.I}
      pkod = valperskolltemp.PERSONALKOD.
      APPLY "GO" TO FRAME {&FRAME-NAME}.              
      APPLY "CLOSE":U TO THIS-PROCEDURE.
      /*
      FRAME DEFAULT-FRAME:HIDDEN = TRUE.
      RETURN.*/ 
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-TIDSKRIVNING
&Scoped-define SELF-NAME BTN_OVER
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL BTN_OVER C-Win
ON CHOOSE OF BTN_OVER IN FRAME FRAME-TIDSKRIVNING
DO:
   
   status-ok = BRW_GODK:SELECT-FOCUSED-ROW() IN FRAME {&FRAME-NAME} NO-ERROR.
   IF status-ok THEN DO:
      IF AVAILABLE godkannartemp THEN DO: 
         EMPTY TEMP-TABLE epersextra  NO-ERROR. 
         RUN godbortkoll_UI IN  asfaktapph (INPUT godkannartemp.PERSONALKOD, OUTPUT TABLE epersextra).
         FIND FIRST epersextra NO-LOCK NO-ERROR.
         IF AVAILABLE epersextra THEN DO:
            MESSAGE "Godkännaren går ej att ta bort. Godkännaren ligger upplagd på " + epersextra.PERSONALKOD + " " + epersextra.FORNAMN + " " + epersextra.EFTERNAMN   VIEW-AS ALERT-BOX.
            RETURN NO-APPLY.
         END.
         ELSE DO:
            RUN godbort_UI IN  asfaktapph (INPUT godkannartemp.PERSONALKOD).
         END.       
         
      END.   
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME CMB_ANST
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_ANST C-Win
ON VALUE-CHANGED OF CMB_ANST IN FRAME FRAME-AVTAL /* Anst.form */
DO:
   CMB_ANST = INPUT CMB_ANST.     
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_BEF
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_BEF C-Win
ON VALUE-CHANGED OF CMB_BEF IN FRAME FRAME-AVTAL /* Befattning */
DO:
   CMB_BEF = INPUT CMB_BEF.   
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_BEF2
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_BEF2 C-Win
ON VALUE-CHANGED OF CMB_BEF2 IN FRAME FRAME-AVTAL /* Befattning */
DO:
   CMB_BEF2 = INPUT CMB_BEF2.   
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME CMB_BER
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_BER C-Win
ON VALUE-CHANGED OF CMB_BER IN FRAME FRAME-AVTAL /* Beredskapsalt. */
DO:
   CMB_BER = INPUT CMB_BER.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME CMB_OMR
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_OMR C-Win
ON LEAVE OF CMB_OMR IN FRAME DEFAULT-FRAME /* Område */
DO:
   CMB_OMR = INPUT CMB_OMR.      
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME CMB_ORGCHEF
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_ORGCHEF C-Win
ON VALUE-CHANGED OF CMB_ORGCHEF IN FRAME FRAME-AVTAL /* Rörelsegren */
DO:
   CMB_ORGCHEF = INPUT CMB_ORGCHEF.       
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-TIDSKRIVNING
&Scoped-define SELF-NAME CMB_OVERUT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_OVERUT C-Win
ON VALUE-CHANGED OF CMB_OVERUT IN FRAME FRAME-TIDSKRIVNING /* Övertiduttag */
DO:
   CMB_OVERUT = INPUT CMB_OVERUT.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME CMB_TRA
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_TRA C-Win
ON VALUE-CHANGED OF CMB_TRA IN FRAME FRAME-AVTAL /* Trakt.avtal */
DO:
   CMB_TRA = INPUT CMB_TRA.       
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-ARBETSTIDER
&Scoped-define SELF-NAME CMB_VECKO
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_VECKO C-Win
ON ENTRY OF CMB_VECKO IN FRAME FRAME-ARBETSTIDER /* Veckoschema */
DO:
   CMB_VECKO = INPUT CMB_VECKO. 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_VECKO C-Win
ON LEAVE OF CMB_VECKO IN FRAME FRAME-ARBETSTIDER /* Veckoschema */
DO:
   CMB_VECKO = INPUT CMB_VECKO.    
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL CMB_VECKO C-Win
ON VALUE-CHANGED OF CMB_VECKO IN FRAME FRAME-ARBETSTIDER /* Veckoschema */
DO:
   CMB_VECKO = INPUT CMB_VECKO.
   FOR EACH valperskolltemp:
      DELETE valperskolltemp.
   END.
   FOR EACH valsoktemp:
      DELETE valsoktemp.
   END.   
   CREATE valperskolltemp.
   valperskolltemp.VECKOSCHEMA = CMB_VECKO.
   IF Guru.Konstanter:appcon THEN DO:      
      RUN PERSUPP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT 3,INPUT pkod,INPUT TABLE valperskolltemp,INPUT-OUTPUT TABLE valsoktemp,OUTPUT TABLE felmeddtemp).
   END.
   ELSE DO:
      RUN PERSUPP.P 
      (INPUT 3,INPUT pkod,INPUT TABLE valperskolltemp,INPUT-OUTPUT TABLE valsoktemp,OUTPUT TABLE felmeddtemp).
   END.
   RUN vladda_UI.    
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME FILL-IN-ATERFOR50
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-ATERFOR50 C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN-ATERFOR50 IN FRAME FRAME-AVTAL /* Återför 50 tim */
DO:
   IF INPUT FILL-IN-ATERFOR50 = TRUE THEN FILL-IN-ATERFOR50 = FALSE.
   IF INPUT FILL-IN-ATERFOR50 = FALSE THEN FILL-IN-ATERFOR50 = TRUE.
   DISPLAY FILL-IN-ATERFOR50 WITH FRAME {&FRAME-NAME}.  
   
   IF FILL-IN-ATERFOR50 = TRUE THEN DO:
      IF FILL-IN-ATERTIM = 0 THEN FILL-IN-ATERTIM = 50. 
      FILL-IN-ATERTIM:HIDDEN                    = FALSE.
      DISPLAY FILL-IN-ATERTIM WITH FRAME {&FRAME-NAME}.
   END.   
   ELSE DO:
      FILL-IN-ATERTIM = 0.
      FILL-IN-ATERTIM:HIDDEN                    = TRUE.
   END.
      
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-DISPELAK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-DISPELAK C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN-DISPELAK IN FRAME FRAME-AVTAL /* Disp.läk.besök */
DO:
   IF INPUT FILL-IN-DISPELAK = TRUE THEN FILL-IN-DISPELAK = FALSE.
   IF INPUT FILL-IN-DISPELAK = FALSE THEN FILL-IN-DISPELAK = TRUE.
   DISPLAY FILL-IN-DISPELAK WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-DISPENS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-DISPENS C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN-DISPENS IN FRAME FRAME-AVTAL /* Tillåt > 350 tim/år ÖV */
DO:
   IF INPUT FILL-IN-DISPENS = TRUE THEN FILL-IN-DISPENS = FALSE.
   IF INPUT FILL-IN-DISPENS = FALSE THEN FILL-IN-DISPENS = TRUE.
   DISPLAY FILL-IN-DISPENS WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-DISPENS48
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-DISPENS48 C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN-DISPENS48 IN FRAME FRAME-AVTAL /* Tillåt > 48 tim/4v ÖV */
DO:
   IF INPUT FILL-IN-DISPENS48 = TRUE THEN FILL-IN-DISPENS48 = FALSE.
   IF INPUT FILL-IN-DISPENS48 = FALSE THEN FILL-IN-DISPENS48 = TRUE.
   DISPLAY FILL-IN-DISPENS48 WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-DISPENSM
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-DISPENSM C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN-DISPENSM IN FRAME FRAME-AVTAL /* Tillåt > 50 tim/mån ÖV */
DO:
   IF INPUT FILL-IN-DISPENSM = TRUE THEN FILL-IN-DISPENSM = FALSE.
   IF INPUT FILL-IN-DISPENSM = FALSE THEN FILL-IN-DISPENSM = TRUE.
   DISPLAY FILL-IN-DISPENSM WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-FLEXSLUT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-FLEXSLUT C-Win
ON LEAVE OF FILL-IN-FLEXSLUT IN FRAME FRAME-AVTAL /* Flex slutdat */
DO:     
  ASSIGN FILL-IN-FLEXSLUT = INPUT FILL-IN-FLEXSLUT. 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-FLEXSLUT C-Win
ON MOUSE-MENU-CLICK OF FILL-IN-FLEXSLUT IN FRAME FRAME-AVTAL /* Flex slutdat */
DO:
  ASSIGN  
   regdatum = FILL-IN-FLEXSLUT.
   IF Guru.GlobalaVariabler:regdatum = ? THEN regdatum = TODAY + 1.
   RUN AlmanBtn.w.
   FILL-IN-FLEXSLUT = Guru.GlobalaVariabler:regdatum.    
   DISPLAY FILL-IN-FLEXSLUT WITH FRAME {&FRAME-NAME}.

END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN-FLEXSTART
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-FLEXSTART C-Win
ON LEAVE OF FILL-IN-FLEXSTART IN FRAME FRAME-AVTAL /* Flex startdat */
DO:
   
  ASSIGN FILL-IN-FLEXSTART = INPUT FILL-IN-FLEXSTART.  

END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-FLEXSTART C-Win
ON MOUSE-MENU-CLICK OF FILL-IN-FLEXSTART IN FRAME FRAME-AVTAL /* Flex startdat */
DO:
   ASSIGN  
   Guru.GlobalaVariabler:regdatum = FILL-IN-FLEXSTART.
   IF Guru.GlobalaVariabler:regdatum = ? THEN Guru.GlobalaVariabler:regdatum = TODAY + 1.
   RUN AlmanBtn.w.
   FILL-IN-FLEXSTART = Guru.GlobalaVariabler:regdatum.    
   DISPLAY FILL-IN-FLEXSTART WITH FRAME {&FRAME-NAME}.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-PERSONALLIGGARE
&Scoped-define SELF-NAME FILL-IN-FORETAG
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-FORETAG C-Win
ON LEAVE OF FILL-IN-FORETAG IN FRAME FRAME-PERSONALLIGGARE /* Företag */
DO:
  FILL-IN-FORETAG = INPUT FILL-IN-FORETAG.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME FILL-IN-NODF
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-NODF C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN-NODF IN FRAME FRAME-AVTAL /* Tillåt nödfallsövertid */
DO:
   IF INPUT FILL-IN-NODF = TRUE THEN FILL-IN-NODF = FALSE.
   IF INPUT FILL-IN-NODF = FALSE THEN FILL-IN-NODF = TRUE.
   DISPLAY FILL-IN-NODF WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-PERSONALLIGGARE
&Scoped-define SELF-NAME FILL-IN-ORGNR
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-ORGNR C-Win
ON LEAVE OF FILL-IN-ORGNR IN FRAME FRAME-PERSONALLIGGARE /* Orgnr */
DO:
   IF INPUT FILL-IN-ORGNR = "" THEN  ASSIGN FILL-IN-ORGNR = "0000000000".
   ELSE ASSIGN FILL-IN-ORGNR = INPUT FILL-IN-ORGNR.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-TIDSKRIVNING
&Scoped-define SELF-NAME FILL-IN-SEALLTID
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SEALLTID C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN-SEALLTID IN FRAME FRAME-TIDSKRIVNING /* Uppföljning - se all personals tid */
DO:
  IF INPUT FILL-IN-SEALLTID = TRUE THEN FILL-IN-SEALLTID = FALSE.
   IF INPUT FILL-IN-SEALLTID = FALSE THEN FILL-IN-SEALLTID = TRUE.
   DISPLAY FILL-IN-SEALLTID WITH FRAME {&FRAME-NAME}.  

END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME FILL-IN-SPARRFR
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN-SPARRFR C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN-SPARRFR IN FRAME FRAME-AVTAL /* Spärr Friskv */
DO:
   IF INPUT FILL-IN-SPARRFR = TRUE THEN FILL-IN-SPARRFR = FALSE.
   IF INPUT FILL-IN-SPARRFR = FALSE THEN FILL-IN-SPARRFR = TRUE.
   DISPLAY FILL-IN-SPARRFR WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_AKTIV
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_AKTIV C-Win
ON LEAVE OF FILL-IN_AKTIV IN FRAME FRAME-AVTAL /* Tidskrivning */
DO:
   ASSIGN FILL-IN_AKTIV = INPUT FILL-IN_AKTIV.
    
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_AKTIV C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN_AKTIV IN FRAME FRAME-AVTAL /* Tidskrivning */
DO:
   IF INPUT FILL-IN_AKTIV = TRUE THEN FILL-IN_AKTIV = FALSE.
   IF INPUT FILL-IN_AKTIV = FALSE THEN FILL-IN_AKTIV = TRUE.   
   DISPLAY FILL-IN_AKTIV WITH FRAME {&FRAME-NAME}.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME FILL-IN_ANSTNR
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_ANSTNR C-Win
ON LEAVE OF FILL-IN_ANSTNR IN FRAME DEFAULT-FRAME /* Anställningsnr */
DO:    
   FILL-IN_ANSTNR = INPUT FILL-IN_ANSTNR.   
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-ADRESS
&Scoped-define SELF-NAME FILL-IN_BOXEN
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_BOXEN C-Win
ON LEAVE OF FILL-IN_BOXEN IN FRAME FRAME-ADRESS /* Box */
DO:
    FILL-IN_BOXEN = INPUT FILL-IN_BOXEN.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME FILL-IN_DELTID
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_DELTID C-Win
ON LEAVE OF FILL-IN_DELTID IN FRAME FRAME-AVTAL /* Deltid */
DO:
    ASSIGN FILL-IN_DELTID = INPUT FILL-IN_DELTID.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_DELTID C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN_DELTID IN FRAME FRAME-AVTAL /* Deltid */
DO:
   IF INPUT FILL-IN_DELTID = TRUE THEN FILL-IN_DELTID = FALSE.
   IF INPUT FILL-IN_DELTID = FALSE THEN FILL-IN_DELTID = TRUE.
   DISPLAY FILL-IN_DELTID WITH FRAME {&FRAME-NAME}.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME FILL-IN_EFTERNAMN
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_EFTERNAMN C-Win
ON LEAVE OF FILL-IN_EFTERNAMN IN FRAME DEFAULT-FRAME /* Efternamn */
DO:
    FILL-IN_EFTERNAMN = TRIM(INPUT FILL-IN_EFTERNAMN). 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-ADRESS
&Scoped-define SELF-NAME FILL-IN_EPOST
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_EPOST C-Win
ON LEAVE OF FILL-IN_EPOST IN FRAME FRAME-ADRESS /* E-post */
DO:
   ASSIGN FILL-IN_EPOST = TRIM(INPUT FILL-IN_EPOST).
   IF FILL-IN_EPOST NE "" THEN DO:
      RUN EPOSTKOLL.P (INPUT FILL-IN_EPOST,OUTPUT musz).
      IF musz = FALSE THEN DO:
         APPLY "ENTRY" TO FILL-IN_EPOST IN FRAME {&FRAME-NAME}.
         RETURN NO-APPLY.
      END.
      musz = FALSE.
   END.   
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME FILL-IN_FLEXTID
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_FLEXTID C-Win
ON LEAVE OF FILL-IN_FLEXTID IN FRAME FRAME-AVTAL /* Flextid */
DO:
  FILL-IN_FLEXTID = INPUT FILL-IN_FLEXTID.
  IF Guru.Konstanter:globforetag = "ELPA" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV"  THEN DO:   
     IF FILL-IN_FLEXTID = TRUE THEN DO:              
        IF Guru.Konstanter:globforetag = "SUND" THEN DO:                
           IF FILL-IN-FAVTAL = "T" THEN ASSIGN CMB_FAVTAL = "Sundsvall Övriga".                   
           IF FILL-IN-FAVTAL = "TU" THEN ASSIGN CMB_FAVTAL = "Korsta".
           IF FILL-IN-FAVTAL = "" THEN ASSIGN CMB_FAVTAL = "Sundsvall Övriga".
        END.
        ELSE IF Guru.Konstanter:globforetag = "SNAT"  THEN DO:     
           IF FILL-IN-FAVTAL = "TE" THEN ASSIGN CMB_FAVTAL = "8-17".               /*   "Sundsvall Elnät".*/           
           IF FILL-IN-FAVTAL = "K" THEN ASSIGN CMB_FAVTAL = "7-16".                      /*"Sundsvall kollektiv Elnät".*/
           IF FILL-IN-FAVTAL = "" THEN ASSIGN CMB_FAVTAL = "8-17".         
           
        END.
        ELSE if Guru.Konstanter:globforetag = "MISV"  THEN DO: 
           IF FILL-IN-FAVTAL = "T" THEN ASSIGN CMB_FAVTAL = "Sundsvall Övriga".           
           IF FILL-IN-FAVTAL = "KV" THEN ASSIGN CMB_FAVTAL = "Sundsvall kollektiv Vatten".          
           IF FILL-IN-FAVTAL = "" THEN ASSIGN CMB_FAVTAL = "Sundsvall Övriga".
        END.     
        ASSIGN
        CMB_FAVTAL:HIDDEN = FALSE.
        /*FILL-IN-FLEXSTART:HIDDEN = FALSE
        FILL-IN-FLEXSLUT:HIDDEN = FALSE.*/
        ENABLE CMB_FAVTAL WITH FRAME {&FRAME-NAME}.
        DISPLAY CMB_FAVTAL /*FILL-IN-FLEXSTART FILL-IN-FLEXSLUT*/ WITH FRAME {&FRAME-NAME}.
           
     END.
     ELSE DO:
        ASSIGN
        CMB_FAVTAL:HIDDEN = TRUE
        FILL-IN-FLEXSTART:HIDDEN = TRUE
        FILL-IN-FLEXSLUT:HIDDEN = TRUE.
     END.   
           
  END.   
  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_FLEXTID C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN_FLEXTID IN FRAME FRAME-AVTAL /* Flextid */
DO:
   IF INPUT FILL-IN_FLEXTID = TRUE THEN FILL-IN_FLEXTID = FALSE.
   IF INPUT FILL-IN_FLEXTID = FALSE THEN FILL-IN_FLEXTID = TRUE.
   DISPLAY FILL-IN_FLEXTID WITH FRAME {&FRAME-NAME}.
   IF Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV"  THEN DO:
      IF FILL-IN_FLEXTID = TRUE THEN DO:                       
         IF FILL-IN-FAVTAL = "TE" THEN ASSIGN CMB_FAVTAL =  "8-17".                       /*"Sundsvall Elnät".*/
         IF FILL-IN-FAVTAL = "K" THEN ASSIGN CMB_FAVTAL =  "7-16".                          /*"Sundsvall kollektiv Elnät".*/
         IF FILL-IN-FAVTAL = "T" THEN ASSIGN CMB_FAVTAL = "Sundsvall Övriga".    
         IF FILL-IN-FAVTAL = "KV" THEN ASSIGN CMB_FAVTAL = "Sundsvall kollektiv Vatten".
         IF FILL-IN-FAVTAL = "TU" THEN ASSIGN CMB_FAVTAL = "Korsta".
         IF FILL-IN-FAVTAL = "" THEN ASSIGN CMB_FAVTAL = "Sundsvall Övriga".
         
         ASSIGN
         CMB_FAVTAL:HIDDEN = FALSE.
         /*FILL-IN-FLEXSTART:HIDDEN = FALSE
         FILL-IN-FLEXSLUT:HIDDEN = FALSE.*/
         ENABLE CMB_FAVTAL WITH FRAME {&FRAME-NAME}.
         DISPLAY CMB_FAVTAL /*FILL-IN-FLEXSTART FILL-IN-FLEXSLUT*/ WITH FRAME {&FRAME-NAME}.
      END.
      ELSE DO:
         ASSIGN
         CMB_FAVTAL:HIDDEN = TRUE
         FILL-IN-FLEXSTART:HIDDEN = TRUE
         FILL-IN-FLEXSLUT:HIDDEN = TRUE.
      END.       
   END. 
   ELSE DO:
      ASSIGN
      CMB_FAVTAL:HIDDEN = TRUE
      FILL-IN-FLEXSTART:HIDDEN = TRUE
      FILL-IN-FLEXSLUT:HIDDEN = TRUE.
   END.   
          
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME FILL-IN_FORNAMN
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_FORNAMN C-Win
ON LEAVE OF FILL-IN_FORNAMN IN FRAME DEFAULT-FRAME /* Förnamn */
DO:
   ASSIGN FILL-IN_FORNAMN = TRIM(INPUT FILL-IN_FORNAMN). 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME FILL-IN_FORTRO
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_FORTRO C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN_FORTRO IN FRAME FRAME-AVTAL /* Förtroendetid */
DO:
   IF INPUT FILL-IN_FORTRO = TRUE THEN FILL-IN_FORTRO = FALSE.
   IF INPUT FILL-IN_FORTRO = FALSE THEN FILL-IN_FORTRO = TRUE.
   DISPLAY FILL-IN_FORTRO WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-ADRESS
&Scoped-define SELF-NAME FILL-IN_GATUADRESS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_GATUADRESS C-Win
ON LEAVE OF FILL-IN_GATUADRESS IN FRAME FRAME-ADRESS /* Gatuadress */
DO:
     ASSIGN FILL-IN_GATUADRESS = INPUT FILL-IN_GATUADRESS. 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME FILL-IN_LAGBAS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_LAGBAS C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN_LAGBAS IN FRAME FRAME-AVTAL /* Lagbas */
DO:
   IF INPUT FILL-IN_LAGBAS = TRUE THEN FILL-IN_LAGBAS = FALSE.
   IF INPUT FILL-IN_LAGBAS = FALSE THEN FILL-IN_LAGBAS = TRUE.
   DISPLAY FILL-IN_LAGBAS WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_LONVATK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_LONVATK C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN_LONVATK IN FRAME FRAME-AVTAL /* Löneväxla ATK */
DO:
   IF INPUT FILL-IN_LONVATK = TRUE THEN FILL-IN_LONVATK = FALSE.
   IF INPUT FILL-IN_LONVATK = FALSE THEN FILL-IN_LONVATK = TRUE.
   DISPLAY FILL-IN_LONVATK WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-ADRESS
&Scoped-define SELF-NAME FILL-IN_MOBILRADIO
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_MOBILRADIO C-Win
ON LEAVE OF FILL-IN_MOBILRADIO IN FRAME FRAME-ADRESS /* Mobilradio */
DO:
    ASSIGN FILL-IN_MOBILRADIO = INPUT FILL-IN_MOBILRADIO.   
    FILL-IN_MOBILRADIO= tabortblanka(FILL-IN_MOBILRADIO).
    DISPLAY FILL-IN_MOBILRADIO WITH FRAME FRAME-ADRESS. 

END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_MOBILTEL
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_MOBILTEL C-Win
ON LEAVE OF FILL-IN_MOBILTEL IN FRAME FRAME-ADRESS /* Mobiltel */
DO:
    ASSIGN FILL-IN_MOBILTEL = INPUT FILL-IN_MOBILTEL. 
    FILL-IN_MOBILTEL = tabortblanka(FILL-IN_MOBILTEL ).
   DISPLAY FILL-IN_MOBILTEL WITH FRAME FRAME-ADRESS. 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME FILL-IN_OVERTIDUTTAG
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_OVERTIDUTTAG C-Win
ON LEAVE OF FILL-IN_OVERTIDUTTAG IN FRAME DEFAULT-FRAME /* Övertiduttag */
DO:
   ASSIGN FILL-IN_OVERTIDUTTAG = INPUT FILL-IN_OVERTIDUTTAG.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_PERSONALKOD
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_PERSONALKOD C-Win
ON LEAVE OF FILL-IN_PERSONALKOD IN FRAME DEFAULT-FRAME /* Enhet/Sign */
DO:  
   ASSIGN FILL-IN_PERSONALKOD = INPUT FILL-IN_PERSONALKOD.  
   IF Guru.Konstanter:globforetag = "GRAN" THEN DO:
      FILL-IN_ANSTNR = FILL-IN_PERSONALKOD.
      DISPLAY  FILL-IN_ANSTNR WITH FRAME {&FRAME-NAME}.
      DISABLE  FILL-IN_ANSTNR WITH FRAME {&FRAME-NAME}.
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_PERSONNUMMER
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_PERSONNUMMER C-Win
ON LEAVE OF FILL-IN_PERSONNUMMER IN FRAME DEFAULT-FRAME /* Personnummer */
DO:   
   IF INPUT FILL-IN_PERSONNUMMER = "" THEN  ASSIGN FILL-IN_PERSONNUMMER = "0000000000".
   ELSE ASSIGN FILL-IN_PERSONNUMMER = INPUT FILL-IN_PERSONNUMMER.
   IF FILL-IN_PERSONNUMMER NE "0000000000" THEN DO:  
      persnr[1] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),1,1)).
      persnr[2] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),2,1)).
      persnr[3] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),3,1)).
      persnr[4] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),4,1)).
      persnr[5] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),5,1)).
      persnr[6] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),6,1)).
      persnr[7] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),8,1)).
      persnr[8] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),9,1)).
      persnr[9] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),10,1)).
      persnr[10] = INTEGER(SUBSTRING(STRING(FILL-IN_PERSONNUMMER,"999999-9999"),11,1)).
      persnr[1] = persnr[1] * 2.
      IF persnr[1] > 9 THEN persnr[1] = 
      INTEGER(SUBSTRING(STRING(persnr[1],"99"),1,1)) + 
      INTEGER(SUBSTRING(STRING(persnr[1],"99"),2,1)).
      persnr[3] = persnr[3] * 2.
      IF persnr[3] > 9 THEN persnr[3] =
      INTEGER(SUBSTRING(STRING(persnr[3],"99"),1,1)) +
      INTEGER(SUBSTRING(STRING(persnr[3],"99"),2,1)).
      persnr[5] = persnr[5] * 2.
      IF persnr[5] > 9 THEN persnr[5] =
      INTEGER(SUBSTRING(STRING(persnr[5],"99"),1,1)) +
      INTEGER(SUBSTRING(STRING(persnr[5],"99"),2,1)).
      persnr[7] = persnr[7] * 2.
      IF persnr[7] > 9 THEN persnr[7] =
      INTEGER(SUBSTRING(STRING(persnr[7],"99"),1,1)) +
      INTEGER(SUBSTRING(STRING(persnr[7],"99"),2,1)).
      persnr[9] = persnr[9] * 2.
      IF persnr[9] > 9 THEN persnr[9] =
      INTEGER(SUBSTRING(STRING(persnr[9],"99"),1,1)) +
      INTEGER(SUBSTRING(STRING(persnr[9],"99"),2,1)).
      tal1 = persnr[1] + persnr[2] + persnr[3] + persnr[4] + persnr[5] +
      persnr[6] + persnr[7] + persnr[8] + persnr[9].

      IF tal1 > 99 THEN
      tal2 = INTEGER(SUBSTRING(STRING(tal1,"999"),3,1)).
      IF tal1 < 100 THEN
      tal2 = INTEGER(SUBSTRING(STRING(tal1,"99"),2,1)).
      ksiffran = 10 - tal2.
      IF ksiffran = 10 THEN ksiffran = 0.
      IF persnr[10] = ksiffran OR (persnr[7] = 0 AND persnr[8] = 0 AND
      persnr[9] = 0 AND persnr[10] = 0) THEN ksiffran = ksiffran.
      ELSE DO:
         MESSAGE "Felaktigt personnummer." VIEW-AS ALERT-BOX.
         RETURN NO-APPLY.
      END.   
   END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-ADRESS
&Scoped-define SELF-NAME FILL-IN_PERSONSOK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_PERSONSOK C-Win
ON LEAVE OF FILL-IN_PERSONSOK IN FRAME FRAME-ADRESS /* Personsökare */
DO:
   ASSIGN FILL-IN_PERSONSOK = INPUT FILL-IN_PERSONSOK. 
   FILL-IN_PERSONSOK = tabortblanka(FILL-IN_PERSONSOK).
   DISPLAY FILL-IN_PERSONSOK WITH FRAME FRAME-ADRESS. 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_POSTADRESS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_POSTADRESS C-Win
ON LEAVE OF FILL-IN_POSTADRESS IN FRAME FRAME-ADRESS /* Postadress */
DO:
    ASSIGN FILL-IN_POSTADRESS = INPUT FILL-IN_POSTADRESS.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_POSTNUMMER
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_POSTNUMMER C-Win
ON LEAVE OF FILL-IN_POSTNUMMER IN FRAME FRAME-ADRESS /* Postnummer */
DO:
    ASSIGN FILL-IN_POSTNUMMER = INPUT FILL-IN_POSTNUMMER.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME FILL-IN_SEMFOR
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_SEMFOR C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN_SEMFOR IN FRAME FRAME-AVTAL /* Spärr ATK */
DO:
   IF INPUT FILL-IN_SEMFOR = TRUE THEN FILL-IN_SEMFOR = FALSE.
   IF INPUT FILL-IN_SEMFOR = FALSE THEN FILL-IN_SEMFOR = TRUE.
   DISPLAY FILL-IN_SEMFOR WITH FRAME {&FRAME-NAME}.
   IF Guru.Konstanter:globforetag = "gkal" OR Guru.Konstanter:globforetag = "snat" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "MISV"  THEN DO:  
      IF FILL-IN_SEMFOR = TRUE THEN  FILL-IN_LONVATK:HIDDEN                    = FALSE.
      ELSE DO:
         FILL-IN_LONVATK = FALSE.
         FILL-IN_LONVATK:HIDDEN                    = TRUE.
      END.
   END.      
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-ADRESS
&Scoped-define SELF-NAME FILL-IN_TELEFON
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_TELEFON C-Win
ON LEAVE OF FILL-IN_TELEFON IN FRAME FRAME-ADRESS /* Telefon */
DO:
    ASSIGN FILL-IN_TELEFON = INPUT FILL-IN_TELEFON.   
   FILL-IN_TELEFON = tabortblanka(FILL-IN_TELEFON ).
   DISPLAY FILL-IN_TELEFON WITH FRAME FRAME-ADRESS. 

END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_TELEFON2
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_TELEFON2 C-Win
ON LEAVE OF FILL-IN_TELEFON2 IN FRAME FRAME-ADRESS /* Telefon2 */
DO:
   ASSIGN FILL-IN_TELEFON2 = INPUT FILL-IN_TELEFON2.
   FILL-IN_TELEFON2 = tabortblanka(FILL-IN_TELEFON2).
   DISPLAY FILL-IN_TELEFON2 WITH FRAME FRAME-ADRESS. 

END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME FILL-IN_TELEFONSEM
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_TELEFONSEM C-Win
ON LEAVE OF FILL-IN_TELEFONSEM IN FRAME FRAME-ADRESS /* Semestertele */
DO:
   ASSIGN FILL-IN_TELEFONSEM = INPUT FILL-IN_TELEFONSEM.
   FILL-IN_TELEFONSEM = tabortblanka(FILL-IN_TELEFONSEM ).
   DISPLAY FILL-IN_TELEFONSEM WITH FRAME FRAME-ADRESS. 

END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-TIDSKRIVNING
&Scoped-define SELF-NAME FILL-IN_TIDSGODK
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_TIDSGODK C-Win
ON ENTRY OF FILL-IN_TIDSGODK IN FRAME FRAME-TIDSKRIVNING /* Godkänner tid */
DO:   
   
   ENABLE BRW_GODK WITH FRAME {&FRAME-NAME}.
   
   FIND FIRST godkannartemp WHERE 
   godkannartemp.PERSONALKOD = FILL-IN_TIDSGODK 
   NO-LOCK NO-ERROR.   

   IF NOT AVAILABLE godkannartemp THEN DO:
      GET FIRST BRW_GODK.
      
   END.
   IF AVAILABLE godkannartemp THEN DO:
      RUN setlastrowid_UI IN brwproc[1] (INPUT ROWID(godkannartemp)).
      RUN lastselectdyn_UI IN brwproc[1].         
   END.             
   
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_TIDSGODK C-Win
ON LEAVE OF FILL-IN_TIDSGODK IN FRAME FRAME-TIDSKRIVNING /* Godkänner tid */
DO:
   ASSIGN FILL-IN_TIDSGODK = INPUT FILL-IN_TIDSGODK.      
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME FRAME-AVTAL
&Scoped-define SELF-NAME FILL-IN_TILLIT
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL FILL-IN_TILLIT C-Win
ON MOUSE-SELECT-CLICK OF FILL-IN_TILLIT IN FRAME FRAME-AVTAL /* Tillit */
DO:
   IF INPUT FILL-IN_TILLIT = TRUE THEN FILL-IN_TILLIT = FALSE.
   IF INPUT FILL-IN_TILLIT = FALSE THEN FILL-IN_TILLIT = TRUE.
   DISPLAY FILL-IN_TILLIT WITH FRAME {&FRAME-NAME}.  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define FRAME-NAME DEFAULT-FRAME
&Scoped-define SELF-NAME RAD_PERS
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL RAD_PERS C-Win
ON VALUE-CHANGED OF RAD_PERS IN FRAME DEFAULT-FRAME
DO:
   RAD_PERS = INPUT RAD_PERS.   
  IF RAD_PERS = 1 THEN DO:
     ASSIGN FRAME FRAME-ADRESS:HIDDEN = FALSE.
     ASSIGN FRAME FRAME-TIDSKRIVNING:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-AVTAL:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-ARBETSTIDER:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-PERSONALLIGGARE:HIDDEN = TRUE.
  END.
  IF  RAD_PERS = 2 THEN DO:
     ASSIGN FRAME FRAME-ADRESS:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-TIDSKRIVNING:HIDDEN = FALSE.
     ASSIGN FRAME FRAME-AVTAL:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-ARBETSTIDER:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-PERSONALLIGGARE:HIDDEN = TRUE.
    
     IF FILL-IN_TIDSGODK NE "" THEN DO:
        FIND FIRST godkannartemp WHERE godkannartemp.PERSONALKOD = FILL-IN_TIDSGODK NO-LOCK NO-ERROR.       
        IF AVAILABLE godkannartemp THEN DO:                                   
           RUN setlastrowid_UI IN brwproc[1] (INPUT ROWID(godkannartemp)).
           RUN lastselectdyn_UI IN brwproc[1]. 
        END.
     END.   
     
  END.
  IF  RAD_PERS = 3 THEN DO:
     ASSIGN FRAME FRAME-ADRESS:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-TIDSKRIVNING:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-AVTAL:HIDDEN = FALSE.
     ASSIGN FRAME FRAME-ARBETSTIDER:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-PERSONALLIGGARE:HIDDEN = TRUE.
  END.
  IF  RAD_PERS = 4 THEN DO:
     ASSIGN FRAME FRAME-ADRESS:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-TIDSKRIVNING:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-AVTAL:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-ARBETSTIDER:HIDDEN = FALSE.
     ASSIGN FRAME FRAME-PERSONALLIGGARE:HIDDEN = TRUE.
  END.
  IF  RAD_PERS = 5 THEN DO:
     ASSIGN FRAME FRAME-ADRESS:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-TIDSKRIVNING:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-AVTAL:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-ARBETSTIDER:HIDDEN = TRUE.
     ASSIGN FRAME FRAME-PERSONALLIGGARE:HIDDEN = FALSE.
     
     IF Guru.Konstanter:varforetypchar[9] = "1" THEN DO:            
        RUN fannsRESTUser_UI IN restuserh (INPUT pkod, OUTPUT plfanns).
        IF plfanns = TRUE THEN FILL-IN-PLREG =   "Användare är registrerad för GPL" .
        ELSE FILL-IN-PLREG =  "Användare är inte registrerad för GPL". 
        DISPLAY FILL-IN-PLREG WITH FRAME FRAME-PERSONALLIGGARE.                        
     END.
  END.   
  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&UNDEFINE SELF-NAME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CUSTOM _MAIN-BLOCK C-Win 


/* ***************************  Main Block  *************************** */

/* Set CURRENT-WINDOW: this will parent dialog-boxes and frames.        */
ASSIGN CURRENT-WINDOW                = {&WINDOW-NAME} 
       THIS-PROCEDURE:CURRENT-WINDOW = {&WINDOW-NAME}.

/* The CLOSE event can be used from inside or outside the procedure to  */
/* terminate it.                                                        */
ON CLOSE OF THIS-PROCEDURE DO:
   IF VALID-HANDLE(restuserh) THEN DELETE PROCEDURE restuserh NO-ERROR.
   restuserh = ?.
   {BORTBRWPROC.I}
   RUN disable_UI.
END.   
ON WINDOW-CLOSE OF {&WINDOW-NAME} DO:
  APPLY "CLOSE":U TO THIS-PROCEDURE.
  RETURN NO-APPLY.
END.
ON ENDKEY, END-ERROR OF {&WINDOW-NAME} ANYWHERE DO:
  APPLY "CLOSE":U TO THIS-PROCEDURE.
  RETURN NO-APPLY.
END.
/* Best default for GUI applications is...                              */
PAUSE 0 BEFORE-HIDE.

/* Now enable the interface and wait for the exit condition.            */
/* (NOTE: handle ERROR and END-KEY so cleanup code will always fire.    */
MAIN-BLOCK:
DO ON ERROR   UNDO MAIN-BLOCK, LEAVE MAIN-BLOCK
   ON END-KEY UNDO MAIN-BLOCK, LEAVE MAIN-BLOCK:
   
  {WIN_M_START.I}
 
  {muswait.i}
  {ALLSTARTDYN.I} 
 
 
  RUN ladda_UI.
  
  IF Guru.Konstanter:varforetypval[2] = 0 THEN 
  RUN forstsisttid_UI IN asfaktapph (INPUT pkod, OUTPUT forstdat, OUTPUT sistdat).   
  IF forstdat NE  ? THEN DO:
     ASSIGN FILL-IN-FTID = forstdat.
  END.
  IF sistdat NE ? THEN DO:
     ASSIGN FILL-IN-STID = sistdat.
  END.    
  
  
   IF Guru.Konstanter:varforetypval[46] = 1 THEN DO:     
      RUN hfaktor IN asfaktapph (INPUT pkod, OUTPUT avkfaktor, OUTPUT sefaktor).   
      IF avkfaktor > 0 THEN DO:
         ASSIGN FILL-IN-AKFAKTOR = avkfaktor.
      END.
      IF sefaktor > 0 THEN DO:
         ASSIGN FILL-IN-SFAKTOR = avkfaktor.
      END.
   END.
      
   IF Guru.Konstanter:globforetag = "gkal" OR Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "elpa" THEN DO:   
      RUN hdispens IN asfaktapph (INPUT pkod, OUTPUT dispens, OUTPUT dardatum, OUTPUT dargodk).         
      ASSIGN FILL-IN-DISPENS = dispens.
      RUN hdispensm IN asfaktapph (INPUT pkod, OUTPUT dispensm, OUTPUT dmandatum, OUTPUT dmangodk).         
      ASSIGN FILL-IN-DISPENSM = dispensm.            
   END.
   IF Guru.Konstanter:globforetag = "MISV"  THEN DO:   
      RUN hdispens48 IN asfaktapph (INPUT pkod, OUTPUT dispens48, OUTPUT d48datum, OUTPUT d48godk).         
      ASSIGN FILL-IN-DISPENS48 = dispens48.                  
   END.
   
   IF Guru.Konstanter:globforetag = "gkal" OR Guru.Konstanter:globforetag = "elpa" THEN DO:   
      RUN spfrisk IN asfaktapph (INPUT pkod, OUTPUT spafr).         
      ASSIGN FILL-IN-SPARRFR = spafr.            
   END.
   IF Guru.Konstanter:globforetag = "gkal" OR  Guru.Konstanter:globforetag = "sund" OR Guru.Konstanter:globforetag = "TECM" THEN DO:   
      RUN fortro IN asfaktapph (INPUT pkod, OUTPUT ftro).         
      ASSIGN FILL-IN_FORTRO = ftro.            
   END.
   IF Guru.Konstanter:globforetag = "gkal"  THEN DO:   
      RUN tillit IN asfaktapph (INPUT pkod, OUTPUT tillit).         
      ASSIGN FILL-IN_TILLIT = tillit.            
   END.
   
   IF Guru.Konstanter:globforetag = "gkal" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "elpa" THEN DO:   
      RUN havafor IN asfaktapph (INPUT pkod, OUTPUT avarfor).         
      ASSIGN FILL-IN-AVAFOR = avarfor.            
   END.
   IF Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "elpa" THEN DO:   
      RUN lakdispens IN asfaktapph (INPUT pkod, OUTPUT lakdispens).         
      ASSIGN FILL-IN-DISPELAK = lakdispens.            
   END.
  
   IF Guru.Konstanter:globforetag = "MISV"  THEN DO:  
      FILL-IN-DISPENS:LABEL = " Tillåt > 200 tim/år ÖV".     
   END.
      
   IF Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "snat" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "MISV" THEN DO:   
      RUN lonvaxatk IN asfaktapph (INPUT pkod, OUTPUT lonvaxatk).         
      ASSIGN FILL-IN_LONVATK = lonvaxatk.            
   END.
   IF Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV"  THEN DO:
      RUN flexstsl IN asfaktapph (INPUT pkod, OUTPUT flst, output flsl).         
      ASSIGN FILL-IN-FLEXSTART = flst
      FILL-IN-FLEXSLUT = flsL.            
   END.
   IF Guru.Konstanter:globforetag = "SNAT"  THEN DO:   
      
      RUN htillatnodf IN asfaktapph (INPUT pkod, OUTPUT nofall, OUTPUT nodatum, OUTPUT nogodk ).         
      ASSIGN FILL-IN-NODF = nofall.                  
   END.
   
   FILL-IN-ATERFOR50:TOOLTIP = "Obs! Kontrollera hur mycket kompledigt den anställde har tagit ut. Max 50 timmar kan återföras.  Facket skall informaeras".   
   IF Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "CGKAL"  THEN DO:   
      RUN ater50_UI IN asfaktapph (INPUT pkod, OUTPUT ater50,OUTPUT a50tim, OUTPUT a50datum, OUTPUT a50godk).
           
      ASSIGN 
      FILL-IN-ATERFOR50 = ater50
      FILL-IN-ATERTIM = a50tim.            
   END.
   /*Nya regler allmän övertid 200 tim/kalkenderår , extra övertid + 150 timmar vid särskilda skäl
   Lena 20171114
   */
   IF Guru.Konstanter:varforetypval[2] = 0 THEN
   RUN ovgrans_UI IN asfaktapph ( OUTPUT ovgrans).
   FILL-IN-DISPENS:LABEL = "Tillåt > " + STRING(ovgrans) + " tim/år ÖV".
   
   IF Guru.Konstanter:varforetypval[2] = 0 THEN DO:
      RUN sealltid_UI IN asfaktapph (INPUT pkod, OUTPUT sealltid, OUTPUT sedatum, OUTPUT seanv).           
      ASSIGN FILL-IN-SEALLTID = sealltid.
   END.   
   DEBUGGER:SET-BREAK().
   IF Guru.Konstanter:varforetypchar[9] = "1" THEN DO:
      RUN hmtpersligg IN asfaktapph (INPUT pkod, OUTPUT eorgnr,output eforetag).     
      
      IF eorgnr = "" THEN  ASSIGN FILL-IN-ORGNR = "0000000000".
      ELSE ASSIGN FILL-IN-ORGNR = eorgnr.     
      FILL-IN-FORETAG = eforetag.
      
   END.   
  
  RUN enable_UI.
   ASSIGN  
   FILL-IN_FLEXTID:HIDDEN                    = TRUE
   FILL-IN-AKFAKTOR:HIDDEN                   = TRUE
   FILL-IN-SFAKTOR:HIDDEN                    = TRUE   
   FILL-IN-DISPENS48:HIDDEN                  = TRUe
   FILL-IN-DISPELAK:HIDDEN                   = TRUE   
   FILL-IN-SPARRFR:HIDDEN                    = TRUE
   FILL-IN_FORTRO:HIDDEN                     = TRUE
   FILL-IN_TILLIT:HIDDEN                     = TRUE
   FILL-IN_LAGBAS:HIDDEN                     = TRUE
   FILL-IN_LONVATK:HIDDEN                    = TRUE
   CMB_ORGCHEF:HIDDEN                        = TRUE
   CMB_BEF2:HIDDEN                           = TRUE
   FILL-IN_MOBILRADIO:HIDDEN                 = TRUE
   FILL-IN_PERSONSOK:HIDDEN                  = TRUE
   CMB_FAVTAL:HIDDEN                         = TRUE
   FILL-IN-FLEXSTART:HIDDEN                  = TRUE
   FILL-IN-FLEXSLUT:HIDDEN                  = TRUE
   FILL-IN-ORGNR:HIDDEN                      = TRUE
   FILL-IN-FORETAG:HIDDEN                    = TRUE
   FILL-IN-ATERFOR50:HIDDEN                    = TRUE
   FILL-IN-ATERTIM:HIDDEN                    = TRUE   
   FILL-IN-AVAFOR:HIDDEN                       = TRUE
   FILL-IN-NODF:HIDDEN                     = TRUE.
   BTN_OVER:HIDDEN = TRUE.
  IF Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "ELPA" THEN DO:
      CMB_ORGCHEF:HIDDEN                     = FALSE.
   END.
   IF Guru.Konstanter:varforetypval[46] = 1 THEN DO:      
      ASSIGN
      FILL-IN-AKFAKTOR:HIDDEN                    = FALSE
      FILL-IN-SFAKTOR:HIDDEN                     = FALSE.
   END.      
   IF Guru.Konstanter:globforetag = "MISV"  THEN DO:
      FILL-IN-DISPENS48:HIDDEN                    = FALSE.
   END.               
   IF Guru.Konstanter:globforetag = "GKAL"  THEN DO:      
      FILL-IN-SPARRFR:HIDDEN                    = FALSE.         
   END.   
   IF Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "TECM" THEN DO:           
      FILL-IN_FORTRO:HIDDEN                    = FALSE.         
   END.
   IF Guru.Konstanter:globforetag = "GKAL"  THEN DO:           
      FILL-IN_TILLIT:HIDDEN                    = FALSE.         
   END.      
   IF Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "GKAL"  THEN DO:      
      FILL-IN-DISPELAK:HIDDEN                    = FALSE.         
   END.
   IF  Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "LULE"  OR Guru.Konstanter:globforetag = "ELPA" THEN DO:      
      FILL-IN_FLEXTID:HIDDEN = FALSE.
      ENABLE FILL-IN_FLEXTID WITH FRAME FRAME-AVTAL.
      DISPLAY FILL-IN_FLEXTID WITH FRAME FRAME-AVTAL.
   END.   
   IF Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" THEN DO:
      FILL-IN-ATERFOR50:HIDDEN = FALSE.
      IF FILL-IN-ATERFOR50 = TRUE THEN  FILL-IN-ATERTIM:HIDDEN                    = FALSE.
      ELSE DO:
         FILL-IN-ATERTIM = 0.
         FILL-IN-ATERTIM:HIDDEN                    = TRUE.
      END.    
            
      IF FILL-IN_FLEXTID = TRUE THEN DO: 
         ASSIGN                 
         CMB_FAVTAL:HIDDEN = FALSE.
         /*FILL-IN-FLEXSTART:HIDDEN = FALSE
         FILL-IN-FLEXSLUT:HIDDEN = FALSE.*/
         ENABLE CMB_FAVTAL WITH FRAME FRAME-AVTAL.
         DISPLAY CMB_FAVTAL /*FILL-IN-FLEXSTART FILL-IN-FLEXSLUT*/ WITH FRAME FRAME-AVTAL.
      END.
   END.
   IF Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "sund" OR Guru.Konstanter:globforetag = "misv" OR Guru.Konstanter:globforetag = "snat" THEN DO:
      FILL-IN-AVAFOR:HIDDEN                       = FALSE.
   END.    
   IF Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "snat" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "MISV" THEN DO:
      /*LÖNEVÄXLING ATK*/
      IF FILL-IN_SEMFOR = TRUE THEN  FILL-IN_LONVATK:HIDDEN                    = FALSE.
      ELSE DO:
         FILL-IN_LONVATK = FALSE.
         FILL-IN_LONVATK:HIDDEN                    = TRUE.
      END.            
   END.        
   IF Guru.Konstanter:globforetag = "CGRAN"  THEN DO:      
      FILL-IN_LAGBAS:HIDDEN                         = FALSE.
   END.
   IF Guru.Konstanter:globforetag = "SNAT"  THEN DO:
      FILL-IN-NODF:HIDDEN                     =  FALSE.
   END.   
  /* personalliggare - visa flik i aonr - visa fält i personal */ 
  IF Guru.Konstanter:varforetypchar[9] = "1" THEN DO:
     FILL-IN-ORGNR:HIDDEN = FALSE.
     FILL-IN-FORETAG:HIDDEN = FALSE.
     ENABLE FILL-IN-ORGNR FILL-IN-FORETAG WITH FRAME FRAME-PERSONALLIGGARE.
     DISPLAY FILL-IN-ORGNR FILL-IN-FORETAG WITH FRAME FRAME-PERSONALLIGGARE.
  END.   
  ELSE DO:
     FILL-IN-ORGNR:HIDDEN = TRUE.
     FILL-IN-FORETAG:HIDDEN = TRUE.
  END.   
  RUN vdis_UI.
   RAD_PERS = 1.
   APPLY "VALUE-CHANGED" TO RAD_PERS.
   IF varifran = 1 THEN musz = musz.
   ELSE DO: 
      DISABLE FILL-IN_PERSONALKOD  WITH FRAME {&FRAME-NAME}.
      DISABLE CMB_VECKO WITH FRAME FRAME-ARBETSTIDER.
   END.
   IF varifran = 0 THEN DO:    
      /*enbart visning av uppgifter*/
      DISABLE FILL-IN_FORNAMN FILL-IN_EFTERNAMN FILL-IN_ANSTNR FILL-IN_PERSONNUMMER  CMB_OMR  WITH FRAME {&FRAME-NAME}.
      DISABLE  FILL-IN_TIDSGODK  BRW_GODK WITH FRAME FRAME-TIDSKRIVNING.         
   END.
   /*EJTIDFOR*/
   IF Guru.Konstanter:varforetypval[2] = 1 AND varifran = 0 THEN DO:
      BTN_OK:HIDDEN = TRUE.
   END.
   ELSE IF Guru.Konstanter:globforetag = "GRAN" THEN DO:
      FILL-IN_ANSTNR = FILL-IN_PERSONALKOD.
      DISPLAY  FILL-IN_ANSTNR WITH FRAME {&FRAME-NAME}.
      DISABLE  FILL-IN_ANSTNR WITH FRAME {&FRAME-NAME}.
   END.
  {FRMSIZEF.I}
  
  Guru.GlobalaVariabler:collefth = BTN_AVB:HANDLE.
  Guru.GlobalaVariabler:colrighth = BTN_OK:HANDLE.      
  RUN buttcolh_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).  
 
  FILL-IN_TELEFONSEM:HIDDEN = TRUE.
    
            
  {musarrow.i}    
  {WIN_M_SLUT.I}
   
  ON 'VALUE-CHANGED' OF FRAME FRAME-AVTAL PERSISTENT RUN fixastorlek_UI IN THIS-PROCEDURE.
  RUN setapplyvc IN framesizeh (INPUT FRAME FRAME-AVTAL:HANDLE).
  RUN fixastorlek_UI.
  IF NOT THIS-PROCEDURE:PERSISTENT THEN
    WAIT-FOR CLOSE OF THIS-PROCEDURE.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


/* **********************  Internal Procedures  *********************** */

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE allstartbrw_UI C-Win 
PROCEDURE allstartbrw_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
    ASSIGN   
   godkannartemp.PERSONALKOD:READ-ONLY IN BROWSE BRW_GODK = TRUE.   
   RUN DYNBRW.P PERSISTENT SET brwproc[1] 
      (INPUT BRW_GODK:HANDLE IN FRAME FRAME-TIDSKRIVNING).
   RUN DYNBRW.P PERSISTENT SET brwproc[2] 
      (INPUT BRW_PERS:HANDLE IN FRAME FRAME-TIDSKRIVNING).       
   IF Guru.Konstanter:appcon THEN DO:
      IF Guru.Konstanter:varforetypval[27] = 0 THEN RUN ASFAKTAPP.P PERSISTENT SET asfaktapph ON Guru.Konstanter:apphand TRANSACTION DISTINCT. 
   END.
   ELSE DO:      
      IF Guru.Konstanter:varforetypval[27] = 0 THEN RUN ASFAKTAPP.P PERSISTENT SET asfaktapph.
   END.   
   IF NOT VALID-HANDLE(restuserh) THEN DO:
      IF Guru.Konstanter:appcon THEN DO:
         RUN RESTUSERS.P PERSISTENT SET restuserh ON Guru.Konstanter:apphand TRANSACTION DISTINCT.
      END.
      ELSE DO:      
         RUN RESTUSERS.P PERSISTENT SET restuserh.
      END.  
   END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE btnok_UI C-Win 
PROCEDURE btnok_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   
   ASSIGN
   CMB_OMR = INPUT FRAME {&FRAME-NAME} CMB_OMR
   FILL-IN_PERSONALKOD = INPUT FILL-IN_PERSONALKOD  
   FILL-IN_ANSTNR = INPUT FILL-IN_ANSTNR
   FILL-IN_PERSONNUMMER = INPUT FILL-IN_PERSONNUMMER
   FILL-IN_FORNAMN = INPUT FILL-IN_FORNAMN
   FILL-IN_EFTERNAMN = INPUT FILL-IN_EFTERNAMN
  
   FILL-IN_BOXEN = INPUT FRAME FRAME-ADRESS FILL-IN_BOXEN
   FILL-IN_GATUADRESS = INPUT FILL-IN_GATUADRESS
   FILL-IN_MOBILRADIO = INPUT FILL-IN_MOBILRADIO
   FILL-IN_MOBILTEL = INPUT FILL-IN_MOBILTEL      
   FILL-IN_PERSONSOK = INPUT FILL-IN_PERSONSOK
   FILL-IN_EPOST = TRIM(INPUT FILL-IN_EPOST)
   FILL-IN_POSTADRESS = INPUT FILL-IN_POSTADRESS
   FILL-IN_POSTNUMMER = INPUT FILL-IN_POSTNUMMER
   FILL-IN_TELEFON = INPUT FILL-IN_TELEFON
   FILL-IN_TELEFON2 = INPUT FILL-IN_TELEFON2
   FILL-IN_TELEFONSEM = INPUT FILL-IN_TELEFONSEM
   
   
   FILL-IN_TIDSGODK = INPUT FRAME FRAME-TIDSKRIVNING FILL-IN_TIDSGODK
   
   FILL-IN_AKTIV = INPUT FRAME FRAME-AVTAL FILL-IN_AKTIV
   FILL-IN_DELTID = INPUT FILL-IN_DELTID   
   FILL-IN_FLEXTID = INPUT FILL-IN_FLEXTID
   FILL-IN-AKFAKTOR = INPUT FILL-IN-AKFAKTOR   
   FILL-IN-SFAKTOR = INPUT FILL-IN-SFAKTOR
   FILL-IN-DISPENS = INPUT FILL-IN-DISPENS
   FILL-IN-DISPENSM = INPUT FILL-IN-DISPENSM
   FILL-IN-DISPENS48 = INPUT FILL-IN-DISPENS48
   FILL-IN-DISPELAK = INPUT FILL-IN-DISPELAK
   FILL-IN-AVAFOR = INPUT FILL-IN-AVAFOR
   FILL-IN-SPARRFR = INPUT FILL-IN-SPARRFR
   FILL-IN_FORTRO = INPUT FILL-IN_FORTRO
   FILL-IN_TILLIT = INPUT FILL-IN_TILLIT
   FILL-IN_LONVATK = INPUT FILL-IN_LONVATK
   FILL-IN-ATERFOR50 = INPUT FILL-IN-ATERFOR50
   FILL-IN-ATERTIM = INPUT FILL-IN-ATERTIM
  
   
   CMB_ORGCHEF = INPUT CMB_ORGCHEF.
   
   FIND FIRST omrtemp WHERE omrtemp.NAMN = CMB_OMR USE-INDEX OMRNAMN NO-LOCK.
   FIND FIRST valperstemp WHERE valperstemp.PERSONALKOD = FILL-IN_PERSONALKOD NO-ERROR.
   IF NOT AVAILABLE valperstemp THEN DO:
       CREATE valperstemp.       
   END.    
   ASSIGN                     
   valperstemp.ORGCHEF       = CMB_ORGCHEF
   valperstemp.OMRADE        = omrtemp.OMRADE
   valperstemp.AKTIV         = FILL-IN_AKTIV         
   valperstemp.DELTID        = FILL-IN_DELTID        
   valperstemp.ANSTNR        = FILL-IN_ANSTNR        
   /*valperstemp.ANSVARIGTIDR  = FILL-IN_ANSVARIGTIDR  */
   valperstemp.BOXEN         = FILL-IN_BOXEN         
   valperstemp.EFTERNAMN     = FILL-IN_EFTERNAMN     
   valperstemp.FORNAMN       = FILL-IN_FORNAMN       
   valperstemp.GATUADRESS    = FILL-IN_GATUADRESS    
   valperstemp.MOBILRADIO    = FILL-IN_MOBILRADIO    
   valperstemp.MOBILTEL      = FILL-IN_MOBILTEL      
   valperstemp.PERSONALKOD   = FILL-IN_PERSONALKOD   
   valperstemp.PERSONNUMMER  = FILL-IN_PERSONNUMMER  
   valperstemp.PERSONSOK = ""
   SUBSTRING(valperstemp.PERSONSOK,1,19) = FILL-IN_PERSONSOK     
   SUBSTRING(valperstemp.PERSONSOK,20) = FILL-IN_EPOST
   valperstemp.POSTADRESS    = FILL-IN_POSTADRESS    
   valperstemp.POSTNUMMER    = FILL-IN_POSTNUMMER    
   valperstemp.TELEFON       = FILL-IN_TELEFON       
   valperstemp.TELEFON2      = FILL-IN_TELEFON2      
   valperstemp.TELEFONSEM    = FILL-IN_TELEFONSEM    
   valperstemp.TIDSGODK      = FILL-IN_TIDSGODK      
   valperstemp.LAGBAS        = FILL-IN_LAGBAS        
   valperstemp.OVERTIDUTTAG  = FILL-IN_OVERTIDUTTAG .
   IF      FILL-IN_SEMFOR = FALSE THEN valperstemp.OMREGTID = 0.
   ELSE IF FILL-IN_SEMFOR = TRUE  THEN valperstemp.OMREGTID = 1.
   ASSIGN 
   CMB_VECKO = INPUT FRAME FRAME-ARBETSTIDER CMB_VECKO  
   CMB_TRA   = INPUT CMB_TRA 
   CMB_ANST  = INPUT CMB_ANST
   CMB_BEF   = INPUT CMB_BEF
   CMB_BEF2   = INPUT CMB_BEF2
   CMB_OVERUT   = INPUT CMB_OVERUT
   CMB_BER   = INPUT CMB_BER.
   
  
   IF CMB_OVERUT = "Komp" THEN valperstemp.OVERTIDUTTAG = "K" .
   IF CMB_OVERUT = "Över" THEN valperstemp.OVERTIDUTTAG = "Ö" .
   IF CMB_OVERUT = "Flex" THEN valperstemp.OVERTIDUTTAG = "F" . 
   IF CMB_OVERUT = "Ejöv" THEN valperstemp.OVERTIDUTTAG = "I" .
   
     
   FOR EACH valperskolltemp:
      DELETE valperskolltemp.
   END.
   CREATE valperskolltemp.
   BUFFER-COPY valperstemp TO valperskolltemp.
   FOR EACH valsoktemp:
      DELETE valsoktemp.
   END.   
   IF Guru.Konstanter:globforetag = "cELPA" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" THEN DO: 
      ASSIGN 
      CMB_FAVTAL = INPUT CMB_FAVTAL.
      /*IF CMB_FAVTAL = "Sundsvall Elnät" THEN FILL-IN-FAVTAL = "TE".
      IF CMB_FAVTAL = "Sundsvall kollektiv Elnät" THEN FILL-IN-FAVTAL = "K".*/
      IF CMB_FAVTAL = "8-17" THEN FILL-IN-FAVTAL = "TE".
      IF CMB_FAVTAL = "7-16" THEN FILL-IN-FAVTAL = "K".
      IF CMB_FAVTAL = "Sundsvall kollektiv Vatten" THEN FILL-IN-FAVTAL = "KV".
      IF CMB_FAVTAL = "Sundsvall Övriga" THEN FILL-IN-FAVTAL = "T".         
      IF CMB_FAVTAL = "Korsta" THEN FILL-IN-FAVTAL = "TU".         
   END.
   ELSE FILL-IN-FAVTAL = "T".
   
   IF FILL-IN_FORTRO = TRUE AND  FILL-IN_FLEXTID = TRUE THEN DO:
      MESSAGE "Förtroendetid går inte att ha om man har flexavtal." VIEW-AS ALERT-BOX.      
      musz = TRUE.
      RETURN.
   END.       
   IF FILL-IN_FORTRO = TRUE AND  CMB_OVERUT NE "Ejöv" THEN DO:
      MESSAGE "Förtroendetid går inte att ha om man har övertidsavtal." VIEW-AS ALERT-BOX.      
      musz = TRUE.
      RETURN.
   END.
   IF FILL-IN_TILLIT = TRUE AND  FILL-IN_FORTRO = TRUE THEN DO:
      MESSAGE "Det går inte att ha både Tillitstid och Förtroendetid." VIEW-AS ALERT-BOX.      
      musz = TRUE.
      RETURN.
   END.
   IF FILL-IN_TILLIT = TRUE AND  FILL-IN_FLEXTID = TRUE THEN DO:
      MESSAGE "Tillitstid går inte att ha om man har flexavtal." VIEW-AS ALERT-BOX.      
      musz = TRUE.
      RETURN.
   END.       
   IF FILL-IN_TILLIT = TRUE AND  CMB_OVERUT NE "Ejöv" THEN DO:
      MESSAGE "Tillitstid måste ha vara inställt på Ejöv som start." VIEW-AS ALERT-BOX.      
      musz = TRUE.
      RETURN.
   END.   
   IF FILL-IN_FLEXTID = FALSE AND  CMB_OVERUT = "Flex" THEN DO:
      MESSAGE "Personen har inte flexavtal och kan då inte heller ha Övertiduttag = Flex." VIEW-AS ALERT-BOX.      
      musz = TRUE.
      RETURN.
   END.
   IF FILL-IN-ATERFOR50 = TRUE AND  FILL-IN-ATERTIM > 50 THEN DO:
      MESSAGE "Det går max att överföra 50 tim." VIEW-AS ALERT-BOX.      
      musz = TRUE.
      RETURN.
   END.
   IF FILL-IN-ATERFOR50 = TRUE AND  FILL-IN-ATERTIM = 0 THEN DO:
      MESSAGE "Du har svarat ja på att överföra timmar men angett 0 tim." VIEW-AS ALERT-BOX.      
      musz = TRUE.
      RETURN.
   END.   
   
    
   IF Guru.Konstanter:varforetypval[27] = 0 THEN DO:
      CREATE valsoktemp.
      ASSIGN
      valsoktemp.SOKVAL = 1
      valsoktemp.SOKINT[1]  =  CMB_VECKO 
      valsoktemp.SOKCHAR[1] =  CMB_TRA  
      valsoktemp.SOKCHAR[2] = CMB_ANST 
      valsoktemp.SOKCHAR[3] = CMB_BEF  
      valsoktemp.SOKCHAR[4] = CMB_BER.
   END.   
   /*IF Guru.Konstanter:globforetag = "LULE" THEN DO: 
      ASSIGN
      valsoktemp.SOKCHAR[3] = CMB_BEF2.  
   END.*/
   IF Guru.Konstanter:varforetypval[2] = 1 THEN.
   ELSE DO:
      IF pkod NE "" THEN DO:
         IF spomr NE valperstemp.OMRADE THEN DO:
            RUN bytbolag IN asfaktapph (INPUT FILL-IN_PERSONALKOD,INPUT valperstemp.OMRADE,INPUT spomr,OUTPUT judbyt, OUTPUT finnstid).
            IF judbyt = TRUE AND finnstid = TRUE THEN DO:
               MESSAGE "Du byter bolag på denna person. Personen har tid skriven som ännu ej är körd till ekonomi och lön."  SKIP  
                       "Denna tid kommer att gå över på det nya bolaget. Kontrollera att debiteringspriserna för tidregistreringarna har rätt pris vid brytningen."
               VIEW-AS ALERT-BOX.
            END.   
         END.
      END.
   END.            
   
   IF Guru.Konstanter:varforetypval[27] = 0 THEN DO:
      CREATE valsoktemp.
      ASSIGN
      valsoktemp.SOKVAL = 11
      valsoktemp.SOKLOG[1]  =  FILL-IN_FLEXTID  
      valsoktemp.SOKCHAR[1] =  FILL-IN-FAVTAL.
      CREATE valsoktemp.
      ASSIGN
      valsoktemp.SOKVAL = 2
      valsoktemp.SOKCHAR[1] = ansvgamla
      valsoktemp.SOKCHAR[2] = tidggamla
      valsoktemp.SOKCHAR[3] = Guru.Konstanter:globanv
      valsoktemp.SOKINT[3] = Guru.Konstanter:globniv.
   END.
   DEBUGGER:SET-BREAK().
   IF Guru.Konstanter:varforetypval[27] = 1 THEN DO:
      /*EKG*/
      IF Guru.Konstanter:appcon THEN DO:      
         RUN PERSUPP2.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
         (INPUT 2,INPUT pkod,INPUT TABLE valperskolltemp,INPUT-OUTPUT TABLE valsoktemp,OUTPUT TABLE felmeddtemp).
      END.
      ELSE DO:
         RUN PERSUPP2.P 
         (INPUT 2,INPUT pkod,INPUT TABLE valperskolltemp,INPUT-OUTPUT TABLE valsoktemp,OUTPUT TABLE felmeddtemp).
      END.
   END. 
   ELSE DO:   
      IF Guru.Konstanter:appcon THEN DO:      
         RUN PERSUPP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
         (INPUT 2,INPUT pkod,INPUT TABLE valperskolltemp,INPUT-OUTPUT TABLE valsoktemp,OUTPUT TABLE felmeddtemp).
      END.
      ELSE DO:
         RUN PERSUPP.P 
         (INPUT 2,INPUT pkod,INPUT TABLE valperskolltemp,INPUT-OUTPUT TABLE valsoktemp,OUTPUT TABLE felmeddtemp).
      END.
   END.   
   FOR EACH felmeddtemp:
      MESSAGE felmeddtemp.FELMEDD VIEW-AS ALERT-BOX.
      DELETE felmeddtemp.
      /* rensa temptabeller annars ser det ut som som att det har uppdaterats när man "Hämtar person"  Lena 20160125*/
      FIND FIRST valperskolltemp   NO-ERROR.
      IF AVAILABLE valperskolltemp THEN DO:                  
         FIND FIRST valperstemp  WHERE valperstemp.personalkod = valperskolltemp.PERSONALKOD NO-ERROR.
         IF AVAILABLE valperstemp THEN DO:
            DELETE valperstemp.
            DELETE valperskolltemp.
         END.   
      END.
      musz = TRUE.
      RETURN.
   END.
   IF Guru.Konstanter:varforetypval[46] = 1 THEN DO:
            
      RUN sphfaktor IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-AKFAKTOR, INPUT FILL-IN-SFAKTOR).   
   END.
   IF Guru.Konstanter:globforetag = "gkal" OR Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "elpa" THEN DO:   
      IF FILL-IN-DISPENS = FALSE THEN RUN bortdispens IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN spdispens IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-DISPENS, INPUT TODAY, INPUT Guru.Konstanter:globanv).
      IF FILL-IN-DISPENSM = FALSE THEN RUN bortdispensm IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN spdispensM IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-DISPENSM, INPUT TODAY, INPUT Guru.Konstanter:globanv).   
   END.
   IF Guru.Konstanter:globforetag = "MISV"  THEN DO:   
      IF FILL-IN-DISPENS48 = FALSE THEN RUN bortdispens48 IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN spdispens48 IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-DISPENS48, INPUT TODAY, INPUT Guru.Konstanter:globanv).         
   END.
   IF Guru.Konstanter:globforetag = "gkal" OR Guru.Konstanter:globforetag = "elpa" THEN DO:   
      IF FILL-IN-SPARRFR = FALSE THEN RUN bortspfr IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN spspfr IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-SPARRFR).   
   END.
   IF Guru.Konstanter:globforetag = "GKAL" OR  Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "TECM" THEN DO:   
      IF FILL-IN_FORTRO = FALSE THEN RUN bortftro IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN spfortro IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN_FORTRO).   
   END.
   IF Guru.Konstanter:globforetag = "GKAL"  THEN DO:   
      IF FILL-IN_TILLIT = FALSE THEN RUN borttillit IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN sptillit IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN_TILLIT).   
   END.
   /*atkgräns*/
   IF Guru.Konstanter:globforetag = "gkal" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "MISV" OR Guru.Konstanter:globforetag = "elpa" THEN DO:  
      RUN atkgrans IN asfaktapph ( OUTPUT foremaxarbkort).    
      /*IF Guru.Konstanter:globforetag = "gkal" THEN foremaxarbkort = 63.
      ELSE IF Guru.Konstanter:globforetag = "SNAT" THEN foremaxarbkort = 63.
      ELSE IF Guru.Konstanter:globforetag = "LULE" THEN foremaxarbkort = 63.
      ELSE IF Guru.Konstanter:globforetag = "MISV" THEN foremaxarbkort = 27.
      ELSE foremaxarbkort = 54.     */
      IF FILL-IN-AVAFOR = 0 OR FILL-IN-AVAFOR = foremaxarbkort THEN RUN bortavafor IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN spavafor IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-AVAFOR).   
   END.   
   IF Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "elpa" THEN DO:   
      IF FILL-IN-DISPELAK = FALSE THEN RUN bortdispensla IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN spdispenslak IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-DISPELAK).   
   END.
   
   IF Guru.Konstanter:globforetag = "SNAT" THEN DO:   
      IF FILL-IN-NODF = FALSE THEN RUN bortnodfall IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN spnodfall IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-NODF, INPUT TODAY, INPUT Guru.Konstanter:globanv).   
      
   END.
  
   IF  Guru.Konstanter:globforetag = "GKAL" OR Guru.Konstanter:globforetag = "snat" OR Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "MISV" THEN DO:
      
      IF FILL-IN_SEMFOR = FALSE THEN FILL-IN_LONVATK = FALSE.   
      IF FILL-IN_LONVATK = FALSE THEN RUN bortlonvatk IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN splonvatk IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN_LONVATK).   
   END.
   DEBUGGER:SET-BREAK().
   IF Guru.Konstanter:globforetag = "snat" OR Guru.Konstanter:globforetag = "sund" OR Guru.Konstanter:globforetag = "misv" THEN DO:
      IF FILL-IN-FLEXSTART = ? AND FILL-IN-FLEXSLUT = ? THEN DO:
         RUN bortflexstsl IN asfaktapph (INPUT FILL-IN_PERSONALKOD).
      END.   
      ELSE DO:
         RUN spflexstsl IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-FLEXSTART, INPUT FILL-IN-FLEXSLUT).
      END.
         
   END.   
   IF Guru.Konstanter:globforetag = "sund" OR Guru.Konstanter:globforetag = "snat" OR Guru.Konstanter:globforetag = "misv" THEN DO:   
      IF FILL-IN-ATERFOR50 = FALSE THEN RUN bortater50 IN asfaktapph (INPUT FILL-IN_PERSONALKOD).   
      ELSE RUN spater50 IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-ATERFOR50, INPUT  FILL-IN-ATERTIM,INPUT TODAY, INPUT Guru.Konstanter:globanv).         
   END.
   IF Guru.Konstanter:varforetypval[2] = 0 THEN DO:
      IF FILL-IN-SEALLTID = FALSE THEN RUN bortsealltid IN asfaktapph (INPUT FILL-IN_PERSONALKOD).
      ELSE RUN spsealltid_UI IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT  FILL-IN-SEALLTID, INPUT TODAY, INPUT Guru.Konstanter:globanv).                 
   END.
   
   IF Guru.Konstanter:varforetypchar[9] = "1" THEN DO:
      DEBUGGER:SET-BREAK().
       
      IF INPUT FRAME FRAME-PERSONALLIGGARE FILL-IN-ORGNR = "" THEN  ASSIGN FILL-IN-ORGNR = "0000000000".
      ELSE ASSIGN FILL-IN-ORGNR = INPUT FILL-IN-ORGNR. 
      
      FILL-IN-FORETAG = INPUT FILL-IN-FORETAG.
      IF FILL-IN-ORGNR = "" AND FILL-IN-FORETAG = "" THEN RUN bortpersligg IN asfaktapph (INPUT FILL-IN_PERSONALKOD).
      ELSE IF FILL-IN-ORGNR = "0000000000" AND FILL-IN-FORETAG = "" THEN RUN bortpersligg IN asfaktapph (INPUT FILL-IN_PERSONALKOD).
      ELSE RUN sppersligg IN asfaktapph (INPUT FILL-IN_PERSONALKOD, INPUT FILL-IN-ORGNR, INPUT FILL-IN-FORETAG ).
      
   END.   
   
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE disable_UI C-Win  _DEFAULT-DISABLE
PROCEDURE disable_UI :
/*------------------------------------------------------------------------------
  Purpose:     DISABLE the User Interface
  Parameters:  <none>
  Notes:       Here we clean-up the user-interface by deleting
               dynamic widgets we have created and/or hide 
               frames.  This procedure is usually called when
               we are ready to "clean-up" after running.
------------------------------------------------------------------------------*/
  /* Delete the WINDOW we created */
  IF SESSION:DISPLAY-TYPE = "GUI":U AND VALID-HANDLE(C-Win)
  THEN DELETE WIDGET C-Win.
  IF THIS-PROCEDURE:PERSISTENT THEN DELETE PROCEDURE THIS-PROCEDURE.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE enable_UI C-Win  _DEFAULT-ENABLE
PROCEDURE enable_UI :
/*------------------------------------------------------------------------------
  Purpose:     ENABLE the User Interface
  Parameters:  <none>
  Notes:       Here we display/view/enable the widgets in the
               user-interface.  In addition, OPEN all queries
               associated with each FRAME and BROWSE.
               These statements here are based on the "Other 
               Settings" section of the widget Property Sheets.
------------------------------------------------------------------------------*/
  DISPLAY FILL-IN_PERSONALKOD FILL-IN_ANSTNR FILL-IN_PERSONNUMMER 
          FILL-IN_FORNAMN FILL-IN_EFTERNAMN CMB_OMR RAD_PERS 
      WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
  ENABLE FILL-IN_PERSONALKOD FILL-IN_ANSTNR FILL-IN_PERSONNUMMER 
         FILL-IN_FORNAMN FILL-IN_EFTERNAMN CMB_OMR RAD_PERS BTN_OK Btn_AVB 
      WITH FRAME DEFAULT-FRAME IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-DEFAULT-FRAME}
  DISPLAY FILL-IN_GATUADRESS FILL-IN_BOXEN FILL-IN_POSTNUMMER FILL-IN_POSTADRESS 
          FILL-IN_TELEFON FILL-IN_TELEFON2 FILL-IN_MOBILTEL FILL-IN_TELEFONSEM 
          FILL-IN_EPOST FILL-IN_MOBILRADIO FILL-IN_PERSONSOK 
      WITH FRAME FRAME-ADRESS IN WINDOW C-Win.
  ENABLE FILL-IN_GATUADRESS FILL-IN_BOXEN FILL-IN_POSTNUMMER FILL-IN_POSTADRESS 
         FILL-IN_TELEFON FILL-IN_TELEFON2 FILL-IN_MOBILTEL FILL-IN_TELEFONSEM 
         FILL-IN_EPOST FILL-IN_MOBILRADIO FILL-IN_PERSONSOK 
      WITH FRAME FRAME-ADRESS IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-FRAME-ADRESS}
  ENABLE CMB_VECKO FILL-IN-MAN FILL-IN-TIS FILL-IN-ONS FILL-IN-TOR FILL-IN-FRE 
         FILL-IN-LOR FILL-IN-SON FILL-IN-TOT FILL-IN-DSCH1 FILL-IN-DSCH2 
         FILL-IN-DSCH3 FILL-IN-DSCH4 FILL-IN-DSCH5 FILL-IN-DSCH6 FILL-IN-DSCH7 
         FILL-IN-TOTV FILL-IN-BORJ1 FILL-IN-BORJ2 FILL-IN-BORJ3 FILL-IN-BORJ4 
         FILL-IN-BORJ5 FILL-IN-BORJ6 FILL-IN-BORJ7 FILL-IN-SLU1 FILL-IN-SLU2 
         FILL-IN-SLU3 FILL-IN-SLU4 FILL-IN-SLU5 FILL-IN-SLU6 FILL-IN-SLU7 
         FILL-IN-TIM1 FILL-IN-TIM2 FILL-IN-TIM3 FILL-IN-TIM4 FILL-IN-TIM5 
         FILL-IN-TIM6 FILL-IN-TIM7 
      WITH FRAME FRAME-ARBETSTIDER IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-FRAME-ARBETSTIDER}
  DISPLAY FILL-IN_AKTIV CMB_BEF CMB_ORGCHEF CMB_ANST CMB_TRA CMB_BEF2 CMB_BER 
          FILL-IN_DELTID FILL-IN_FORTRO FILL-IN_TILLIT FILL-IN_FLEXTID 
          FILL-IN_SEMFOR FILL-IN_LONVATK FILL-IN-AVAFOR FILL-IN-SPARRFR 
          FILL-IN-DISPELAK FILL-IN_LAGBAS FILL-IN-AKFAKTOR FILL-IN-DISPENS 
          FILL-IN-ATERFOR50 FILL-IN-ATERTIM FILL-IN-SFAKTOR FILL-IN-DISPENSM 
          FILL-IN-DISPENS48 FILL-IN-NODF 
      WITH FRAME FRAME-AVTAL IN WINDOW C-Win.
  ENABLE FILL-IN_AKTIV CMB_BEF CMB_ORGCHEF CMB_ANST CMB_TRA CMB_BEF2 CMB_BER 
         FILL-IN_DELTID FILL-IN_FORTRO FILL-IN_TILLIT FILL-IN-FLEXSLUT 
         FILL-IN_FLEXTID CMB_FAVTAL FILL-IN-FLEXSTART FILL-IN_SEMFOR 
         FILL-IN_LONVATK FILL-IN-AVAFOR FILL-IN-SPARRFR FILL-IN-DISPELAK 
         FILL-IN_LAGBAS FILL-IN-AKFAKTOR FILL-IN-DISPENS FILL-IN-ATERFOR50 
         FILL-IN-ATERTIM FILL-IN-SFAKTOR FILL-IN-DISPENSM FILL-IN-DISPENS48 
         FILL-IN-NODF 
      WITH FRAME FRAME-AVTAL IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-FRAME-AVTAL}
  DISPLAY FILL-IN-PLREG 
      WITH FRAME FRAME-PERSONALLIGGARE IN WINDOW C-Win.
  ENABLE FILL-IN-ORGNR FILL-IN-FORETAG BTN_GPLREG BTN_GPLAVREG FILL-IN-PLREG 
      WITH FRAME FRAME-PERSONALLIGGARE IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-FRAME-PERSONALLIGGARE}
  DISPLAY FILL-IN_TIDSGODK CMB_OVERUT FILL-IN-FTID FILL-IN-STID FILL-IN-SEALLTID 
      WITH FRAME FRAME-TIDSKRIVNING IN WINDOW C-Win.
  ENABLE BRW_GODK BRW_PERS BTN_OVER FILL-IN_TIDSGODK CMB_OVERUT BTN_BACK 
         FILL-IN-SEALLTID 
      WITH FRAME FRAME-TIDSKRIVNING IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-FRAME-TIDSKRIVNING}
  VIEW C-Win.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE fixastorlek_UI C-Win 
PROCEDURE fixastorlek_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
  
  FRAME FRAME-ADRESS:ROW = RAD_PERS:ROW IN FRAME DEFAULT-FRAME + 1.
  FRAME FRAME-ARBETSTIDER:ROW = FRAME FRAME-ADRESS:ROW.
  FRAME FRAME-AVTAL:ROW = FRAME FRAME-ADRESS:ROW.
  FRAME FRAME-PERSONALLIGGARE:ROW = FRAME FRAME-ADRESS:ROW.
  FRAME FRAME-TIDSKRIVNING:ROW = FRAME FRAME-ADRESS:ROW.
  /*
  Guru.Konstanter:LabelFlytt(FILL-IN_PERSONALKOD:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_ANSTNR:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_PERSONNUMMER:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_FORNAMN:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_EFTERNAMN:HANDLE).
  Guru.Konstanter:LabelFlytt(CMB_OMR:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_GATUADRESS:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_BOXEN:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_POSTNUMMER:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_POSTADRESS:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_TELEFON:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_TELEFON2:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_MOBILTEL:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_TELEFONSEM:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_EPOST:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_MOBILRADIO:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_PERSONSOK:HANDLE).
  Guru.Konstanter:LabelFlytt(CMB_VECKO:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-DSCH1:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-BORJ1:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-SLU1:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-TIM1:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_AKTIV:HANDLE).
  Guru.Konstanter:LabelFlytt(CMB_BEF:HANDLE).
  Guru.Konstanter:LabelFlytt(CMB_ORGCHEF:HANDLE).
  Guru.Konstanter:LabelFlytt(CMB_ANST:HANDLE).
  Guru.Konstanter:LabelFlytt(CMB_TRA:HANDLE).
  Guru.Konstanter:LabelFlytt(CMB_BEF2:HANDLE).
  Guru.Konstanter:LabelFlytt(CMB_BER:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_DELTID:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_FORTRO:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_FLEXTID:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_SEMFOR:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_LONVATK:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-AVAFOR:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-SPARRFR:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-DISPELAK:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_LAGBAS:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-AKFAKTOR:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-DISPENS:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-ATERFOR50:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-ATERTIM:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-SFAKTOR:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-DISPENSM:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-DISPENS48:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-ORGNR:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-FORETAG:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-PLREG:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN_TIDSGODK:HANDLE).
  Guru.Konstanter:LabelFlytt(CMB_OVERUT:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-FTID:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-STID:HANDLE).
  Guru.Konstanter:LabelFlytt(FILL-IN-SEALLTID:HANDLE).
  */
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE ladda_UI C-Win 
PROCEDURE ladda_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
  /*EJTIDFOR*/
   
   IF Guru.Konstanter:varforetypval[2] = 1  THEN DO:
      RAD_PERS:DELETE("Tidskrivning") IN FRAME DEFAULT-FRAME.     
      RAD_PERS:DELETE("Avtal") IN FRAME DEFAULT-FRAME.
      RAD_PERS:DELETE("Arbetstider") IN FRAME DEFAULT-FRAME.
   END.
   ELSE IF varifran = 0 THEN DO:      
      RAD_PERS:DELETE("Avtal") IN FRAME DEFAULT-FRAME.
      RAD_PERS:DELETE("Arbetstider") IN FRAME DEFAULT-FRAME.            
   END.
   
   /* personalliggare - visa flik i aonr - visa fält i personal */ 
   IF Guru.Konstanter:varforetypchar[9] = "1" THEN DO:
     RAD_PERS:ADD-LAST("Personalliggare", 5) IN FRAME DEFAULT-FRAME.
     
   END.
     
   IF Guru.Konstanter:globforetag = "SUND" THEN DO:            
      status-ok = CMB_FAVTAL:ADD-LAST("Sundsvall Övriga") IN FRAME FRAME-AVTAL.     
      status-ok = CMB_FAVTAL:ADD-LAST("Korsta") IN FRAME FRAME-AVTAL.     
   END.
   IF Guru.Konstanter:globforetag = "SNAT" THEN DO:
      status-ok = CMB_FAVTAL:ADD-LAST("8-17") IN FRAME FRAME-AVTAL.
      status-ok = CMB_FAVTAL:ADD-LAST("7-16") IN FRAME FRAME-AVTAL.      
           
   END.
   IF Guru.Konstanter:globforetag = "MISV" THEN DO:      
      status-ok = CMB_FAVTAL:ADD-LAST("Sundsvall kollektiv Vatten") IN FRAME FRAME-AVTAL.
      status-ok = CMB_FAVTAL:ADD-LAST("Sundsvall Övriga") IN FRAME FRAME-AVTAL.           
   END.
      
   ASSIGN
   FILL-IN-MAN = "måndag"
   FILL-IN-TIS = "tisdag"
   FILL-IN-ONS = "onsdag"
   FILL-IN-TOR = "torsdag"
   FILL-IN-FRE = "fredag"
   FILL-IN-LOR = "lördag"
   FILL-IN-SON = "söndag"
   FILL-IN-TOT = "Tim/Veck".
   FOR EACH omrtemp USE-INDEX OMR NO-LOCK:
      status-ok = CMB_OMR:ADD-LAST(omrtemp.NAMN).
   END.
          
   IF Guru.Konstanter:globforetag = "GRAN" THEN DO:
      FIND FIRST omrtemp WHERE omrtemp.OMRADE = "One" USE-INDEX OMR NO-LOCK NO-ERROR.
   END.
   ELSE DO:   
      FIND FIRST omrtemp USE-INDEX OMR NO-LOCK NO-ERROR.
   END.      
   CMB_OMR:SCREEN-VALUE = omrtemp.NAMN.
   IF pkod = "" THEN DO : 
      ASSIGN       
      FILL-IN_SEMFOR = TRUE.
      /*spärr atk = Ja vid nyupplägg  Lena 20200116*/
   END.
   IF pkod NE "" THEN DO:
      FIND FIRST valperstemp WHERE valperstemp.PERSONALKOD = pkod NO-ERROR.
      ASSIGN
      FILL-IN_AKTIV = valperstemp.AKTIV
      FILL-IN_DELTID = valperstemp.DELTID
      FILL-IN_ANSTNR = valperstemp.ANSTNR
      /*FILL-IN_ANSVARIGTIDR = valperstemp.ANSVARIGTIDR*/
      FILL-IN_BOXEN = valperstemp.BOXEN
      FILL-IN_EFTERNAMN = valperstemp.EFTERNAMN
      FILL-IN_FORNAMN = valperstemp.FORNAMN
      FILL-IN_GATUADRESS = valperstemp.GATUADRESS
      FILL-IN_MOBILRADIO = valperstemp.MOBILRADIO
      FILL-IN_MOBILTEL = valperstemp.MOBILTEL
      FILL-IN_PERSONALKOD = valperstemp.PERSONALKOD
      FILL-IN_PERSONNUMMER = valperstemp.PERSONNUMMER
      FILL-IN_PERSONSOK = SUBSTRING(valperstemp.PERSONSOK,1,19)
      FILL-IN_EPOST = SUBSTRING(valperstemp.PERSONSOK,20)
      FILL-IN_POSTADRESS = valperstemp.POSTADRESS
      FILL-IN_POSTNUMMER = valperstemp.POSTNUMMER
      FILL-IN_TELEFON = valperstemp.TELEFON
      FILL-IN_TELEFON2 = valperstemp.TELEFON2
      FILL-IN_TELEFONSEM = valperstemp.TELEFONSEM
      FILL-IN_TIDSGODK = valperstemp.TIDSGODK
      FILL-IN_LAGBAS = valperstemp.LAGBAS
      FILL-IN_OVERTIDUTTAG = valperstemp.OVERTIDUTTAG.
      IF valperstemp.OMREGTID = 0 THEN FILL-IN_SEMFOR = FALSE.
      ELSE IF valperstemp.OMREGTID = 1 THEN FILL-IN_SEMFOR = TRUE.
      IF valperstemp.OVERTIDUTTAG = "K" THEN ASSIGN CMB_OVERUT :SCREEN-VALUE IN FRAME FRAME-TIDSKRIVNING = "Komp".
      IF valperstemp.OVERTIDUTTAG = "Ö" THEN ASSIGN CMB_OVERUT:SCREEN-VALUE = "Över".
      IF valperstemp.OVERTIDUTTAG = "F" THEN ASSIGN CMB_OVERUT:SCREEN-VALUE = "Flex". 
      IF valperstemp.OVERTIDUTTAG = "I" THEN ASSIGN CMB_OVERUT:SCREEN-VALUE = "Ejöv".
        
      CMB_OVERUT = INPUT CMB_OVERUT.
      /*ansvgamla = FILL-IN_ANSVARIGTIDR.*/
      tidggamla = FILL-IN_TIDSGODK.
      FIND FIRST omrtemp WHERE omrtemp.OMRADE = valperstemp.OMRADE 
      USE-INDEX OMR NO-LOCK NO-ERROR.
      IF AVAILABLE omrtemp THEN 
      ASSIGN  CMB_OMR:SCREEN-VALUE = omrtemp.NAMN.       
      spomr = valperstemp.OMRADE.
   END.
   IF Guru.Konstanter:globforetag = "LULE" OR Guru.Konstanter:globforetag = "ELPA" THEN DO:
     IF Guru.Konstanter:appcon THEN DO:      
         RUN RGRHMT.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
         (INPUT Guru.Konstanter:globforetag,OUTPUT TABLE rgrtemp).
      END.
      ELSE DO:
         RUN RGRHMT.P 
         (INPUT Guru.Konstanter:globforetag,OUTPUT TABLE rgrtemp).
      END.
      FOR EACH rgrtemp:
         CMB_ORGCHEF:ADD-LAST(rgrtemp.RGR).      
      END.
      FIND FIRST rgrtemp WHERE NO-LOCK NO-ERROR.
      IF AVAILABLE rgrtemp THEN DO:
         CMB_ORGCHEF:SCREEN-VALUE = rgrtemp.RGR.
      END.
      IF AVAILABLE valperstemp THEN DO:
         IF valperstemp.ORGCHEF NE "" THEN CMB_ORGCHEF:SCREEN-VALUE = valperstemp.ORGCHEF NO-ERROR.         
      END.
   END.
   FOR EACH aavtaltemp:
      IF aavtaltemp.TYP = "BEF" THEN DO:
         status-ok = CMB_BEF:ADD-LAST(aavtaltemp.AVTALNAMN).      
         status-ok = CMB_BEF2:ADD-LAST(aavtaltemp.AVTALNAMN).      
         IF lopkollk[1] = FALSE THEN DO:
            lopkollk[1] = TRUE.            
            ASSIGN CMB_BEF:SCREEN-VALUE = aavtaltemp.AVTALNAMN. 
            ASSIGN CMB_BEF2:SCREEN-VALUE = aavtaltemp.AVTALNAMN. 
         END.
         ELSE DO:            
            IF AVAILABLE valperstemp THEN DO:
               IF aavtaltemp.AVTALTYP = valperstemp.BEFATTNING THEN CMB_BEF:SCREEN-VALUE = aavtaltemp.AVTALNAMN. 
               IF aavtaltemp.AVTALTYP = valperstemp.BEFATTNING THEN CMB_BEF2:SCREEN-VALUE = aavtaltemp.AVTALNAMN. 
            END.
            ELSE DO:
              IF ( Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" ) AND aavtaltemp.AVTALNAMN = "Ej tid" THEN ASSIGN CMB_BEF:SCREEN-VALUE = "Ej tid". 
              IF Guru.Konstanter:globforetag = "MISV" AND aavtaltemp.AVTALNAMN = "Ej tid" THEN ASSIGN CMB_BEF:SCREEN-VALUE = "Ej tid". 
            END.            
         END.
      END.
      IF aavtaltemp.TYP = "BER" THEN DO:
         status-ok = CMB_BER:ADD-LAST(aavtaltemp.AVTALNAMN).
         IF lopkollk[2] = FALSE THEN DO:
            lopkollk[2] = TRUE.
            ASSIGN CMB_BER:SCREEN-VALUE = aavtaltemp.AVTALNAMN.
         END.
         ELSE DO:
            IF AVAILABLE valperstemp THEN DO:
              IF aavtaltemp.AVTALTYP = valperstemp.BEREDSKAPSAVTAL THEN CMB_BER:SCREEN-VALUE = aavtaltemp.AVTALNAMN.
            END.
         END.
      END.
      IF aavtaltemp.TYP = "TRA" THEN DO:
         status-ok = CMB_TRA:ADD-LAST(aavtaltemp.AVTALNAMN).
         IF lopkollk[3] = FALSE THEN DO:
            lopkollk[3] = TRUE.
            ASSIGN CMB_TRA:SCREEN-VALUE = aavtaltemp.AVTALNAMN.
         END.
         ELSE DO:
            IF AVAILABLE valperstemp THEN DO:
               IF aavtaltemp.AVTALTYP = valperstemp.TRAAVTAL THEN CMB_TRA:SCREEN-VALUE = aavtaltemp.AVTALNAMN.
            END.
         END.
      END.
      IF aavtaltemp.TYP = "ANS" THEN DO:
         status-ok = CMB_ANST:ADD-LAST(aavtaltemp.AVTALNAMN).
         IF lopkollk[4] = FALSE THEN DO:
            lopkollk[4] = TRUE.
            ASSIGN CMB_ANST:SCREEN-VALUE = aavtaltemp.AVTALNAMN.
         END.
         ELSE DO:
            IF AVAILABLE valperstemp THEN DO:
               IF aavtaltemp.AVTALTYP = valperstemp.ANSTALLNING THEN CMB_ANST:SCREEN-VALUE = aavtaltemp.AVTALNAMN.
            END.
         END.
      END.
      IF aavtaltemp.TYP = "VEC" THEN DO:
         status-ok = CMB_VECKO:ADD-LAST(aavtaltemp.AVTALNAMN) IN FRAME FRAME-ARBETSTIDER.      
      END.
   END.
   status-ok = CMB_VECKO:DELETE("0") NO-ERROR.      
   IF (Guru.Konstanter:globforetag = "CELPA" OR Guru.Konstanter:globforetag = "cGRAN") THEN DO:
      FILL-IN_ANSTNR:LABEL = "Succel sign".     
   END.
   ELSE IF Guru.Konstanter:globforetag = "GRAN" THEN DO:
      FILL-IN_ANSTNR:LABEL = "IFS-id". 
   END.
   ELSE DO:
      FILL-IN_ANSTNR:LABEL = "Anställningsnr.".  
   END.   
   FILL-IN_LAGBAS:LABEL = "Lagbas".     
   CMB_OMR:LABEL = Guru.Konstanter:gomrk.
   IF Guru.Konstanter:varforetypval[27] = 1 THEN.
   ELSE IF pkod NE "" THEN DO:
      {SOKSTART.I}
      ASSIGN
      soktemp.SOKVAL = 21
      soktemp.SOKINT[1] = 2
      soktemp.SOKCHAR[1] = pkod.      
      {SOKANROP.I}        
      
   END.
   ELSE DO:      
      CMB_OVERUT = INPUT CMB_OVERUT. 
      ASSIGN  CMB_OVERUT:SCREEN-VALUE = "Över".
   END.
   IF Guru.Konstanter:varforetypval[27] = 0 THEN DO:
      IF Guru.Konstanter:appcon THEN DO:      
         RUN PERSUPP.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
         (INPUT 1,INPUT pkod,INPUT TABLE valperskolltemp,INPUT-OUTPUT TABLE valsoktemp,OUTPUT TABLE felmeddtemp).
      END.
      ELSE DO:
         RUN PERSUPP.P 
         (INPUT 1,INPUT pkod,INPUT TABLE valperskolltemp,INPUT-OUTPUT TABLE valsoktemp,OUTPUT TABLE felmeddtemp).
      END.
   END.
   FIND FIRST valsoktemp WHERE valsoktemp.SOKVAL = 11 NO-ERROR.
   IF AVAILABLE valsoktemp THEN DO:
      ASSIGN            
      FILL-IN_FLEXTID = valsoktemp.SOKLOG[1] 
      FILL-IN-FAVTAL =  valsoktemp.SOKCHAR[1].
      IF FILL-IN_FLEXTID = TRUE THEN DO:               
         IF Guru.Konstanter:globforetag = "SUND" OR Guru.Konstanter:globforetag = "SNAT" OR Guru.Konstanter:globforetag = "MISV" THEN DO:
            IF FILL-IN-FAVTAL = "TE" THEN ASSIGN CMB_FAVTAL:SCREEN-VALUE = "8-17".
            IF FILL-IN-FAVTAL = "K" THEN ASSIGN CMB_FAVTAL:SCREEN-VALUE = "7-16".
            IF FILL-IN-FAVTAL = "T" THEN ASSIGN CMB_FAVTAL:SCREEN-VALUE = "Sundsvall Övriga".            
            IF FILL-IN-FAVTAL = "KV" THEN ASSIGN CMB_FAVTAL:SCREEN-VALUE = "Sundsvall kollektiv Vatten".
            IF FILL-IN-FAVTAL = "TU" THEN ASSIGN CMB_FAVTAL:SCREEN-VALUE = "Korsta".
            IF FILL-IN-FAVTAL = "" THEN ASSIGN CMB_FAVTAL:SCREEN-VALUE = "Sundsvall Övriga".
            ENABLE CMB_FAVTAL WITH FRAME FRAME-AVTAL.            
            
         END.
      END.
   END.
   OPEN QUERY BRW_ANSV FOR EACH ansvarigtemp NO-LOCK .                                                                  
   OPEN QUERY BRW_GODK FOR EACH godkannartemp NO-LOCK .      
   RUN vladda_UI.
   IF Guru.Konstanter:varforetypval[2] = 1 THEN Guru.Konstanter:varforetypval[2] = Guru.Konstanter:varforetypval[2].
   ELSE DO:
      IF AVAILABLE valperstemp THEN DO:
         IF valperstemp.VECKOSCHEM = 0 THEN musz = musz.
         ELSE CMB_VECKO:SCREEN-VALUE = STRING(valperstemp.VECKOSCHEMA).         
      END.
      ELSE DO:            
         CMB_VECKO:SCREEN-VALUE = STRING(varsechema).                           
      END.
   END.
   IF Guru.Konstanter:varforetypval[2] = 0  THEN DO:
      EMPTY TEMP-TABLE persextra NO-ERROR.
      EMPTY TEMP-TABLE bortpersextra NO-ERROR. 
      
      RUN persextra_UI IN  asfaktapph (OUTPUT TABLE persextra).         
      RUN openbdynspec_UI IN brwproc[2].
   END.   
   
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE vdis_UI C-Win 
PROCEDURE vdis_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
    DISABLE  
   FILL-IN-MAN FILL-IN-TIS FILL-IN-ONS FILL-IN-TOR FILL-IN-FRE FILL-IN-LOR FILL-IN-SON 
   FILL-IN-TOT FILL-IN-TOTV
   FILL-IN-BORJ1 FILL-IN-BORJ2 FILL-IN-BORJ3 FILL-IN-BORJ4 FILL-IN-BORJ5 FILL-IN-BORJ6 
   FILL-IN-BORJ7 
   FILL-IN-DSCH1 FILL-IN-DSCH2 FILL-IN-DSCH3 FILL-IN-DSCH4 FILL-IN-DSCH5 FILL-IN-DSCH6
   FILL-IN-DSCH7   
   FILL-IN-SLU1 FILL-IN-SLU2 FILL-IN-SLU3 FILL-IN-SLU4 FILL-IN-SLU5 FILL-IN-SLU6 
   FILL-IN-SLU7     
   FILL-IN-TIM1 FILL-IN-TIM2 FILL-IN-TIM3 FILL-IN-TIM4 FILL-IN-TIM5 FILL-IN-TIM6 
   FILL-IN-TIM7 
   WITH FRAME FRAME-ARBETSTIDER.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE vladda_UI C-Win 
PROCEDURE vladda_UI :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
   FIND FIRST valsoktemp WHERE valsoktemp.SOKVAL = 1 NO-ERROR.
   IF NOT AVAILABLE valsoktemp THEN RETURN.
   varsechema = valsoktemp.SOKINT[1].
   IF AVAILABLE valsoktemp THEN DO:
      FILL-IN-TOTV = valsoktemp.SOKDECI[1].
      ASSIGN
      FILL-IN-DSCH1 = valsoktemp.SOKDECI[2]
      FILL-IN-BORJ1 = valsoktemp.SOKDECI[3]
      FILL-IN-SLU1  = valsoktemp.SOKDECI[4]
      FILL-IN-TIM1  = valsoktemp.SOKDECI[5].
   END.
   FIND FIRST valsoktemp WHERE valsoktemp.SOKVAL = 2 NO-ERROR.
   IF AVAILABLE valsoktemp THEN DO:        
      ASSIGN
      FILL-IN-DSCH2 = valsoktemp.SOKDECI[2] 
      FILL-IN-BORJ2 = valsoktemp.SOKDECI[3] 
      FILL-IN-SLU2  = valsoktemp.SOKDECI[4] 
      FILL-IN-TIM2  = valsoktemp.SOKDECI[5].
   END.
   FIND FIRST valsoktemp WHERE valsoktemp.SOKVAL = 3 NO-ERROR.
   IF AVAILABLE valsoktemp THEN DO:        
      ASSIGN
      FILL-IN-DSCH3 = valsoktemp.SOKDECI[2] 
      FILL-IN-BORJ3 = valsoktemp.SOKDECI[3] 
      FILL-IN-SLU3  = valsoktemp.SOKDECI[4] 
      FILL-IN-TIM3  = valsoktemp.SOKDECI[5].
   END.
   FIND FIRST valsoktemp WHERE valsoktemp.SOKVAL = 4 NO-ERROR.
   IF AVAILABLE valsoktemp THEN DO:        
      ASSIGN
      FILL-IN-DSCH4 = valsoktemp.SOKDECI[2] 
      FILL-IN-BORJ4 = valsoktemp.SOKDECI[3] 
      FILL-IN-SLU4  = valsoktemp.SOKDECI[4] 
      FILL-IN-TIM4  = valsoktemp.SOKDECI[5].
   END.
   FIND FIRST valsoktemp WHERE valsoktemp.SOKVAL = 5 NO-ERROR.
   IF AVAILABLE valsoktemp THEN DO:
      ASSIGN
      FILL-IN-DSCH5 = valsoktemp.SOKDECI[2] 
      FILL-IN-BORJ5 = valsoktemp.SOKDECI[3] 
      FILL-IN-SLU5  = valsoktemp.SOKDECI[4] 
      FILL-IN-TIM5  = valsoktemp.SOKDECI[5].
   END.
   FIND FIRST valsoktemp WHERE valsoktemp.SOKVAL = 6 NO-ERROR.
   IF AVAILABLE valsoktemp THEN DO:        
      ASSIGN
      FILL-IN-DSCH6 = valsoktemp.SOKDECI[2] 
      FILL-IN-BORJ6 = valsoktemp.SOKDECI[3] 
      FILL-IN-SLU6  = valsoktemp.SOKDECI[4] 
      FILL-IN-TIM6  = valsoktemp.SOKDECI[5].
   END.
   FIND FIRST valsoktemp WHERE valsoktemp.SOKVAL = 7 NO-ERROR.
   IF AVAILABLE valsoktemp THEN DO:      
      ASSIGN
      FILL-IN-DSCH7 = valsoktemp.SOKDECI[2] 
      FILL-IN-BORJ7 = valsoktemp.SOKDECI[3] 
      FILL-IN-SLU7  = valsoktemp.SOKDECI[4] 
      FILL-IN-TIM7  = valsoktemp.SOKDECI[5].     
   END.
   
   DISPLAY 
   FILL-IN-MAN FILL-IN-TIS FILL-IN-ONS FILL-IN-TOR FILL-IN-FRE FILL-IN-LOR FILL-IN-SON 
   FILL-IN-TOT FILL-IN-TOTV
   FILL-IN-BORJ1 FILL-IN-BORJ2 FILL-IN-BORJ3 FILL-IN-BORJ4 FILL-IN-BORJ5 FILL-IN-BORJ6 
   FILL-IN-BORJ7 
   FILL-IN-DSCH1 FILL-IN-DSCH2 FILL-IN-DSCH3 FILL-IN-DSCH4 FILL-IN-DSCH5 FILL-IN-DSCH6
   FILL-IN-DSCH7   
   FILL-IN-SLU1 FILL-IN-SLU2 FILL-IN-SLU3 FILL-IN-SLU4 FILL-IN-SLU5 FILL-IN-SLU6 
   FILL-IN-SLU7     
   FILL-IN-TIM1 FILL-IN-TIM2 FILL-IN-TIM3 FILL-IN-TIM4 FILL-IN-TIM5 FILL-IN-TIM6 
   FILL-IN-TIM7 
   WITH FRAME FRAME-ARBETSTIDER.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

/* ************************  Function Implementations ***************** */

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _FUNCTION tabortblanka C-Win 
FUNCTION tabortblanka RETURNS CHARACTER
  (  INPUT namnblanka AS CHARACTER ) :
/*------------------------------------------------------------------------------
  Purpose:  
    Notes:  
------------------------------------------------------------------------------*/
  namnblanka = REPLACE(namnblanka," ","").
  RETURN   namnblanka.   /* Function return value. */
   
 
END FUNCTION.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

