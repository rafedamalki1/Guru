/*AONRZONAPP.P*/
&Scoped-define NEW NEW
&Scoped-define SHARED SHARED
{GLOBVAR2.I}

{AVTAONRTEMP.I}

PROCEDURE zonhmt.
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER omr AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR zontemp.
   DEFINE OUTPUT PARAMETER TABLE FOR aonrzontemp.
   EMPTY TEMP-TABLE zontemp NO-ERROR.    
   OPEN QUERY zq FOR EACH ZON WHERE ZON.OMRADE = omr NO-LOCK.
   GET FIRST zq NO-LOCK.
   DO WHILE AVAILABLE(ZON):
      CREATE zontemp.
      BUFFER-COPY ZON TO zontemp.
      GET NEXT zq NO-LOCK.
   END.
   CLOSE QUERY zq.
   EMPTY TEMP-TABLE aonrzontemp NO-ERROR.    
   OPEN QUERY azq FOR EACH AONRZON  WHERE AONRZON.AONR = aonrvar AND 
   AONRZON.DELNR = delnrvar NO-LOCK.
   GET FIRST azq NO-LOCK.
   DO WHILE AVAILABLE(AONRZON):
      CREATE aonrzontemp.
      BUFFER-COPY AONRZON TO aonrzontemp.
      GET NEXT azq NO-LOCK.
   END.
   CLOSE QUERY azq.
   RETURN.
END PROCEDURE.

PROCEDURE aozonskap.
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER zonvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER omr AS CHARACTER NO-UNDO.
   DO TRANSACTION:
      FIND FIRST AONRZON WHERE AONRZON.AONR = aonrvar AND
      AONRZON.DELNR = delnrvar USE-INDEX AONR EXCLUSIVE-LOCK NO-ERROR.
      IF NOT AVAILABLE AONRZON THEN CREATE AONRZON.
      ASSIGN
      AONRZON.AONR = aonrvar
      AONRZON.DELNR = delnrvar
      AONRZON.ZONNR = zonvar
      AONRZON.OMRADE = omr.
   END.
   RELEASE AONRZON NO-ERROR.
   RETURN.
END PROCEDURE.

PROCEDURE zonskap.
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER zonvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER omr AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER brec AS RECID NO-UNDO.
   DEFINE OUTPUT PARAMETER omraderec AS RECID NO-UNDO.
   FIND FIRST OMRADETAB WHERE OMRADETAB.OMRADE = omr NO-LOCK NO-ERROR.
   ASSIGN
   omraderec = RECID(OMRADETAB).
   DO TRANSACTION:
      FIND FIRST AONRZON WHERE AONRZON.AONR = aonrvar AND
      AONRZON.DELNR = delnrvar USE-INDEX AONR EXCLUSIVE-LOCK NO-ERROR.
      IF NOT AVAILABLE AONRZON THEN CREATE AONRZON.
      ASSIGN
      AONRZON.AONR = aonrvar
      AONRZON.DELNR = delnrvar
      AONRZON.ZONNR = zonvar
      AONRZON.OMRADE = omr.
   END.
   RELEASE AONRZON NO-ERROR.
   DO TRANSACTION:
      CREATE ZON.
      ASSIGN
      ZON.ZONNR = zonvar
      ZON.OMRADE = omr
      brec = RECID(ZON).
   END.
   RELEASE ZON NO-ERROR.
   RETURN.
END PROCEDURE.



