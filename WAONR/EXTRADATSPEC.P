/*EXTRADATSPEC.P bara aonr*/
&Scoped-define NEW NEW
&Scoped-define SHARED SHARED
{GLOBVAR2DEL1.I}
{DIRDEF.I}
DEFINE INPUT PARAMETER vart AS INTEGER NO-UNDO.
IF vart = 1 THEN DO:
   FIND FIRST EXTRADATA WHERE EXTRADATA.PROGRAM = "AOPROJ" NO-LOCK NO-ERROR.
   IF NOT AVAILABLE EXTRADATA THEN DO:
      OPEN QUERY aoq FOR EACH AONRTAB WHERE AONRTAB.AONRAVDATUM = 01/01/91 NO-LOCK.
      GET FIRST aoq NO-LOCK.
      DO WHILE AVAILABLE(AONRTAB):
         IF AONRTAB.STARTDAG = "mån" OR AONRTAB.STARTDAG = "tis" OR 
            AONRTAB.STARTDAG = "ons" OR AONRTAB.STARTDAG = "tor" OR 
            AONRTAB.STARTDAG = "fre" OR AONRTAB.STARTDAG = "lör" OR 
            AONRTAB.STARTDAG = "sön" THEN vart = vart.
         ELSE DO:
            FIND FIRST EXTRADATA WHERE EXTRADATA.PROGRAM = "AOPROJ" AND EXTRADATA.HUVUDCH = AONRTAB.STARTDAG NO-LOCK NO-ERROR.
            IF NOT AVAILABLE EXTRADATA THEN DO:
               FIND FIRST PERSONALTAB WHERE PERSONALTAB.PERSONALKOD = AONRTAB.STARTDAG NO-LOCK NO-ERROR.
               IF AVAILABLE PERSONALTAB THEN DO:
                  CREATE EXTRADATA.
                  ASSIGN 
                  EXTRADATA.PROGRAM = "AOPROJ"
                  EXTRADATA.HUVUDCH = AONRTAB.STARTDAG.
               END.               
            END.
         END.
         GET NEXT aoq NO-LOCK.
      END.
   END.
END.
PROCEDURE refhmtaen.   
   DEFINE INPUT PARAMETER refvar AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR evaldaao.
   DEFINE OUTPUT PARAMETER TABLE FOR felmeddtemp.
   DEFINE OUTPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE VARIABLE musz AS LOGICAL NO-UNDO.
   DEFINE VARIABLE edataapph AS HANDLE NO-UNDO.
   EMPTY TEMP-TABLE evaldaao NO-ERROR. 
   EMPTY TEMP-TABLE felmeddtemp NO-ERROR.

   FIND FIRST EXTRADATA WHERE EXTRADATA.PROGRAM = "AOREF" AND  
   EXTRADATA.SOKCHAR[1] = refvar  NO-LOCK NO-ERROR.   
   IF NOT AVAILABLE EXTRADATA THEN DO:
      CREATE felmeddtemp.  
      ASSIGN felmeddtemp.FELMEDD = "Ref.nr beställare finns inte!".
      RETURN.
   END.
   ELSE DO:
      FOR EACH EXTRADATA WHERE EXTRADATA.PROGRAM = "AOREF" AND  
      EXTRADATA.SOKCHAR[1] = refvar  NO-LOCK:         
         FIND FIRST evaldaao WHERE evaldaao.AONR = EXTRADATA.HUVUDCH AND 
         evaldaao.DELNR = EXTRADATA.HUVUDINT NO-LOCK NO-ERROR.     
         IF NOT AVAILABLE evaldaao THEN DO:         
            FIND FIRST AONRTAB WHERE AONRTAB.AONR = EXTRADATA.HUVUDCH AND 
            AONRTAB.DELNR = EXTRADATA.HUVUDINT NO-LOCK NO-ERROR.     
            IF AVAILABLE AONRTAB THEN DO:
               CREATE evaldaao.
               BUFFER-COPY AONRTAB TO evaldaao.
               evaldaao.AONRREC = RECID(AONRTAB).
               ASSIGN
               aonrvar = AONRTAB.AONR
               delnrvar = AONRTAB.DELNR.
            END.      
         END.
         ELSE DO:
            ASSIGN
            aonrvar = evaldaao.AONR
            delnrvar = evaldaao.DELNR.
         END.
      END.
   END.


END PROCEDURE.
