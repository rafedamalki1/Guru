/*FLRDEB.P*/
{SOKDEF.I}
DEFINE VARIABLE timraknare AS INTEGER NO-UNDO.
{FLRPRIUT.I}
IF varifran = 1 THEN DO:
   FOR EACH debpris USE-INDEX PERSONALKOD EXCLUSIVE-LOCK:
      FIND TIMKOSTNADSTAB WHERE 
      RECID(TIMKOSTNADSTAB) = debpris.TIMPRISREC NO-LOCK NO-ERROR.
      timraknare = 1.
      REPEAT:
         FIND NEXT TIMKOSTNADSTAB WHERE 
         TIMKOSTNADSTAB.PERSONALKOD = debpris.PERSONALKOD
         USE-INDEX PRISPERS NO-LOCK NO-ERROR.
         IF NOT AVAILABLE TIMKOSTNADSTAB THEN LEAVE.            
         ASSIGN debpris.TIMPRISREC = RECID(TIMKOSTNADSTAB).
         IF timraknare = 1 THEN DO:
            ASSIGN
            debpris.PRISA = 0.00  
            debpris.PRISA-2 = 0.00   
            debpris.PRISA-3 = 0.00
            debpris.PRISA-4 = 0.00. 
         END. 
         IF timraknare = 1 THEN
         ASSIGN debpris.PRISA = TIMKOSTNADSTAB.PRISA. 
         IF timraknare = 2 THEN
         ASSIGN debpris.PRISA-2 = TIMKOSTNADSTAB.PRISA.
         IF timraknare = 3 THEN
         ASSIGN debpris.PRISA-3 = TIMKOSTNADSTAB.PRISA.
         IF timraknare = 4 THEN
         ASSIGN debpris.PRISA-4 = TIMKOSTNADSTAB.PRISA.
         IF timraknare = 4 THEN LEAVE.
         timraknare = timraknare + 1.
      END.   
   END.            
END.
IF varifran = 2 THEN DO:
   FIND FIRST valsoktemp NO-ERROR.
   IF NOT AVAILABLE valsoktemp THEN RETURN.
   DO TRANSACTION:
      IF valsoktemp.SOKCHAR[1] NE "XXX" THEN DO:
         FIND FIRST AUTOMREG WHERE AUTOMREG.PRISTYP = valsoktemp.SOKCHAR[1]
         USE-INDEX PRISTYP EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE AUTOMREG THEN AUTOMREG.PRISA = valsoktemp.SOKINT[1].
      END.
      IF valsoktemp.SOKCHAR[2] NE "XXX" THEN DO:
         FIND FIRST AUTOMREG WHERE AUTOMREG.PRISTYP = valsoktemp.SOKCHAR[2]
         USE-INDEX PRISTYP EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE AUTOMREG THEN AUTOMREG.PRISA = valsoktemp.SOKINT[2]. 
      END.
      IF valsoktemp.SOKCHAR[3] NE "XXX" THEN DO:
         FIND FIRST AUTOMREG WHERE AUTOMREG.PRISTYP = valsoktemp.SOKCHAR[3]
         USE-INDEX PRISTYP EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE AUTOMREG THEN AUTOMREG.PRISA = valsoktemp.SOKINT[3].
      END.
      IF valsoktemp.SOKCHAR[4] NE "XXX" THEN DO:
         FIND FIRST AUTOMREG WHERE AUTOMREG.PRISTYP = valsoktemp.SOKCHAR[4]
         USE-INDEX PRISTYP EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE AUTOMREG THEN AUTOMREG.PRISA = valsoktemp.SOKINT[4].
      END.
   END.       
   OPEN QUERY pq FOR EACH PERSONALTAB 
   USE-INDEX PERSONALKOD NO-LOCK.
   GET FIRST pq NO-LOCK.
   DO WHILE AVAILABLE(PERSONALTAB):   
      FIND FIRST ANSTFORMTAB WHERE ANSTFORMTAB.ANSTALLNING = PERSONALTAB.ANSTALLNING 
      USE-INDEX ANSTF NO-LOCK NO-ERROR.
      IF AVAILABLE ANSTFORMTAB THEN DO:
         IF ANSTFORMTAB.MEDVIDUPPD = TRUE THEN DO TRANSACTION:
            FIND FIRST debpris WHERE debpris.PERSONALKOD = PERSONALTAB.PERSONALKOD NO-ERROR.
            IF valsoktemp.SOKCHAR[1] NE "XXX" THEN DO:
               FIND FIRST TIMKOSTNADSTAB WHERE TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
               TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[1] USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.                             
               IF AVAILABLE TIMKOSTNADSTAB THEN DO:
                  TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[1]. 
                  debpris.PRISA = valsoktemp.SOKINT[1].
               END.
            END.
            IF valsoktemp.SOKCHAR[2] NE "XXX" THEN DO:
               FIND FIRST TIMKOSTNADSTAB WHERE TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
               TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[2] USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.                       
               IF AVAILABLE TIMKOSTNADSTAB THEN DO:
                  TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[2].
                  debpris.PRISA-2 = valsoktemp.SOKINT[2].
               END.
            END.
            IF valsoktemp.SOKCHAR[3] NE "XXX" THEN DO:
               FIND FIRST TIMKOSTNADSTAB WHERE TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
               TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[3] USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.                       
               IF AVAILABLE TIMKOSTNADSTAB THEN DO:
                  TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[3].
                  debpris.PRISA-3 = valsoktemp.SOKINT[3].
               END.
            END.
            IF valsoktemp.SOKCHAR[4] NE "XXX" THEN DO:
               FIND FIRST TIMKOSTNADSTAB WHERE TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
               TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[4] USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.                       
               IF AVAILABLE TIMKOSTNADSTAB THEN DO:
                  TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[4].      
                  debpris.PRISA-4 = valsoktemp.SOKINT[4].
               END.
            END.
         END.
      END.
      GET NEXT pq NO-LOCK.    
   END.
END.  
IF varifran = 3 THEN DO:
   FIND FIRST valsoktemp NO-ERROR.
   IF NOT AVAILABLE valsoktemp THEN RETURN.
   OPEN QUERY pq FOR EACH PERSONALTAB WHERE 
   PERSONALTAB.BEFATTNING = valsoktemp.SOKCHAR[5]
   USE-INDEX PBEF NO-LOCK.
   GET FIRST pq NO-LOCK.
   DO WHILE AVAILABLE(PERSONALTAB): 
      FIND FIRST debpris WHERE 
      debpris.PERSONALKOD = PERSONALTAB.PERSONALKOD 
      USE-INDEX PERSONALKOD NO-ERROR.
      IF valsoktemp.SOKCHAR[1] NE "XXX" THEN DO TRANSACTION:
         FIND FIRST TIMKOSTNADSTAB WHERE 
         TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
         TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[1]
         USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE TIMKOSTNADSTAB THEN TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[1].
         ASSIGN debpris.PRISA = valsoktemp.SOKINT[1].
      END.
      IF valsoktemp.SOKCHAR[2] NE "XXX" THEN DO TRANSACTION:
         FIND FIRST TIMKOSTNADSTAB WHERE 
         TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
         TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[2]
         USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE TIMKOSTNADSTAB THEN TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[2]. 
         ASSIGN debpris.PRISA-2 = valsoktemp.SOKINT[2].
      END.
      IF valsoktemp.SOKCHAR[3] NE "XXX" THEN DO TRANSACTION:   
         FIND FIRST TIMKOSTNADSTAB WHERE 
         TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
         TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[3]
         USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE TIMKOSTNADSTAB THEN TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[3].
         ASSIGN debpris.PRISA-3 = valsoktemp.SOKINT[3].
      END.
      IF valsoktemp.SOKCHAR[4] NE "XXX" THEN DO TRANSACTION:   
         FIND FIRST TIMKOSTNADSTAB WHERE 
         TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
         TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[4]
         USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE TIMKOSTNADSTAB THEN TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[4]. 
         ASSIGN debpris.PRISA-4 = valsoktemp.SOKINT[4].         
      END.   
      GET NEXT pq NO-LOCK.    
   END.
END.
IF varifran = 4 THEN DO:
   FIND FIRST valsoktemp NO-ERROR.
   IF NOT AVAILABLE valsoktemp THEN RETURN.
   OPEN QUERY pq FOR EACH PERSONALTAB WHERE 
   PERSONALTAB.OMRADE = valsoktemp.SOKCHAR[5]
   USE-INDEX PBEF NO-LOCK.
   GET FIRST pq NO-LOCK.
   DO WHILE AVAILABLE(PERSONALTAB): 
      FIND FIRST debpris WHERE 
      debpris.PERSONALKOD = PERSONALTAB.PERSONALKOD 
      USE-INDEX PERSONALKOD NO-ERROR.
      IF valsoktemp.SOKCHAR[1] NE "XXX" THEN DO TRANSACTION:
         FIND FIRST TIMKOSTNADSTAB WHERE 
         TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
         TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[1]
         USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE TIMKOSTNADSTAB THEN TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[1].
         ASSIGN debpris.PRISA = valsoktemp.SOKINT[1].
      END.
      IF valsoktemp.SOKCHAR[2] NE "XXX" THEN DO TRANSACTION:
         FIND FIRST TIMKOSTNADSTAB WHERE 
         TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
         TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[2]
         USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE TIMKOSTNADSTAB THEN TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[2]. 
         ASSIGN debpris.PRISA-2 = valsoktemp.SOKINT[2].
      END.
      IF valsoktemp.SOKCHAR[3] NE "XXX" THEN DO TRANSACTION:   
         FIND FIRST TIMKOSTNADSTAB WHERE 
         TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
         TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[3]
         USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE TIMKOSTNADSTAB THEN TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[3].
         ASSIGN debpris.PRISA-3 = valsoktemp.SOKINT[3].
      END.
      IF valsoktemp.SOKCHAR[4] NE "XXX" THEN DO TRANSACTION:   
         FIND FIRST TIMKOSTNADSTAB WHERE 
         TIMKOSTNADSTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD AND 
         TIMKOSTNADSTAB.PRISTYP = valsoktemp.SOKCHAR[4]
         USE-INDEX PRISPERS EXCLUSIVE-LOCK NO-ERROR.
         IF AVAILABLE TIMKOSTNADSTAB THEN TIMKOSTNADSTAB.PRISA = valsoktemp.SOKINT[4]. 
         ASSIGN debpris.PRISA-4 = valsoktemp.SOKINT[4].         
      END.   
      GET NEXT pq NO-LOCK.    
   END.
END.
