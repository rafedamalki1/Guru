/*KOLLDUB.P*/
DEF TEMP-TABLE cc NO-UNDO
FIELD rc AS RECID.
{AMERICANEUROPEAN.I}

DEFINE BUFFER MTRLBUFF FOR MTRLBER.
OPEN QUERY mq FOR EACH MTRLBER NO-LOCK.
GET FIRST MQ NO-LOCK.
DO WHILE AVAILABLE(MTRLBER):
   FIND FIRST MTRLBUFF WHERE MTRLBUFF.KTYPKOD = MTRLBER.KTYPKOD AND
   MTRLBUFF.ENR = MTRLBER.ENR AND MTRLBUFF.F1 = MTRLBER.F1 AND
   MTRLBUFF.F2 = MTRLBER.F2 AND
   MTRLBUFF.F3 = MTRLBER.F3 AND
   MTRLBUFF.F4 = MTRLBER.F4 AND
   MTRLBUFF.F5 = MTRLBER.F5 AND RECID(MTRLBUFF) NE RECID(MTRLBER) no-LOCK NO-ERROR.
   IF AVAILABLE MTRLBUFF THEN DO:
      IF MTRLBER.LINKAB = TRUE AND MTRLBER.DIAMETER > 0 THEN DO:
         CREATE cc.
         cc.rc = RECID(MTRLBUFF).
         
      END.
      ELSE IF MTRLBER.LINKAB = TRUE AND MTRLBER.DIAMETER = 0 THEN DO:
         IF MTRLBUFF.LINKAB = TRUE AND MTRLBUFF.DIAMETER > 0 THEN DO:
            CREATE cc.
            cc.rc = RECID(MTRLBER).
         END.
         ELSE DO:
            CREATE cc.
            cc.rc = RECID(MTRLBUFF).
         END.
      END.
      ELSE DO:
         IF MTRLBUFF.LINKAB = TRUE THEN DO:
            CREATE cc.
            cc.rc = RECID(MTRLBER).
         END.
         ELSE DO:
            CREATE cc.
            cc.rc = RECID(MTRLBUFF).
         END.
      END.
   END.
   
   GET NEXT  MQ NO-LOCK.
END.
CLOSE QUERY MQ.

FOR EACH cc:
   DO TRANSACTION:
      FIND FIRST MTRLBER WHERE recid(MTRLBER) = cc.rc EXCLUSIVE-LOCK NO-ERROR.
      IF AVAILABLE MTRLBER THEN DELETE MTRLBER.
   END.      
END.

OUTPUT TO e:\delad\pro9\guru\koll.txt APPEND.
      PUT "special klart. VSAB"  SKIP.
      OUTPUT CLOSE.
      {EUROPEANAMERICAN.I}
