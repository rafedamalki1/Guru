/*VALKONSTAPP2.P*/

{STARTFORAPP.I}
{BEREDNINGTEMP.I}
{BERMTRL.I}
{BERIDTEMP.I}
{BERUPPTEMP.I}
DEFINE VARIABLE valaonr AS CHARACTER NO-UNDO.
DEFINE VARIABLE valdelnr AS INTEGER NO-UNDO.
DEFINE VARIABLE valomrade AS CHARACTER NO-UNDO.
DEFINE VARIABLE aovar AS CHARACTER NO-UNDO.

PROCEDURE ladda_UI : 
   DEFINE INPUT PARAMETER valaonr2 AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER valomrade2 AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER globforetag AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR beredningtemp.
   EMPTY TEMP-TABLE beredningtemp NO-ERROR. 
   ASSIGN
   valaonr = valaonr2
   valomrade = valomrade2.

   FIND FIRST BEREDNING WHERE BEREDNING.BERNR = INTEGER(valaonr) AND
   BEREDNING.OMRADE = valomrade USE-INDEX BERNR NO-LOCK NO-ERROR.
   IF AVAILABLE BEREDNING THEN DO:
      IF globforetag = "UMEA" THEN DO:      
         aovar = BEREDNING.AONR.         
         FOR EACH BEREDNING WHERE BEREDNING.AONR = aovar NO-LOCK:
             CREATE beredningtemp.
             BUFFER-COPY BEREDNING TO beredningtemp.
         END.         
      END.
      ELSE DO:
         CREATE beredningtemp.
         BUFFER-COPY BEREDNING TO beredningtemp.         
      END.
   END.  
   RETURN.
END PROCEDURE.

PROCEDURE laddaberid_UI :
   DEFINE INPUT PARAMETER beraonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER omradevar AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR beridtemp.
   EMPTY TEMP-TABLE beridtemp NO-ERROR. 
   OPEN QUERY idq FOR EACH BERID WHERE BERID.AONR = beraonrvar AND 
   BERID.OMRADE = omradevar NO-LOCK.
   GET FIRST idq NO-LOCK.
   DO WHILE AVAILABLE(BERID):
      CREATE beridtemp.
      BUFFER-COPY BERID TO beridtemp.
      GET NEXT idq NO-LOCK.
   END.
   CLOSE QUERY idq.
   RETURN.
END PROCEDURE.

PROCEDURE laddaberval_UI :
   DEFINE INPUT PARAMETER beraonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER omradevar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER numvar AS INTEGER NO-UNDO.
   DEFINE OUTPUT PARAMETER ktypkodvar AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER bernumvar AS INTEGER NO-UNDO.
   ASSIGN
   ktypkodvar = ""
   bernumvar = 0.
   FIND FIRST BERVAL WHERE BERVAL.AONR = beraonrvar AND
   BERVAL.OMRADE = omradevar AND BERVAL.NUM = numvar NO-LOCK NO-ERROR.
   IF AVAILABLE BERVAL THEN DO:
      ASSIGN 
      ktypkodvar = BERVAL.KTYPKOD
      bernumvar = BERVAL.NUM.
   END.
   RETURN.

END PROCEDURE.

PROCEDURE berhmt_UI :
   DEFINE INPUT PARAMETER valaonr2 AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER valomrade2 AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR beredningtemp.
   EMPTY TEMP-TABLE beredningtemp NO-ERROR. 
   FIND FIRST BEREDNING WHERE BEREDNING.BERNR = INTEGER(valaonr2) AND
   BEREDNING.OMRADE = valomrade2 USE-INDEX BERNR NO-LOCK NO-ERROR.
   IF AVAILABLE BEREDNING THEN DO:
      CREATE beredningtemp.
      BUFFER-COPY BEREDNING TO beredningtemp.
   END.

END PROCEDURE.

PROCEDURE upplhmt_UI :
   DEFINE INPUT PARAMETER valaonr2 AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER valomrade2 AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR berupptemp.
   
   EMPTY TEMP-TABLE berupptemp NO-ERROR. 
   FOR EACH BERUPP WHERE BERUPP.AONR = valaonr2 AND
   BERUPP.OMRADE = valomrade2 NO-LOCK:  
      CREATE berupptemp.
      BUFFER-COPY BERUPP TO berupptemp.
   END.
   
   {BERUPPLPUNKT.I}
END PROCEDURE.
