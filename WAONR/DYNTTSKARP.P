/*DYNTTSKARP.P*/
DEFINE VARIABLE orgbufh AS HANDLE NO-UNDO.
DEFINE VARIABLE dynloadh AS HANDLE NO-UNDO.
DEFINE VARIABLE tth AS HANDLE NO-UNDO.
DEFINE VARIABLE tthtmp AS HANDLE NO-UNDO.
DEFINE VARIABLE dynbrwh AS HANDLE NO-UNDO.
DEFINE VARIABLE dynbufh AS HANDLE NO-UNDO.
DEFINE VARIABLE dynbufhtmp AS HANDLE NO-UNDO.
DEFINE VARIABLE dynqueh AS HANDLE NO-UNDO.
DEFINE VARIABLE tmpcolh AS HANDLE NO-UNDO.
DEFINE VARIABLE efieldh AS HANDLE NO-UNDO.
DEFINE VARIABLE q AS HANDLE NO-UNDO.
DEFINE VARIABLE qtmp AS HANDLE NO-UNDO.
DEFINE VARIABLE tmpquery AS CHARACTER NO-UNDO.
DEFINE VARIABLE openquery AS CHARACTER NO-UNDO.
DEFINE VARIABLE ttname AS CHARACTER NO-UNDO.
DEFINE VARIABLE tabname AS CHARACTER NO-UNDO.
DEFINE VARIABLE dynok AS LOGICAL NO-UNDO.
DEFINE VARIABLE brwrow AS ROWID NO-UNDO.
DEFINE VARIABLE lastbrwrow AS ROWID NO-UNDO.
DEFINE VARIABLE i AS INTEGER NO-UNDO.
DEFINE VARIABLE j AS INTEGER NO-UNDO.
DEFINE VARIABLE k AS INTEGER NO-UNDO.
DEFINE VARIABLE efield AS CHARACTER NO-UNDO.
DEFINE VARIABLE colwidth AS INTEGER NO-UNDO.
DEFINE VARIABLE brwnum AS INTEGER NO-UNDO.
DEFINE VARIABLE dyncolh AS HANDLE NO-UNDO.
DEFINE INPUT PARAMETER bh AS HANDLE NO-UNDO.
DEFINE INPUT PARAMETER fh AS HANDLE NO-UNDO.
DEFINE TEMP-TABLE valsoktemp NO-UNDO
   FIELD SOKVAL AS INTEGER 
   FIELD SOKCHAR AS CHARACTER EXTENT 10
   FIELD SOKDATE AS DATE EXTENT 10
   FIELD SOKINT AS INTEGER EXTENT 10
   FIELD SOKDECI AS DECIMAL EXTENT 10
   FIELD SOKLOG AS LOGICAL EXTENT 10.


dynbrwh = bh.

RUN DYNAPPTT.P PERSISTENT SET dynloadh.
DELETE WIDGET-POOL "dynpool" NO-ERROR.
/*Create widget-pool*/
CREATE WIDGET-POOL "dynpool" PERSISTENT.
RETURN.

/*Browse will be filled with varsum number*/
PROCEDURE settrigger_UI :
   DEFINE INPUT PARAMETER val AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER procname AS CHARACTER NO-UNDO.
   IF val = 1 THEN DO:
      ON ROW-LEAVE OF dynbrwh PERSISTENT RUN VALUE(procname) IN SOURCE-PROCEDURE.
   END.   
END PROCEDURE.
PROCEDURE movecol_UI:
   DEFINE INPUT PARAMETER fc AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER tc AS INTEGER NO-UNDO.
   dynbrwh:MOVE-COLUMN(fc,tc).
END PROCEDURE.
PROCEDURE createbrw_UI.
   DEFINE INPUT PARAMETER tabname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER kommandoquery AS CHARACTER NO-UNDO.
   CREATE BUFFER orgbufh FOR TABLE tabname IN WIDGET-POOL "dynpool".
   dynbufh = orgbufh.
   CREATE QUERY dynqueh.
   dynqueh:SET-BUFFERS(dynbufh).
   dynbufh = dynqueh:GET-BUFFER-HANDLE. 
   dynqueh:QUERY-PREPARE(kommandoquery).
   dynbrwh:QUERY = dynqueh.   
   openquery = kommandoquery.
   dynbrwh:FRAME = fh.
   dynbrwh:X = 1.75.   
   dynbrwh:y = 100.
   dynbrwh:WIDTH-CHARS = 120.75.
   dynbrwh:HEIGHT-CHARS = 19.17.
   dynbrwh:DOWN = 17.
   dynbrwh:VISIBLE = TRUE.
   dynbrwh:ADD-COLUMNS-FROM(dynbufh).
   dynbrwh:ALLOW-COLUMN-SEARCHING = TRUE.
   dynbrwh:COLUMN-RESIZABLE = TRUE.
   dynbrwh:COLUMN-SCROLLING = TRUE.
   dynbrwh:SCROLLBAR-VERTICAL = TRUE.
   dynbrwh:READ-ONLY = FALSE.
   dynbrwh:EXPANDABLE = TRUE.
   dynbrwh:SENSITIVE = TRUE.
   dyncolh = dynbrwh:GET-BROWSE-COLUMN(1). 
   dyncolh:COLUMN-READ-ONLY = FALSE.

   dynqueh:QUERY-PREPARE(openquery).
   dynqueh:QUERY-OPEN().   

   
   RETURN.
END PROCEDURE.

/*Trigger off-end in browse*/
PROCEDURE ttfillnext_UI : 
   
END PROCEDURE.

/*Set Triggers*/
PROCEDURE settriggerproc_UI :
   DEFINE INPUT PARAMETER procname AS CHARACTER NO-UNDO.
   ON OFF-END OF dynbrwh PERSISTENT RUN VALUE(procname) IN SOURCE-PROCEDURE.
   RETURN.
END PROCEDURE.

/*Release procedure*/
PROCEDURE releaseh_UI :
   RUN releaseh_UI IN dynloadh.
   IF VALID-HANDLE(dynloadh) THEN DELETE PROCEDURE dynloadh NO-ERROR.
   IF VALID-HANDLE(dynqueh) THEN DO:
      dynqueh:QUERY-CLOSE.
      DELETE OBJECT dynqueh NO-ERROR.
      DELETE OBJECT q NO-ERROR.
      DELETE OBJECT dynbufh NO-ERROR.
      DELETE OBJECT dynbufhtmp NO-ERROR.
      ASSIGN
      dynqueh = ?
      q = ?
      dynbufh = ?
      dynbufhtmp = ?.  
   END.
   RETURN.
END PROCEDURE.
