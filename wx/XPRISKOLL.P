{SOKDEF.I}
DEFINE NEW SHARED VARIABLE globforetag LIKE FORETAG.FORETAG NO-UNDO.
DEFINE NEW SHARED VARIABLE vartvar AS CHARACTER NO-UNDO.
 
DEFINE  VARIABLE appcon AS LOGICAL NO-UNDO.
FIND FIRST FORETAG USE-INDEX FORETAG NO-LOCK NO-ERROR.
globforetag = FORETAG.FORETAG.
{CONAPP.I}

DEF VAR musz  AS LOGICAL NO-UNDO.
OPEN QUERY TQ FOR EACH TIDREGITAB WHERE TIDREGITAB.DATUM >= 10/01/2002 AND 
TIDREGITAB.tidlog = TRUE 
NO-LOCK BY PERSONALKOD BY DATUM. 
GET FIRST TQ NO-LOCK.
DO  WHILE AVAILABLE(TIDREGITAB):
   {SOKSTART.I}
                 ASSIGN
                 soktemp.SOKVAL = 1
                 soktemp.SOKCHAR[1] = "GRAN"
                 soktemp.SOKCHAR[2] = TIDREGITAB.PERSONALKOD
                 soktemp.SOKCHAR[3] = TIDREGITAB.PRISTYP
                 soktemp.SOKCHAR[4] = TIDREGITAB.OVERTIDTILL 
                 soktemp.SOKDATE[1] = TIDREGITAB.DATUM.
                 {SOKANROP.I}
      IF TIDREGITAB.PRIS = soktemp.SOKDECI[1] THEN musz = musz.
      ELSE DO:
         DISP tidregitab.personalkod TIDREGITAB.PRISTYP TIDREGITAB.PRIS TIDREGITAB.DATUM TIDREGITAB.OVERTIDTILL  TIDREGITAB.PROGRAM FORMAT "X(25)" WITH FRAME CC DOWN.
         DOWN 1 WITH FRAME CC.
      END.
     
   /*
      DO TRANSACTION:
         GET CURRENT tq EXCLUSIVE-LOCK.
         TIDREGITAB.PRIS = PERSONALPRIS.PRIS.  
      END.
      */

   GET next TQ NO-LOCK.   
END.
IF Guru.Konstanter:appcon THEN Guru.Konstanter:appcon = Guru.Konstanter:apphand:DISCONNECT().
         DELETE OBJECT Guru.Konstanter:apphand.




