/* FREKINV.P
INLÄSNING AV FREKVENSTABELL P1 TILL P2 GRÖNA KATALOGEN             */
/* TÄNK PÅ ATT DET ÄR MINUS PÅ ANTAL FÖR RETURER I FILEN              */
/* GÖR ANTALSKOLUMNEN UTAN - TECKEN GENOM ATT VÄLJA MINUS MED RÖD FÄRG*/
/* SÄTT VARIABELN ARVAR TILL RÄTT KATALOG ÅR                          */
{GLOBVAR2DEL1.I}
DEFINE NEW SHARED VARIABLE quotervar AS CHARACTER FORMAT "X(256)" NO-UNDO.
/*

*/
DEFINE VARIABLE musz AS LOGICAL NO-UNDO.

DEFINE VARIABLE rad AS INTEGER NO-UNDO.
DEFINE VARIABLE prognamn AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE prognamndat AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE prognamnque AS CHARACTER FORMAT "X(20)" NO-UNDO.                
DEFINE VARIABLE words AS CHARACTER FORMAT "X(132)" NO-UNDO.
DEFINE VARIABLE kommando AS CHARACTER FORMAT "X(132)" NO-UNDO.
DEFINE VARIABLE kommandoprog AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE satsvar AS CHARACTER FORMAT "X(11)" NO-UNDO.
DEFINE VARIABLE enrvar AS CHARACTER FORMAT "X(11)" NO-UNDO.
DEFINE VARIABLE melvar AS INTEGER NO-UNDO.
DEFINE VARIABLE melvar2 AS INTEGER NO-UNDO.
DEFINE VARIABLE langd AS INTEGER NO-UNDO.
DEFINE VARIABLE pos1 AS INTEGER NO-UNDO.
DEFINE VARIABLE arvar AS INTEGER NO-UNDO.

DEFINE TEMP-TABLE tidinfr
   FIELD P1                 AS CHARACTER FORMAT "X(6)" 
   FIELD B1                 AS CHARACTER FORMAT "X(10)" 
   FIELD P2                 AS CHARACTER FORMAT "X(5)"
   FIELD B2                 AS CHARACTER FORMAT "X(10)" 
   FIELD ANTAL              AS DECIMAL FORMAT ">>>>>9.99".

DEFINE TEMP-TABLE infil
   FIELD PROGNAMN AS CHARACTER FORMAT "X(78)" 
   INDEX PRO IS PRIMARY PROGNAMN.
DEFINE TEMP-TABLE intid
   FIELD TIN AS CHARACTER FORMAT "X(78)" .
   
DEFINE INPUT PARAMETER filnamn AS CHARACTER NO-UNDO.   
DEFINE INPUT PARAMETER gforetag AS CHARACTER NO-UNDO.   

{muswait.i}        
   ASSIGN
   arvar = 2006.
   EMPTY TEMP-TABLE intid NO-ERROR. 
   EMPTY TEMP-TABLE tidinfr NO-ERROR.    
   {AMERICANEUROPEAN.I}
   INPUT FROM VALUE(filnamn) NO-ECHO.
   REPEAT:
      DO TRANSACTION: 
         CREATE tidinfr.
         ASSIGN.
         IMPORT DELIMITER ";" tidinfr   NO-ERROR.
      END.               
   END.
   IF Guru.Konstanter:appcon THEN DO:                              
      RUN SKAPFREKV.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT TABLE tidinfr, INPUT arvar).          
   END. 
   ELSE DO:
      RUN SKAPFREKV.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT TABLE tidinfr, INPUT arvar).          
   END.
   /*RUN skapasats_UI.           */
{musarrow.i}
{EUROPEANAMERICAN.I}
/*PROCEDURE skapasats_UI:   
   FOR EACH tidinfr NO-LOCK:                                
      DO TRANSACTION:
         CREATE FREKVENS.
         ASSIGN
         FREKVENS.ARBKOD = SUBSTRING(tidinfr.P1,1,4)
         FREKVENS.LOPNR = INTEGER(SUBSTRING(tidinfr.P1,5,2))
         FREKVENS.FREKOD = SUBSTRING(tidinfr.P2,1,3)
         FREKVENS.FREKNR = INTEGER(SUBSTRING(tidinfr.P2,4,2))
         FREKVENS.ANTAL = tidinfr.ANTAL / 100         
         FREKVENS.KATAR = arvar.                  
         FIND FIRST LOP2 WHERE LOP2.ARBKOD = SUBSTRING(tidinfr.P2,1,3) AND
         LOP2.LOPNR = INTEGER(SUBSTRING(tidinfr.P2,4,2)) AND LOP2.KATAR = arvar NO-LOCK NO-ERROR.
         IF AVAILABLE LOP2 THEN DO:
            ASSIGN
            FREKVENS.BENAMNING = LOP2.BENAMNING
            FREKVENS.ENHET = LOP2.ENHET.            
         END. 
         ELSE DO:
            ASSIGN
            FREKVENS.BENAMNING = tidinfr.B2.
         END.
      END.                           
   END.      
END PROCEDURE.   */

                
