/*FILFLYTSERVER.P*/
{BLOB.I}
DEFINE VARIABLE hjvart AS CHARACTER NO-UNDO.
PROCEDURE chek_UI :
   DEFINE INPUT PARAMETER nyprogdat AS DATE NO-UNDO.
   DEFINE INPUT PARAMETER gurudator   AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER uppdatera AS LOGICAL NO-UNDO.
   FIND FIRST BLOBCOMP WHERE BLOBCOMP.ID = 0 AND BLOBCOMP.DATORNAMN = gurudator NO-LOCK NO-ERROR.
   IF NOT AVAILABLE BLOBCOMP THEN DO TRANSACTION:
      CREATE BLOBCOMP.
      ASSIGN
      BLOBCOMP.ID = 0
      BLOBCOMP.DATORNAMN = gurudator
      BLOBCOMP.ANDTID = ?
      BLOBCOMP.ANDDAT = ?
      BLOBCOMP.SKAPTID = TIME
      BLOBCOMP.SKAPDAT = nyprogdat - 1.
   END.   
   IF BLOBCOMP.SKAPDAT >= nyprogdat THEN DO:
      uppdatera = FALSE.      
   END.
   ELSE uppdatera = TRUE.
   RELEASE BLOBCOMP NO-ERROR. 
END PROCEDURE.


PROCEDURE flytta_UI :   
   DEFINE INPUT PARAMETER TABLE FOR blobinfotemp.
   DEFINE INPUT PARAMETER TABLE FOR blobdatatemp.
   {AMERICANEUROPEAN.I}
   FOR EACH blobinfotemp:
      hjvart = blobinfotemp.VART + blobinfotemp.FILNAMN.
      OUTPUT TO VALUE(hjvart) NO-MAP NO-CONVERT BINARY.
      FOR EACH blobdatatemp NO-LOCK WHERE blobdatatemp.ID = blobinfotemp.ID USE-INDEX SEK:
         PUT CONTROL blobdatatemp.DATA.
      END.
      OUTPUT CLOSE.
   END.
   {EUROPEANAMERICAN.I}
   FILE-INFO:FILE-NAME = hjvart.
END PROCEDURE.

PROCEDURE status_UI :
   DEFINE INPUT PARAMETER nyprogdat AS DATE NO-UNDO.
   DEFINE INPUT PARAMETER gurudator   AS CHARACTER NO-UNDO.
   DO TRANSACTION:
      FIND FIRST BLOBCOMP WHERE BLOBCOMP.ID = 0 AND BLOBCOMP.DATORNAMN = gurudator EXCLUSIVE-LOCK NO-ERROR.
      IF NOT AVAILABLE BLOBCOMP THEN DO:
      /*borde inte kunna hända*/
         CREATE BLOBCOMP.
         ASSIGN
         BLOBCOMP.ID = 0
         BLOBCOMP.DATORNAMN = gurudator
         BLOBCOMP.ANDTID = ?
         BLOBCOMP.ANDDAT = ?.      
      END.
      ASSIGN
      BLOBCOMP.SKAPTID = TIME
      BLOBCOMP.SKAPDAT = nyprogdat.
   END.
   RELEASE BLOBCOMP NO-ERROR. 
END PROCEDURE.
