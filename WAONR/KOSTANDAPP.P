/*KOSTANDAPP.P*/
&Scoped-define NEW NEW
&Scoped-define SHARED SHARED
{GLOBVAR2DEL1.I}
{REGVAR.I}

{KOSTREG.I}

PROCEDURE ladda.
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR kostregtemp.
   OPEN QUERY kq FOR EACH KOSTREG WHERE KOSTREG.AONR = aonrvar AND
   KOSTREG.DELNR = delnrvar NO-LOCK.
   GET FIRST kq NO-LOCK.
   DO  WHILE AVAILABLE(KOSTREG):
      CREATE kostregtemp.
      BUFFER-COPY KOSTREG TO kostregtemp.
      GET NEXT kq NO-LOCK.
   END.
   CLOSE QUERY kq.
END PROCEDURE.

PROCEDURE bortkost.
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER rad AS INTEGER NO-UNDO.
   DO TRANSACTION:
      FIND FIRST KOSTREG WHERE KOSTREG.AONR = aonrvar AND 
      KOSTREG.DELNR = delnrvar AND KOSTREG.RADNR = rad EXCLUSIVE-LOCK NO-ERROR.   
      IF AVAILABLE KOSTREG THEN DELETE KOSTREG.   
   END.
   RETURN.
END PROCEDURE.


PROCEDURE nytid.
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE OUTPUT PARAMETER rad AS INTEGER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR kostregtemp.
   EMPTY TEMP-TABLE kostregtemp NO-ERROR.    
   DO TRANSACTION:
      rad = 1.
      FIND LAST KOSTREG WHERE KOSTREG.AONR = aonrvar AND
      KOSTREG.DELNR = delnrvar USE-INDEX KOST NO-LOCK NO-ERROR.  
      IF AVAILABLE KOSTREG THEN DO: 
         rad = KOSTREG.RADNR + 1.
      END.
      CREATE KOSTREG.
      ASSIGN  
      KOSTREG.RADNR = rad
      KOSTREG.AONR = aonrvar
      KOSTREG.DELNR = delnrvar
      KOSTREG.KOSTAUTO = FALSE
      KOSTREG.FAKTURERAD = ?.
      CREATE kostregtemp.
      ASSIGN  
      kostregtemp.RADNR = rad
      kostregtemp.AONR = aonrvar
      kostregtemp.DELNR = delnrvar
      kostregtemp.KOSTAUTO = FALSE
      kostregtemp.FAKTURERAD = ?.     
   END.
   RELEASE KOSTREG NO-ERROR.
END PROCEDURE.
