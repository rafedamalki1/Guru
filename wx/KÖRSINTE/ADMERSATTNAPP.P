/*ADMERSATTNAPP.P ANVÄNDS DENNA?*/
&Scoped-define NEW NEW
&Scoped-define SHARED SHARED
{GLOBVAR2DEL1.I}
DEFINE TEMP-TABLE bersattemp NO-UNDO
   FIELD NAMN AS CHARACTER
   FIELD ANVANDARE AS CHARACTER
   FIELD BESTID AS CHARACTER
   FIELD OMRADE AS CHARACTER
   FIELD BEN1 AS CHARACTER
   FIELD BEN2 AS CHARACTER
   FIELD MTRLROW AS ROWID.

PROCEDURE admsparmtrl_UI:  
   DEFINE INPUT-OUTPUT PARAMETER TABLE FOR bersattemp. 
   FIND FIRST bersattemp NO-LOCK NO-ERROR.
   IF AVAILABLE bersattemp THEN DO:         
      IF bersattemp.MTRLROW = ? THEN DO TRANSACTION:         
         CREATE BETPLAN.
         BUFFER-COPY bersattemp TO BETPLAN.
         ASSIGN bersattemp.MTRLROW = ROWID(BETPLAN).      
      END.
      ELSE DO:  
         DO TRANSACTION:      
            FIND FIRST BETPLAN WHERE ROWID(BETPLAN) = bersattemp.MTRLROW EXCLUSIVE-LOCK NO-ERROR.
            IF AVAILABLE BETPLAN THEN DO:                                
               FIND FIRST bersattemp NO-LOCK NO-ERROR.
               BUFFER-COPY bersattemp TO BETPLAN.   
            END.             
         END.
      END.      
      RELEASE BETPLAN NO-ERROR.
   END.   
END PROCEDURE.

PROCEDURE checkmtrl_UI:  
   DEFINE INPUT PARAMETER TABLE FOR bersattemp. 
   DEFINE OUTPUT PARAMETER kollfel AS LOGICAL NO-UNDO.
   kollfel = FALSE.
   FIND FIRST bersattemp NO-LOCK NO-ERROR.
   IF AVAILABLE bersattemp THEN DO:         
      IF bersattemp.MTRLROW = ? THEN DO TRANSACTION:       
         FIND FIRST BETPLAN WHERE BETPLAN.NAMN = bersattemp.NAMN AND BETPLAN.ANVANDARE = bersattemp.ANVANDARE
         AND BETPLAN.BESTID = bersattemp.BESTID NO-LOCK NO-ERROR.
         IF AVAILABLE BETPLAN THEN DO:       
            kollfel = TRUE.        
         END.
      END.
   END.   
END PROCEDURE.


PROCEDURE admbortmtrl_UI:   
   DEFINE INPUT-OUTPUT PARAMETER TABLE FOR bersattemp. 
   DEFINE OUTPUT PARAMETER TABLE FOR felmeddtemp. 

   EMPTY TEMP-TABLE felmeddtemp NO-ERROR.    
   FIND FIRST bersattemp NO-ERROR.
   DO TRANSACTION:         
      FIND FIRST BETPLAN WHERE ROWID(BETPLAN) = bersattemp.MTRLROW EXCLUSIVE-LOCK NO-ERROR.                            
      IF AVAILABLE BETPLAN THEN DO:        
         DELETE BETPLAN.                     
      END.
   END.
   RELEASE BETPLAN NO-ERROR.
END PROCEDURE.

PROCEDURE kolllev_UI:
   DEFINE INPUT PARAMETER lkod AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER kollev AS LOGICAL NO-UNDO.
   kollev = FALSE.
   FIND FIRST LEVERANTOR WHERE LEVERANTOR.LEVKOD = lkod NO-LOCK NO-ERROR.
   IF AVAILABLE LEVERANTOR THEN DO:
      kollev = TRUE.
   END.
END PROCEDURE.


PROCEDURE kollenr_UI:
   DEFINE INPUT PARAMETER lkod AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER senr AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER kollev AS LOGICAL NO-UNDO.
   kollev = FALSE.
   FIND FIRST MTRL WHERE MTRL.LEVKOD = lkod AND MTRL.ENR = senr AND MTRL.KALKNR = 0 NO-LOCK NO-ERROR.
   IF AVAILABLE MTRL THEN DO:
      kollev = TRUE.
   END.
END PROCEDURE.
