/*EXEMKABLU2.P*/
DEFINE VARIABLE markag AS INTEGER NO-UNDO.
DEFINE VARIABLE extrarader AS INTEGER NO-UNDO.
DEFINE VARIABLE extrarader2 AS INTEGER FORMAT "-9999999" NO-UNDO.
DEFINE VARIABLE extram AS INTEGER NO-UNDO.
DEFINE VARIABLE emg AS INTEGER NO-UNDO.
DEFINE VARIABLE uColumn  AS INTEGER INITIAL 0.
DEFINE VARIABLE fnamn AS CHARACTER NO-UNDO.
DEFINE VARIABLE fnamn2 AS CHARACTER NO-UNDO.
DEFINE VARIABLE fnamnA AS CHARACTER NO-UNDO.
DEFINE VARIABLE fnamnB AS CHARACTER NO-UNDO.
DEFINE VARIABLE link AS CHARACTER NO-UNDO.
DEFINE VARIABLE bytcol AS LOGICAL NO-UNDO.
DEFINE VARIABLE bytacol AS CHARACTER NO-UNDO.
DEFINE VARIABLE bytbcol AS CHARACTER NO-UNDO.
DEFINE VARIABLE bytccol AS CHARACTER NO-UNDO.
DEFINE VARIABLE bytgcol AS CHARACTER NO-UNDO.
DEFINE VARIABLE bythcol AS CHARACTER NO-UNDO.

DEFINE VARIABLE valvardnr AS INTEGER NO-UNDO.
DEFINE VARIABLE omravd AS INTEGER NO-UNDO.
DEFINE VARIABLE aovar AS CHARACTER NO-UNDO.
DEFINE VARIABLE delnrvar AS INTEGER NO-UNDO.
DEFINE VARIABLE ortvar AS CHARACTER NO-UNDO.   
DEFINE VARIABLE fkommun AS CHARACTER NO-UNDO.   
DEFINE VARIABLE fvaker AS CHARACTER NO-UNDO.   
DEFINE VARIABLE vman AS CHARACTER NO-UNDO.   
DEFINE VARIABLE vadress AS CHARACTER NO-UNDO.
DEFINE VARIABLE vpadress AS CHARACTER NO-UNDO.
DEFINE VARIABLE vtelef AS CHARACTER NO-UNDO.
DEFINE VARIABLE felmedd AS CHARACTER NO-UNDO.
DEFINE VARIABLE omromr AS CHARACTER NO-UNDO.
DEFINE VARIABLE hjproc AS DECIMAL NO-UNDO.
DEFINE VARIABLE hjagare AS INTEGER NO-UNDO.
DEFINE VARIABLE projl AS CHARACTER NO-UNDO.
DEFINE VARIABLE arrendator AS CHARACTER NO-UNDO.
DEFINE VARIABLE allnamn AS CHARACTER NO-UNDO.
DEFINE VARIABLE allpersnr AS CHARACTER NO-UNDO.
DEFINE VARIABLE lujona AS CHARACTER NO-UNDO.
DEFINE VARIABLE minimi AS INTEGER NO-UNDO.
DEFINE VARIABLE skprotapph AS HANDLE NO-UNDO.
DEFINE VARIABLE lelitt AS CHARACTER NO-UNDO.
DEFINE VARIABLE pnamn AS CHARACTER NO-UNDO.
DEFINE VARIABLE pled AS CHARACTER NO-UNDO.
DEFINE VARIABLE konc AS CHARACTER NO-UNDO.
DEFINE VARIABLE domsaga AS CHARACTER NO-UNDO.
DEFINE VARIABLE nstn AS CHARACTER NO-UNDO.
DEFINE VARIABLE par1a AS INTEGER NO-UNDO.
DEFINE VARIABLE par1b AS INTEGER NO-UNDO.
DEFINE VARIABLE par2c AS INTEGER NO-UNDO.
DEFINE VARIABLE antfast AS INTEGER NO-UNDO.
DEFINE VARIABLE fbet AS CHARACTER NO-UNDO.
DEFINE VARIABLE flerfastsum AS INTEGER NO-UNDO.
DEFINE VARIABLE lled AS INTEGER NO-UNDO.
DEFINE VARIABLE jkab AS DECIMAL  NO-UNDO.
DEFINE VARIABLE nats AS INTEGER NO-UNDO.
DEFINE VARIABLE jklsp AS INTEGER NO-UNDO.
DEFINE VARIABLE kskap AS INTEGER NO-UNDO.
DEFINE VARIABLE ovg AS INTEGER NO-UNDO.
DEFINE VARIABLE tlgg AS INTEGER NO-UNDO.
DEFINE VARIABLE mmini AS INTEGER NO-UNDO.
DEFINE VARIABLE ttalt AS INTEGER NO-UNDO.
DEFINE VARIABLE mg AS CHARACTER NO-UNDO.
DEFINE VARIABLE fabet AS CHARACTER NO-UNDO.
DEFINE VARIABLE delsumover AS LOGICAL NO-UNDO.
DEFINE VARIABLE kommnatkab AS CHARACTER NO-UNDO.
DEFINE VARIABLE kommkskap AS CHARACTER NO-UNDO.
DEFINE VARIABLE fastbelopp AS INTEGER NO-UNDO.

DEFINE VARIABLE vardman AS CHARACTER NO-UNDO.
DEFINE VARIABLE vardtel AS CHARACTER NO-UNDO.
DEFINE VARIABLE kabersatt AS DECIMAL NO-UNDO.
DEFINE VARIABLE gamled AS CHARACTER NO-UNDO.
DEFINE VARIABLE dodas AS CHARACTER NO-UNDO.
DEFINE VARIABLE krha AS INTEGER NO-UNDO.
DEFINE VARIABLE skadeers AS INTEGER NO-UNDO.
DEFINE VARIABLE tilldag AS DATE NO-UNDO.
DEFINE VARIABLE tkmeter AS CHARACTER NO-UNDO.
DEFINE VARIABLE natstn AS INTEGER NO-UNDO.
DEFINE VARIABLE utsag AS INTEGER NO-UNDO.
DEFINE VARIABLE lleduex AS INTEGER  NO-UNDO.
DEFINE VARIABLE jkabuex AS DECIMAL  NO-UNDO.
DEFINE VARIABLE exltot AS decimal NO-UNDO.
DEFINE VARIABLE fabet1 AS CHARACTER NO-UNDO.
DEFINE VARIABLE sidvar AS INTEGER NO-UNDO.

DEFINE TEMP-TABLE marag             
   FIELD VARDNR AS INTEGER                   
   FIELD MARKNR AS INTEGER                   
   FIELD PERSONNUMMER AS CHARACTER           
   FIELD PNR2 AS CHARACTER                   
   FIELD MARKAGARE AS CHARACTER
   FIELD GATUADRESS AS CHARACTER 
   FIELD POSTNUMMER AS CHARACTER 
   FIELD POSTADRESS AS CHARACTER
   FIELD BETECKNING AS CHARACTER  
   FIELD PROCENT AS INTEGER 
   FIELD KOMMUN AS CHARACTER 
   FIELD SOCKEN AS CHARACTER 
   FIELD PAKER AS CHARACTER 
   FIELD VAKER AS CHARACTER 
   FIELD AONR AS CHARACTER
   FIELD DELNR AS INTEGER
   FIELD ANAMN AS CHARACTER 
   FIELD AADRESS AS CHARACTER 
   FIELD APONR AS CHARACTER 
   FIELD APADRESS AS CHARACTER 
   FIELD APERNR AS CHARACTER 
   FIELD MARKREC AS RECID
   INDEX MARKNR IS PRIMARY MARKNR ASCENDING.
DEFINE TEMP-TABLE marag2             
   FIELD VARDNR AS INTEGER                   
   FIELD MARKNR AS INTEGER                   
   FIELD PERSONNUMMER AS CHARACTER           
   FIELD PNR2 AS CHARACTER                   
   FIELD MARKAGARE AS CHARACTER
   FIELD GATUADRESS AS CHARACTER 
   FIELD POSTNUMMER AS CHARACTER 
   FIELD POSTADRESS AS CHARACTER
   FIELD BETECKNING AS CHARACTER  
   FIELD PROCENT AS INTEGER 
   FIELD KOMMUN AS CHARACTER 
   FIELD SOCKEN AS CHARACTER 
   FIELD PAKER AS CHARACTER 
   FIELD VAKER AS CHARACTER 
   FIELD AONR AS CHARACTER
   FIELD DELNR AS INTEGER
   FIELD ANAMN AS CHARACTER 
   FIELD AADRESS AS CHARACTER 
   FIELD APONR AS CHARACTER 
   FIELD APADRESS AS CHARACTER 
   FIELD APERNR AS CHARACTER 
   FIELD MARKREC AS RECID
   INDEX MARKNR IS PRIMARY MARKNR ASCENDING
   INDEX BETECKNING BETECKNING MARKNR.

DEFINE TEMP-TABLE uppfoltemp   
   FIELD FORETAG AS CHARACTER
   FIELD ANVANDARE AS CHARACTER  
   FIELD ALLAMA AS LOGICAL
   FIELD VALVARD AS CHARACTER
   FIELD FORSTA AS LOGICAL
   FIELD STAMP AS LOGICAL.  
{TIDUTTT.I}
{SUMTEMP.I}
DEFINE TEMP-TABLE maga                       
   FIELD VARDNR AS INTEGER                   
   FIELD MARKNR AS INTEGER                   
   FIELD PERSONNUMMER AS CHARACTER           
   FIELD PNR2 AS CHARACTER                   
   FIELD MARKAGARE AS CHARACTER              
   FIELD GATUADRESS AS CHARACTER             
   FIELD POSTNUMMER AS CHARACTER             
   FIELD POSTADRESS AS CHARACTER             
   FIELD BETECKNING AS CHARACTER             
   FIELD PROCENT AS INTEGER                  
   FIELD ANAMN AS CHARACTER                  
   FIELD AADRESS AS CHARACTER                
   FIELD APONR AS CHARACTER                  
   FIELD APADRESS AS CHARACTER               
   FIELD APERNR AS CHARACTER 
   FIELD ORDNING AS INTEGER
   FIELD MARKREC AS RECID                    
   INDEX MARKNR IS PRIMARY MARKNR ASCENDING
   INDEX ORDN ORDNING ASCENDING.
{allavardtemp.I}   
/*DEFINE TEMP-TABLE akevard         
   FIELD MARKNR AS INTEGER
   FIELD BETECKNING AS CHARACTER
   FIELD BENAMNING AS CHARACTER
   FIELD STOLPNR AS INTEGER
   FIELD L1  AS INTEGER
   FIELD L2 AS INTEGER
   FIELD L3 AS INTEGER
   FIELD L4 AS INTEGER
   FIELD L5 AS INTEGER
   FIELD SORT AS CHARACTER
   FIELD VARDEPKT AS DATE
   FIELD FASTPRIS AS LOGICAL 
   FIELD KRONOR AS INTEGER
   FIELD PLUS AS LOGICAL
   INDEX MARKNR IS PRIMARY MARKNR ASCENDING.   

DEFINE TEMP-TABLE akekab         
   FIELD MARKNR AS INTEGER
   FIELD BETECKNING AS CHARACTER
   FIELD BENAMNING AS CHARACTER 
   FIELD L1 AS INTEGER
   FIELD L2 AS DECIMAL
   FIELD FASTPRIS AS LOGICAL
   FIELD FLKAB AS LOGICAL
   FIELD KRONOR AS INTEGER
   FIELD PLUS AS LOGICAL
   FIELD LSP AS LOGICAL
   INDEX MARKNR IS PRIMARY MARKNR ASCENDING.      
DEFINE TEMP-TABLE svard    
   FIELD MARKNR AS INTEGER
   FIELD BESTAND AS INTEGER
   FIELD BARRLOV AS CHARACTER
   FIELD BENAMNING AS CHARACTER
   FIELD BREDD AS INTEGER
   FIELD LANGD AS INTEGER
   FIELD BETECKNING AS CHARACTER
   FIELD BESTTYP AS CHARACTER
   FIELD MARKTYP AS CHARACTER
   FIELD HA AS DECIMAL
   FIELD SLENH AS DECIMAL
   FIELD FASTPRIS AS LOGICAL
   FIELD PROCENT AS INTEGER
   FIELD KR-HA AS INTEGER
   FIELD KRONOR AS INTEGER
   INDEX MARKNR IS PRIMARY MARKNR ASCENDING.*/     
DEFINE TEMP-TABLE fastaga         
   FIELD MARKNR AS INTEGER
   FIELD MARKAGARE AS CHARACTER
   FIELD PERSONNUMMER AS CHARACTER     
   INDEX MARKNR IS PRIMARY MARKNR ASCENDING.      
     
DEFINE VARIABLE kommando AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommando2 AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommando3 AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommando4 AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE kommando5 AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE chWord AS COM-HANDLE     NO-UNDO.
DEFINE VARIABLE chDoc  AS COM-HANDLE     NO-UNDO. 
DEFINE VARIABLE chWord2 AS COM-HANDLE     NO-UNDO.
DEFINE VARIABLE chDoc2  AS COM-HANDLE     NO-UNDO.
DEFINE VARIABLE SELECTION AS COM-HANDLE NO-UNDO.
DEFINE VARIABLE bkRange AS COM-HANDLE NO-UNDO.

DEFINE VARIABLE bokvalue AS CHARACTER NO-UNDO.
DEFINE VARIABLE bokname AS CHARACTER NO-UNDO.
DEFINE VARIABLE antagare AS INTEGER NO-UNDO.

DEFINE INPUT PARAMETER ponr AS CHARACTER FORMAT "X(12)" NO-UNDO.
DEFINE INPUT PARAMETER avtal AS CHARACTER NO-UNDO.
DEFINE INPUT PARAMETER spmall AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER fildir AS CHARACTER NO-UNDO.
DEFINE INPUT PARAMETER skrivutmall AS LOGICAL NO-UNDO.

/*{EGENBEN.I}*/

{GLOBVAR2DEL1.I}
&Scoped-define SHARED SHARED  
{MARKVAL.I}                         
DEFINE BUFFER markvalbuff FOR markval.

&SCOPED-DEFINE NEW NEW
&SCOPED-DEFINE SHARED SHARED
{BLOB.I}
DEFINE VARIABLE bloblog AS LOGICAL NO-UNDO.
DEFINE VARIABLE blobproch AS HANDLE NO-UNDO.

DEFINE VARIABLE cDocPath AS CHARACTER NO-UNDO.
DEFINE VARIABLE cDocName AS CHARACTER NO-UNDO.
DEFINE VARIABLE wdGoToBookmark AS INTEGER NO-UNDO INITIAL -1.
DEFINE VARIABLE edataapph AS HANDLE NO-UNDO.
{EXTRADATA.I}

    
IF Guru.Konstanter:appcon THEN DO:
   RUN EXTRADATAHMT.P PERSISTENT SET edataapph ON Guru.Konstanter:apphand TRANSACTION DISTINCT. 
END.
ELSE DO:
  RUN EXTRADATAHMT.P PERSISTENT SET edataapph.  
END.

IF Guru.Konstanter:appcon THEN DO:
   RUN SKAPPROTOU7.P PERSISTENT SET skprotapph ON Guru.Konstanter:apphand TRANSACTION DISTINCT. 
END.
ELSE DO:
   RUN SKAPPROTOU7.P PERSISTENT SET skprotapph.
END.
/*FOR EACH MARKVAL:
   MESSAGE MARKVAL.BETECKNING MARKVAL.MARKAGARE VIEW-AS ALERT-BOX.
END.*/

RUN basuppg_UI IN skprotapph (OUTPUT minimi).
IF ponr NE ? AND ponr NE ""  THEN DO:
   EMPTY TEMP-TABLE inextradatatemp NO-ERROR. 
   CREATE inextradatatemp.          
   ASSIGN
   inextradatatemp.PROGRAM = "NATPROJ"                   
   inextradatatemp.HUVUDCH = ponr.                    
   RUN etabhamt_UI IN edataapph (INPUT TABLE inextradatatemp, OUTPUT TABLE extradatatemp). 
   FIND FIRST extradatatemp NO-LOCK NO-ERROR.
   IF AVAILABLE extradatatemp THEN DO:      
      ASSIGN       
      lelitt = extradatatemp.SOKCHAR[1] 
      pnamn = extradatatemp.SOKCHAR[2] 
      pled = extradatatemp.SOKCHAR[3] 
      konc = extradatatemp.SOKCHAR[4] 
      domsaga = extradatatemp.SOKCHAR[5]
      nstn = extradatatemp.SOKCHAR[9]
      par1a = extradatatemp.SOKINT[1]
      par1b = extradatatemp.SOKINT[2]
      par2c = extradatatemp.SOKINT[3].
   
   END.
   
   EMPTY TEMP-TABLE inextradatatemp NO-ERROR. 
   CREATE inextradatatemp.          
   ASSIGN
   inextradatatemp.PROGRAM = "PROJHSAND"                   
   inextradatatemp.HUVUDCH = ponr.                    
   RUN etabhamt_UI IN edataapph (INPUT TABLE inextradatatemp, OUTPUT TABLE extradatatemp). 
   FIND FIRST extradatatemp NO-LOCK NO-ERROR.
   IF AVAILABLE extradatatemp THEN DO:      
      ASSIGN       
      gamled = extradatatemp.SOKCHAR[1] 
      dodas = extradatatemp.SOKCHAR[2] 
      krha = extradatatemp.SOKINT[1]             
      skadeers = extradatatemp.SOKINT[2]
      tilldag = extradatatemp.SOKDATE[1]
      tkmeter = extradatatemp.SOKCHAR[3]     
      natstn = extradatatemp.SOKINT[4].                 
   
   END.
END.      
 

fabet1 = "".
sidvar = 1.
EMPTY TEMP-TABLE emarkval NO-ERROR.    
FOR EACH markval BY markval.BETECKNING:
   DEBUGGER:SET-BREAK().
   IF fabet NE markval.BETECKNING THEN DO:
      FOR EACH markvalbuff  WHERE markvalbuff.BETECKNING = markval.BETECKNING:       
         CREATE emarkval.
         BUFFER-COPY markvalbuff TO emarkval.
      END.         
      RUN skapamua_UI.
      sidvar = sidvar + 1.   
      EMPTY TEMP-TABLE emarkval NO-ERROR.
      fabet = markval.BETECKNING.
   END.
END.         
IF VALID-HANDLE(skprotapph) THEN DELETE PROCEDURE skprotapph.      
skprotapph = ?.
IF VALID-HANDLE(edataapph) THEN DELETE PROCEDURE edataapph.   
edataapph = ?.
PROCEDURE skapamua_UI :

   EMPTY TEMP-TABLE marag NO-ERROR.
   EMPTY TEMP-TABLE marag2 NO-ERROR.
   EMPTY TEMP-TABLE sumtemp NO-ERROR.
   EMPTY TEMP-TABLE uppfoltemp NO-ERROR.  
   FIND FIRST emarkval NO-LOCK NO-ERROR.  
   IF Guru.Konstanter:appcon THEN DO:                           
      RUN EXKABLUAPP3.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT 
      (INPUT emarkval.VARDNR,INPUT emarkval.BETECKNING,INPUT TABLE emarkval,OUTPUT omravd,OUTPUT omromr,OUTPUT aovar,OUTPUT delnrvar,OUTPUT ortvar,OUTPUT fkommun,OUTPUT fvaker
      ,OUTPUT vman,OUTPUT vadress,OUTPUT vpadress, OUTPUT vtelef , OUTPUT projl, OUTPUT arrendator,OUTPUT TABLE marag ).
   END.
   ELSE DO:
      RUN EXKABLUAPP3.P 
      (INPUT emarkval.VARDNR,INPUT emarkval.BETECKNING,INPUT TABLE emarkval,OUTPUT omravd,OUTPUT omromr,OUTPUT aovar,OUTPUT delnrvar,OUTPUT ortvar,OUTPUT fkommun,OUTPUT fvaker
      ,OUTPUT vman,OUTPUT vadress,OUTPUT vpadress, OUTPUT vtelef , OUTPUT projl , OUTPUT arrendator,OUTPUT TABLE marag ).
   END.   
      
    
   FOR EACH marag:
      CREATE marag2.
      BUFFER-COPY marag TO marag2.
   END.
     
   CREATE uppfoltemp.
   ASSIGN
   uppfoltemp.FORETAG = globforetag   
   uppfoltemp.ALLAMA = FALSE
   uppfoltemp.VALVARD = ""
   uppfoltemp.FORSTA = TRUE
   uppfoltemp.STAMP = FALSE.
    
   FIND FIRST emarkval NO-LOCK NO-ERROR.
   RUN vardman_UI IN skprotapph (INPUT emarkval.VARDNR, OUTPUT vardman, OUTPUT vardtel, OUTPUT kabersatt).   
   FIND FIRST emarkval NO-LOCK NO-ERROR.  
   RUN markupp_UI IN skprotapph
   (INPUT "" ,INPUT emarkval.BETECKNING,INPUT emarkval.MARKREC,INPUT TABLE uppfoltemp,INPUT TABLE emarkval,INPUT TABLE maga,OUTPUT TABLE sumtemp).
   FIND FIRST emarkval NO-LOCK NO-ERROR. 
    
   RUN kommentarnat_UI IN skprotapph
   (INPUT emarkval.BETECKNING,INPUT emarkval.VARDNR,OUTPUT kommnatkab).
   RUN kommentarkskap_UI IN skprotapph
   (INPUT emarkval.BETECKNING,INPUT emarkval.VARDNR,OUTPUT kommkskap).
     
   
   RUN mval_UI.
   antagare = 0.
   FOR EACH marag NO-LOCK:
      antagare = antagare + 1.
   END.
   
   ASSIGN
   antfast = 0
   fbet = "".
   FOR EACH marag BY marag.BETECKNING:
      IF fbet NE marag.BETECKNING THEN antfast = antfast + 1.
      fbet = marag.BETECKNING.
   END.
   IF antfast > 1 THEN DO:
      mg = "".
      FOR EACH marag BY marag.MARKAGARE:
         IF mg = marag.MARKAGARE THEN DELETE marag.
         IF AVAILABLE marag THEN mg = marag.MARKAGARE.
      END.
      mg = "".
      FOR EACH marag2 BY marag2.MARKAGARE:
         IF mg = marag2.MARKAGARE THEN DELETE marag2.
         IF AVAILABLE marag2 THEN mg = marag2.MARKAGARE.
      END.
   END.
   IF globforetag = "BHEL"  OR globforetag = "ESKO" THEN omravd = 4.
   IF globforetag = "NYLB"  THEN omravd = 1.
   IF globforetag = "GREL"  THEN omravd = 1.
   IF globforetag = "REJI" OR globforetag = "ELPC"  THEN omravd = 1.
   IF globforetag = "FORS"  THEN omravd = 1.
   IF globforetag = "ETSA"  THEN omravd = 1.
   delsumover = FALSE.
   
   ASSIGN
   lled = 0
   jkab = 0
   nats = 0
   jklsp = 0
   kskap = 0
   ovg = 0
   tlgg = 0
   ttalt = 0
   mmini = 0
   lleduex = 0
   jkabuex = 0
   fbet = ""
   fabet = "".
   fastbelopp = 0.
   /*Obs dessa uträkningar finns i OVERSIKTVIS.W också men då i temp-table MUAtemp*/ 
   /* summera ihop  för om det finns fler fastigehter*/
   FOR EACH mval BY mval.BETECKNING:
      IF mval.BETECKNING NE fbet THEN DO:
         fabet = fabet + " " + mval.BETECKNING.
         FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
         IF AVAILABLE sumtemp THEN DO:
           
            mmini = mmini + sumtemp.MINIERS.
            DEBUGGER:SET-BREAK().
            IF avtal BEGINS "upplåtelseluft" OR avtal BEGINS "upplåtelsemark" THEN DO:
               /*IF globforetag = "TECT" OR globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS"   OR globforetag = "ELPA" THEN DO:*/ 
               lled = lled + sumtemp.OMN + sumtemp.OMB + sumtemp.SMN + sumtemp.SMB.
               /*OM DECIMAL FRAMRÄKNAD - ANVÄND*/
               IF sumtemp.JKNDEC > 0 THEN jkab = jkab + sumtemp.JKNDEC - sumtemp.JKB.            
               ELSE jkab = jkab + sumtemp.JKN - sumtemp.JKB.  
               IF varforetypval[40] = 1 THEN DO:  
                  lleduex = lleduex + ((sumtemp.OMN + sumtemp.OMB)/ ( 1 + ( 0.25 * 0.66 )))  + ((sumtemp.SMN + sumtemp.SMB) / 1.25).
                  /*OM DECIMAL FRAMRÄKNAD - ANVÄND*/
                  IF sumtemp.JKNDEC > 0 THEN jkabuex = jkabuex + ((sumtemp.JKNDEC - sumtemp.JKB) / 1.25).
                  ELSE jkabuex = jkabuex + ((sumtemp.JKN - sumtemp.JKB) / 1.25).      
               END.   
               /*END.
               ELSE DO:
                  lled = lled + sumtemp.OMN + sumtemp.OMB.
                  /*OM DECIMAL FRAMRÄKNAD - ANVÄND*/            
                  IF sumtemp.JKNDEC > 0 THEN jkab = jkab + sumtemp.JKNDEC - sumtemp.JKB + sumtemp.SMN + sumtemp.SMB.
                  ELSE jkab = jkab + sumtemp.JKN - sumtemp.JKB + sumtemp.SMN + sumtemp.SMB.
                  lleduex = lleduex + ((sumtemp.OMN + sumtemp.OMB)/ (1 + (0.25 * 0.66))).
                  IF sumtemp.JKNDEC > 0 THEN jkabuex = jkabuex + ((sumtemp.JKNDEC - sumtemp.JKB) / 1.25) + + ((sumtemp.SMN + sumtemp.SMB) / 1.25).
                  ELSE jkabuex = jkabuex + ((sumtemp.JKN - sumtemp.JKB) / 1.25) + + ((sumtemp.SMN + sumtemp.SMB) / 1.25).                          
               END.*/
               nats = nats + sumtemp.TSF - sumtemp.TSB.         
               /*separera kabelskåp och station på två rader kabelskåp ska in på överigt   lena 20140507*/
                              
               kskap = kskap + sumtemp.TSKF - sumtemp.TSKB.                                                
               IF avtal BEGINS "upplåtelseluft" OR avtal BEGINS "upplåtelsemark" THEN DO:
                  ovg = ovg + sumtemp.OVRIG.   
                  tlgg = tlgg + sumtemp.TILLAGG.   
                  jkab = jkab + sumtemp.JKLN - sumtemp.JKLB.     /* obs! lägg till lågspänning om uppdalad*/
                  fastbelopp = fastbelopp + sumtemp.SMF + sumtemp.JKF +  sumtemp.OMF.
                  /* borttaget eftersom kabelskåp ska ut separat 20140507
                  nats = nats + sumtemp.TSKF - sumtemp.TSKB.    /*lägg till även kabelskåpen till nätstation*/*/                    
               END.
            END.
            IF avtal BEGINS "harnosand"  THEN DO:
               nats = nats + sumtemp.TSF - sumtemp.TSB.
            END.         
            ttalt = ttalt + sumtemp.SUMMA.
            
         END.
      END.
      fbet = mval.BETECKNING.
   END.   
   IF varforetypval[40] = 1 THEN DO:      
      exltot = (lled - lleduex) + (jkab - jkabuex).
   END.
   ELSE IF varforetypval[40] = 0 THEN DO:                
      exltot = ((sumtemp.OMN + sumtemp.OMB) * ( 0.25 * 0.66 ))  + ((sumtemp.SMN + sumtemp.SMB) * 0.25) + ((sumtemp.TSF + sumtemp.TSKF) * 0.25).
      /*OM DECIMAL FRAMRÄKNAD - ANVÄND*/
      IF sumtemp.JKNDEC > 0 THEN exltot = exltot + ((sumtemp.JKNDEC - sumtemp.JKB) * 0.25).
      ELSE exltot = exltot + ((sumtemp.JKN - sumtemp.JKB) * 0.25).      
   END.      
   fnamnb = ".doc".
   /*fnamnb = ".docx".*/   
   IF avtal = "upplåtelseluft" OR avtal = "upplåtelseluftLast" THEN DO:   
      lujona = "".
      IF avtal = "upplåtelseluft" THEN fnamnA = "Muluft".
      IF avtal = "upplåtelseluftLast" THEN fnamnA = "MUA Luft".         
      FIND FIRST mval NO-LOCK NO-ERROR.   
      FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
      IF AVAILABLE sumtemp THEN DO:             
         IF globforetag = "TECT" OR globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS" OR globforetag = "ELPA" THEN DO: 
            /*tectel vill ha skogen (kalmark) som luftledning*/
            IF (sumtemp.OMN + sumtemp.OMB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = "l".  /*Luftledning*/
            IF (sumtemp.JKN - sumtemp.JKB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/
            IF (sumtemp.TSF - sumtemp.TSB) > 0 THEN lujona = lujona + "n".                     /*Nätstation*/
         END.
         ELSE DO:
            IF (sumtemp.OMN + sumtemp.OMB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = "l".  /*Luftledning*/
            IF (sumtemp.JKN - sumtemp.JKB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/
            IF (sumtemp.TSF - sumtemp.TSB) > 0 THEN lujona = lujona + "n".                     /*Nätstation*/
         END.
      END.            
   END.
   ELSE IF avtal = "upplåtelsemark" OR avtal = "upplåtelsemarkLast" THEN DO:
      lujona = "".
      IF avtal = "upplåtelsemark" THEN fnamnA = "Mujord".         
      IF avtal = "upplåtelsemarkLast" THEN fnamnA = "MUA Jord".         
      FIND FIRST mval NO-LOCK NO-ERROR.   
      FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
      IF AVAILABLE sumtemp THEN DO:             
         IF globforetag = "TECT" OR globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS" OR globforetag = "ELPA" THEN DO: 
            /*tectel vill ha skogen (kalmark) som luftledning*/            
            IF (sumtemp.JKN - sumtemp.JKB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/
            IF (sumtemp.TSF - sumtemp.TSB) > 0 THEN lujona = lujona + "n".                     /*Nätstation*/
         END.
         ELSE DO:            
            IF (sumtemp.JKN - sumtemp.JKB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/
            IF (sumtemp.TSF - sumtemp.TSB) > 0 THEN lujona = lujona + "n".                     /*Nätstation*/
         END.
      END.           
   END.
   ELSE IF avtal = "upplåtelsemarkbod" THEN fnamnA = "Markujordb".      
   ELSE IF avtal = "upplåtelseluftbod" THEN fnamnA = "Markuluftb".     
   ELSE IF avtal = "upplåtelsemarklul" THEN fnamnA = "Mujordlu".     
   ELSE IF avtal = "upplåtelseluftlul" THEN fnamnA = "Muluftlu".
   ELSE IF avtal = "upplåtelsemarkjuk" THEN fnamnA = "Mujordju".     
   ELSE IF avtal = "upplåtelseluftjuk" THEN fnamnA = "Muluftju".     
   ELSE IF avtal = "harnosandL06" THEN fnamnA = "L06".  
   ELSE IF avtal = "harnosandM06" THEN fnamnA = "M06".  
   ELSE IF avtal = "harnosandFL06" THEN fnamnA = "FL_06".
   ELSE IF avtal = "harnosandFM06" THEN fnamnA = "FM_06".
   ELSE IF avtal = "harnosandL07" THEN fnamnA = "L07".  
   ELSE IF avtal = "harnosandM07" THEN fnamnA = "M07".  
   ELSE IF avtal = "harnosandFL07" THEN fnamnA = "FL_07".
   ELSE IF avtal = "harnosandFM07" THEN fnamnA = "FM_07".
   ELSE IF avtal = "harnosandL08" THEN fnamnA = "L08".  
   ELSE IF avtal = "harnosandM08" THEN fnamnA = "M08".  
   ELSE IF avtal = "harnosandFL08" THEN fnamnA = "FL_08".
   ELSE IF avtal = "harnosandFM08" THEN fnamnA = "FM_08".
   ELSE IF avtal = "harnosandL10" THEN fnamnA = "L10".  
   ELSE IF avtal = "harnosandM10" THEN fnamnA = "M10".  
   ELSE IF avtal = "harnosandFL10" THEN fnamnA = "FL_10".
   ELSE IF avtal = "harnosandFM10" THEN fnamnA = "FM_10".
   ELSE IF avtal = "harnosandL12" THEN fnamnA = "L12".  
   ELSE IF avtal = "harnosandM12" THEN fnamnA = "M12".  
   ELSE IF avtal = "harnosandFL12" THEN fnamnA = "FL_12".
   ELSE IF avtal = "harnosandFM12" THEN fnamnA = "FM_12".
   ELSE IF avtal = "harnosanduts" THEN fnamnA = "HEMABUTS".  
     
   ELSE IF avtal = "eonupplåtelse" THEN DO:      
      lujona = "".
      FIND FIRST mval NO-LOCK NO-ERROR.   
      FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
      IF AVAILABLE sumtemp THEN DO:             
         IF globforetag = "TECT" OR globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS" OR globforetag = "ELPA" THEN DO: 
            IF (sumtemp.OMN + sumtemp.OMB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = "l".  /*Luftledning*/
            IF (sumtemp.JKN - sumtemp.JKB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/    
         END.
         ELSE DO:
            IF (sumtemp.OMN + sumtemp.OMB /*+ sumtemp.SMN + sumtemp.SMB*/) > 0 THEN lujona = "l".  /*Luftledning*/
            IF (sumtemp.JKN - sumtemp.JKB + sumtemp.SMN + sumtemp.SMB) > 0 THEN lujona = lujona + "j".                     /*Jordkabel*/    
         END.
      END.
      fnamnA = "Eonmarkupp".
      /*IF lujona NE "" THEN fnamn = "Eonmarkupp" + lujona + ".Doc".         
      ELSE fnamn = "Eonmarkupp.Doc".*/         
   END.
   ELSE IF avtal = "eonupplåtelseR" THEN DO:
      fnamnA = "Eonmarkteupp".           
   END.
   
   IF lujona NE "" THEN DO:                     
       fnamnA = fnamnA + lujona.  
   END.   
                                 
   fnamn = fnamnA + fnamnB.  
   
   
   /*fnamn = "Markupplåtelseavtal.Doc".*/
   IF Guru.Konstanter:appcon THEN RUN FINNSTABELL.P ON Guru.Konstanter:apphand TRANSACTION DISTINCT (INPUT "BLOBINFO", OUTPUT bloblog).
   ELSE RUN FINNSTABELL.P (INPUT "BLOBINFO", OUTPUT bloblog).
   
   IF bloblog = TRUE THEN DO:
      {FINNSDYNBLOB.I}
      DEFINE VARIABLE resid AS INTEGER NO-UNDO.
      RUN blobfil_UI IN blobproch (INPUT fnamn, OUTPUT resid).
      IF resid = ? THEN DO:
         kommando = SEARCH(fnamn).      
      END.
      ELSE DO:
         FIND FIRST blobinfotemp WHERE blobinfotemp.ID = resid NO-LOCK NO-ERROR.
         RUN blobopen_UI IN blobproch (INPUT blobinfotemp.FILNAMN, OUTPUT kommando).
      END.
      RUN deleteproc_UI IN blobproch.
      IF VALID-HANDLE(blobproch) THEN DELETE PROCEDURE blobproch NO-ERROR.
   END.
   ELSE kommando = SEARCH(fnamn).   
   /*MESSAGE kommando "SÖK OK" VIEW-AS ALERT-BOX.*/
   IF kommando = ? THEN DO:
      MESSAGE "Hittade inte " fnamn VIEW-AS ALERT-BOX.
      RETURN.       
   END.   
   
   kommando2 = SESSION:TEMP-DIRECTORY + Guru.Konstanter:globanv + "\".
   kommando3 = SESSION:TEMP-DIRECTORY + Guru.Konstanter:globanv + "\".
   kommando4 = kommando.
   
   {SESSIONTEMPDIR.I}
   IF SESSION:CLIENT-TYPE = "WEBCLIENT" THEN DO:
       kommando2 = webclienttempdir.
       kommando3 = webclienttempdir.
   END.
   OS-CREATE-DIR VALUE(kommando2) NO-ERROR.
   
   IF spmall = TRUE AND fildir NE "" THEN DO:
      kommando2 = fildir  + "\".
      kommando3 = fildir  + "\".  
   END.
   
   
   IF avtal = "harnosanduts" THEN DO:
      /*fnamn = "HEMABUTS.DOC".*/
      utsag = 1.
         
      FOR EACH marag:
         fnamn2 = "HEMABUTS" + string(utsag) + ".DOC".
         IF Guru.GlobalaVariabler:plusaonr = "" OR Guru.GlobalaVariabler:plusaonr = ? THEN kommando5 = kommando2 + fnamn2.
         ELSE kommando5 = kommando2 + TRIM (Guru.GlobalaVariabler:plusaonr) + TRIM(STRING(Guru.GlobalaVariabler:plusdnr,Guru.Konstanter:varforetypchar[1])) + fnamn2.
         OS-COPY VALUE(kommando) VALUE(kommando5).
         IF SEARCH(kommando5) = ? THEN DO:
            MESSAGE "Du kan inte kopiera till " kommando2 VIEW-AS ALERT-BOX.
            RETURN.
         END. 
         kommando = kommando5. 
         RUN skapdokuts_UI.
         utsag = utsag + 1.
      END.   
   END.   
   ELSE DO:
      /*
      IF Guru.GlobalaVariabler:plusaonr = "" OR Guru.GlobalaVariabler:plusaonr = ? THEN kommando2 = kommando2 + fnamn.
      ELSE kommando2 = kommando2 + TRIM (Guru.GlobalaVariabler:plusaonr) + TRIM(STRING(Guru.GlobalaVariabler:plusdnr,Guru.Konstanter:varforetypchar[1])) + fnamn.
      
      OS-COPY VALUE(kommando) VALUE(kommando2).
      IF SEARCH(kommando2) = ? THEN DO:
         MESSAGE "Du kan inte kopiera till " kommando2 VIEW-AS ALERT-BOX.
         RETURN.
      END. 
      kommando = kommando2.*/
      RUN skapdok_UI.
   END.   
END PROCEDURE.

PROCEDURE skapdok_UI.

   /*IF  sidvar > 1 THEN DO:*/
      IF Guru.GlobalaVariabler:plusaonr = "" OR Guru.GlobalaVariabler:plusaonr = ? THEN DO:
         kommando2 = kommando3 + fnamnA + string(sidvar) + fnamnB.
      END.
      ELSE DO:
         kommando2 = kommando3 + TRIM (Guru.GlobalaVariabler:plusaonr) + TRIM(STRING(Guru.GlobalaVariabler:plusdnr,Guru.Konstanter:varforetypchar[1])) + fnamnA + string(sidvar) + fnamnB.
      END.
      
      OS-COPY VALUE(kommando4) VALUE(kommando2).   
      kommando = kommando2.
/*   END.*/      
   CREATE "Word.Application" chWord NO-ERROR.
   DEBUGGER:SET-BREAK().
   IF ERROR-STATUS:ERROR = FALSE THEN DO:
      chWord:Options:AllowReadingMode = FALSE NO-ERROR. /*Fix för excel 2013*/
      chDoc = chWord:Documents:Open(kommando,,,,,,,,,).
      IF avtal = "upplåtelseluftLast" OR avtal = "upplåtelsemarkLast" THEN DO:
         /*chDoc:Unprotect("gurulösen").*/
         chWord:VISIBLE = FALSE.
      END.   
      ELSE DO:
         chDoc:Protect(2).
         chWord:VISIBLE = TRUE.
      END.  
      IF spmall = TRUE THEN chWord:Visible = FALSE.
      ELSE IF  skrivutmall = TRUE THEN chWord:Visible = FALSE.
      EMPTY TEMP-TABLE tidut NO-ERROR. 
      ASSIGN
      hjproc = 0
      hjagare = 0.
      FOR EACH mval:
         hjagare = hjagare + 1.
         hjproc = hjproc + mval.PRODEL.
      END.
      
      FIND FIRST mval NO-LOCK NO-ERROR.  
      ASSIGN mval.AONR = aovar
      mval.DELNR = delnrvar.   
      DEBUGGER:SET-BREAK().
      IF avtal BEGINS  "eonupplåtelse" THEN DO:  
         IF globforetag = "TECT" OR globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "GREL" OR globforetag = "FORS" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "ETSA" 
         OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS" OR globforetag = "ELPA" THEN DO:                        
            IF pnamn NE "" THEN RUN inbokvalue_UI (INPUT "Projektnamn" ,INPUT pnamn).                
            IF konc NE "" THEN RUN inbokvalue_UI (INPUT "Konc" ,INPUT konc).         
            IF domsaga NE "" THEN RUN inbokvalue_UI (INPUT "Domsaga" ,INPUT domsaga).                        
            IF par1a > 0 THEN RUN inbokvalue_UI (INPUT "a1" ,INPUT par1a).                        
            IF par1b > 0 THEN RUN inbokvalue_UI (INPUT "b1" ,INPUT par1b).                        
            IF par2c > 0 THEN RUN inbokvalue_UI (INPUT "c2" ,INPUT par2c).                        
            
         END.
         RUN inbokvaluetba12_UI (INPUT "Kontaktnamn" ,INPUT vman).  
         RUN inbokvaluetba12_UI (INPUT "Kontaktnamn2" ,INPUT vman).  
         RUN inbokvaluetba12_UI (INPUT "KontaktAdress" ,INPUT vadress + "   " + vpadress ).        
         RUN inbokvaluetba12_UI (INPUT "Kontakttele" ,INPUT vtelef).
         FIND FIRST marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR .
         IF AVAILABLE marag2 THEN DO:
            /*ägare 1*/         
            RUN inbokvaluetnr12_UI (INPUT "Fägare1" ,INPUT marag2.MARKAGARE).   
            RUN inbokvaluetba12_UI (INPUT "Fastighetsägare1" ,INPUT marag2.MARKAGARE).   
            RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande1" ,INPUT marag2.BETECKNING).
            RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande1" ,INPUT marag2.KOMMUN).
         END.
         FIND NEXT marag2 USE-INDEX BETECKNING  NO-LOCK NO-ERROR.
         IF AVAILABLE marag2 THEN DO:
            /*ägare 2*/   
            RUN inbokvaluetnr12_UI (INPUT "Fägare2" ,INPUT marag2.MARKAGARE).   
            RUN inbokvaluetba12_UI (INPUT "Fastighetsägare2" ,INPUT marag2.MARKAGARE).   
            RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande2" ,INPUT marag2.BETECKNING).
            RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande2" ,INPUT marag2.KOMMUN).
            FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
            IF AVAILABLE marag2 THEN DO:       
               /*ägare 3*/
               RUN inbokvaluetnr12_UI (INPUT "Fägare3" ,INPUT marag2.MARKAGARE).   
               RUN inbokvaluetba12_UI (INPUT "Fastighetsägare3" ,INPUT marag2.MARKAGARE).   
               RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande3" ,INPUT marag2.BETECKNING).
               RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande3" ,INPUT marag2.KOMMUN).
               RUN inbokvaluetnr12_UI (INPUT "BilagaFastighet" ,INPUT marag2.BETECKNING).   
               FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
               IF AVAILABLE marag2 THEN DO:          
                  /*ägare 4*/
                  RUN inbokvaluetnr12_UI (INPUT "Fägare4" ,INPUT marag2.MARKAGARE).   
                  RUN inbokvaluetba12_UI (INPUT "Fastighetsägare4" ,INPUT marag2.MARKAGARE).   
                  RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande4" ,INPUT marag2.BETECKNING).
                  RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande4" ,INPUT marag2.KOMMUN).
                  FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                  IF AVAILABLE marag2 THEN DO:
                     /*ägare 5*/
                     RUN inbokvaluetnr12_UI (INPUT "Fägare5" ,INPUT marag2.MARKAGARE).   
                     RUN inbokvaluetba12_UI (INPUT "Fastighetsägare5" ,INPUT marag2.MARKAGARE).   
                     RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande5" ,INPUT marag2.BETECKNING).
                     RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande5" ,INPUT marag2.KOMMUN).
                     FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                     IF AVAILABLE marag2 THEN DO:
                        /*ägare 6*/
                        RUN inbokvaluetnr12_UI (INPUT "Fägare6" ,INPUT marag2.MARKAGARE).   
                        RUN inbokvaluetba12_UI (INPUT "Fastighetsägare6" ,INPUT marag2.MARKAGARE).   
                        RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande6" ,INPUT marag2.BETECKNING).
                        RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande6" ,INPUT marag2.KOMMUN).
                        FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                        IF AVAILABLE marag2 THEN DO:
                           /*ägare 7*/
                           RUN inbokvaluetnr12_UI (INPUT "Fägare7" ,INPUT marag2.MARKAGARE).   
                           RUN inbokvaluetba12_UI (INPUT "Fastighetsägare7" ,INPUT marag2.MARKAGARE).   
                           RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande7" ,INPUT marag2.BETECKNING).
                           RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande7" ,INPUT marag2.KOMMUN).
                           FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                           IF AVAILABLE marag2 THEN DO:
                              /*ägare 8*/
                              RUN inbokvaluetnr12_UI (INPUT "Fägare8" ,INPUT marag2.MARKAGARE).   
                              RUN inbokvaluetba12_UI (INPUT "Fastighetsägare8" ,INPUT marag2.MARKAGARE).   
                              RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande8" ,INPUT marag2.BETECKNING).
                              RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande8" ,INPUT marag2.KOMMUN).
                              FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                              IF AVAILABLE marag2 THEN DO:
                                 /*ägare 9*/
                                 RUN inbokvaluetnr12_UI (INPUT "Fägare9" ,INPUT marag2.MARKAGARE).   
                                 RUN inbokvaluetba12_UI (INPUT "Fastighetsägare9" ,INPUT marag2.MARKAGARE).   
                                 RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande9" ,INPUT marag2.BETECKNING).
                                 RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande9" ,INPUT marag2.KOMMUN).
                                 FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                                 IF AVAILABLE marag2 THEN DO:
                                    /*ägare 10*/
                                    RUN inbokvaluetnr12_UI (INPUT "Fägare10" ,INPUT marag2.MARKAGARE).   
                                    RUN inbokvaluetba12_UI (INPUT "Fastighetsägare10" ,INPUT marag2.MARKAGARE).   
                                    RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande10" ,INPUT marag2.BETECKNING).
                                    RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande10" ,INPUT marag2.KOMMUN).
                                    FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                                    IF AVAILABLE marag2 THEN DO:
                                       /*ägare 11*/
                                       RUN inbokvaluetnr12_UI (INPUT "Fägare11" ,INPUT marag2.MARKAGARE).   
                                       RUN inbokvaluetba12_UI (INPUT "Fastighetsägare11" ,INPUT marag2.MARKAGARE).   
                                       RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande11" ,INPUT marag2.BETECKNING).
                                       RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande11" ,INPUT marag2.KOMMUN).
                                       FIND NEXT marag2 USE-INDEX BETECKNING NO-LOCK NO-ERROR.
                                       IF AVAILABLE marag2 THEN DO:
                                          /*ägare 12*/
                                          RUN inbokvaluetnr12_UI (INPUT "Fägare12" ,INPUT marag2.MARKAGARE).   
                                          RUN inbokvaluetba12_UI (INPUT "Fastighetsägare12" ,INPUT marag2.MARKAGARE).   
                                          RUN inbokvaluetnr12_UI (INPUT "Fastighettjänande12" ,INPUT marag2.BETECKNING).
                                          RUN inbokvaluetnr12_UI (INPUT "Kommuntjänande12" ,INPUT marag2.KOMMUN).
                                       END.
                                    END.
                                 END.
                              END.
   
                           END.
                        END.
   
                     END.
                  END.
   
               END.
            END.
         END.      
         IF arrendator NE "" THEN RUN inbokvalue_UI (INPUT "Nyttjanderättsinneh" ,INPUT arrendator).      
         IF ttalt > 0 THEN RUN inbokvaluetnr12_UI (INPUT "Totalt" ,INPUT STRING(ttalt) + " :-").                       
      END.
      ELSE DO:              
         
         RUN inbokvalue_UI (INPUT "KontaktNamn" ,INPUT vman).  
         RUN inbokvalue_UI (INPUT "KontaktAdress" ,INPUT vadress).  
         RUN inbokvalue_UI (INPUT "KontaktPostadress" ,INPUT vpadress).  
         RUN inbokvalue_UI (INPUT "Kontakttele" ,INPUT vtelef).  
         
         /*ccc*/
         IF antfast > 1 THEN RUN inbokvalue_UI (INPUT "Fastighettjänande" ,INPUT fabet).
         ELSE RUN inbokvalue_UI (INPUT "Fastighettjänande" ,INPUT mval.BETECKNING).
         RUN inbokvalue_UI (INPUT "Kommuntjänande" ,INPUT fkommun).
         RUN inbokvalue_UI (INPUT "Läntjänande" ,INPUT fvaker).      
         
         IF globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS" OR globforetag = "ELPA" THEN DO:
            IF avtal = "upplåtelseluftlul" OR avtal = "upplåtelsemarklul" THEN DO:
               /*redan ifyllt*/
               
               /*RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Luleå Kronan 1:6").*/
               RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Luleå").
               RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").
            END.             
            ELSE IF avtal = "upplåtelseluftbod" OR avtal = "upplåtelsemarkbod" THEN DO:
               /*ingen fastighet för bodenavtal*/
               RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Boden").
               RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").
               IF globforetag = "SKOK" THEN DO:
                  RUN inbokvalue_UI (INPUT "Ledningsunderskrift" ,INPUT "Jan-Olov Nylander").                              
               END.         
            END.
            ELSE DO:         
               IF fkommun = "Haparanda" OR fkommun = "Kalix" OR fkommun = "Överkalix" OR fkommun =  "Övertorneå"   THEN DO:    
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Näsbyn 4:15").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Kalix").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").         
               END.              
               IF fkommun = "Gällivare" OR fkommun = "Jokkmokk" OR fkommun = "Kiruna" OR fkommun =  "Pajala"   THEN DO:    
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Videt 7").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Gällivare").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").         
               END.        
               IF fkommun = "Arvidsjaur" OR fkommun = "Arjeplog" OR fkommun = "Boden" OR fkommun =  "Piteå" OR fkommun =  "Älvsbyn"  THEN DO:    
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Arvidsjaur 6:20").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Arvidsjaur").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").                           
               END.
               IF fvaker = "Västerbottens län" OR fvaker = "Västernorrlands län" THEN DO: 
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Harrselsfors 1:22").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Vännäs ").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västerbottens län").         
               END.               
               IF fkommun = "Strängnäs" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Biholm 3:10").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Strängnäs").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Södermanlands län").
               END.
               IF fkommun = "Tyresö" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Bollmora 1:61").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Tyresö").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
               END.
               IF fkommun = "Värmdö" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Bullandö 1:9").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Värmdö").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
               END.
               IF fkommun = "Sigtuna" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Märsta 8:1").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Sigtuna").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
               END.
               IF fkommun = "Botkyrka" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Tumba 8:21").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Botkyrka").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
               END.
               IF fkommun = "Norrtälje" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Häverö-Västernäs 1:65").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Norrtälje").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
               END.
               IF fkommun = "Huddinge" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Transformatorn 2").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Huddinge").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
               END.
               IF fkommun = "Sundbyberg" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Sundbyberg 2:28").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Sundbyberg").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Stockholms län").
               END.
               IF fkommun = "Eskilstuna" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Knutstaslog 1:5").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Eskilstuna").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Södermanlands län").
               END.
               IF fkommun = "Surahammar" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Surahammar 9:3").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Surahammar").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västmanlands län").
               END.
               IF fkommun = "Avesta" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Myran 1").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Avesta").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Dalarnas län").
               END.
               IF fkommun = "Uppsala" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Fullerö 18:45").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Uppsala").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Uppsala län").
               END.
               IF fkommun = "Tierp" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Vallskoga 1:121").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Tierp").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Uppsala län").
               END.
               IF fkommun = "Knivsta" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Husby-Långhundra 6:20").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Knivsta").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Uppsala län").
               END.               
               IF fkommun = "Enköping" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Rymningen 16:3").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Enköping").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Uppsala län").
               END.
               IF fkommun = "Boden" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Sävast 17:7").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Boden").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Norrbottens län").
               END.                                             
               IF fkommun = "Trollhättan" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Lextorp 7:1").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Trollhättan").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västra Götalands län").
               END.
               IF fkommun = "Vänersborg" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Begonian 10").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Vänersborg").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västra Götalands län").
               END.
               IF fkommun = "Motala" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Charlottenborg 2:18").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Motala").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Östergötlands län").
               END.               
               IF fkommun = "Nyköping" THEN DO:
                  RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Nyköpings Bruk 6").
                  RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Nyköping").
                  RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Södermanlands län").
               END.                
            END.
         END.      
         IF globforetag = "VAST" OR globforetag = "VELD" OR globforetag = "BHEL" OR globforetag = "ESKO" OR globforetag = "NYLB" OR globforetag = "cELPA" THEN DO: 
            IF omravd = 1 OR omravd = 2  THEN DO:    
               RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Begonian 10").
               RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Vänersborg").
               RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Västra Götaland").         
            END.
            IF omravd = 3 THEN DO:
               RUN inbokvalue_UI (INPUT "Fastighethärskande" ,INPUT "Nyköpingsbruk 6").         
               RUN inbokvalue_UI (INPUT "Kommunhärskande" ,INPUT "Nyköping").
               RUN inbokvalue_UI (INPUT "Länhärskande" ,INPUT "Södermanland").                                 
            END.         
         END.      
         FIND FIRST marag NO-LOCK NO-ERROR.
         IF globforetag = "VAST" OR globforetag = "VELD" OR globforetag = "BHEL" OR globforetag = "ESKO" OR globforetag = "NYLB" OR globforetag = "GREL" OR globforetag = "FORS" OR globforetag = "ETSA" OR globforetag = "cELPA" THEN DO: 
            /*ägare 1*/                       
            RUN inbokvalue_UI (INPUT "Fägare1" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).   
            RUN inbokvalue_UI (INPUT "Fastighetsägare1" ,INPUT marag.MARKAGARE).  
            IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare21" ,INPUT marag.MARKAGARE).                          
            FIND NEXT marag NO-LOCK NO-ERROR.
            IF AVAILABLE marag THEN DO:
               /*ägare 2*/                          
               RUN inbokvalue_UI (INPUT "Fägare2" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).      
               RUN inbokvalue_UI (INPUT "Fastighetsägare2" ,INPUT marag.MARKAGARE).  
               IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare22" ,INPUT marag.MARKAGARE).                     
               FIND NEXT marag NO-LOCK NO-ERROR.
               IF AVAILABLE marag THEN DO:       
                  /*ägare 3*/                          
                  RUN inbokvalue_UI (INPUT "Fägare3" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).         
                  RUN inbokvalue_UI (INPUT "Fastighetsägare3" ,INPUT marag.MARKAGARE).
                  IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare23" ,INPUT marag.MARKAGARE).       
                  FIND NEXT marag NO-LOCK NO-ERROR.
                  IF AVAILABLE marag THEN DO:          
                     /*ägare 4*/                            
                     RUN inbokvalue_UI (INPUT "Fägare4" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).            
                     RUN inbokvalue_UI (INPUT "Fastighetsägare4" ,INPUT marag.MARKAGARE).
                     IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare24" ,INPUT marag.MARKAGARE).                               
                     FIND NEXT marag NO-LOCK NO-ERROR.
                     IF AVAILABLE marag THEN DO:
                        /*ägare 5*/                                
                        RUN inbokvalue_UI (INPUT "Fägare5" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).               
                        RUN inbokvalue_UI (INPUT "Fastighetsägare5" ,INPUT marag.MARKAGARE).              
                        IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare25" ,INPUT marag.MARKAGARE).
                        FIND NEXT marag NO-LOCK NO-ERROR.
                        IF AVAILABLE marag THEN DO:
                           /*ägare 6*/                                  
                           RUN inbokvalue_UI (INPUT "Fägare6" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                  
                           RUN inbokvalue_UI (INPUT "Fastighetsägare6" ,INPUT marag.MARKAGARE).              
                           IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare26" ,INPUT marag.MARKAGARE).                           
                           FIND NEXT marag NO-LOCK NO-ERROR.
                           IF AVAILABLE marag THEN DO:
                              /*ägare 7*/                                      
                              RUN inbokvalue_UI (INPUT "Fägare7" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                              RUN inbokvalue_UI (INPUT "Fastighetsägare7" ,INPUT marag.MARKAGARE).              
                              IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare27" ,INPUT marag.MARKAGARE).
                              FIND NEXT marag NO-LOCK NO-ERROR.
                              IF AVAILABLE marag THEN DO:
                                 /*ägare 8*/                                         
                                 RUN inbokvalue_UI (INPUT "Fägare8" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                 RUN inbokvalue_UI (INPUT "Fastighetsägare8" ,INPUT marag.MARKAGARE).              
                                 IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare28" ,INPUT marag.MARKAGARE).                                 
                                 FIND NEXT marag NO-LOCK NO-ERROR.
                                 IF AVAILABLE marag THEN DO:
                                    /*ägare 9*/                                            
                                    RUN inbokvalue_UI (INPUT "Fägare9" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                    RUN inbokvalue_UI (INPUT "Fastighetsägare9" ,INPUT marag.MARKAGARE).              
                                    IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare29" ,INPUT marag.MARKAGARE).
                                    FIND NEXT marag NO-LOCK NO-ERROR.
                                    IF AVAILABLE marag THEN DO:
                                       /*ägare 10*/                                               
                                       RUN inbokvalue_UI (INPUT "Fägare10" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                       RUN inbokvalue_UI (INPUT "Fastighetsägare10" ,INPUT marag.MARKAGARE).              
                                       RUN inbokvalue_UI (INPUT "Fastighetsägare30" ,INPUT marag.MARKAGARE).                                       
                                       FIND NEXT marag NO-LOCK NO-ERROR.
                                       IF AVAILABLE marag THEN DO:
                                          /*ägare 11*/                                                  
                                          RUN inbokvalue_UI (INPUT "Fägare11" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                          RUN inbokvalue_UI (INPUT "Fastighetsägare11" ,INPUT marag.MARKAGARE).              
                                          RUN inbokvalue_UI (INPUT "Fastighetsägare31" ,INPUT marag.MARKAGARE).                                          
                                          FIND NEXT marag NO-LOCK NO-ERROR.
                                          IF AVAILABLE marag THEN DO:
                                             /*ägare 12*/                                                    
                                             RUN inbokvalue_UI (INPUT "Fägare12" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                             RUN inbokvalue_UI (INPUT "Fastighetsägare12" ,INPUT marag.MARKAGARE).              
                                             RUN inbokvalue_UI (INPUT "Fastighetsägare32" ,INPUT marag.MARKAGARE).
                                             FIND NEXT marag NO-LOCK NO-ERROR.
                                             IF AVAILABLE marag THEN DO:
                                                /*ägare 13*/                                                      
                                                RUN inbokvalue_UI (INPUT "Fägare13" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                                RUN inbokvalue_UI (INPUT "Fastighetsägare13" ,INPUT marag.MARKAGARE).              
                                                RUN inbokvalue_UI (INPUT "Fastighetsägare33" ,INPUT marag.MARKAGARE).                                                
                                                FIND NEXT marag NO-LOCK NO-ERROR.
                                                IF AVAILABLE marag THEN DO:
                                                   /*ägare 14*/                                                          
                                                   RUN inbokvalue_UI (INPUT "Fägare14" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                                   RUN inbokvalue_UI (INPUT "Fastighetsägare14" ,INPUT marag.MARKAGARE).              
                                                   RUN inbokvalue_UI (INPUT "Fastighetsägare34" ,INPUT marag.MARKAGARE).                                                   
                                                END.
                                             END.
                                          END.
                                       END.
                                    END.
                                 END.
                              END.
                           END.
                        END.
                     END.
                  END.
               END.
            END.
         END.
         IF globforetag = "TECT" OR globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS" OR globforetag = "ELPA" THEN DO:            
            /*ägare 1*/   
            IF avtal BEGINS  "harnosand" THEN DO:
               RUN inbokvalue_UI (INPUT "vardman" ,INPUT vardman).
               RUN inbokvalue_UI (INPUT "vardman2" ,INPUT vardman).
               RUN inbokvalue_UI (INPUT "vardtel" ,INPUT vardtel).
               RUN inbokvalue_UI (INPUT "vman" ,INPUT vman).  
               RUN inbokvalue_UI (INPUT "KontaktAdress" ,INPUT vadress).  
               RUN inbokvalue_UI (INPUT "KontaktPostadress" ,INPUT vpadress).  
               RUN inbokvalue_UI (INPUT "Kontakttele" ,INPUT vtelef).
               RUN inbokvalue_UI (INPUT "kabersatt" ,INPUT STRING(kabersatt,">9.99")).  
               RUN inbokvalue_UI (INPUT "Nätstation" ,INPUT STRING(nats)).          
               RUN inbokvalue_UI (INPUT "Datum" ,INPUT STRING(today,"9999-99-99")).
               RUN inbokvalue_UI (INPUT "Fastighet" ,INPUT marag.BETECKNING).
               RUN inbokvalue_UI (INPUT "Fastighet1" ,INPUT marag.BETECKNING).
               RUN inbokvalue_UI (INPUT "Fägare1" ,INPUT marag.MARKAGARE).   
               RUN inbokvalue_UI (INPUT "Pnr1" ,INPUT STRING(marag.PERSONNUMMER,"999999-9999")).   
               RUN inbokvalue_UI (INPUT "Fastighetsägare1" ,INPUT marag.MARKAGARE).              
               IF ttalt > 0 THEN RUN inbokvalue_UI (INPUT "Totalt1" ,INPUT STRING(ttalt)).  
               IF arrendator = "" THEN  RUN inbokvalue_UI (INPUT "Fastighetsägare21" ,INPUT marag.MARKAGARE).
               RUN inbokvalue_UI (INPUT "projekt" ,INPUT ponr).
               RUN inbokvalue_UI (INPUT "gamled" ,INPUT gamled).
               RUN inbokvalue_UI (INPUT "dödas" ,INPUT dodas).
               IF krha NE 9680 THEN RUN inbokvalue_UI (INPUT "krha" ,INPUT krha).
               IF skadeers > 0 THEN RUN inbokvalue_UI (INPUT "skadeersättning" ,INPUT skadeers).
               IF tilldag NE ? THEN RUN inbokvalue_UI (INPUT "tillträdelsedag" ,INPUT STRING(tilldag,"9999-99-99")).
               IF tkmeter NE "" THEN RUN inbokvalue_UI (INPUT "tkmeter" ,INPUT tkmeter).
               IF tkmeter NE "" THEN RUN inbokvalue_UI (INPUT "tkmeter2" ,INPUT tkmeter).                           
            END.
            ELSE DO:        
               RUN inbokvalue_UI (INPUT "Fägare1" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).   
               RUN inbokvalue_UI (INPUT "Fastighetsägare1" ,INPUT marag.MARKAGARE).  
               IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare21" ,INPUT marag.MARKAGARE).     
            END.        
            FIND NEXT marag NO-LOCK NO-ERROR.
            IF AVAILABLE marag THEN DO:
               /*ägare 2*/   
               IF avtal BEGINS "harnosand"  THEN DO:
                  RUN inbokvalue_UI (INPUT "Fägare2" ,INPUT marag.MARKAGARE).   
                  RUN inbokvalue_UI (INPUT "Pnr2" ,INPUT STRING(marag.PERSONNUMMER,"999999-9999")).   
                  RUN inbokvalue_UI (INPUT "Fastighetsägare2" ,INPUT marag.MARKAGARE).                 
                  IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare22" ,INPUT marag.MARKAGARE).                    
               END.
               ELSE DO:        
                  RUN inbokvalue_UI (INPUT "Fägare2" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).      
                  RUN inbokvalue_UI (INPUT "Fastighetsägare2" ,INPUT marag.MARKAGARE).  
                  IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare22" ,INPUT marag.MARKAGARE).      
               END.
               FIND NEXT marag NO-LOCK NO-ERROR.
               IF AVAILABLE marag THEN DO:       
                  /*ägare 3*/
                  IF  avtal BEGINS "harnosand" THEN DO:
                     RUN inbokvalue_UI (INPUT "Fägare3" ,INPUT marag.MARKAGARE).   
                     RUN inbokvalue_UI (INPUT "Pnr3" ,INPUT STRING(marag.PERSONNUMMER,"999999-9999")).   
                     RUN inbokvalue_UI (INPUT "Fastighetsägare3" ,INPUT marag.MARKAGARE).                    
                     IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare23" ,INPUT marag.MARKAGARE).                       
                  END.
                  ELSE DO:        
                     RUN inbokvalue_UI (INPUT "Fägare3" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).         
                     RUN inbokvalue_UI (INPUT "Fastighetsägare3" ,INPUT marag.MARKAGARE).
                     IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare23" ,INPUT marag.MARKAGARE).       
                  END.
                  FIND NEXT marag NO-LOCK NO-ERROR.
                  IF AVAILABLE marag THEN DO:          
                     /*ägare 4*/
                     IF  avtal BEGINS "harnosand" THEN DO:
                        RUN inbokvalue_UI (INPUT "Fägare4" ,INPUT marag.MARKAGARE).   
                        RUN inbokvalue_UI (INPUT "Pnr4" ,INPUT STRING(marag.PERSONNUMMER,"999999-9999")).   
                        RUN inbokvalue_UI (INPUT "Fastighetsägare4" ,INPUT marag.MARKAGARE).                    
                        IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare24" ,INPUT marag.MARKAGARE).                          
                     END.
                     ELSE DO:        
                        RUN inbokvalue_UI (INPUT "Fägare4" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).            
                        RUN inbokvalue_UI (INPUT "Fastighetsägare4" ,INPUT marag.MARKAGARE).
                        IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare24" ,INPUT marag.MARKAGARE).          
                     END.
                     FIND NEXT marag NO-LOCK NO-ERROR.
                     IF AVAILABLE marag THEN DO:
                        /*ägare 5*/                                
                        RUN inbokvalue_UI (INPUT "Fägare5" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).               
                        RUN inbokvalue_UI (INPUT "Fastighetsägare5" ,INPUT marag.MARKAGARE).              
                        IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare25" ,INPUT marag.MARKAGARE).                        
                        FIND NEXT marag NO-LOCK NO-ERROR.
                        IF AVAILABLE marag THEN DO:
                           /*ägare 6*/                                   
                           RUN inbokvalue_UI (INPUT "Fägare6" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                  
                           RUN inbokvalue_UI (INPUT "Fastighetsägare6" ,INPUT marag.MARKAGARE).              
                           IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare26" ,INPUT marag.MARKAGARE).                           
                           FIND NEXT marag NO-LOCK NO-ERROR.
                           IF AVAILABLE marag THEN DO:
                              /*ägare 7*/                                      
                              RUN inbokvalue_UI (INPUT "Fägare7" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                              RUN inbokvalue_UI (INPUT "Fastighetsägare7" ,INPUT marag.MARKAGARE).              
                              IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare27" ,INPUT marag.MARKAGARE).                              
                              FIND NEXT marag NO-LOCK NO-ERROR.
                              IF AVAILABLE marag THEN DO:
                                 /*ägare 8*/                                         
                                 RUN inbokvalue_UI (INPUT "Fägare8" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                 RUN inbokvalue_UI (INPUT "Fastighetsägare8" ,INPUT marag.MARKAGARE).              
                                 IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare28" ,INPUT marag.MARKAGARE).                                 
                                 FIND NEXT marag NO-LOCK NO-ERROR.
                                 IF AVAILABLE marag THEN DO:
                                    /*ägare 9*/                                           
                                    RUN inbokvalue_UI (INPUT "Fägare9" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                    RUN inbokvalue_UI (INPUT "Fastighetsägare9" ,INPUT marag.MARKAGARE).              
                                    IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare29" ,INPUT marag.MARKAGARE).                                    
                                    FIND NEXT marag NO-LOCK NO-ERROR.
                                    IF AVAILABLE marag THEN DO:
                                       /*ägare 10*/                                              
                                       RUN inbokvalue_UI (INPUT "Fägare10" ,INPUT marag.MARKAGARE + " " + STRING(marag.PERSONNUMMER,"999999-9999")).                     
                                       RUN inbokvalue_UI (INPUT "Fastighetsägare10" ,INPUT marag.MARKAGARE).              
                                       IF arrendator = "" THEN RUN inbokvalue_UI (INPUT "Fastighetsägare30" ,INPUT marag.MARKAGARE).                                       
                                    END.
                                 END.
                              END.
                           END.
                        END.
                     END.
                  END.
               END.
            END.
         END.      
         
         IF ponr NE ? THEN RUN inbokvalue_UI (INPUT "Projektnummer" ,INPUT ponr).                  
         IF globforetag = "TECT" OR globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS" OR globforetag = "ELPA" THEN DO:                
            
            IF lelitt NE "" THEN RUN inbokvalue_UI (INPUT "Littera" ,INPUT lelitt).               
            /*IF lelitt NE "" THEN RUN inbokvalue_UI (INPUT "LEDN" ,INPUT lelitt).    */
            IF pnamn NE "" THEN RUN inbokvalue_UI (INPUT "Projektnamn" ,INPUT pnamn).               
            IF pled NE "" THEN RUN inbokvalue_UI (INPUT "Projektledare" ,INPUT pled).         
            IF nstn NE "" THEN RUN inbokvalue_UI (INPUT "nstn" ,INPUT nstn).         
         END.      
         ELSE DO: 
            IF lelitt NE "" THEN RUN inbokvalue_UI (INPUT "Littera" ,INPUT lelitt).               
            IF ortvar NE "" THEN RUN inbokvalue_UI (INPUT "Projektnamn" ,INPUT ortvar).               
            RUN inbokvalue_UI (INPUT "Projektledare" ,INPUT projl).
         END.
         DEBUGGER:SET-BREAK().
         IF arrendator NE "" THEN RUN inbokvalue_UI (INPUT "Nyttjanderättsinneh" ,INPUT arrendator).            
         FIND FIRST mval NO-LOCK NO-ERROR.   
         FIND FIRST sumtemp WHERE sumtemp.BETECKNING = mval.BETECKNING AND sumtemp.MARKNR = mval.MARKNR NO-ERROR.
         IF AVAILABLE sumtemp THEN DO:             
            IF avtal BEGINS "upplåtelseluft" OR avtal BEGINS "upplåtelsemark" THEN DO:
               IF globforetag = "TECT" OR globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS" OR globforetag = "ELPA" THEN DO: 
                        
                  IF varforetypval[40] = 1 THEN DO:
                      /* dela upp för expropriationslagen som VP Vatt*/
                      IF lleduex > 0  THEN RUN inbokvalue_UI (INPUT "Luftledning" ,INPUT STRING(lleduex)).                      
                      IF jkabuex > 0  THEN RUN inbokvalue_UI (INPUT "Jordkabel" ,INPUT STRING(INTEGER(jkabuex))).
                      IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "exl" ,INPUT STRING(INTEGER(exltot))).
                   END.
                   ELSE DO:
                      IF lled > 0  THEN RUN inbokvalue_UI (INPUT "Luftledning" ,INPUT STRING(lled)).
                      IF jkab > 0  THEN RUN inbokvalue_UI (INPUT "Jordkabel" ,INPUT STRING(INTEGER(jkab))).
                      IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "exl" ,INPUT STRING(INTEGER(exltot))).
                      
                   END.                                                           
               END.
               ELSE DO:                  
                  IF varforetypval[40] = 1 THEN DO:  
                      /* dela upp för expropriationslagen som VP Vatt*/
                      IF lleduex > 0 THEN  RUN inbokvalue_UI (INPUT "Luftledning" ,INPUT STRING(lleduex)).                      
                      IF jkabuex > 0 THEN RUN inbokvalue_UI (INPUT "Jordkabel" ,INPUT STRING(INTEGER(jkabuex))).
                      IF exltot > 0 THEN RUN inbokvalue_UI (INPUT "exl" ,INPUT STRING(INTEGER(exltot))).                      
                  END.
                  ELSE DO:
                     IF lled > 0  THEN RUN inbokvalue_UI (INPUT "Luftledning" ,INPUT STRING(lled)).              
                     IF jkab > 0 THEN  RUN inbokvalue_UI (INPUT "Jordkabel" ,INPUT STRING(INTEGER(jkab))).
                     IF exltot > 0  THEN RUN inbokvalue_UI (INPUT "exl" ,INPUT STRING(INTEGER(exltot))).       
                  END. 
               END.
                              
               IF nats > 0  THEN RUN inbokvalue_UI (INPUT "Nätstation" ,INPUT STRING(nats)).                     
               IF kommnatkab NE "" THEN RUN inbokvalue_UI (INPUT "kommnat" ,INPUT STRING(kommnatkab)).
         
               /*kabelskåp ska in på övrigt- flyttat ner 20140827*/               
               /*IF kskap > 0  THEN RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap)).*/                     
               IF kommkskap NE "" THEN RUN inbokvalue_UI (INPUT "ovrigtkom" ,INPUT STRING(kommkskap)).
                    
                         
               DEBUGGER:SET-BREAK().
               IF globforetag = "VAST" OR globforetag = "VELD" OR globforetag = "BHEL" OR globforetag = "ESKO" OR globforetag = "NYLB" OR globforetag = "GREL" OR globforetag = "FORS" OR globforetag = "ETSA"  OR globforetag = "CELPA" THEN DO:                   
                  IF avtal BEGINS "upplåtelseluft" OR avtal BEGINS "upplåtelsemark" THEN DO:
                                                                                                    
                     /*lägg det som är kvar på övrigt*/
                     IF mmini = 0  THEN DO:  /*ej minimi*/                     
                        /*kabelskåp och om det finns något fast belopp*/
                        IF varforetypval[40] = 1 THEN DO:
                           IF INTEGER(ttalt - lled - jkab - nats /*- kskap*/ - tlgg ) > 0 THEN DO:
                               RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(INTEGER(ttalt - lled - jkab - nats - tlgg))).                               
                           END.
                        END.
                        ELSE IF varforetypval[40] = 0 THEN DO:
                           IF INTEGER(ttalt - lled - jkab - nats /*- kskap*/ - tlgg - exltot) > 0 THEN DO:
                              /*avrundningsproblem så att inte kabelskåp bli 499 eller 501 kr*/
                              IF ttalt - lled - jkab - nats /*- kskap*/ - tlgg - exltot - 500 > 2 OR ttalt - lled - jkab - nats /*- kskap*/ - tlgg - exltot - 500 < -2 THEN DO:                                 
                                RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(INTEGER(ttalt - lled - jkab - nats - tlgg - exltot))).
                             END.
                             ELSE RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(INTEGER(500))).                                   
                           END.
                        END.      
                     END.
                     ELSE DO:                                 
                        /*IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap + ovg)).*/                           
                        IF INTEGER(ttalt - mmini) > 0 THEN DO: 
                           RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(INTEGER(ttalt - mmini + kskap))).                     
                           /*RUN inbokvalue_UI (INPUT "ovrigtkom" ,INPUT "25% påslag intrång").                     */
                        END.
                        ELSE IF kskap > 0 THEN RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(INTEGER(kskap))).
                     END.                    
                     /*IF mmini = 0  THEN DO:*/                           
                        IF tlgg > 0  THEN RUN inbokvalue_UI (INPUT "overens" ,INPUT STRING(tlgg)).   
                     /*END.*/            
                  END.
               END.
               ELSE IF globforetag = "TECT" OR globforetag = "PICA"  OR globforetag = "SWEO" OR globforetag = "REJI" OR globforetag = "ELPC" OR globforetag = "SKOK" OR globforetag = "JSBF" OR globforetag = "ATS" OR globforetag = "ELPA" THEN DO:                                                                  
                  IF avtal BEGINS "upplåtelseluft" OR avtal BEGINS "upplåtelsemark" THEN DO:
                     
                     IF kskap > 0  THEN DO:
                       IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg  ) = 0 THEN  RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap + ovg)).   
                       ELSE RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(kskap)).
                     END.                    
                     ELSE IF  fastbelopp > 0 AND INTEGER(fastbelopp - ovg ) = 0 THEN  RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(ovg)).
                     ELSE IF (ovg - tlgg) > 0  THEN DO: 
                        RUN inbokvalue_UI (INPUT "ovrigt" ,INPUT STRING(ovg - tlgg)).   
                        /*RUN inbokvalue_UI (INPUT "ovrigtkom" ,INPUT "25% påslag intrång").                     */
                     END.                     
                     /*IF mmini = 0  THEN DO:*/                           
                        IF tlgg > 0  THEN RUN inbokvalue_UI (INPUT "overens" ,INPUT STRING(tlgg)).   
                     /*END.*/            
                  END.
               END.
               ELSE DO:
                  
               END.      
            END.            
            IF ttalt > 0  THEN RUN inbokvalue_UI (INPUT "Totalt" ,INPUT STRING(ttalt)).                 
            RUN inbokvalue_UI (INPUT "minimiersättning" ,INPUT minimi).      
         END.
      END.
      IF avtal = "upplåtelseluftLast" OR AVTAL =  "upplåtelsemarkLast" THEN DO: 
         /*chDoc:Protect(2,,"gurulösen").*/
         IF spmall = TRUE THEN chWord:Visible = FALSE.
         ELSE IF skrivutmall = TRUE THEN chWord:Visible = FALSE. 
         ELSE chWord:VISIBLE = TRUE.
      END.   
      /*ELSE  chDoc:Protect(2).*/
      DEBUGGER:SET-BREAK().
      IF spmall = TRUE OR skrivutmall = TRUE THEN DO:
         chWord:displayalerts = FALSE.      
         chDoc:SaveAs(kommando,,,,,,,,,).        
         chWord:displayalerts = TRUE.
         IF skrivutmall = TRUE THEN DO:                                 
            chWord:ScreenUpdating = FALSE.
            chDoc:PrintOut(,,,,STRING(SESSION:PRINTER-NAME),,,).                           
         END.                          
         NO-RETURN-VALUE chDoc:CLOSE().
         NO-RETURN-VALUE chWord:QUIT().
      END.   
      
      RELEASE OBJECT chDoc NO-ERROR.
   END.
   RELEASE OBJECT chWord NO-ERROR.
   
END PROCEDURE.


PROCEDURE skapdokuts_UI.
   CREATE "Word.Application" chWord NO-ERROR.
   
   IF ERROR-STATUS:ERROR = FALSE THEN DO:
      chDoc = chWord:Documents:Open(kommando,,,,,,,,,).
      chWord:VISIBLE = TRUE.
      chDoc = chWord:ActiveDocument.
      EMPTY TEMP-TABLE tidut NO-ERROR. 
      /*ASSIGN
      hjproc = 0
      hjagare = 0.
      FOR EACH mval:
         hjagare = hjagare + 1.
         hjproc = hjproc + mval.PRODEL.
      END.*/   
      RUN inbokvalue_UI (INPUT "vardman" ,INPUT vardman).
      RUN inbokvalue_UI (INPUT "vardman2" ,INPUT vardman).
      RUN inbokvalue_UI (INPUT "vardtel" ,INPUT vardtel).
      RUN inbokvalue_UI (INPUT "vman" ,INPUT vman).  
      RUN inbokvalue_UI (INPUT "KontaktAdress" ,INPUT vadress).  
      RUN inbokvalue_UI (INPUT "KontaktPostadress" ,INPUT vpadress).  
      RUN inbokvalue_UI (INPUT "Kontakttele" ,INPUT vtelef).
      RUN inbokvalue_UI (INPUT "kabersatt" ,INPUT STRING(kabersatt,">9.99")).  
      RUN inbokvalue_UI (INPUT "Nätstation" ,INPUT STRING(nats)).          
      RUN inbokvalue_UI (INPUT "Datum" ,INPUT STRING(today,"9999-99-99")).
      RUN inbokvalue_UI (INPUT "Fastighet" ,INPUT marag.BETECKNING).
      RUN inbokvalue_UI (INPUT "Fastighet1" ,INPUT marag.BETECKNING).
      RUN inbokvalue_UI (INPUT "Fägare1" ,INPUT marag.MARKAGARE).   
      RUN inbokvalue_UI (INPUT "Pnr1" ,INPUT STRING(marag.PERSONNUMMER,"999999-9999")).   
      RUN inbokvalue_UI (INPUT "Fastighetsägare1" ,INPUT marag.MARKAGARE).              
      IF ttalt > 0 THEN RUN inbokvalue_UI (INPUT "Totalt1" ,INPUT STRING(ttalt)).  
      IF arrendator = "" THEN  RUN inbokvalue_UI (INPUT "Fastighetsägare21" ,INPUT marag.MARKAGARE).
      RUN inbokvalue_UI (INPUT "projekt" ,INPUT ponr).
      RUN inbokvalue_UI (INPUT "gamled" ,INPUT gamled).
      RUN inbokvalue_UI (INPUT "dödas" ,INPUT dodas).
      IF krha NE 9680 THEN RUN inbokvalue_UI (INPUT "krha" ,INPUT krha).
      IF skadeers > 0 THEN RUN inbokvalue_UI (INPUT "skadeersättning" ,INPUT skadeers).
      IF tilldag NE ? THEN RUN inbokvalue_UI (INPUT "tillträdelsedag" ,INPUT STRING(tilldag,"9999-99-99")).
      IF tkmeter NE "" THEN RUN inbokvalue_UI (INPUT "tkmeter" ,INPUT tkmeter).
      IF tkmeter NE "" THEN RUN inbokvalue_UI (INPUT "tkmeter2" ,INPUT tkmeter).                           
   
      
      chDoc:Protect(2).
      RELEASE OBJECT chDoc NO-ERROR.
   END.
   RELEASE OBJECT chWord NO-ERROR.
   /*IF VALID-HANDLE(skprotapph) THEN DELETE PROCEDURE skprotapph.      
   skprotapph = ?.
   IF VALID-HANDLE(edataapph) THEN DELETE PROCEDURE edataapph.   
   edataapph = ?.*/
END PROCEDURE.   

/*PROCEDURE inbokvalue_UI.
   DEFINE INPUT PARAMETER bokname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER bokvalue AS CHARACTER NO-UNDO.
   DEBUGGER:SET-BREAK().
   IF chDoc:Bookmarks:EXISTS( bokname ) = TRUE THEN DO:      
      chWord:SELECTION:GOTO (wdGoToBookmark BY-VARIANT-POINTER,,,bokname BY-VARIANT-POINTER).  
      IF bokvalue <> ? THEN chWord:SELECTION:TypeText ( bokvalue )  NO-ERROR.   
   END.
END PROCEDURE.*/

PROCEDURE inbokvalue_UI.
   DEFINE INPUT PARAMETER bokname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER bokvalue AS CHARACTER NO-UNDO.
   DEBUGGER:SET-BREAK().
   IF chDoc:Bookmarks:EXISTS( bokname ) = TRUE THEN DO:
      chDoc:FormFields:item(bokname):RESULT = bokvalue .      
      /*chWord:SELECTION:GOTO (wdGoToBookmark BY-VARIANT-POINTER,,,bokname BY-VARIANT-POINTER).
      /*bkRange = chWord:SELECTION:Range.*/
      IF bokvalue <> ? THEN chWord:SELECTION:TypeText ( bokvalue )  NO-ERROR.
      /*bkrange:text = chWord:SELECTION:Range:TEXT(bokvalue). 
      chword:ActiveDocument:Bookmarks:ADD(bokname, bkRange BY-VARIANT-POINTER).*/
      /*IF bokvalue <> ? THEN chWord:SELECTION:TypeText ( bokvalue )  NO-ERROR.
      bkRange = chWord:ActiveDocument:Bookmarks(bokname):Range .*/
      /*IF bokvalue <> ? THEN chWord:SELECTION:TypeText ( bokvalue )  NO-ERROR.
      chword:ActiveDocument:Bookmarks:ADD(bokname, bkRange BY-VARIANT-POINTER).*/*/
   END.
END PROCEDURE.

PROCEDURE inbokvaluetnr12_UI.
   DEFINE INPUT PARAMETER bokname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER bokvalue AS CHARACTER NO-UNDO.
   IF chDoc:Bookmarks:EXISTS( bokname ) = TRUE THEN DO:
      chWord:SELECTION:GOTO (wdGoToBookmark BY-VARIANT-POINTER,,,bokname BY-VARIANT-POINTER).  
      IF bokvalue <> ? THEN DO: 
         chWord:SELECTION:FONT:NAME = "Times New Roman".
         chWord:SELECTION:FONT:SIZE = 12.
         chDoc:FormFields:item(bokname):RESULT = bokvalue .
         /*chWord:SELECTION:TypeText ( bokvalue ) NO-ERROR.*/ 
      END.
     
   END.
END PROCEDURE.

PROCEDURE inbokvaluetba12_UI.
   DEFINE INPUT PARAMETER bokname AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER bokvalue AS CHARACTER NO-UNDO.
   IF chDoc:Bookmarks:EXISTS( bokname ) = TRUE THEN DO:
      chWord:SELECTION:GOTO (wdGoToBookmark BY-VARIANT-POINTER,,,bokname BY-VARIANT-POINTER).  
      IF bokvalue <> ? THEN DO: 
         chWord:SELECTION:FONT:NAME = "Book Antiqua".
         chWord:SELECTION:FONT:SIZE = 12.
         chDoc:FormFields:item(bokname):RESULT = bokvalue .
         /*chWord:SELECTION:TypeText ( bokvalue ) NO-ERROR.*/ 
      END.
     
   END.
END PROCEDURE.

PROCEDURE mval_UI :
   EMPTY TEMP-TABLE mval NO-ERROR. 
   FOR EACH emarkval:      
      CREATE mval.
      BUFFER-COPY emarkval TO mval.
      ASSIGN mval.PRODEL = mval.PROCENT
      mval.ANDEL = "".
      /*markägare andel*/
      IF varforetypval[22] = 1 THEN DO:      
      
         IF mval.PROCENT = 100 THEN DO:
            ASSIGN
            mval.ANDEL = "1/1"        
            mval.PRODEL = mval.PROCENT.         
         END.
         ELSE DO:      
            EMPTY TEMP-TABLE inextradatatemp NO-ERROR. 
            CREATE inextradatatemp.          
            ASSIGN
            inextradatatemp.PROGRAM = "MARKFASTANDEL"                   
            inextradatatemp.HUVUDINT = mval.MARKNR.                    
            inextradatatemp.HUVUDCH = mval.BETECKNING.                    
            RUN etabhamt_UI IN edataapph (INPUT TABLE inextradatatemp, OUTPUT TABLE extradatatemp). 
            FIND FIRST extradatatemp NO-LOCK NO-ERROR.
            IF AVAILABLE extradatatemp THEN DO:      
               ASSIGN
               mval.ANDEL = extradatatemp.SOKCHAR[1]               
               mval.PRODEL = extradatatemp.SOKDEC[1].         
            END.       
            ELSE DO:
               mval.PRODEL = mval.PROCENT.
               IF mval.PROCENT = 100 THEN mval.ANDEL = "1/1".
               ELSE IF mval.PROCENT = 80 THEN mval.ANDEL = "4/5".         
               ELSE IF mval.PROCENT = 66 THEN mval.ANDEL = "2/3".         
               ELSE IF mval.PROCENT = 60 THEN mval.ANDEL = "3/5".         
               ELSE IF mval.PROCENT = 50 THEN mval.ANDEL = "1/2".         
               ELSE IF mval.PROCENT = 40 THEN mval.ANDEL = "2/5".         
               ELSE IF mval.PROCENT = 33 THEN mval.ANDEL = "1/3".         
               ELSE IF mval.PROCENT = 34 THEN mval.ANDEL = "1/3".   
               ELSE IF mval.PROCENT = 25 THEN mval.ANDEL = "1/4".
               ELSE IF mval.PROCENT = 20 THEN mval.ANDEL = "1/5".
               ELSE IF mval.PROCENT = 10 THEN mval.ANDEL = "1/10".
               ELSE mval.ANDEL = STRING(mval.PROCENT) + "/100".
            END.
         END.
      END.
   END.

END PROCEDURE.



