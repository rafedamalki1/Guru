/*VIFAKAPPA.P*/
&Scoped-define NEW NEW
{GLOBVAR2DEL1.I}

FIND FIRST FORETAG NO-LOCK NO-ERROR.
Guru.Konstanter:globforetag = FORETAG.FORETAG.
RUN STYRFORE.P (INPUT Guru.Konstanter:globforetag).
&Scoped-define NEW NEW                          
{FAKTTEMP.I}
{FAKTTYPDEF.I}
&Scoped-define NEW 
{FAKTTYPSKAP.I}

{FAKTBILAG.I}
{TIDUTTTNEW.I}

DEFINE INPUT PARAMETER infaktnr    LIKE FAKTPLAN.FAKTNR NO-UNDO.
DEFINE INPUT PARAMETER kreditnrvar LIKE FAKTURERAD.VFAKTNR NO-UNDO.
DEFINE INPUT PARAMETER direkt AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER TABLE FOR fakbilag.
DEFINE INPUT PARAMETER TABLE FOR sumtidtemp.
DEFINE OUTPUT PARAMETER TABLE FOR tidut.
DEFINE NEW SHARED VARIABLE musz AS LOGICAL NO-UNDO.

DEFINE VARIABLE betvar AS DECIMAL NO-UNDO.
DEFINE VARIABLE fnrvar AS CHARACTER NO-UNDO.
DEFINE VARIABLE vartyp AS INTEGER NO-UNDO.
DEFINE VARIABLE varcolon AS INTEGER NO-UNDO.
DEFINE VARIABLE str AS CHARACTER FORMAT "X(80)" NO-UNDO.   
DEFINE VARIABLE momsumma AS DECIMAL NO-UNDO.
DEFINE VARIABLE momshlpvar AS CHARACTER NO-UNDO.
DEFINE VARIABLE varfakturd AS DATE NO-UNDO.
DEFINE VARIABLE varforfalld AS DATE NO-UNDO.
DEFINE VARIABLE vfknr AS INTEGER NO-UNDO.

{ANMARKD.I}
FIND FAKTPLAN WHERE FAKTPLAN.FAKTNR = infaktnr NO-LOCK NO-ERROR.
FIND FAKTKRED WHERE FAKTKRED.FAKTNR = infaktnr AND FAKTKRED.FDELNR = kreditnrvar NO-LOCK NO-ERROR.      
vfknr = FAKTKRED.VKREDIT.
IF direkt = FALSE THEN DO:
   RUN tidhamt_UI.   
END.

{VIFAKAPPA.I}
