DEFINE VARIABLE perskod AS CHARACTER NO-UNDO.
DEFINE TEMP-TABLE fltemp
   FIELD PERSONALKOD AS CHARACTER
   FIELD DATUM AS DATE
   FIELD KNAPP AS CHARACTER
   FIELD KLOCK AS DECIMAL
   FIELD TOTALT AS DECIMAL
   FIELD FTT AS DECIMAL. 
   
FUNCTION klock100 RETURNS DECIMAL
  ( INPUT ber60 AS DECIMAL ):
/*------------------------------------------------------------------------------
  Purpose:  
    Notes:  
------------------------------------------------------------------------------*/

  RETURN  (TRUNCATE(ber60,0) * 3600 + (ber60 - TRUNCATE(ber60,0)) * 100 * 60) / 3600.

END FUNCTION.
/*dagtot = dagtot + klock100(tidbuff.TOTALT).*/
EMPTY TEMP-TABLE FLTEMP NO-ERROR. 
RUN FLKV_UI (INPUT "SEPLM").
RUN FLKV_UI (INPUT "SEEBn").
RUN FLKV_UI (INPUT "SESST").
RUN FLKV_UI (INPUT "SESLN").

RUN FLIN_UI (INPUT "SEEBn").
RUN FLIN_UI (INPUT "SESST").
RUN FLIN_UI (INPUT "SESLN").

FOR EACH fltemp WHERE NO-LOCK:
   IF fltemp.KNAPP = "UT" THEN DO:
      fltemp.TOTALT = klock100(fltemp.KLOCK - 18).
   END.
   IF fltemp.KNAPP = "IN" THEN DO:
      fltemp.TOTALT = 7 - klock100(fltemp.KLOCK).
   END.

END.

/*perskod = "".
ftot = 0.
FOR EACH FLTEMP BY FLTEMP.PERSONALKOD BY FLTEMP.DATUM:

   IF FLTEMP.PERSONALKOD NE perskod THEN DO:
      ftot = FLTEMP.TOTALT.
      FLTEMP.FTT = ftot.
   END.
   ELSE DO:
      FLTEMP.FTT =  FLTEMP.FTT + FLTEMP.TOTALT.
   END.
    perskod = FLTEMP.PERSONALKOD.
END.*/
OUTPUT TO D:\delad\klient\pro10\flexut.txt.
FOR EACH FLTEMP BY FLTEMP.PERSONALKOD BY FLTEMP.DATUM:
    PUT FLTEMP.PERSONALKOD FLTEMP.datum FLTEMP.knapp FLTEMP.klock FLTEMP.totalt  SKIP.
END.

PROCEDURE FLKV_UI.
 DEFINE INPUT PARAMETER PKOD AS CHARACTER NO-UNDO.
   FOR EACH FLEXTID WHERE PERSONALKOD = PKOD AND DATUM GE 01/01/2011 AND FLEXTID.KNAPP = "UT" AND FLEXTID.TID > 18.
      CREATE fltemp.
      ASSIGN
      FLTEMP.PERSONALKOD = FLEXTID.PERSONALKOD
      FLTEMP.datum = FLEXTID.datum
      FLTEMP.KNAPP = FLEXTID.KNAPP
      FLTEMP.KLOCK = FLEXTID.TID.

   END.
END PROCEDURE.

PROCEDURE FLIN_UI.
 DEFINE INPUT PARAMETER PKOD AS CHARACTER NO-UNDO.
   FOR EACH FLEXTID WHERE PERSONALKOD = PKOD AND DATUM GE 01/01/2011 AND FLEXTID.KNAPP = "IN" AND FLEXTID.TID < 7.
      CREATE fltemp.
      ASSIGN
      FLTEMP.PERSONALKOD = FLEXTID.PERSONALKOD
      FLTEMP.datum = FLEXTID.datum
      FLTEMP.KNAPP = FLEXTID.KNAPP
      FLTEMP.KLOCK = FLEXTID.TID.

   END.
END PROCEDURE.
