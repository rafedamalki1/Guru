
   
   /*xkringkalkinlas.p*/       
DEFINE NEW SHARED VARIABLE quotervar AS CHARACTER FORMAT "X(256)" NO-UNDO.



DEFINE VARIABLE gurubilder AS CHARACTER NO-UNDO.

DEFINE VARIABLE musz AS LOGICAL NO-UNDO.

DEFINE VARIABLE rad AS INTEGER NO-UNDO.
DEFINE VARIABLE prognamn AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE prognamndat AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE prognamnque AS CHARACTER FORMAT "X(20)" NO-UNDO.                
DEFINE VARIABLE words AS CHARACTER FORMAT "X(132)" NO-UNDO.
DEFINE VARIABLE kommando AS CHARACTER  NO-UNDO.
DEFINE VARIABLE kommando2 AS CHARACTER  NO-UNDO.
DEFINE VARIABLE kommandoprog AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE satsvar AS CHARACTER FORMAT "X(11)" NO-UNDO.
DEFINE VARIABLE enrvar AS CHARACTER FORMAT "X(11)" NO-UNDO.
DEFINE VARIABLE melvar AS INTEGER NO-UNDO.
DEFINE VARIABLE melvar2 AS INTEGER NO-UNDO.
DEFINE VARIABLE langd AS INTEGER NO-UNDO.
DEFINE VARIABLE pos1 AS INTEGER NO-UNDO. 
DEFINE VARIABLE hjenr AS CHARACTER NO-UNDO.
DEFINE VARIABLE vald_depa  AS INTEGER NO-UNDO.
DEFINE VARIABLE timehjalp AS INTEGER NO-UNDO.
DEFINE VARIABLE trnr AS INTEGER NO-UNDO.
DEFINE VARIABLE akod AS CHARACTER NO-UNDO.
DEFINE VARIABLE lnr AS INTEGER NO-UNDO.
DEFINE TEMP-TABLE tidinah   
   FIELD akodlopnr              AS character
   FIELD benamning              AS character
   FIELD enhet                AS CHARACTER
   FIELD KVID AS INTEGER                 
   FIELD okost              AS DECIMAL.
   
   

DEFINE TEMP-TABLE infil
   FIELD PROGNAMN AS CHARACTER FORMAT "X(78)" 
   INDEX PRO IS PRIMARY PROGNAMN.
DEFINE TEMP-TABLE intid
   FIELD TIN AS CHARACTER FORMAT "X(78)" .
   
DEFINE VARIABLE filnamn AS CHARACTER NO-UNDO.   
DEFINE VARIABLE leverant LIKE LEVERANTOR.LEVKOD NO-UNDO.
DEFINE BUFFER KALKYLKATALOGSUBbuff FOR KALKYLKATALOGSUB.
DEFINE BUFFER kalkylpriserbuff FOR kalkylpriser.

DEFINE VARIABLE hjraknare AS INTEGER NO-UNDO.
FIND FIRST FORETAG NO-LOCK NO-ERROR.
 


   filnamn = "C:\kring\HEbaraökost.skv".
   
   EMPTY TEMP-TABLE tidinah  NO-ERROR.     
   RUN in_UI.
      

   FIND LAST KALKYLKATALOGSUBbuff USE-INDEX KLOGSUBID NO-LOCK NO-ERROR.
   IF AVAILABLE KALKYLKATALOGSUBbuff THEN DO:
      hjraknare = KALKYLKATALOGSUBbuff.KLOGSUBID + 1.
   END.
   ELSE hjraknare = hjraknare + 1.

   CREATE KALKYLKATALOGSUB.
   ASSIGN
   KALKYLKATALOGSUB.KLOGSUBID = hjraknare
   KALKYLKATALOGSUB.KLOGID = ?
   KALKYLKATALOGSUB.BENAMNING = "Kring HE PE"
   KALKYLKATALOGSUB.INDATUM = TODAY.
   
   
     
  RUN skapaposter_UI (INPUT KALKYLKATALOGSUB.KLOGSUBID).

  filnamn = "C:\kring\PEbaraökost.skv".
   
   EMPTY TEMP-TABLE tidinah  NO-ERROR.     
   RUN in_UI.    
   RUN skapaposter2_UI (INPUT KALKYLKATALOGSUB.KLOGSUBID).
      
PROCEDURE in_UI: 
   EMPTY TEMP-TABLE intid NO-ERROR.
   EMPTY TEMP-TABLE tidinah NO-ERROR.
   DEF VAR ordnnr AS INTEGER.
   ordnnr = 1.
   INPUT FROM VALUE(filnamn) NO-ECHO.
   REPEAT:
      DO TRANSACTION: 
         CREATE tidinah.
         ASSIGN.
         IMPORT DELIMITER ";" tidinah   NO-ERROR.
         /*tidinah.ordnr = ordnnr.
         ordnnr = ordnnr + 1.*/
      END.               
   END.


              

   
END PROCEDURE.

PROCEDURE skapaposter_UI:
   DEFINE INPUT PARAMETER KGID AS INTEGER NO-UNDO.
   
   
   FOR EACH kalkylpriserbuff WHERE kalkylpriserbuff.KLOGSUBID = 16 AND kalkylpriserbuff.KPID < 11 NO-LOCK:
      CREATE KALKYLPRISER.
      BUFFER-COPY KALKYLPRISERbuff TO KALKYLPRISER.
      ASSIGN 
      KALKYLPRISER.KLOGSUBID = KGID
      KALKYLPRISER.EGENKODUPP  = TRUE
      KALKYLPRISER.EGENPRISUPP = TRUE. 
   END.
   
     /*CREATE KALKYLPRISER.
      ASSIGN 
      KALKYLPRISER.KLOGSUBID = KGID
      KALKYLPRISER.BENAMNING = "Övrig kostnad"
      KALKYLPRISER.EGENKODUPP  = TRUE
      KALKYLPRISER.EGENPRISUPP = FALSE
      KALKYLPRISER.KPID = 1
      KALKYLPRISER.KVID = 4
      KALKYLPRISER.PRIS = 0
      KALKYLPRISER.SOKBENAMNING = "Övrig kostnad" .*/
   FOR EACH tidinah NO-LOCK:
      
      ASSIGN 
      akod = SUBSTRING(tidinah.akodlopnr,1,4). 
      lnr = INTEGER(SUBSTRING(tidinah.akodlopnr,5)).
      FIND FIRST KALKYLARBKODER WHERE  KALKYLARBKODER.KLOGSUBID = KGID AND KALKYLARBKODER.ARBKOD = akod  NO-LOCK NO-ERROR.
      IF NOT AVAILABLE KALKYLARBKODER THEN DO:      
         CREATE KALKYLARBKODER.
         assign
         KALKYLARBKODER.KLOGSUBID = KGID   
         KALKYLARBKODER.arbkod = akod 
         KALKYLARBKODER.BENAMNING = akod
         KALKYLARBKODER.typkalk = 2.
      END.
      CREATE KALKYLLOPPOSTER.
      ASSIGN
      KALKYLLOPPOSTER.KLOGSUBID = KGID
      KALKYLLOPPOSTER.ARBKOD = AKOD
      KALKYLLOPPOSTER.LOPNR = lnr
      KALKYLLOPPOSTER.BENAMNING = tidinah.BENAMNING      
      KALKYLLOPPOSTER.ENHET = tidinah.ENHET
      KALKYLLOPPOSTER.TYPKALK = 2.
      
      CREATE KALKYLLOPSUB.
      ASSIGN 
      KALKYLLOPSUB.KLOGSUBID = KGID
      KALKYLLOPSUB.ARBKOD = AKOD
      KALKYLLOPSUB.LOPNR = lnr
      KALKYLLOPSUB.KPID = 2      
      KALKYLLOPSUB.KOSTNAD = tidinah.okost.
              
    END.       
      
  
END PROCEDURE.

PROCEDURE skapaposter2_UI:
   DEFINE INPUT PARAMETER KGID AS INTEGER NO-UNDO.
   
   
   /*FOR EACH kalkylpriserbuff WHERE kalkylpriserbuff.KLOGSUBID = 16 AND kalkylpriserbuff.KPID < 11 NO-LOCK:
      CREATE KALKYLPRISER.
      BUFFER-COPY KALKYLPRISERbuff TO KALKYLPRISER.
      ASSIGN 
      KALKYLPRISER.KLOGSUBID = KGID
      KALKYLPRISER.EGENKODUPP  = TRUE
      KALKYLPRISER.EGENPRISUPP = TRUE. 
   END.*/
   
     /*CREATE KALKYLPRISER.
      ASSIGN 
      KALKYLPRISER.KLOGSUBID = KGID
      KALKYLPRISER.BENAMNING = "Övrig kostnad"
      KALKYLPRISER.EGENKODUPP  = TRUE
      KALKYLPRISER.EGENPRISUPP = FALSE
      KALKYLPRISER.KPID = 1
      KALKYLPRISER.KVID = 4
      KALKYLPRISER.PRIS = 0
      KALKYLPRISER.SOKBENAMNING = "Övrig kostnad" .*/
   FOR EACH tidinah NO-LOCK:
      
      ASSIGN 
      akod = SUBSTRING(tidinah.akodlopnr,1,4). 
      lnr = INTEGER(SUBSTRING(tidinah.akodlopnr,5)).
      FIND FIRST KALKYLARBKODER WHERE  KALKYLARBKODER.KLOGSUBID = KGID AND KALKYLARBKODER.ARBKOD = akod  NO-LOCK NO-ERROR.
      IF NOT AVAILABLE KALKYLARBKODER THEN DO:      
         CREATE KALKYLARBKODER.
         assign
         KALKYLARBKODER.KLOGSUBID = KGID   
         KALKYLARBKODER.arbkod = akod 
         KALKYLARBKODER.BENAMNING = akod
         KALKYLARBKODER.typkalk = 2.
      END.
      CREATE KALKYLLOPPOSTER.
      ASSIGN
      KALKYLLOPPOSTER.KLOGSUBID = KGID
      KALKYLLOPPOSTER.ARBKOD = AKOD
      KALKYLLOPPOSTER.LOPNR = lnr
      KALKYLLOPPOSTER.BENAMNING = tidinah.BENAMNING      
      KALKYLLOPPOSTER.ENHET = tidinah.ENHET
      KALKYLLOPPOSTER.TYPKALK = 2.
      
      CREATE KALKYLLOPSUB.
      ASSIGN 
      KALKYLLOPSUB.KLOGSUBID = KGID
      KALKYLLOPSUB.ARBKOD = AKOD
      KALKYLLOPSUB.LOPNR = lnr
      KALKYLLOPSUB.KPID = 2      
      KALKYLLOPSUB.KOSTNAD = tidinah.okost.
              
    END.       
      
END PROCEDURE.
   

=======
   
   /*xkringkalkinlas.p*/       
DEFINE NEW SHARED VARIABLE quotervar AS CHARACTER FORMAT "X(256)" NO-UNDO.



DEFINE VARIABLE gurubilder AS CHARACTER NO-UNDO.

DEFINE VARIABLE musz AS LOGICAL NO-UNDO.

DEFINE VARIABLE rad AS INTEGER NO-UNDO.
DEFINE VARIABLE prognamn AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE prognamndat AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE prognamnque AS CHARACTER FORMAT "X(20)" NO-UNDO.                
DEFINE VARIABLE words AS CHARACTER FORMAT "X(132)" NO-UNDO.
DEFINE VARIABLE kommando AS CHARACTER  NO-UNDO.
DEFINE VARIABLE kommando2 AS CHARACTER  NO-UNDO.
DEFINE VARIABLE kommandoprog AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE satsvar AS CHARACTER FORMAT "X(11)" NO-UNDO.
DEFINE VARIABLE enrvar AS CHARACTER FORMAT "X(11)" NO-UNDO.
DEFINE VARIABLE melvar AS INTEGER NO-UNDO.
DEFINE VARIABLE melvar2 AS INTEGER NO-UNDO.
DEFINE VARIABLE langd AS INTEGER NO-UNDO.
DEFINE VARIABLE pos1 AS INTEGER NO-UNDO. 
DEFINE VARIABLE hjenr AS CHARACTER NO-UNDO.
DEFINE VARIABLE vald_depa  AS INTEGER NO-UNDO.
DEFINE VARIABLE timehjalp AS INTEGER NO-UNDO.
DEFINE VARIABLE trnr AS INTEGER NO-UNDO.
DEFINE VARIABLE akod AS CHARACTER NO-UNDO.
DEFINE VARIABLE lnr AS INTEGER NO-UNDO.
DEFINE TEMP-TABLE tidinah   
   FIELD akodlopnr              AS character
   FIELD benamning              AS character
   FIELD enhet                AS CHARACTER
   FIELD KVID AS INTEGER                 
   FIELD okost              AS DECIMAL.
   
   

DEFINE TEMP-TABLE infil
   FIELD PROGNAMN AS CHARACTER FORMAT "X(78)" 
   INDEX PRO IS PRIMARY PROGNAMN.
DEFINE TEMP-TABLE intid
   FIELD TIN AS CHARACTER FORMAT "X(78)" .
   
DEFINE VARIABLE filnamn AS CHARACTER NO-UNDO.   
DEFINE VARIABLE leverant LIKE LEVERANTOR.LEVKOD NO-UNDO.
DEFINE BUFFER KALKYLKATALOGSUBbuff FOR KALKYLKATALOGSUB.
DEFINE BUFFER kalkylpriserbuff FOR kalkylpriser.

DEFINE VARIABLE hjraknare AS INTEGER NO-UNDO.
FIND FIRST FORETAG NO-LOCK NO-ERROR.
 


   filnamn = "C:\kring\HEbaraökost.skv".
   
   EMPTY TEMP-TABLE tidinah  NO-ERROR.     
   RUN in_UI.
      

   FIND LAST KALKYLKATALOGSUBbuff USE-INDEX KLOGSUBID NO-LOCK NO-ERROR.
   IF AVAILABLE KALKYLKATALOGSUBbuff THEN DO:
      hjraknare = KALKYLKATALOGSUBbuff.KLOGSUBID + 1.
   END.
   ELSE hjraknare = hjraknare + 1.

   CREATE KALKYLKATALOGSUB.
   ASSIGN
   KALKYLKATALOGSUB.KLOGSUBID = hjraknare
   KALKYLKATALOGSUB.KLOGID = ?
   KALKYLKATALOGSUB.BENAMNING = "Kring HE PE"
   KALKYLKATALOGSUB.INDATUM = TODAY.
   
   
     
  RUN skapaposter_UI (INPUT KALKYLKATALOGSUB.KLOGSUBID).

  filnamn = "C:\kring\PEbaraökost.skv".
   
   EMPTY TEMP-TABLE tidinah  NO-ERROR.     
   RUN in_UI.    
   RUN skapaposter2_UI (INPUT KALKYLKATALOGSUB.KLOGSUBID).
      
PROCEDURE in_UI: 
   EMPTY TEMP-TABLE intid NO-ERROR.
   EMPTY TEMP-TABLE tidinah NO-ERROR.
   DEF VAR ordnnr AS INTEGER.
   ordnnr = 1.
   INPUT FROM VALUE(filnamn) NO-ECHO.
   REPEAT:
      DO TRANSACTION: 
         CREATE tidinah.
         ASSIGN.
         IMPORT DELIMITER ";" tidinah   NO-ERROR.
         /*tidinah.ordnr = ordnnr.
         ordnnr = ordnnr + 1.*/
      END.               
   END.


              

   
END PROCEDURE.

PROCEDURE skapaposter_UI:
   DEFINE INPUT PARAMETER KGID AS INTEGER NO-UNDO.
   
   
   FOR EACH kalkylpriserbuff WHERE kalkylpriserbuff.KLOGSUBID = 16 AND kalkylpriserbuff.KPID < 11 NO-LOCK:
      CREATE KALKYLPRISER.
      BUFFER-COPY KALKYLPRISERbuff TO KALKYLPRISER.
      ASSIGN 
      KALKYLPRISER.KLOGSUBID = KGID
      KALKYLPRISER.EGENKODUPP  = TRUE
      KALKYLPRISER.EGENPRISUPP = TRUE. 
   END.
   
     /*CREATE KALKYLPRISER.
      ASSIGN 
      KALKYLPRISER.KLOGSUBID = KGID
      KALKYLPRISER.BENAMNING = "Övrig kostnad"
      KALKYLPRISER.EGENKODUPP  = TRUE
      KALKYLPRISER.EGENPRISUPP = FALSE
      KALKYLPRISER.KPID = 1
      KALKYLPRISER.KVID = 4
      KALKYLPRISER.PRIS = 0
      KALKYLPRISER.SOKBENAMNING = "Övrig kostnad" .*/
   FOR EACH tidinah NO-LOCK:
      
      ASSIGN 
      akod = SUBSTRING(tidinah.akodlopnr,1,4). 
      lnr = INTEGER(SUBSTRING(tidinah.akodlopnr,5)).
      FIND FIRST KALKYLARBKODER WHERE  KALKYLARBKODER.KLOGSUBID = KGID AND KALKYLARBKODER.ARBKOD = akod  NO-LOCK NO-ERROR.
      IF NOT AVAILABLE KALKYLARBKODER THEN DO:      
         CREATE KALKYLARBKODER.
         assign
         KALKYLARBKODER.KLOGSUBID = KGID   
         KALKYLARBKODER.arbkod = akod 
         KALKYLARBKODER.BENAMNING = akod
         KALKYLARBKODER.typkalk = 2.
      END.
      CREATE KALKYLLOPPOSTER.
      ASSIGN
      KALKYLLOPPOSTER.KLOGSUBID = KGID
      KALKYLLOPPOSTER.ARBKOD = AKOD
      KALKYLLOPPOSTER.LOPNR = lnr
      KALKYLLOPPOSTER.BENAMNING = tidinah.BENAMNING      
      KALKYLLOPPOSTER.ENHET = tidinah.ENHET
      KALKYLLOPPOSTER.TYPKALK = 2.
      
      CREATE KALKYLLOPSUB.
      ASSIGN 
      KALKYLLOPSUB.KLOGSUBID = KGID
      KALKYLLOPSUB.ARBKOD = AKOD
      KALKYLLOPSUB.LOPNR = lnr
      KALKYLLOPSUB.KPID = 2      
      KALKYLLOPSUB.KOSTNAD = tidinah.okost.
              
    END.       
      
  
END PROCEDURE.

PROCEDURE skapaposter2_UI:
   DEFINE INPUT PARAMETER KGID AS INTEGER NO-UNDO.
   
   
   /*FOR EACH kalkylpriserbuff WHERE kalkylpriserbuff.KLOGSUBID = 16 AND kalkylpriserbuff.KPID < 11 NO-LOCK:
      CREATE KALKYLPRISER.
      BUFFER-COPY KALKYLPRISERbuff TO KALKYLPRISER.
      ASSIGN 
      KALKYLPRISER.KLOGSUBID = KGID
      KALKYLPRISER.EGENKODUPP  = TRUE
      KALKYLPRISER.EGENPRISUPP = TRUE. 
   END.*/
   
     /*CREATE KALKYLPRISER.
      ASSIGN 
      KALKYLPRISER.KLOGSUBID = KGID
      KALKYLPRISER.BENAMNING = "Övrig kostnad"
      KALKYLPRISER.EGENKODUPP  = TRUE
      KALKYLPRISER.EGENPRISUPP = FALSE
      KALKYLPRISER.KPID = 1
      KALKYLPRISER.KVID = 4
      KALKYLPRISER.PRIS = 0
      KALKYLPRISER.SOKBENAMNING = "Övrig kostnad" .*/
   FOR EACH tidinah NO-LOCK:
      
      ASSIGN 
      akod = SUBSTRING(tidinah.akodlopnr,1,4). 
      lnr = INTEGER(SUBSTRING(tidinah.akodlopnr,5)).
      FIND FIRST KALKYLARBKODER WHERE  KALKYLARBKODER.KLOGSUBID = KGID AND KALKYLARBKODER.ARBKOD = akod  NO-LOCK NO-ERROR.
      IF NOT AVAILABLE KALKYLARBKODER THEN DO:      
         CREATE KALKYLARBKODER.
         assign
         KALKYLARBKODER.KLOGSUBID = KGID   
         KALKYLARBKODER.arbkod = akod 
         KALKYLARBKODER.BENAMNING = akod
         KALKYLARBKODER.typkalk = 2.
      END.
      CREATE KALKYLLOPPOSTER.
      ASSIGN
      KALKYLLOPPOSTER.KLOGSUBID = KGID
      KALKYLLOPPOSTER.ARBKOD = AKOD
      KALKYLLOPPOSTER.LOPNR = lnr
      KALKYLLOPPOSTER.BENAMNING = tidinah.BENAMNING      
      KALKYLLOPPOSTER.ENHET = tidinah.ENHET
      KALKYLLOPPOSTER.TYPKALK = 2.
      
      CREATE KALKYLLOPSUB.
      ASSIGN 
      KALKYLLOPSUB.KLOGSUBID = KGID
      KALKYLLOPSUB.ARBKOD = AKOD
      KALKYLLOPSUB.LOPNR = lnr
      KALKYLLOPSUB.KPID = 2      
      KALKYLLOPSUB.KOSTNAD = tidinah.okost.
              
    END.       
      
END PROCEDURE.
   

>>>>>>> branch 'master' of file:///\\server05\delad\REMOTEGURU\GuruRemote.git
