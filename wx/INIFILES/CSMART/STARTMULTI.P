/*STARTMULTI.P*/

DEFINE INPUT-OUTPUT PARAMETER nyprog AS LOGICAL NO-UNDO.



DEFINE NEW SHARED VARIABLE tth AS HANDLE NO-UNDO.
DEFINE NEW SHARED VARIABLE aonrrec AS RECID NO-UNDO.
DEFINE NEW SHARED VARIABLE aonrrec2 AS RECID NO-UNDO.

DEFINE NEW SHARED VARIABLE skrivut AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE musz AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE bilforare AS LOGICAL FORMAT "JA/NEJ" NO-UNDO.
DEFINE NEW SHARED VARIABLE enflerdygns AS LOGICAL FORMAT "ENDAGS/FLERDYGNS" NO-UNDO.
DEFINE NEW SHARED VARIABLE vart AS CHARACTER FORMAT "X(3)" NO-UNDO.
DEFINE NEW SHARED VARIABLE klocka AS DECIMAL NO-UNDO.
DEFINE NEW SHARED VARIABLE vartpro AS CHARACTER FORMAT "X(3)" NO-UNDO.
DEFINE NEW SHARED VARIABLE valkalknr AS INTEGER NO-UNDO. 
DEFINE NEW SHARED VARIABLE kalkmtrl AS LOGICAL NO-UNDO. 
DEFINE NEW SHARED VARIABLE kalkregvar AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE RAD_FAST AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE TOG_AONR AS LOGICAL INITIAL NO NO-UNDO.
DEFINE NEW SHARED VARIABLE finnskoff AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE vald_kundlev AS CHARACTER FORMAT "X(4)" NO-UNDO.
DEFINE NEW SHARED VARIABLE vald_lev AS CHARACTER FORMAT "X(4)" NO-UNDO.
DEFINE NEW SHARED VARIABLE best AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE sok AS LOGICAL NO-UNDO.  
DEFINE NEW SHARED VARIABLE sokant AS LOGICAL NO-UNDO. 
DEFINE NEW SHARED VARIABLE bestant AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE huvudlev AS CHARACTER FORMAT "X(25)" NO-UNDO.  

DEFINE NEW SHARED VARIABLE globanvextra AS CHARACTER NO-UNDO.
DEFINE VARIABLE hdbloblog AS LOGICAL NO-UNDO.
{windows.i}
{FAKTIN.I}
{KALKIN.I}
{MARKVARDIN.I}
{TIDUTTTNEW.I}
/*appcon ska ej vara new*/
&Scoped-define NEW 
 
&Scoped-define NEW NEW
&Scoped-define SHARED SHARED
{REGVAR.I}
{BESTKUNDALLT.I}
{FAKTTYPDEF.I}
{FORETEMP.I}
/*varforetypval ska vara new*/

{GLOBVAR2DEL1.I}
{OMRTEMPW.I}
{SEKVARN.I}


                              
                              
DEFINE NEW SHARED VARIABLE orgpropath AS CHARACTER NO-UNDO.
DEFINE VARIABLE anvanv AS CHARACTER NO-UNDO.
DEFINE VARIABLE datornamn AS CHARACTER NO-UNDO.
DEFINE VARIABLE chrComputerName AS CHARACTER NO-UNDO FORMAT "X(16)".
DEFINE VARIABLE intBufferSize   AS INTEGER   NO-UNDO INITIAL 16.
DEFINE VARIABLE intResultI       AS INTEGER   NO-UNDO.
DEFINE VARIABLE ptrToString     AS MEMPTR    NO-UNDO.
DEFINE VARIABLE chrUserID   AS CHARACTER NO-UNDO.
DEFINE VARIABLE intResult   AS INTEGER   NO-UNDO.
DEFINE VARIABLE intSize     AS INTEGER   NO-UNDO.
DEFINE VARIABLE lpServer     AS CHARACTER NO-UNDO.
DEFINE VARIABLE lpNameBuffer   AS MEMPTR NO-UNDO.
DEFINE VARIABLE BufferType       AS MEMPTR NO-UNDO.


PROCEDURE GetComputerNameA EXTERNAL "KERNEL32.DLL":
   DEFINE OUTPUT       PARAMETER ptrToString     AS MEMPTR.
   DEFINE INPUT-OUTPUT PARAMETER intBufferSize   AS LONG.
   DEFINE RETURN       PARAMETER intResultI       AS SHORT.
END PROCEDURE.
SET-SIZE(ptrToString) = 16.
RUN GetComputerNameA (OUTPUT       ptrToString,
                      INPUT-OUTPUT intBufferSize,
                      OUTPUT       intResultI).
IF intResultI = 1 THEN DO:
   ASSIGN chrComputerName = GET-STRING(ptrToString,1).
   
END.                                            
{PROVAG.I}

IF Guru.Konstanter:appcon THEN DO:
   RUN EGENBENFORE.p ON Guru.Konstanter:apphand TRANSACTION DISTINCT  (OUTPUT TABLE foretemp).   
END.
ELSE DO:
   RUN EGENBENFORE.p (OUTPUT TABLE foretemp).   
END.

FIND FIRST foretemp NO-ERROR.
ASSIGN
Guru.Konstanter:globnystart = TRUE
Guru.Konstanter:globforetag = foretemp.FORETAG
Guru.GlobalaVariabler:plusdval = foretemp.PLUSD.
IF Guru.Konstanter:globforetag = "SEKG" THEN DO:
   Guru.Konstanter:guruvar = REPLACE(Guru.Konstanter:guruvar,"guruonweb","ekgonweb").
   Guru.Konstanter:gurubilder = REPLACE(Guru.Konstanter:gurubilder,"guruonweb","ekgonweb").
   Guru.Konstanter:wtidvar = REPLACE(Guru.Konstanter:wtidvar,"guruonweb","ekgonweb"). 
END.   
IF TRIM(PROVERSION) BEGINS "9.1c" THEN DO:
   MESSAGE "Du ska uppdatera till Progress version!" SKIP
   "Du kan inte köra Guru korrekt! Kontakta Elpool 090-184540"       
   VIEW-AS ALERT-BOX.
   QUIT.
END.
{FORESTYR.I}
{FAKTTYPSKAP.I}
/*aonr*/
DEFINE NEW SHARED VARIABLE retvalkoll AS LOGICAL NO-UNDO.
&Scoped-define NEW NEW
&Scoped-define SHARED SHARED
/*aonr*/
{ANSPROJBER.I}
{ARBATE.I}
{AONRDEF.I}
{AVTPLANTEMP.I}
{PHMT.I}
DEFINE NEW SHARED VARIABLE tanint AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE tanval AS CHARACTER NO-UNDO.
DEFINE NEW SHARED VARIABLE tanlangd AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE qsort AS CHARACTER FORMAT "x(65)" NO-UNDO.
DEFINE NEW SHARED VARIABLE kalkrec AS RECID NO-UNDO.
DEFINE NEW SHARED VARIABLE omrbildvar AS CHARACTER  NO-UNDO.
DEFINE NEW SHARED VARIABLE rubrikvar AS CHARACTER FORMAT "X(30)" NO-UNDO.
DEFINE NEW SHARED VARIABLE saonrrec AS RECID NO-UNDO.
DEFINE NEW SHARED VARIABLE aoplan AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE vardrec AS RECID NO-UNDO.
DEFINE NEW SHARED VARIABLE avbryt AS LOGICAL NO-UNDO.                           
DEFINE NEW SHARED VARIABLE aonrvar AS CHARACTER NO-UNDO. 
DEFINE NEW SHARED VARIABLE delnrvar AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE aonrapph AS HANDLE NO-UNDO.

/*beredning*/
&Scoped-define NEW NEW
&Scoped-define SHARED SHARED
{BERANN.I}
{MTRLTEMP.I} 
{HUVLEVTEMP.I}
{LEVTEMP.I}
{KONVALTEMP.I} 
{KONID.I}       
{LISTMTRL.I}  
{KOPPLINA.I}
{FRITEMP.I}   
{KALKTEMP2.I}  
{BILDBERTEMP.I}
{SMTRL.I}
{MARKGRUPP.I}
DEFINE NEW SHARED VARIABLE kalkrec2 AS RECID NO-UNDO.
DEFINE NEW SHARED VARIABLE karlrec AS RECID NO-UNDO. 
DEFINE NEW SHARED VARIABLE valaonr AS CHARACTER NO-UNDO.
DEFINE NEW SHARED VARIABLE valbernr AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE valdelnr AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE valort AS CHARACTER NO-UNDO. 
DEFINE NEW SHARED VARIABLE valomrade AS CHARACTER NO-UNDO. 
DEFINE NEW SHARED VARIABLE katvar AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE ejanv AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE nyvar AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE datvar AS DATE NO-UNDO.
DEFINE NEW SHARED VARIABLE skapamtrl AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE lista AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE inkop AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE laddaproch AS HANDLE NO-UNDO.
/*kalk*/
{EBRPRISTEMP.I}
{KALKYLTEMP.I}
{EJTEMP.I}
{AVDTEMP.I}
{HAMTAVDJUDEF.I}
{KALKSTART.I}
{SOKMTRL.I}
{LOPTEMP.I}

DEFINE NEW SHARED VARIABLE arkopia     AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE ejkalk      AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE kalkproch   AS HANDLE NO-UNDO. /* KALKAPP.P */
DEFINE NEW SHARED VARIABLE kodbild     AS CHARACTER NO-UNDO.
DEFINE NEW SHARED VARIABLE konvar      AS INTEGER NO-UNDO.                                                
DEFINE NEW SHARED VARIABLE mtrlspec    AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE offert      AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE typ_val     AS INTEGER NO-UNDO. 
DEFINE NEW SHARED VARIABLE typpris     AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE xanmark     AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE xanmark2    AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE xdeci       AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE xfaktor     AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE xhuvud      AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE xmtrl       AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE xpris       AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE xtypmtrl    AS INTEGER NO-UNDO.
DEFINE NEW SHARED VARIABLE xarbkod      AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE xmat AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE summkod AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE felmedd1 AS CHARACTER NO-UNDO.
DEFINE NEW SHARED VARIABLE felmedd2 AS CHARACTER NO-UNDO.
DEFINE NEW SHARED VARIABLE summakalkylvar AS LOGICAL NO-UNDO.

RUN STARTMULTI2.P (INPUT-OUTPUT nyprog).
