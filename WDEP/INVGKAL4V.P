DEFINE TEMP-TABLE spec_mtrl NO-UNDO
    FIELD DEPNR AS INTEGER FORMAT ">>9" LABEL "Depånr"   
    FIELD ENR AS  CHARACTER  FORMAT "x(11)" LABEL "Enr"
    FIELD BENAMNING AS CHARACTER FORMAT "x(40)" LABEL "Benämning" 
    FIELD ENHET AS  CHARACTER FORMAT "x(5)"   LABEL "Enhet" 
    FIELD NPRIS AS  DECIMAL FORMAT ">>>>99.99" LABEL "Netto pris" 
    FIELD BPRIS AS  DECIMAL FORMAT ">>>>99.99"   
    FIELD BERKVANT AS  DECIMAL FORMAT "->>>>9.99" LABEL "Antal"        
    FIELD LEVKOD AS  CHARACTER FORMAT "x(4)"   
    FIELD BESTKVANT AS DECIMAL FORMAT ">>>>9" LABEL "Best-kvant" 
    FIELD BESTPUNKT AS INTEGER FORMAT ">>>>9" LABEL "Best-punkt"    
    FIELD INVDATUM AS DATE
    FIELD INVANT AS INTEGER FORMAT ">>>>9" LABEL "Inv-antal"
    FIELD IB AS INTEGER
    FIELD IBDATUM AS DATE
    FIELD FACKID AS  CHARACTER  FORMAT "x(8)"
    FIELD OMSATT  AS DECIMAL LABEL "Omsättning/år"
    FIELD SALDO AS INTEGER FORMAT ">>>>>9" LABEL "Saldo"
    FIELD LAGER AS LOGICAL
    FIELD KLAR AS LOGICAL.   


DEFINE INPUT PARAMETER vald_depa AS INTEGER NO-UNDO.
DEFINE INPUT PARAMETER datvar AS DATE NO-UNDO.
DEFINE OUTPUT PARAMETER TABLE FOR spec_mtrl.
   
   OPEN QUERY balans FOR EACH MTRLDEP WHERE MTRLDEP.DEPNR = vald_depa AND 
   MTRLDEP.IBDATUM = datvar NO-LOCK.
   GET FIRST balans NO-LOCK.   
   DO WHILE AVAILABLE(MTRLDEP):
      IF MTRLDEP.INVDATUM NE ? THEN DO:  
         CREATE spec_mtrl.          
         ASSIGN      
         spec_mtrl.ENR = MTRLDEP.ENR
         spec_mtrl.BENAMNING = MTRLDEP.BENAMNING
         spec_mtrl.FACKID = MTRLDEP.FACKID
         spec_mtrl.ENHET = MTRLDEP.ENHET
         spec_mtrl.INVANT = MTRLDEP.INVANT
         spec_mtrl.SALDO = MTRLDEP.SALDO
         spec_mtrl.INVDATUM = MTRLDEP.INVDATUM       
         spec_mtrl.NPRIS = MTRLDEP.NPRIS
         spec_mtrl.BPRIS = MTRLDEP.BPRIS     
         spec_mtrl.IB = MTRLDEP.IB 
         spec_mtrl.IBDATUM = MTRLDEP.IBDATUM                     
         spec_mtrl.LEVKOD = MTRLDEP.LEVKOD.         
      END.   
      GET NEXT balans NO-LOCK.      
   END. 
