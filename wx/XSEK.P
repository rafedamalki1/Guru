
   /*XSEK.P*/
/*NY DATABAS LÄGG UPP ELPAO, KUND MED LÖSEN KUND SÄTT BLANK USER ACCESS,
ÄNDRA ADMIN TILL ELPAO KÖR DETTA PROGRAM*/
DEFINE VARIABLE musz AS LOGICAL NO-UNDO.

FIND FIRST _USER WHERE _USER._USERID = "KUND" NO-LOCK NO-ERROR.
IF NOT AVAILABLE _USER THEN DO:
   DO TRANSACTION:
      CREATE _USER.
      ASSIGN
      _USER._PASSWORD = "WtEydlFdWCDjgbjO"
      _USER._USERID = "KUND".
   END.
END.
REPEAT:
   DO TRANSACTION:
      FIND NEXT _File WHERE _file-number > 0 AND _file._owner = "PUB" NO-LOCK NO-ERROR NO-WAIT.
      IF NOT AVAILABLE  _File THEN DO:
         LEAVE.
      END.
      ELSE DO:
         DISPLAY _File._file-name.
         FIND CURRENT _File EXCLUSIVE-LOCK NO-ERROR NO-WAIT.
         IF LOCKED _File THEN musz = musz.
         ELSE IF _file._can-Read NE "ELPAO,KUND" THEN DO:
            ASSIGN   
            _file._can-Read = "ELPAO,KUND"
            _file._can-Write = "ELPAO,KUND"
            _file._can-Create = "ELPAO,KUND"
            _file._can-Delete = "ELPAO,KUND"
            _file._can-Dump = "ELPAO,KUND"
            _file._can-Load = "ELPAO,KUND".   
         END.         
      END.
   END.
END.   
DO TRANSACTION:
   FIND FIRST _File WHERE _file-NAME = "_FILE" EXCLUSIVE-LOCK NO-ERROR NO-WAIT.
   IF AVAILABLE _File THEN DO:
      ASSIGN
      _file._can-Read = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Write = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Create = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Delete = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Dump = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Load = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79).
   END.
   ELSE MESSAGE "_FILE GICK EJ ATT UPPDATERA" VIEW-AS ALERT-BOX.         
END.              
FOR EACH _File WHERE _file-number > 0 AND _file._owner = "PUB" AND _file._can-Read NE "ELPAO,KUND" NO-LOCK BY _file-NAME:
   DISPLAY _file._file-NAME FORMAT "x(15)" _file._can-Read FORMAT "x(15)".
END.
/*SETUSERID("KUND","KUND").*/
/*Äldre databas:
Den som skapat databasen går in via 4GL Data Administration Tool och skapar en 
user "sysprogress", lösen "sysprogress" via Admin - Security - Edit User List, med access till databasen. Access ges via
4GL Data Administration Tool "Admin - Security - Security Administrators "firstadmin,sysprogress". 
Anslut databas via SQL Explorer Tool med user "sysprogress". Sysprogress är default user 
med rättigheter till databas via SQL-92.

Anslut med SQL Explorer Tool.
Host: pc012
Service: 2553
Database: rt9
User: sysprogress
Password: sysprogress


/*Se till att inga users är inne i systemet och kör*/
Ta bort rättigheter för alla klienter som kan komma åt 
databasens meta schema tabeller.
Exempel:
revoke select on pub."_file" from public;
commit;

Sätt rättigheter för den user 
som ska kunna komma åt en viss tabell i databasen. 
Exempel: 
grant select on pub.SUMTIDDAG to KUND;
commit;

Ta bort rättighet för en user.
Exempel:
revoke select on pub.SUMTIDDAG FROM KUND;
commit;

Kontrollera rättighet för en user. Logga in som den user som ska testas.
Kör select på den tabell som ska kontrolleras.
Exempel:
select SUMTIDDAG.AONR from pub.SUMTIDDAG WHERE SUMTIDDAG.AONR = '110300';
*/
