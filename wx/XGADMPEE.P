DEF VAR pnr AS CHARACTER.
DEFINE TEMP-TABLE pkod   
   FIELD PERSONALKOD AS CHARACTER
   FIELD PERSONNUMMER AS CHARACTER    
   FIELD EFTERNAMN AS CHARACTER
   FIELD FORNAMN AS CHARACTER
   FIELD OMRADE AS CHARACTER
   FIELD ANSV AS CHARACTER
   FIELD GANSV AS CHARACTER
   FIELD OVERTIDUTTAG AS CHARACTER
   FIELD BEFATTNING AS CHARACTER
   /*FIELD KOD AS CHARACTER*/
   FIELD ANSTALLNING AS CHARACTER
   FIELD TRAAVTAL AS CHARACTER
   FIELD BEREDSKAPSAVTAL AS CHARACTER
   FIELD DELTID AS LOGICAL
   FIELD VECKOSCHEMA AS INTEGER 
   FIELD PNR AS CHARACTER .

/*INPUT FROM F:\ELPOOL\ELPLO\kraftvärmeenergimarknad\energimarknadGURU3.skv. */
INPUT FROM F:\ELPOOL\ELPLO\kraftvärmeenergimarknad\kraftvärmeguru5.skv.

REPEAT TRANSACTION:
  CREATE pkod.
  ASSIGN.
  IMPORT DELIMITER ";" pkod.
END.   
FOR EACH pkod :
   DISPLAY pkod.
   pkod.pnr = SUBSTRING(pkod.personnummer,1,2) + SUBSTRING( pkod.personnummer,4,2) +
   SUBSTRING( pkod.personnummer,7,2) + SUBSTRING( pkod.personnummer,10,4) .
   DISPLAY pkod.pnr FORMAT "x(15)".
   /*FIND FIRST ANSTFORMTAB WHERE ANSTFORMTAB.KOD = pkod.KOD NO-LOCK NO-ERROR.*/
   CREATE PERSONALTAB.
   ASSIGN 
   PERSONALTAB.PERSONALKOD = pkod.PERSONALKOD
   PERSONALTAB.ANSTNR = pkod.PERSONALKOD
   PERSONALTAB.FORNAMN = pkod.FORNAMN
   PERSONALTAB.EFTERNAMN = pkod.EFTERNAMN
   PERSONALTAB.OMRADE = pkod.OMRADE
   PERSONALTAB.OVERTIDUTTAG = pkod.OVERTIDUTTAG
   PERSONALTAB.BEFATTNING = pkod.BEFATTNING
   PERSONALTAB.ANSTALLNING = pkod.ANSTALLNING   
   PERSONALTAB.TRAAVTAL = pkod.TRAAVTAL
   PERSONALTAB.BEREDSKAPSAVTAL = pkod.BEREDSKAPSAVTAL
   PERSONALTAB.DELTID = pkod.DELTID
   PERSONALTAB.VECKOSCHEMA = pkod.VECKOSCHEMA
   PERSONALTAB.ANSVARIGTIDR = pkod.ANSV
   PERSONALTAB.TIDSGODK = pkod.GANSV
   PERSONALTAB.PERSONNUMMER = pkod.PNR
   PERSONALTAB.ORGCHEF = ""
   PERSONALTAB.LAGBAS = FALSE.   
   
   
   
END.
FOR EACH pkod:
   FIND FIRST ANSVARIGTAB WHERE ANSVARIGTAB.PERSONALKOD = pkod.ANSV EXCLUSIVE-LOCK NO-ERROR.
   IF NOT AVAILABLE ANSVARIGTAB  THEN DO:
      FIND FIRST PERSONALTAB WHERE PERSONALTAB.PERSONALKOD = pkod.ANSV NO-LOCK NO-ERROR.
      IF AVAILABLE PERSONALTAB THEN DO:
         CREATE ANSVARIGTAB.      
         ASSIGN
         ANSVARIGTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD
         ANSVARIGTAB.FORNAMN = PERSONALTAB.FORNAMN
         ANSVARIGTAB.EFTERNAMN = PERSONALTAB.EFTERNAMN
         ANSVARIGTAB.OMREGTID = 00.15.  
      END.
   END.   
   FIND FIRST GODKANNARTAB WHERE GODKANNARTAB.PERSONALKOD = pkod.GANSV EXCLUSIVE-LOCK NO-ERROR.
   IF NOT AVAILABLE GODKANNARTAB  THEN DO:
      FIND FIRST PERSONALTAB WHERE PERSONALTAB.PERSONALKOD = pkod.GANSV NO-LOCK NO-ERROR.
      IF AVAILABLE PERSONALTAB THEN DO:
         CREATE GODKANNARTAB.      
         ASSIGN
         GODKANNARTAB.PERSONALKOD = PERSONALTAB.PERSONALKOD
         GODKANNARTAB.FORNAMN = PERSONALTAB.FORNAMN
         GODKANNARTAB.EFTERNAMN = PERSONALTAB.EFTERNAMN.
      END.
   END.   
   
      
END.
   
   
 
