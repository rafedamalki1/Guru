/*AVTAODATAPP.P*/
&Scoped-define NEW NEW
&Scoped-define SHARED SHARED
{GLOBVAR2DEL1.I}

{AVTAONRTEMP.I}

PROCEDURE avtaodathmt.
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER avtidvar AS INTEGER NO-UNDO.
   
   DEFINE OUTPUT PARAMETER TABLE FOR avtaodattemp.
   EMPTY TEMP-TABLE avtaodattemp NO-ERROR. 
   OPEN QUERY aq FOR EACH AVTAONRDAT WHERE AVTAONRDAT.AONR = aonrvar AND 
   AVTAONRDAT.DELNR = delnrvar AND AVTAONRDAT.AVTALID = avtidvar NO-LOCK.
   GET FIRST aq NO-LOCK.
   DO WHILE AVAILABLE(AVTAONRDAT):
      CREATE avtaodattemp.
      BUFFER-COPY AVTAONRDAT TO avtaodattemp.
      ASSIGN
      avtaodattemp.AVTAODATREC = RECID(AVTAONRDAT).
      GET NEXT aq NO-LOCK.
   END.
   CLOSE QUERY aq.
END PROCEDURE.

PROCEDURE bortavtaodat.
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER avtidvar AS INTEGER NO-UNDO.
   DO TRANSACTION:
      FIND FIRST AVTAONRDAT WHERE AVTAONRDAT.AONR = aonrvar AND 
      AVTAONRDAT.DELNR = delnrvar AND AVTAONRDAT.AVTALID = avtidvar EXCLUSIVE-LOCK NO-ERROR.
      IF AVAILABLE AVTAONRDAT THEN DELETE AVTAONRDAT.
   END.
END PROCEDURE.

PROCEDURE spardat:
   DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER avtidvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER ordvar AS INTEGER NO-UNDO.
   DEFINE INPUT PARAMETER TOG_KLAR AS LOGICAL NO-UNDO.
   DEFINE INPUT PARAMETER FILL-IN-STARTDAT AS DATE NO-UNDO.
   DO TRANSACTION:
      FIND FIRST AVTAONR WHERE AVTAONR.AONR = aonrvar AND AVTAONR.DELNR = delnrvar AND
      AVTAONR.AVTALID = avtidvar AND AVTAONR.ORDNING = ordvar EXCLUSIVE-LOCK NO-ERROR.
      IF TOG_KLAR = FALSE THEN DO:
          AVTAONR.KLAR = ?.
      END.
      ELSE DO:
          AVTAONR.KLAR = FILL-IN-STARTDAT.
      END.   
   END.
   RELEASE AVTAONR NO-ERROR.
END PROCEDURE.
