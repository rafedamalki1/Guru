/*MOMSBERA.P*/
/* ************************  Function Implementations ***************** */

FUNCTION klockan100 RETURNS DECIMAL
  ( INPUT ber60 AS DECIMAL ):
  RETURN  (TRUNCATE(ber60,0) * 3600 + (ber60 - TRUNCATE(ber60,0)) * 100 * 60) / 3600.
END FUNCTION.
FUNCTION klockan60 RETURNS DECIMAL
  ( INPUT ber100 AS DECIMAL ):
  RETURN TRUNCATE(ber100,0) + ((ber100 - TRUNCATE(ber100,0)) / 100) * 60 . 
END FUNCTION.
FUNCTION runda RETURNS DECIMAL
  ( INPUT varedin AS DECIMAL) :
  RETURN ROUND(varedin,0).   /* Function return value. */
END FUNCTION.
&Scoped-define NEW NEW                          
{FAKTTEMP.I}

DEFINE VARIABLE frinr AS INTEGER NO-UNDO.
DEFINE VARIABLE faoff AS DECIMAL NO-UNDO.
DEFINE VARIABLE nyfakttotal AS DECIMAL FORMAT ">>>>>>>>>>>9.9<<<" NO-UNDO .
DEFINE VARIABLE nymomstotal AS DECIMAL NO-UNDO.
DEFINE VARIABLE totkoll AS DECIMAL NO-UNDO.
DEFINE VARIABLE nyber AS DECIMAL NO-UNDO.
DEFINE VARIABLE delfakt AS DECIMAL  NO-UNDO.
DEFINE VARIABLE extrasumma AS DECIMAL  NO-UNDO.
DEFINE VARIABLE musz AS LOGICAL NO-UNDO.
DEFINE TEMP-TABLE artemp NO-UNDO
   FIELD ARTAL AS INTEGER
   INDEX ARTAL ARTAL.

DEFINE TEMP-TABLE frikolltemp NO-UNDO  
   FIELD AONR AS CHARACTER
   FIELD DELNR AS INTEGER 
   FIELD TOTBELOPP AS DECIMAL 
   FIELD TOTFAKT AS DECIMAL
   FIELD FRIBELOPP AS DECIMAL
   FIELD FORDELNING AS LOGICAL
   INDEX AONR IS PRIMARY AONR DELNR.


DEFINE INPUT PARAMETER infakplannr           AS INTEGER NO-UNDO.
DEFINE INPUT PARAMETER fdelnrvar             AS INTEGER NO-UNDO.
DEFINE INPUT PARAMETER vartyp AS INTEGER NO-UNDO.
DEFINE INPUT PARAMETER TOG_MOMS AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER skarpvar LIKE FAKTSKARP.LOPNR NO-UNDO.
DEFINE INPUT PARAMETER tidfaktvar AS DECIMAL NO-UNDO.
DEFINE INPUT PARAMETER tidmomsvar AS DECIMAL NO-UNDO.
DEFINE INPUT PARAMETER FILL-IN_SLUTFAKT AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER rundavar AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER tidigfakt AS DECIMAL NO-UNDO.
DEFINE INPUT PARAMETER FILL-IN_TAKPRIS AS DECIMAL NO-UNDO.
DEFINE OUTPUT PARAMETER nymoms AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER TABLE FOR kosttemp.
DEFINE INPUT PARAMETER TABLE FOR sumtidtemp.
DEFINE INPUT PARAMETER TABLE FOR gfaktemp.
DEFINE OUTPUT PARAMETER TABLE FOR kolltabeltemp.  

FIND FIRST FAKTPLAN WHERE FAKTPLAN.FAKTNR = infakplannr NO-LOCK NO-ERROR.
FIND FIRST FAKTURERAD WHERE FAKTURERAD.FAKTNR = infakplannr AND FAKTURERAD.FDELNR = fdelnrvar  NO-LOCK NO-ERROR.

{MOMSBER.I}


