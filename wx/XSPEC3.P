 /* AUREG.P AUTOMATREGISTRERING   */

DEFINE TEMP-TABLE slutsum           
   FIELD PERSONALKOD LIKE TIDREGITAB.PERSONALKOD    
   FIELD AONR LIKE TIDREGITAB.AONR
   FIELD DELNR LIKE TIDREGITAB.DELNR 
   FIELD ANTAL LIKE EKRAPPRESULT.EANTAL LABEL "TIMMAR"              
   INDEX AONR IS PRIMARY AONR DELNR ASCENDING.  


DEFINE VARIABLE arrhjsum LIKE EKRAPPRESULT.EANTAL   NO-UNDO.    
DEFINE VARIABLE arrhjsum2 LIKE EKRAPPRESULT.EANTAL   NO-UNDO. 
DEFINE VARIABLE arrhjsum3 AS DECIMAL NO-UNDO.  

DEFINE VARIABLE regdatum AS DATE NO-UNDO.  

Regdatum = DATE(01,01,YEAR(TODAY)).        
                            
FOR EACH TIDREGITAB WHERE TIDREGITAB.DATUM >= regdatum AND 
TIDREGITAB.TIDLOG = TRUE NO-LOCK BREAK BY TIDREGITAB.PERSONALKOD 
BY TIDREGITAB.AONR BY TIDREGITAB.DELNR  BY TIDREGITAB.PRISTYP:                                                        ACCUMULATE TIDREGITAB.TOTALT 
   (TOTAL BY TIDREGITAB.PERSONALKOD BY TIDREGITAB.AONR BY TIDREGITAB.DELNR 
   BY TIDREGITAB.PRISTYP).     
   IF LAST-OF(TIDREGITAB.PRISTYP) THEN DO:
      CREATE slutsum.
      ASSIGN 
      slutsum.PERSONALKOD = TIDREGITAB.PERSONALKOD       
      slutsum.AONR = TIDREGITAB.AONR
      slutsum.DELNR = TIDREGITAB.DELNR                                  
      slutsum.ANTAL = (ACCUM TOTAL TIDREGITAB.TOTALT) - arrhjsum2.               
      arrhjsum2 = ACCUM TOTAL TIDREGITAB.TOTALT.            
      
   END. 
END.                           
FOR EACH SLUTSUM BY AONR:
DISPLAY SLUTSUM.PERSONALKOD LABEL "ENH" FORMAT "X(3)"
 SLUTSUM.ANTAL WITH FRAME CCC WIDTH 78 DOWN.
END.    