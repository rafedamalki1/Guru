
/*------------------------------------------------------------------------
    File        : SEKDBSET.P
    Purpose     : 
/*NY DATABAS LÄGG UPP ELPAO, KUND MED LÖSEN KUND SÄTT BLANK USER ACCESS,
ÄNDRA ADMIN TILL ELPAO KÖR DETTA PROGRAM*/
    Syntax      :

    Description : 

    Author(s)   : 
    Created     : Wed Nov 09 12:25:21 CET 2016
    Notes       :
  ----------------------------------------------------------------------*/
  

DEFINE VARIABLE musz AS LOGICAL NO-UNDO.
DO TRANSACTION:
   FIND FIRST _USER WHERE _USER._USERID = "KUND" EXCLUSIVE-LOCK NO-ERROR.
   IF AVAILABLE _USER THEN DO:
      DELETE _USER.
   END.
END.
REPEAT:
   DO TRANSACTION:
      FIND NEXT _File WHERE _file-number > 0 AND _file._owner = "PUB" NO-LOCK NO-ERROR NO-WAIT.
      IF NOT AVAILABLE  _File THEN DO:
         LEAVE.
      END.
      ELSE DO:
         FIND CURRENT _File EXCLUSIVE-LOCK NO-ERROR NO-WAIT.
         IF _File._File-Name BEGINS "odbc" THEN.
         ELSE IF LOCKED _File THEN musz = musz.
         ELSE IF _file._can-Read NE CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79) THEN DO:
            ASSIGN   
            _file._can-Read = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
            _file._can-Write = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
            _file._can-Create = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
            _file._can-Delete = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
            _file._can-Dump = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
            _file._can-Load = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79).   
         END.         
      END.
   END.
END.   
DO TRANSACTION:
   FIND FIRST _File WHERE _file-NAME = "_FILE" EXCLUSIVE-LOCK NO-ERROR NO-WAIT.
   IF AVAILABLE _File THEN DO:
      ASSIGN
      _file._can-Read = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Write = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Create = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Delete = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Dump = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Load = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79).
   END.
END.
DO TRANSACTION:
   FIND FIRST _File WHERE _file-NAME = "_USER" EXCLUSIVE-LOCK NO-ERROR NO-WAIT.
   IF AVAILABLE _File THEN DO:
      ASSIGN
      _file._can-Read = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Write = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Create = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Delete = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Dump = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79)
      _file._can-Load = CHR(69) + CHR(76) + CHR(80) + CHR(65) + CHR(79).
   END.
END.              
RELEASE _file NO-ERROR.
 
/*Äldre databas:
Den som skapat databasen går in via 4GL Data Administration Tool och skapar en 
user "sysprogress", lösen "sysprogress" via Admin - Security - Edit User List, med access till databasen. Access ges via
4GL Data Administration Tool "Admin - Security - Security Administrators "firstadmin,sysprogress". 
Anslut databas via SQL Explorer Tool med user "sysprogress". Sysprogress är default user 
med rättigheter till databas via SQL-92.

Anslut med SQL Explorer Tool.
Host: pc012
Service: 2553
Database: rt9
User: sysprogress
Password: sysprogress


/*Se till att inga users är inne i systemet och kör*/
Ta bort rättigheter för alla klienter som kan komma åt 
databasens meta schema tabeller.
Exempel:
revoke select on pub."_file" from public;
commit;

Sätt rättigheter för den user 
som ska kunna komma åt en viss tabell i databasen. 
Exempel: 
grant select on pub.SUMTIDDAG to KUND;
commit;

Ta bort rättighet för en user.
Exempel:
revoke select on pub.SUMTIDDAG FROM KUND;
commit;

Kontrollera rättighet för en user. Logga in som den user som ska testas.
Kör select på den tabell som ska kontrolleras.
Exempel:
select SUMTIDDAG.AONR from pub.SUMTIDDAG WHERE SUMTIDDAG.AONR = '110300';
*/
