/*FRIKORTM.P*/   
{FRIKORTMWID.I}
{ALLDEF.I}
&Scoped-define NEW 
{GLOBVAR2DEL1.I}
&Scoped-define SHARED SHARED
{APPARAT.I}
{ANNAMN.I}
{KONSTRMTRL.I}
{BBENAMNTEMP.I}
{KONVALTEMP.I} 
{KONID.I} 
{LISTMTRL.I} 
{KOPPLINA.I}  
{FRITEMP.I}  
{BERSKAP.I}
{MARKGRUPP.I}
{MTRLTEMP.I}
{INKSUMBERTEMP.I} 
{BERVALH.I}
{KORTTMP.I}
DEFINE SHARED TEMP-TABLE mtrl_tab NO-UNDO   
   FIELD BENAMNING AS CHARACTER LABEL "Benämning".   
DEFINE SHARED VARIABLE btnbervalh AS HANDLE NO-UNDO.    
DEFINE SHARED VARIABLE meter AS INTEGER NO-UNDO.
DEFINE SHARED VARIABLE lin_rowid AS ROWID NO-UNDO.
DEFINE SHARED VARIABLE liggande AS LOGICAL NO-UNDO.
DEFINE SHARED VARIABLE sida AS LOGICAL NO-UNDO.
DEFINE SHARED VARIABLE  visvalvar AS INTEGER NO-UNDO.   /* 1= progres vis 2 = excel 3 = IE 4 = pdf*/
DEFINE SHARED VARIABLE kabkortvar AS LOGICAL NO-UNDO.
DEFINE SHARED VARIABLE kon_rowid AS ROWID NO-UNDO. 
DEFINE SHARED VARIABLE musz AS LOGICAL NO-UNDO. 
DEFINE SHARED VARIABLE skrivut AS LOGICAL NO-UNDO.  
DEFINE SHARED VARIABLE valaonr AS CHARACTER NO-UNDO.
DEFINE SHARED VARIABLE valdelnr AS INTEGER NO-UNDO.
DEFINE SHARED VARIABLE valort AS CHARACTER NO-UNDO.
DEFINE SHARED VARIABLE valomrade AS CHARACTER NO-UNDO.  
DEFINE VARIABLE status-ok AS LOGICAL NO-UNDO. 
DEFINE VARIABLE gam_rec AS ROWID NO-UNDO.
DEFINE VARIABLE gam_rec2 AS ROWID NO-UNDO.
DEFINE VARIABLE nummer AS INTEGER NO-UNDO.
DEFINE VARIABLE frannr AS INTEGER NO-UNDO.
DEFINE VARIABLE tillnr AS INTEGER NO-UNDO.
DEFINE VARIABLE sparskapnum AS INTEGER NO-UNDO.
DEFINE VARIABLE forsta AS LOGICAL NO-UNDO.
DEFINE VARIABLE mall AS INTEGER NO-UNDO.
DEFINE VARIABLE frikortapph AS HANDLE NO-UNDO.
DEFINE VARIABLE sakrstor AS INTEGER NO-UNDO.
DEFINE VARIABLE x-multi AS DECIMAL NO-UNDO.
DEFINE VARIABLE y-multi AS DECIMAL NO-UNDO.                         
DEFINE VARIABLE kabut AS LOGICAL NO-UNDO.
DEFINE VARIABLE sartnr AS CHARACTER NO-UNDO.
DEFINE VARIABLE antalinkvar AS DECIMAL NO-UNDO.
DEFINE VARIABLE ejskap AS LOGICAL NO-UNDO.
DEFINE VARIABLE visadkm AS CHARACTER NO-UNDO.
DEFINE VARIABLE hspkoll AS LOGICAL NO-UNDO.
DEFINE VARIABLE skyltlev AS CHARACTER NO-UNDO.
DEFINE VARIABLE kollvatt AS LOGICAL NO-UNDO.
DEFINE BUFFER konbuff FOR kon_val.
DEFINE BUFFER koppbuff FOR kopp_lina. 
DEFINE BUFFER idbuff FOR kon_id.
DEFINE BUFFER fribuff FOR fri_temp.
DEFINE BUFFER listbuff FOR list_mtrl.
DEFINE BUFFER listibuff FOR list_mtrl.
DEFINE VARIABLE mtrl_tabh    AS HANDLE NO-UNDO.
DEFINE VARIABLE apparattemph AS HANDLE NO-UNDO.
DEFINE VARIABLE fri_temph      AS HANDLE NO-UNDO.
framesizeh = framesizeextrah.
fri_temph = TEMP-TABLE  fri_temp:DEFAULT-BUFFER-HANDLE.
apparattemph = TEMP-TABLE  apparattemp:DEFAULT-BUFFER-HANDLE.
mtrl_tabh = TEMP-TABLE  mtrl_tab:DEFAULT-BUFFER-HANDLE.
ON 'VALUE-CHANGED' OF BRW_APP PERSISTENT RUN vbrwapp_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED' OF BRW_KAB PERSISTENT RUN vbrwkab_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED' OF BRW_MTRL PERSISTENT RUN vbrwmtrl_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED' OF CMB_SKYLTART PERSISTENT RUN vcmbsart_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF BTN_EXKSKO PERSISTENT RUN btnexk_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF BTN_EXMARK PERSISTENT RUN btnexm_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF BTN_EXSTOLP PERSISTENT RUN btnexs_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF BTN_MEXC PERSISTENT RUN btnmexc_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF BTN_NER PERSISTENT RUN btnner_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF BTN_UPP PERSISTENT RUN btnupp_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED' OF CMB_TYP PERSISTENT RUN vcmbtyp_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF FBTN_AND PERSISTENT RUN fbtnand_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF FBTN_BORT PERSISTENT RUN fbtbort_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF FBTN_PDF PERSISTENT RUN fbtpdf_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF FBTN_SKAPA PERSISTENT RUN fbtskapa_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF FBTN_SKRIV PERSISTENT RUN fbtskriv_UI IN THIS-PROCEDURE.
ON 'MOUSE-MENU-CLICK' OF FBTN_SKRIV PERSISTENT RUN mskriv_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF FBTN_VISA PERSISTENT RUN fbtvisa_UI IN THIS-PROCEDURE.
ON 'ENTRY' OF FILL-IN-APPARAT PERSISTENT RUN eapp_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-ADR        PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-GRUPPNR    PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-KABEL      PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-METER      PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-SAK        PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-MAX        PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-TYP        PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-SADR       PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-APPARAT    PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-AR         PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-ANMARK     PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-NSKYLTANT  PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-NISKYLTANT  PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-ABONNENT    PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-ADR     PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-GRUPPNR PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-KABEL   PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-METER   PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-SAK     PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-MAX     PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-TYP     PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-SADR    PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-APPARAT PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-AR      PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-ANMARK PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'ANY-KEY' OF FILL-IN-ABONNENT PERSISTENT RUN ankeyanm_UI IN THIS-PROCEDURE.
ON 'MOUSE-MENU-CLICK' OF FILL-IN-METER PERSISTENT RUN mmeter_UI IN THIS-PROCEDURE.
ON 'LEAVE' OF FILL-IN-SADR PERSISTENT RUN spara_UI IN THIS-PROCEDURE.
ON 'ENTRY' OF FILL-IN-TYP PERSISTENT RUN etyp_UI IN THIS-PROCEDURE.
ON 'VALUE-CHANGED' OF RAD_VAL PERSISTENT RUN vradval_UI IN THIS-PROCEDURE.
ON 'CHOOSE' OF FBTN_NASTAKABEL PERSISTENT RUN nastakabel_UI IN THIS-PROCEDURE.

PROCEDURE nastakabel_UI :
   DEFINE VARIABLE lastrow AS ROWID NO-UNDO.
   DEFINE VARIABLE lastrow2 AS ROWID NO-UNDO.
   IF FBTN_NASTAKABEL:HIDDEN = FALSE THEN DO:
      RUN getlastkoll_UI IN brwproc[3] (OUTPUT lastrow2).
      RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(fri_temp)).
      RUN lastselectdyn_UI IN brwproc[3].
      RUN getrowid_UI IN brwproc[3] (OUTPUT lastrow).
      IF lastrow = lastrow2 THEN RUN getfirst_UI IN brwproc[3].
      ELSE RUN getnext_UI IN brwproc[3].
      RUN lastselectdyn_UI IN brwproc[3].      
      IF AVAILABLE fri_temp THEN DO:
         RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(fri_temp)).
         RUN lastselectdyn_UI IN brwproc[3].
      END.
   END.   
END PROCEDURE.
PROCEDURE ankeyanm_UI :
   {TRYCKS.I}
      IF KEYFUNCTION(LASTKEY) = ("RETURN") THEN APPLY "CHOOSE" TO FBTN_NASTAKABEL.   
END PROCEDURE.
PROCEDURE vradval_UI :
   EMPTY TEMP-TABLE mtrl_tab NO-ERROR.    
   IF RAD_VAL:SCREEN-VALUE = "1" THEN DO:
      RUN mtrl_UI.
      ASSIGN
      BRW_APP:HIDDEN = TRUE
      BRW_MTRL:HIDDEN = FALSE.
      RUN setcolsortvar_UI IN brwproc[4] (INPUT "").
      RUN openbdynspec_UI IN brwproc[4].      
   END.   
   ELSE IF RAD_VAL:SCREEN-VALUE = "2" THEN DO:    
      ASSIGN
      BRW_MTRL:HIDDEN = TRUE
      BRW_APP:HIDDEN = FALSE.
      RUN setcolsortvar_UI IN brwproc[1] (INPUT "").
      RUN openbdynspec_UI IN brwproc[1].           
   END.   
   ELSE DO:
      RUN mtrl_UI.
      ASSIGN
      BRW_APP:HIDDEN = TRUE
      BRW_MTRL:HIDDEN = FALSE.
      RUN setcolsortvar_UI IN brwproc[4] (INPUT "").
      RUN openbdynspec_UI IN brwproc[4].      
   END.
   IF kabkortvar = TRUE THEN DO:
      ASSIGN
      BRW_APP:HIDDEN = TRUE
      BRW_MTRL:HIDDEN = TRUE.
   END.
END PROCEDURE.
PROCEDURE etyp_UI :
   IF RAD_VAL:SCREEN-VALUE = "1" THEN DO:
      musz = musz.
   END.   
   ELSE DO:            
      ASSIGN    
      RAD_VAL:SCREEN-VALUE = "1"  
      BRW_MTRL:HIDDEN  = FALSE      
      BRW_APP:HIDDEN = TRUE.
      APPLY "VALUE-CHANGED" TO RAD_VAL.
   END.
END PROCEDURE.

PROCEDURE mmeter_UI :
   {muswait.i}   
   RUN METER.W.   
   FILL-IN-METER:SCREEN-VALUE = STRING(meter).   
   {musarrow.i}
END PROCEDURE.
PROCEDURE eapp_UI :
   IF RAD_VAL:SCREEN-VALUE = "1" THEN DO:      
      ASSIGN      
      RAD_VAL:SCREEN-VALUE = "2"
      BRW_MTRL:HIDDEN  = TRUE      
      BRW_APP:HIDDEN  = FALSE.
      APPLY "VALUE-CHANGED" TO RAD_VAL .
   END.   
   ELSE DO:
      musz = musz.
   END.
END PROCEDURE.
PROCEDURE fbtvisa_UI :
   {muswait.i}     
   visvalvar = 1.
   RUN btnok_UI.  
END PROCEDURE.
PROCEDURE mskriv_UI :
   RUN SIDLANGD.W.
END PROCEDURE.
PROCEDURE fbtskriv_UI :
   APPLY "VALUE-CHANGED" TO BRW_KAB.
   MESSAGE "Vill du ha liggande format?" VIEW-AS ALERT-BOX
   QUESTION BUTTONS YES-NO TITLE "Liggande/Stående?" UPDATE liggande.            
   RUN SKRIVVAL.W (INPUT liggande).       
   IF musz = TRUE THEN musz = FALSE. 
   ELSE DO:
      visvalvar = 1.
      {muswait.i}       
      FIND FIRST kon_val WHERE ROWID(kon_val) = kon_rowid NO-LOCK NO-ERROR.
      FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM NO-LOCK NO-ERROR.
      lin_rowid = ROWID(kon_id).                     
      skrivut = TRUE.   
      {AVBGOM2.I}
      RUN VFRIKORTU.W.
      {AVBFRAM2.I}
   END.       
   {musarrow.i}  
END PROCEDURE.
PROCEDURE fbtskapa_UI :
   IF FILL-IN-TYP:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Skåptyp kan inte vara blank." VIEW-AS ALERT-BOX TITLE "Meddelande".
      APPLY "ENTRY" TO FILL-IN-TYP.
      RETURN NO-APPLY.
   END.   
   ELSE IF FILL-IN-SADR:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Skåpadress kan inte vara blank." VIEW-AS ALERT-BOX TITLE "Meddelande".
      APPLY "ENTRY" TO FILL-IN-SADR.
      RETURN NO-APPLY.
   END. 
   ELSE IF FILL-IN-KABEL:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Kabeltyp kan inte vara blank." VIEW-AS ALERT-BOX TITLE "Meddelande".
      APPLY "ENTRY" TO FILL-IN-KABEL.
      RETURN NO-APPLY.
   END.
   ELSE IF FILL-IN-ADR:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Kabeladress kan inte vara blank." VIEW-AS ALERT-BOX TITLE "Meddelande".
      APPLY "ENTRY" TO FILL-IN-ADR.
      RETURN NO-APPLY.
   END.              
   ELSE IF FILL-IN-AR:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Årtal kan inte vara blank." VIEW-AS ALERT-BOX TITLE "Meddelande".
      APPLY "ENTRY" TO FILL-IN-AR.
      RETURN NO-APPLY.
   END.     
   ELSE DO:    
      FIND LAST fri_temp WHERE fri_temp.NUM = kon_id.NUM USE-INDEX NUM
      NO-LOCK NO-ERROR.    
      IF AVAILABLE fri_temp THEN nummer = fri_temp.KABNR + 1.
      ELSE nummer = 1.      
      DEBUGGER:SET-BREAK().
      CREATE fri_temp.
      ASSIGN 
      fri_temp.NUM = kon_id.NUM      
      fri_temp.BENAMNING = FILL-IN-KABEL:SCREEN-VALUE 
      fri_temp.METER = INTEGER(FILL-IN-METER:SCREEN-VALUE)       
      fri_temp.SKAP = FILL-IN-TYP:SCREEN-VALUE
      fri_temp.SKAPADR = FILL-IN-SADR:SCREEN-VALUE 
      fri_temp.APPARAT = FILL-IN-APPARAT:SCREEN-VALUE
      fri_temp.KABADR = FILL-IN-ADR:SCREEN-VALUE
      fri_temp.ARTAL = INTEGER(FILL-IN-AR:SCREEN-VALUE)       
      fri_temp.ANMARK = FILL-IN-ANMARK:SCREEN-VALUE.
      IF fri_temp.TYP = "hsp" THEN.
      ELSE fri_temp.TYP = CMB_TYP:SCREEN-VALUE.
      fri_temp.KABNR = nummer.      
      IF Guru.Konstanter:varforetypval[44] = 1   THEN DO:         
         FIND FIRST markgrupp WHERE markgrupp.NUM = fri_temp.NUM AND markgrupp.KABNR = fri_temp.KABNR NO-ERROR.
         IF NOT AVAILABLE markgrupp THEN DO:
            CREATE markgrupp.
            ASSIGN            
            markgrupp.NUM = fri_temp.NUM
            markgrupp.KABNR = fri_temp.KABNR.                      
         END.
         ASSIGN 
         markgrupp.GRUPP = FILL-IN-GRUPPNR:SCREEN-VALUE  
         fri_temp.GRUPPNR = FILL-IN-GRUPPNR:SCREEN-VALUE
         markgrupp.ARTNR = CMB_SKYLTART:SCREEN-VALUE  
         fri_temp.ARTNR = CMB_SKYLTART:SCREEN-VALUE
         markgrupp.ABONNENT = FILL-IN-ABONNENT:SCREEN-VALUE  
         fri_temp.ABONNENT = FILL-IN-ABONNENT:SCREEN-VALUE.
      END.
      IF CMB_TYP:SCREEN-VALUE = "In" THEN DO:        
         ASSIGN
         fri_temp.SAKR = ?
         fri_temp.MAXSAKR = ?. 
      END.
      ELSE DO:
         ASSIGN
         fri_temp.SAKR = INTEGER(FILL-IN-SAK:SCREEN-VALUE)
         fri_temp.MAXSAKR = INTEGER(FILL-IN-MAX:SCREEN-VALUE).         
      END.     
      RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(fri_temp)).      
      RUN setcolsortvar_UI IN brwproc[3] (INPUT " WHERE NUM = " + STRING(kon_id.NUM) ).
      RUN openbdynspec_UI IN brwproc[3].
      RUN lastselectdyn_UI IN brwproc[3].
   END.  
END PROCEDURE.

PROCEDURE fbtpdf_UI :
   {muswait.i}     
   visvalvar = 4.
   RUN btnok_UI.                              
   {musarrow.i} 
END PROCEDURE.
PROCEDURE fbtbort_UI :
   RUN selectfoc_UI (INPUT 3).
   IF NOT AVAILABLE fri_temp THEN DO:
      RETURN NO-APPLY.
   END.
   ASSIGN
   gam_rec = ROWID(fri_temp).                                                               
   MESSAGE "Vill du ta bort " + fri_temp.BENAMNING + " ?" VIEW-AS ALERT-BOX
   QUESTION BUTTONS YES-NO TITLE "Ta bort?" UPDATE svar AS LOGICAL.         
   IF svar THEN DO:  
      FIND fri_temp WHERE ROWID(fri_temp) = gam_rec EXCLUSIVE-LOCK.
      DELETE fri_temp.      
      RUN selnextprevrow_UI IN brwproc[3].      
      RUN setcolsortvar_UI IN brwproc[3] (INPUT " WHERE NUM = " + STRING(kon_id.NUM) ).
      RUN openbdynspec_UI IN brwproc[3].  
      RUN lastselectdyn_UI IN brwproc[3].
   END.
END PROCEDURE.
PROCEDURE fbtnand_UI :
   RUN selectfoc_UI (INPUT 3).
   ASSIGN
   gam_rec = ROWID(fri_temp). 
   IF FILL-IN-TYP:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Skåptyp kan inte vara blank." VIEW-AS ALERT-BOX TITLE "Meddelande".
      APPLY "ENTRY" TO FILL-IN-TYP.
      RETURN NO-APPLY.
   END.      
   ELSE IF FILL-IN-KABEL:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Kabeltyp kan inte vara blank." VIEW-AS ALERT-BOX TITLE "Meddelande".
      APPLY "ENTRY" TO FILL-IN-KABEL.
      RETURN NO-APPLY.
   END.
   ELSE IF FILL-IN-ADR:SCREEN-VALUE = "" THEN DO:
      MESSAGE "Kabeladress kan inte vara blank." VIEW-AS ALERT-BOX TITLE "Meddelande".
      APPLY "ENTRY" TO FILL-IN-ADR.
      RETURN NO-APPLY.
   END.      
   ELSE IF INTEGER(FILL-IN-AR:SCREEN-VALUE) = 0 THEN DO:
      MESSAGE "Årtal kan inte vara blank." VIEW-AS ALERT-BOX TITLE "Meddelande".
      APPLY "ENTRY" TO FILL-IN-AR.
      RETURN NO-APPLY.
   END.     
   ELSE DO:                  
      FIND fri_temp WHERE ROWID(fri_temp) = gam_rec NO-LOCK NO-ERROR.       
      IF AVAILABLE fri_temp THEN DO:
         RUN fritempupp_UI.         
         RUN lastselectdyn_UI IN brwproc[3]. 
      END.
   END.     
END PROCEDURE.
PROCEDURE vcmbtyp_UI :  
   IF AVAILABLE fri_temp AND fri_temp.TYP =  "hsp" THEN DO:
      ASSIGN
      FILL-IN-SAK:SCREEN-VALUE = ?
      FILL-IN-MAX:SCREEN-VALUE = ?
      FILL-IN-SAK:HIDDEN = TRUE
      FILL-IN-MAX:HIDDEN = TRUE.      
   END.
   ELSE IF CMB_TYP:SCREEN-VALUE = "Servis" THEN DO:
      ASSIGN
      FILL-IN-SAK:HIDDEN = FALSE
      FILL-IN-MAX:HIDDEN = FALSE.
      IF Guru.Konstanter:globforetag = "krin" THEN FILL-IN-ABONNENT:HIDDEN = FALSE.      
   END.
   ELSE IF CMB_TYP:SCREEN-VALUE = "Ut" THEN DO:
      ASSIGN
      FILL-IN-SAK:HIDDEN = FALSE
      FILL-IN-MAX:HIDDEN = FALSE.
      IF Guru.Konstanter:globforetag = "krin" THEN FILL-IN-ABONNENT:HIDDEN = TRUE.
            
   END.
   ELSE IF CMB_TYP:SCREEN-VALUE = "In" THEN DO:
      ASSIGN
      FILL-IN-SAK:SCREEN-VALUE = ?
      FILL-IN-MAX:SCREEN-VALUE = ?
      FILL-IN-SAK:HIDDEN = TRUE
      FILL-IN-MAX:HIDDEN = TRUE.      
      IF Guru.Konstanter:globforetag = "krin" THEN FILL-IN-ABONNENT:HIDDEN = TRUE.
   END.   
   ELSE DO:
      ASSIGN
      FILL-IN-SAK:SCREEN-VALUE = ?
      FILL-IN-MAX:SCREEN-VALUE = ?
      FILL-IN-SAK:HIDDEN = TRUE
      FILL-IN-MAX:HIDDEN = TRUE.      
   END.      
   RUN spara_UI.
END PROCEDURE.
PROCEDURE btnupp_UI :
   RUN selectfoc_UI (INPUT 3).
   ASSIGN
   frannr = fri_temp.KABNR
   lin_rowid = ROWID(fri_temp).         
   RUN pselectfoc_UI (INPUT 3).
   ASSIGN
   tillnr = fri_temp.KABNR
   fri_temp.KABNR = frannr.         
   FIND fri_temp WHERE ROWID(fri_temp) = lin_rowid.
   fri_temp.KABNR = tillnr.      
   RUN setcolsortvar_UI IN brwproc[3] (INPUT " WHERE NUM = " + STRING(kon_id.NUM) ).
   RUN openbdynspec_UI IN brwproc[3].
   FIND fri_temp WHERE ROWID(fri_temp) = lin_rowid NO-LOCK NO-ERROR.
   IF AVAILABLE fri_temp THEN DO:
      RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(fri_temp)).
      RUN lastselectdyn_UI IN brwproc[3].
   END.
END PROCEDURE.
PROCEDURE btnner_UI :
   RUN selectfoc_UI (INPUT 3).
   ASSIGN
   frannr = fri_temp.KABNR
   lin_rowid = ROWID(fri_temp). 
   RUN nselectfoc_UI (INPUT 3).
   ASSIGN 
   tillnr = fri_temp.KABNR
   fri_temp.KABNR = frannr.   
   FIND fri_temp WHERE ROWID(fri_temp) = lin_rowid.
   fri_temp.KABNR = tillnr.      
   RUN setcolsortvar_UI IN brwproc[3] (INPUT " WHERE NUM = " + STRING(kon_id.NUM) ).
   RUN openbdynspec_UI IN brwproc[3].
   FIND fri_temp WHERE ROWID(fri_temp) = lin_rowid NO-LOCK NO-ERROR.
   IF AVAILABLE fri_temp THEN DO:
      RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(fri_temp)).
      RUN lastselectdyn_UI IN brwproc[3].
   END.  
  
END PROCEDURE.
PROCEDURE btnexs_UI :
   RUN fbtnsnabb_UI IN btnbervalh.
   APPLY "VALUE-CHANGED" TO BRW_KAB.
   FIND FIRST kon_val WHERE ROWID(kon_val) = kon_rowid NO-LOCK NO-ERROR.
   FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM NO-LOCK NO-ERROR.
   lin_rowid = ROWID(kon_id).  
   IF TOG_SORT:HIDDEN = TRUE THEN TOG_SORT:CHECKED = FALSE.                
   IF   mall = 28 THEN DO:
      RUN WOKSKKORTU.P (INPUT mall,INPUT TABLE list_mtrl, INPUT TABLE kon_id,INPUT TABLE fri_temp,
                        INPUT TABLE kon_val,INPUT TABLE konstvaltemp ,INPUT TABLE berskaptemp).
   END.
   ELSE DO:   
      IF TOG_SORT:HIDDEN = TRUE THEN TOG_SORT:CHECKED = FALSE.
      RUN EXKSKKORTU.P (INPUT TOG_SORT:CHECKED,INPUT 3,INPUT TABLE list_mtrl, INPUT TABLE kon_id,INPUT TABLE fri_temp,
                        INPUT TABLE kon_val,INPUT TABLE konstvaltemp ,INPUT TABLE berskaptemp).
   END.
END PROCEDURE.
PROCEDURE btnexm_UI :
   RUN fbtnsnabb_UI IN btnbervalh.
    APPLY "VALUE-CHANGED" TO BRW_KAB.
   FIND FIRST kon_val WHERE ROWID(kon_val) = kon_rowid NO-LOCK NO-ERROR.
   FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM NO-LOCK NO-ERROR.
   lin_rowid = ROWID(kon_id). 
   IF TOG_SORT:HIDDEN = TRUE THEN TOG_SORT:CHECKED = FALSE.                 
   IF   mall = 28 THEN DO:
      RUN WOKSKKORTU.P (INPUT mall,INPUT TABLE list_mtrl, INPUT TABLE kon_id,INPUT TABLE fri_temp,
                        INPUT TABLE kon_val,INPUT TABLE konstvaltemp ,INPUT TABLE berskaptemp).
   END.
   ELSE DO:   
      RUN EXKSKKORTU.P (INPUT TOG_SORT:CHECKED,INPUT 2,INPUT TABLE list_mtrl, INPUT TABLE kon_id,INPUT TABLE fri_temp,
                        INPUT TABLE kon_val,INPUT TABLE konstvaltemp ,INPUT TABLE berskaptemp).
   END.
END PROCEDURE.
PROCEDURE btnexk_UI :   
   RUN fbtnsnabb_UI IN btnbervalh.
   IF CMB_KORTVAL:SCREEN-VALUE = "Kabelskåpskort Allmän" THEN mall = 5.      
   IF CMB_KORTVAL:SCREEN-VALUE = "Magnifix Vattenfall" THEN mall = 15.
   IF CMB_KORTVAL:SCREEN-VALUE = "Hsp Luftisolerade Lastfrånskiljare Vattenfall" THEN mall = 44.
   IF CMB_KORTVAL:SCREEN-VALUE = "Kopplingsstn Magnifix_ Kopplingsskåp Vattenfall" THEN mall = 46.
   IF CMB_KORTVAL:SCREEN-VALUE = "Kopplingsstn HSP Xiria_ NAL Vattenfall" THEN mall = 45.      
   IF CMB_KORTVAL:SCREEN-VALUE = "Xiria Vattenfall" THEN mall = 17.      
   IF CMB_KORTVAL:SCREEN-VALUE = "Stolpstationskort Vattenfall" THEN mall = 18.
   IF CMB_KORTVAL:SCREEN-VALUE = "ABB Nstn Vattenfall" THEN mall = 12.
   IF CMB_KORTVAL:SCREEN-VALUE = "SS2 utan frånskiljare Vattenfall" THEN mall = 13.  
   IF CMB_KORTVAL:SCREEN-VALUE = "SS2 med frånskiljare Vattenfall" THEN mall = 14.
   /*IF CMB_KORTVAL:SCREEN-VALUE = "Nätstationskort Fortum" THEN mall = 20.*/
   /*IF CMB_KORTVAL:SCREEN-VALUE = "Nätstationskort EON" THEN mall = 21. SAMMA SOM 28*/
   IF CMB_KORTVAL:SCREEN-VALUE = "Kabelskåpskort Fortum EON" THEN mall = 22.
   IF CMB_KORTVAL:SCREEN-VALUE = "Kabelskåpskort Vattenfall" THEN mall = 24.
   IF CMB_KORTVAL:SCREEN-VALUE = "Markstationskort Allmän" THEN mall = 27.
   IF CMB_KORTVAL:SCREEN-VALUE = "Nätstationskort EON" THEN mall = 28. 
   IF CMB_KORTVAL:SCREEN-VALUE = "Kabelskåpskort One" THEN mall = 30.
   IF CMB_KORTVAL:SCREEN-VALUE = "Kabelskåpskort Linjemontage" THEN mall = 30.
   IF CMB_KORTVAL:SCREEN-VALUE = "unerRing Vattenfall" THEN mall = 32.
   IF CMB_KORTVAL:SCREEN-VALUE = "Kabelskåpskort Kraftringen2" THEN mall = 35.
   IF CMB_KORTVAL:SCREEN-VALUE = "Kabelskåpskort Kraftringen" THEN mall = 36.
   IF CMB_KORTVAL:SCREEN-VALUE = "Markstationskort Kraftringen" THEN mall = 40.
   IF CMB_KORTVAL:SCREEN-VALUE = "Kabelskåpskort Ellevio " THEN mall = 41.
   IF CMB_KORTVAL:SCREEN-VALUE = "Markstationskort Ellevio " THEN mall = 42.
   IF CMB_KORTVAL:SCREEN-VALUE = "Kabelskåpskort C4Elnät" THEN mall = 50.   
   APPLY "VALUE-CHANGED" TO BRW_KAB. 
   IF TOG_SORT:HIDDEN = TRUE THEN TOG_SORT:CHECKED = FALSE.
   FIND FIRST kon_val WHERE ROWID(kon_val) = kon_rowid NO-LOCK NO-ERROR.
   FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM NO-LOCK NO-ERROR.
   lin_rowid = ROWID(kon_id).                  
   IF  mall = 28  THEN DO:
      RUN WOKSKKORTU.P (INPUT mall,INPUT TABLE list_mtrl, INPUT TABLE kon_id,INPUT TABLE fri_temp,
                        INPUT TABLE kon_val,INPUT TABLE konstvaltemp ,INPUT TABLE berskaptemp).
   END.
   ELSE DO:   
      RUN EXKSKKORTU.P (INPUT TOG_SORT:CHECKED,INPUT mall,INPUT TABLE list_mtrl, INPUT TABLE kon_id,INPUT TABLE fri_temp,
                        INPUT TABLE kon_val,INPUT TABLE konstvaltemp ,INPUT TABLE berskaptemp).
   END.
END PROCEDURE.

PROCEDURE btnmexc_UI :
   RUN fbtnsnabb_UI IN btnbervalh.   
   MESSAGE "Vill du ha skyltmall för den konstruktion du är inne på - svara -JA " SKIP
           "Vill du ha skyltmall för alla konstruktioner i beredningen - svara NEJ " VIEW-AS ALERT-BOX
   QUESTION BUTTONS YES-NO-CANCEL TITLE "Skyltmall" UPDATE svarm AS LOGICAL.         
   APPLY "VALUE-CHANGED" TO BRW_KAB. 
   FIND FIRST kon_val WHERE ROWID(kon_val) = kon_rowid NO-LOCK NO-ERROR.
   FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM NO-LOCK NO-ERROR.
   lin_rowid = ROWID(kon_id).
   IF Guru.Konstanter:globforetag = "elpa" or Guru.Konstanter:globforetag = "gran" OR Guru.Konstanter:globforetag = "NAEK"  OR Guru.Konstanter:globforetag = "FORS" THEN DO:
      IF svarm = TRUE THEN DO:
         RUN EXKSKMAES.P (INPUT 2,INPUT 3).
      END.   
      ELSE IF svarm = FALSE THEN DO:
         RUN EXKSKMAES.P (INPUT 1 ,INPUT 3).
      END.   
   END.
   ELSE IF Guru.Konstanter:globforetag = "SKOK" OR Guru.Konstanter:globforetag = "KEKR"  THEN DO:
      IF svarm = TRUE THEN DO:
         RUN EXKSKMAESAL.P (INPUT 2,INPUT 3).
      END.   
      ELSE IF svarm = FALSE THEN DO:
         RUN EXKSKMAESAL.P (INPUT 1 ,INPUT 3).
      END.   
   END.
   ELSE DO:                     
      IF svarm = TRUE THEN DO:  
         RUN ESSKYLTMK.P (INPUT 2,INPUT TABLE list_mtrl, INPUT TABLE kon_id,INPUT TABLE fri_temp,
                           INPUT TABLE kon_val,INPUT TABLE konstvaltemp ,INPUT TABLE berskaptemp).
      END.
      ELSE IF svarm = FALSE THEN DO:   
         RUN ESSKYLTMK.P (INPUT 1,INPUT TABLE list_mtrl, INPUT TABLE kon_id,INPUT TABLE fri_temp,
                           INPUT TABLE kon_val,INPUT TABLE konstvaltemp ,INPUT TABLE berskaptemp).
      END.
   END.      
END PROCEDURE.

PROCEDURE vbrwmtrl_UI :   
   RUN selectfoc_UI (INPUT 4).   
   IF RAD_VAL:SCREEN-VALUE = "1" THEN DO:
      FILL-IN-TYP:SCREEN-VALUE = mtrl_tab.BENAMNING.   
   END.
   IF RAD_VAL:SCREEN-VALUE = "3" THEN DO:
      FILL-IN-KABEL:SCREEN-VALUE = mtrl_tab.BENAMNING.      
   END.
   
END PROCEDURE.
PROCEDURE vcmbsart_UI :
   IF Guru.Konstanter:globforetag = "FORS" THEN DO:
      IF AVAILABLE listbuff THEN DO: 
         IF listbuff.ENR = "A200" THEN listbuff.ANTAL = INTEGER(FILL-IN-NSKYLTANT:SCREEN-VALUE).      
      END.
      IF AVAILABLE listibuff THEN DO: 
         IF listibuff.ENR = "A201" THEN listibuff.ANTAL = INTEGER(FILL-IN-NISKYLTANT:SCREEN-VALUE).      
      END.   
      IF AVAILABLE list_mtrl THEN DO: 
         IF list_mtrl.ENR = "A202" OR list_mtrl.ENR = "A203" THEN list_mtrl.ANTAL = INTEGER(FILL-IN-SKYLTANT:SCREEN-VALUE).      
      END.
   END.
   ELSE DO:   
      IF AVAILABLE listbuff THEN DO: 
         IF listbuff.ENR = "A101" THEN listbuff.ANTAL = INTEGER(FILL-IN-NSKYLTANT:SCREEN-VALUE).      
      END.
      IF AVAILABLE listibuff THEN DO: 
         IF listibuff.ENR = "A102" THEN listibuff.ANTAL = INTEGER(FILL-IN-NISKYLTANT:SCREEN-VALUE).      
      END.   
      IF AVAILABLE list_mtrl THEN DO: 
         IF list_mtrl.ENR = "A104" OR list_mtrl.ENR = "A105" OR list_mtrl.ENR = "A107" THEN list_mtrl.ANTAL = INTEGER(FILL-IN-SKYLTANT:SCREEN-VALUE).      
      END.
   END.      
   RUN skylthmt_UI.   
END PROCEDURE.

PROCEDURE skylthmt_UI :
   IF Guru.Konstanter:globforetag = "fors" THEN DO:
      FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
      list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = CMB_SKYLTART:SCREEN-VALUE AND 
      list_mtrl.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
   END.
   ELSE DO:      
      FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
      list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = CMB_SKYLTART:SCREEN-VALUE AND 
      list_mtrl.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
   END.   
   IF AVAILABLE list_mtrl THEN  DO: 
      ASSIGN
      FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(list_mtrl.ANTAL)
      FILL-IN-SKYLTBEN:SCREEN-VALUE = list_mtrl.BENAMNING.
   END.
   ELSE DO: 
      ASSIGN
      FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(0)
      FILL-IN-SKYLTBEN:SCREEN-VALUE = "".
   END.
   IF Guru.Konstanter:globforetag = "fors" THEN DO:
      IF CMB_SKYLTART:SCREEN-VALUE = "A202" AND FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(0) THEN DO:
         FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
         list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = "A204" AND 
         list_mtrl.LEVKOD = skyltlev AND list_mtrl.ANTAL > 0 NO-LOCK NO-ERROR.
         IF AVAILABLE list_mtrl THEN  DO: 
            ASSIGN
            CMB_SKYLTART:SCREEN-VALUE = "A204"
            FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(list_mtrl.ANTAL)
            FILL-IN-SKYLTBEN:SCREEN-VALUE = list_mtrl.BENAMNING.
         END.
      END.
   END.
   ELSE DO:   
      IF CMB_SKYLTART:SCREEN-VALUE = "A104" AND FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(0) THEN DO:
         FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
         list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = "A105" AND 
         list_mtrl.LEVKOD = skyltlev AND list_mtrl.ANTAL > 0 NO-LOCK NO-ERROR.
         IF AVAILABLE list_mtrl THEN  DO: 
            ASSIGN
            CMB_SKYLTART:SCREEN-VALUE = "A105"
            FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(list_mtrl.ANTAL)
            FILL-IN-SKYLTBEN:SCREEN-VALUE = list_mtrl.BENAMNING.
         END.
      END.         
   END.
END PROCEDURE.

PROCEDURE nskylthmt_UI :   
   IF Guru.Konstanter:globforetag = "fors" THEN DO:
      FIND FIRST listbuff WHERE listbuff.NUM = fri_temp.NUM AND listbuff.ENR = "A200" AND 
      listbuff.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
      IF AVAILABLE listbuff THEN ASSIGN FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(listbuff.ANTAL).         
      ELSE ASSIGN FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(0).
      FIND FIRST listibuff WHERE listibuff.NUM = fri_temp.NUM AND listibuff.ENR = "A201" AND 
      listibuff.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
      IF AVAILABLE listibuff THEN ASSIGN FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(listibuff.ANTAL).         
      ELSE ASSIGN FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(0).
   END.
   ELSE DO:   
      FIND FIRST listbuff WHERE listbuff.NUM = fri_temp.NUM AND listbuff.ENR = "A101" AND 
      listbuff.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
      IF AVAILABLE listbuff THEN ASSIGN FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(listbuff.ANTAL).         
      ELSE ASSIGN FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(0).
      FIND FIRST listibuff WHERE listibuff.NUM = fri_temp.NUM AND listibuff.ENR = "A102" AND 
      listibuff.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
      IF AVAILABLE listibuff THEN ASSIGN FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(listibuff.ANTAL).         
      ELSE ASSIGN FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(0).         
   END.   
END PROCEDURE.


PROCEDURE vbrwkab_UI :   
   
   RUN selectfoc_UI (INPUT 3).
   IF kabkortvar = TRUE THEN DO:   
      IF forsta = FALSE THEN DO:
         RUN spara_UI.          
      END. 
   END.
   forsta = FALSE.   
   FIND FIRST fri_temp WHERE fri_temp.NUM = kon_id.NUM USE-INDEX NUM
   NO-LOCK NO-ERROR.   
   IF AVAILABLE fri_temp THEN DO:            
      RUN selectfoc_UI (INPUT 3).
      ASSIGN
      gam_rec = ROWID(fri_temp)
      FILL-IN-KABEL:SCREEN-VALUE = fri_temp.BENAMNING 
      FILL-IN-METER:SCREEN-VALUE = STRING(fri_temp.METER)            
      FILL-IN-SADR:SCREEN-VALUE = fri_temp.SKAPADR
      FILL-IN-APPARAT:SCREEN-VALUE = fri_temp.APPARAT
      FILL-IN-ADR:SCREEN-VALUE = fri_temp.KABADR
      FILL-IN-AR:SCREEN-VALUE = STRING(fri_temp.ARTAL) 
      FILL-IN-ANMARK:SCREEN-VALUE = fri_temp.ANMARK.      
      IF fri_temp.SAKR NE ?  THEN FILL-IN-SAK:SCREEN-VALUE = STRING(fri_temp.SAKR).
      IF fri_temp.MAXSAKR NE ? THEN FILL-IN-MAX:SCREEN-VALUE = STRING(fri_temp.MAXSAKR).          
      IF Guru.Konstanter:varforetypval[44] = 1   THEN DO:   
         FIND FIRST markgrupp WHERE markgrupp.NUM = fri_temp.NUM AND markgrupp.KABNR = fri_temp.KABNR NO-ERROR.
         IF AVAILABLE markgrupp THEN DO:
            ASSIGN 
            FILL-IN-GRUPPNR:SCREEN-VALUE = markgrupp.GRUPP.
            fri_temp.GRUPPNR = markgrupp.GRUPP.              
            CMB_SKYLTART:SCREEN-VALUE = markgrupp.ARTNR.
            fri_temp.ARTNR = markgrupp.ARTNR.              
            FILL-IN-ABONNENT:SCREEN-VALUE = markgrupp.ABONNENT.
            fri_temp.ABONNENT = markgrupp.ABONNENT.              
         END.
         ELSE DO:
            CREATE markgrupp.
            ASSIGN            
            markgrupp.NUM = fri_temp.NUM
            markgrupp.KABNR = fri_temp.KABNR
            FILL-IN-GRUPPNR:SCREEN-VALUE = ""
            FILL-IN-ABONNENT:SCREEN-VALUE = "".                                 
         END.         
      END.                 
      IF kon_val.GRUPP = 0 THEN FILL-IN-TYP:SCREEN-VALUE = fri_temp.SKAP.
      IF fri_temp.TYP = "Ut" THEN CMB_TYP:SCREEN-VALUE = "Ut". 
      ELSE IF fri_temp.TYP = "In" THEN CMB_TYP:SCREEN-VALUE = "In".
      ELSE IF fri_temp.TYP = "hsp" THEN CMB_TYP:SCREEN-VALUE = "hsp".
      ELSE CMB_TYP:SCREEN-VALUE = "Servis".
      IF Guru.Konstanter:varforetypval[34] = 1 THEN DO:
         FILL-IN-GRUPPNR:HIDDEN = FALSE. 
         frigrupph:VISIBLE = TRUE.
      END.   
      ELSE DO:
         FILL-IN-GRUPPNR:HIDDEN = TRUE.
         frigrupph:VISIBLE = FALSE.
      END.   
      IF Guru.Konstanter:varforetypval[34] = 1 AND kon_val.GRUPP = 0 THEN DO:                 
         FILL-IN-GRUPPNR:LABEL = "Grupp-nr".  
         frigrupph:LABEL = "Grupp!-nr".
         TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.         
         TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.    
         IF Guru.Konstanter:globforetag = "fors" THEN CMB_SKYLTART:SCREEN-VALUE = "A203".            
         ELSE CMB_SKYLTART:SCREEN-VALUE = "A107".
         RUN skylthmt_UI.         
      END.
      /*onevatt*/      
      IF Guru.Konstanter:varforetypchar[5] = "12,30,33,37,38,45"  THEN DO:               
         IF kon_val.GRUPP = 12 OR kon_val.GRUPP = 30 OR kon_val.GRUPP = 33 OR kon_val.GRUPP = 38 THEN DO:                                  
           TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
           TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.
         END.       
      END.      
      IF Guru.Konstanter:varforetypchar[5] = "33,34,36,37" THEN DO:              
         IF kon_val.GRUPP = 33 OR kon_val.GRUPP = 34 OR kon_val.GRUPP = 36 OR kon_val.GRUPP = 37 THEN DO:                                
           TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
           TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.
         END.       
      END.
      IF Guru.Konstanter:varforetypchar[5] = "33" THEN DO:              
         IF kon_val.GRUPP = 33 THEN DO:                       
           TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
           TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.
         END.       
      END.
      CMB_TYP:HIDDEN = FALSE.
      IF Guru.Konstanter:varforetypchar[5] = "35" OR Guru.Konstanter:varforetypchar[5] = "35,57" THEN DO:                       
         IF kon_val.GRUPP = 35  THEN DO:            
            TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.
            /*Både markstationer och kabelskåp skall ha gruppnr*/
            FIND FIRST konbuff WHERE konbuff.NUM = fri_temp.NUM AND konbuff.SKAPNUM = fri_temp.KABNR NO-LOCK NO-ERROR.
            IF AVAILABLE konbuff  THEN DO:
               FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 14 AND
               konsttemp.KTYPKOD =  LEFT-TRIM(konbuff.F5) NO-LOCK NO-ERROR.
               IF NOT AVAILABLE konsttemp THEN DO:                    
                  CMB_TYP:SCREEN-VALUE = "hsp".
                  CMB_TYP:HIDDEN = TRUE.
                  ASSIGN
                  fri_temp.TYP = "hsp"
                  FILL-IN-GRUPPNR:LABEL = "Fack-nr"            
                  FILL-IN-SAK:SCREEN-VALUE = ?
                  FILL-IN-MAX:SCREEN-VALUE = ?
                  FILL-IN-SAK:HIDDEN = TRUE
                  FILL-IN-MAX:HIDDEN = TRUE.
                  frigrupph:LABEL = "Fack!-nr".
                  TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
                  CMB_SKYLTART:SCREEN-VALUE = "A104".                  
                  RUN skylthmt_UI.                  
               END.
               ELSE DO: 
                  CMB_TYP:HIDDEN = FALSE.
                  FILL-IN-GRUPPNR:LABEL = "Grupp-nr".   
                  frigrupph:LABEL = "Grupp!-nr".
                  TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.               
                  CMB_SKYLTART:SCREEN-VALUE = "A107".
                  RUN skylthmt_UI.                  
               END.
            END.
         END.
         IF kon_val.GRUPP = 57  THEN DO:
            /*ONEVATT*/       
                 
            TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.
            
            IF fri_temp.LSP = 2 THEN DO:
               CMB_TYP:SCREEN-VALUE = "hsp".
               CMB_TYP:HIDDEN = TRUE.
               ASSIGN
               fri_temp.TYP = "hsp"
               FILL-IN-GRUPPNR:LABEL = "Fack-nr"            
               FILL-IN-SAK:SCREEN-VALUE = ?
               FILL-IN-MAX:SCREEN-VALUE = ?
               FILL-IN-SAK:HIDDEN = TRUE
               FILL-IN-MAX:HIDDEN = TRUE.
               frigrupph:LABEL = "Fack!-nr".
               TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
            END.
            ELSE DO: 
               CMB_TYP:HIDDEN = FALSE.
               FILL-IN-GRUPPNR:LABEL = "Grupp-nr". 
               frigrupph:LABEL = "Grupp!-nr".    
               TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.            
            END.                  
            
            
            /*/*Både markstationer och kabelskåp skall ha gruppnr*/
            FIND FIRST konbuff WHERE konbuff.NUM = fri_temp.NUM AND konbuff.SKAPNUM = fri_temp.KABNR NO-LOCK NO-ERROR.
            IF AVAILABLE konbuff  THEN DO:
               FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 14 AND
               konsttemp.KTYPKOD =  LEFT-TRIM(konbuff.F5) NO-LOCK NO-ERROR.
               IF NOT AVAILABLE konsttemp THEN DO:                    
                  CMB_TYP:SCREEN-VALUE = "hsp".
                  CMB_TYP:HIDDEN = TRUE.
                  ASSIGN
                  fri_temp.TYP = "hsp"
                  FILL-IN-GRUPPNR:LABEL = "Fack-nr"            
                  FILL-IN-SAK:SCREEN-VALUE = ?
                  FILL-IN-MAX:SCREEN-VALUE = ?
                  FILL-IN-SAK:HIDDEN = TRUE
                  FILL-IN-MAX:HIDDEN = TRUE.
                  frigrupph:LABEL = "Fack!-nr".
                  TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
                  CMB_SKYLTART:SCREEN-VALUE = "A104".                  
                  RUN skylthmt_UI.                  
               END.
               ELSE DO: 
                  CMB_TYP:HIDDEN = FALSE.
                  FILL-IN-GRUPPNR:LABEL = "Grupp-nr".   
                  frigrupph:LABEL = "Grupp!-nr".
                  TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.               
                  CMB_SKYLTART:SCREEN-VALUE = "A107".
                  RUN skylthmt_UI.                  
               END.
            END.*/
         END.         
      END.     
      IF Guru.Konstanter:varforetypchar[5] = "12,33,38" THEN DO:               
         IF kon_val.GRUPP = 38  THEN DO:            
            TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.
            /*Både markstationer och kabelskåp skall ha gruppnr*/
            FIND FIRST konbuff WHERE konbuff.NUM = fri_temp.NUM AND konbuff.SKAPNUM = fri_temp.KABNR NO-LOCK NO-ERROR.
            IF AVAILABLE konbuff  THEN DO:
               FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 14 AND
               konsttemp.KTYPKOD =  LEFT-TRIM(konbuff.F5) NO-LOCK NO-ERROR.
               IF NOT AVAILABLE konsttemp THEN DO:                    
                  CMB_TYP:SCREEN-VALUE = "hsp".
                  CMB_TYP:HIDDEN = TRUE.
                  ASSIGN
                  fri_temp.TYP = "hsp"
                  FILL-IN-GRUPPNR:LABEL = "Fack-nr"            
                  FILL-IN-SAK:SCREEN-VALUE = ?
                  FILL-IN-MAX:SCREEN-VALUE = ?
                  FILL-IN-SAK:HIDDEN = TRUE
                  FILL-IN-MAX:HIDDEN = TRUE.
                  frigrupph:LABEL = "Fack!-nr".
                  TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
                  CMB_SKYLTART:SCREEN-VALUE = "A104".
                  RUN skylthmt_UI.
               END.
               ELSE DO: 
                  CMB_TYP:HIDDEN = FALSE.
                  FILL-IN-GRUPPNR:LABEL = "Grupp-nr".   
                  frigrupph:LABEL = "Grupp!-nr".
                  TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.               
                  CMB_SKYLTART:SCREEN-VALUE = "A107".
                  RUN skylthmt_UI.                  
               END.
            END.
         END.         
      END.
      IF Guru.Konstanter:varforetypchar[5] = "33" OR Guru.Konstanter:varforetypchar[5] = "33,37" THEN DO:
        
        IF kon_val.GRUPP = 33 OR kon_val.GRUPP = 37  THEN DO:
            
            FIND FIRST konbuff WHERE konbuff.NUM = fri_temp.NUM AND konbuff.SKAPNUM = fri_temp.KABNR NO-LOCK NO-ERROR.
            IF AVAILABLE konbuff  THEN DO:                  
               /*tolka som lsp om den inte finns i någon av 14,25,27,36 Lena 20180124*/
               CMB_TYP:HIDDEN = FALSE.
               FILL-IN-GRUPPNR:LABEL = "Grupp-nr". 
               frigrupph:LABEL = "Grupp!-nr".    
               TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
               IF Guru.Konstanter:globforetag = "fors" THEN DO:
                  CMB_SKYLTART:SCREEN-VALUE = "A203".
                  RUN skylthmt_UI.
               END.
               FIND FIRST konsttemp WHERE konsttemp.KTYPKOD =  LEFT-TRIM(konbuff.F5) NO-LOCK NO-ERROR.
               IF AVAILABLE konsttemp THEN DO:
                  hspkoll = FALSE.
                  IF konsttemp.KONSKOD = 25 OR konsttemp.KONSKOD =  27 THEN hspkoll = TRUE.
                  ELSE IF Guru.Konstanter:globforetag = "fors" THEN DO:
                     IF konsttemp.KONSKOD = 36 THEN hspkoll = TRUE.
                     ELSE IF konsttemp.KONSKOD = 35 THEN hspkoll = TRUE.
                     ELSE IF konsttemp.KONSKOD = 41 THEN hspkoll = TRUE.
                  END.
                  ELSE IF Guru.Konstanter:globforetag = "KRIN" THEN DO:
                     IF LEFT-TRIM(konbuff.F5) BEGINS "MAG" THEN hspkoll = TRUE.
                     ELSE IF LEFT-TRIM(konbuff.F5) BEGINS "KAP" THEN hspkoll = TRUE.
                     ELSE IF LEFT-TRIM(konbuff.F5) BEGINS "SM" THEN hspkoll = TRUE.                     
                  END.
                  ELSE IF LEFT-TRIM(konbuff.F5) BEGINS "12" OR LEFT-TRIM(konbuff.F5) BEGINS "24" THEN hspkoll = TRUE.  
                  IF hspkoll = TRUE THEN DO:                                                     
                     CMB_TYP:SCREEN-VALUE = "hsp".
                     CMB_TYP:HIDDEN = TRUE.
                     ASSIGN
                     fri_temp.TYP = "hsp"
                     FILL-IN-GRUPPNR:LABEL = "Fack-nr"            
                     FILL-IN-SAK:SCREEN-VALUE = ?
                     FILL-IN-MAX:SCREEN-VALUE = ?
                     FILL-IN-SAK:HIDDEN = TRUE
                     FILL-IN-MAX:HIDDEN = TRUE.
                     frigrupph:LABEL = "Fack!-nr".
                     TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
                     IF Guru.Konstanter:globforetag = "fors" THEN DO:
                        CMB_SKYLTART:SCREEN-VALUE = "A202".                  
                        RUN skylthmt_UI.
                     END.   
                  END.
               END.   
               
            END.
         END.
      END.
      /*onevatt*/
      IF Guru.Konstanter:varforetypchar[5] = "12,30,33,37,38,45"   THEN DO:                        
         /*HSP VAST*/
         IF kon_val.GRUPP = 12 OR kon_val.GRUPP = 30 OR kon_val.GRUPP = 33 OR kon_val.GRUPP = 38 OR kon_val.GRUPP = 45 OR kon_val.GRUPP = 57 THEN DO:        
            IF fri_temp.LSP = 2 THEN DO:
               CMB_TYP:SCREEN-VALUE = "hsp".
               CMB_TYP:HIDDEN = TRUE.
               ASSIGN
               fri_temp.TYP = "hsp"
               FILL-IN-GRUPPNR:LABEL = "Fack-nr"            
               FILL-IN-SAK:SCREEN-VALUE = ?
               FILL-IN-MAX:SCREEN-VALUE = ?
               FILL-IN-SAK:HIDDEN = TRUE
               FILL-IN-MAX:HIDDEN = TRUE.
               frigrupph:LABEL = "Fack!-nr".
               TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
            END.
            ELSE DO: 
               CMB_TYP:HIDDEN = FALSE.
               FILL-IN-GRUPPNR:LABEL = "Grupp-nr". 
               frigrupph:LABEL = "Grupp!-nr".    
               TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.            
            END.                       
         END.
      END.
      IF  Guru.Konstanter:varforetypchar[5] = "33,34,36,37" THEN DO:                       
         /*HSP VAST*/
         IF kon_val.GRUPP = 33 OR kon_val.GRUPP = 34 OR kon_val.GRUPP = 36 OR kon_val.GRUPP = 37 THEN DO:        
            IF fri_temp.LSP = 2 THEN DO:
               CMB_TYP:SCREEN-VALUE = "hsp".
               CMB_TYP:HIDDEN = TRUE.
               ASSIGN
               fri_temp.TYP = "hsp"
               FILL-IN-GRUPPNR:LABEL = "Fack-nr"            
               FILL-IN-SAK:SCREEN-VALUE = ?
               FILL-IN-MAX:SCREEN-VALUE = ?
               FILL-IN-SAK:HIDDEN = TRUE
               FILL-IN-MAX:HIDDEN = TRUE.
               frigrupph:LABEL = "Fack!-nr".
               TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
            END.
            ELSE DO: 
               CMB_TYP:HIDDEN = FALSE.
               FILL-IN-GRUPPNR:LABEL = "Grupp-nr". 
               frigrupph:LABEL = "Grupp!-nr".    
               TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.            
            END.                       
         END.
      END.    
      IF  Guru.Konstanter:varforetypchar[5] = "32" THEN DO:                 
         IF kon_val.GRUPP = 32  THEN DO:            
            TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.
            /*Både markstationer och kabelskåp skall ha gruppnr*/
            FIND FIRST konbuff WHERE konbuff.NUM = fri_temp.NUM AND konbuff.SKAPNUM = fri_temp.KABNR NO-LOCK NO-ERROR.
            IF AVAILABLE konbuff  THEN DO:
               FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 14 AND
               konsttemp.KTYPKOD =  LEFT-TRIM(konbuff.F5) NO-LOCK NO-ERROR.
               IF NOT AVAILABLE konsttemp THEN DO:                    
                  CMB_TYP:SCREEN-VALUE = "hsp".
                  CMB_TYP:HIDDEN = TRUE.
                  ASSIGN
                  fri_temp.TYP = "hsp"
                  FILL-IN-GRUPPNR:LABEL = "Fack-nr"            
                  FILL-IN-SAK:SCREEN-VALUE = ?
                  FILL-IN-MAX:SCREEN-VALUE = ?
                  FILL-IN-SAK:HIDDEN = TRUE
                  FILL-IN-MAX:HIDDEN = TRUE.
                  frigrupph:LABEL = "Fack!-nr".
                  TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.
               END.
               ELSE DO: 
                  CMB_TYP:HIDDEN = FALSE.
                  FILL-IN-GRUPPNR:LABEL = "Grupp-nr".   
                  frigrupph:LABEL = "Grupp!-nr".
                  TOG_SORT:LABEL = "För excel kort sortera efter " + FILL-IN-GRUPPNR:LABEL.               
               END.
            END.
         END.         
      END.
      APPLY "VALUE-CHANGED" TO CMB_TYP.
   END.   
   ELSE DO:
      ASSIGN
      FILL-IN-KABEL:SCREEN-VALUE = ""
      FILL-IN-METER:SCREEN-VALUE = "0"      
      FILL-IN-GRUPPNR:SCREEN-VALUE = ""
      FILL-IN-TYP:SCREEN-VALUE = ""
      FILL-IN-SADR:SCREEN-VALUE = ""
      FILL-IN-APPARAT:SCREEN-VALUE = ""
      FILL-IN-ADR:SCREEN-VALUE = ""
      FILL-IN-AR:SCREEN-VALUE = STRING(YEAR(TODAY)) 
      FILL-IN-SAK:SCREEN-VALUE = "35"
      FILL-IN-MAX:SCREEN-VALUE = ?
      FILL-IN-ANMARK:SCREEN-VALUE = ""
      FILL-IN-ABONNENT:SCREEN-VALUE = ""
      CMB_TYP:SCREEN-VALUE = "Servis".      
      APPLY "VALUE-CHANGED" TO CMB_TYP.
   END.         
END PROCEDURE.
PROCEDURE vbrwapp_UI :
   RUN selectfoc_UI (INPUT 1).
   IF RAD_VAL:SCREEN-VALUE = "2" THEN DO:
      FILL-IN-APPARAT:SCREEN-VALUE = apparattemp.BENAMNING.     
   END.  
END PROCEDURE.

PROCEDURE main_UI :
   {muswait.i}
   {ALLSTARTDYN.I}
   ASSIGN
   x-multi = 1
   y-multi = 1 
   BTN_EXSTOLP:HIDDEN = TRUE
   BTN_EXKSKO:HIDDEN = TRUE
   BTN_EXMARK:HIDDEN = TRUE
   BTN_MEXC:HIDDEN = TRUE
   FILL-IN-GRUPPNR:HIDDEN = TRUE.   
   CMB_SKYLTART:HIDDEN = TRUE.
   FILL-IN-SKYLTANT:HIDDEN = TRUE.
   FILL-IN-SKYLTBEN:HIDDEN = TRUE.
   FILL-IN-NSKYLTANT:HIDDEN = TRUE.
   FILL-IN-NISKYLTANT:HIDDEN = TRUE.
   FILL-IN-ABONNENT:HIDDEN = TRUE.      
   TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.
   {OMSTARTAVGURUO.I}
   {OMSTARTAVGURUBER.I}
   RUN laddaapparat_UI IN frikortapph (OUTPUT TABLE apparattemp).
   RUN laddaskylt_UI IN frikortapph (OUTPUT TABLE emtrltemp).
   /*hämta skylt levkod*/
   RUN skyltlt_UI IN frikortapph (OUTPUT skyltlev).
   ASSIGN      
   RAD_VAL:SCREEN-VALUE = "1"
   FILL-IN-AR:SCREEN-VALUE = STRING(YEAR(TODAY))
   FILL-IN-METER:SCREEN-VALUE = "0"
   FILL-IN-GRUPPNR:SCREEN-VALUE = ""
   FILL-IN-ABONNENT:SCREEN-VALUE = ""
   forsta = TRUE
   sida = ?.   
   ASSIGN CMB_TYP:SCREEN-VALUE = "Servis". 
   IF Guru.Konstanter:globforetag = "gran" OR Guru.Konstanter:globforetag = "NAEK" OR Guru.Konstanter:globforetag = "celpa"  OR Guru.Konstanter:globforetag = "CPOMA" THEN DO:
      FILL-IN-ADR:LABEL = "Skylttext".                       
   END.    
   RUN konlabel_UI IN huvprogh 
        (INPUT "FRI",
         INPUT "Kabeltyp",
         INPUT FILL-IN-ADR:LABEL,
         INPUT "Meter",
         INPUT "",
         INPUT "",
         INPUT "",
         INPUT "",
         INPUT "",
         INPUT "",
         INPUT "").
   FIND kon_val WHERE ROWID(kon_val) = kon_rowid.
   FIND FIRST bbenamntemp WHERE bbenamntemp.KONSKOD = kon_val.GRUPP
   NO-LOCK NO-ERROR.
   FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM USE-INDEX NUM
   NO-LOCK NO-ERROR.      
   IF AVAILABLE bbenamntemp THEN DO:
      ASSIGN       
      FILL-IN-B2:SCREEN-VALUE = bbenamntemp.ID2
      FILL-IN-B3:SCREEN-VALUE = "Fri ID".
   END.
   IF AVAILABLE kon_id THEN DO:
      IF kon_id.ENDKOMB = FALSE THEN DO:
         {MARKKABVAL.I}
         IF enval = TRUE AND  kon_val.GRUPP NE 0 THEN DO:            
            IF kon_id.NATNR NE ? THEN FILL-IN-F2:SCREEN-VALUE = STRING(kon_id.NATNR).         
            FIND FIRST annamntemp NO-LOCK NO-ERROR.
            FILL-IN-B2:SCREEN-VALUE =  annamntemp.TAB3.
         END.
         ELSE IF kon_id.FRI2 NE ? THEN FILL-IN-F2:SCREEN-VALUE = STRING(kon_id.FRI2).                  
      END.
      ELSE DO:
         FILL-IN-F2:SCREEN-VALUE = "Ej identifierat".
      END.   
      IF kon_id.FRI3 NE ? THEN DO:
         FILL-IN-F3:SCREEN-VALUE = STRING(kon_id.FRI3).
      END.
      ELSE DO:
         FILL-IN-F3:SCREEN-VALUE = "Ej identifierat".
      END.
   END.     
   CMB_KORTVAL:LIST-ITEMS = "". 
      
   EMPTY TEMP-TABLE korttmp NO-ERROR.  
   RUN korthmt_UI IN frikortapph (INPUT 1,INPUT Guru.Konstanter:globforetag,INPUT kon_val.GRUPP, OUTPUT visadkm, OUTPUT TABLE korttmp ).   
   FOR EACH korttmp:
      CMB_KORTVAL:ADD-LAST(korttmp.KORT).
   END.  
   CMB_KORTVAL:SCREEN-VALUE = visadkm.                  
   BTN_EXKSKO:LABEL = "Kort till Excel".  
   BTN_MEXC:LABEL = "Skyltmall Excel".  
   /*Alla ska ha något kabelskåpskort*/
   FIND FIRST berskaptemp NO-LOCK NO-ERROR.
   IF AVAILABLE berskaptemp THEN DO:
      BTN_EXKSKO:HIDDEN = FALSE.            
      BTN_MEXC:HIDDEN = FALSE.            
   END. 
   ELSE DO:
      BTN_EXKSKO:HIDDEN = TRUE.   
      BTN_MEXC:HIDDEN = TRUE.   
   END.
   IF Guru.Konstanter:globforetag = "gran" OR Guru.Konstanter:globforetag = "NAEK" OR Guru.Konstanter:globforetag = "elpa"  OR Guru.Konstanter:globforetag = "FORS"  OR Guru.Konstanter:globforetag = "SKOK" OR Guru.Konstanter:globforetag = "KEKR" THEN.
   ELSE BTN_MEXC:HIDDEN = TRUE.   
   IF Guru.Konstanter:globforetag = "gran" OR Guru.Konstanter:globforetag = "NAEK" OR Guru.Konstanter:globforetag = "Celpa"  THEN DO:                  
      CMB_SKYLTART:HIDDEN = FALSE.
      FILL-IN-SKYLTANT:HIDDEN = FALSE.
      FILL-IN-SKYLTBEN:HIDDEN = FALSE.      
      IF kon_val.GRUPP = 35  THEN DO:
         FILL-IN-NSKYLTANT:HIDDEN = FALSE.
         FILL-IN-NISKYLTANT:HIDDEN = FALSE.
      END.   
   END.
   IF Guru.Konstanter:globforetag = "fors" THEN DO:                        
      CMB_SKYLTART:HIDDEN = FALSE.
      FILL-IN-SKYLTANT:HIDDEN = FALSE.
      FILL-IN-SKYLTBEN:HIDDEN = FALSE.      
      IF kon_val.GRUPP = 33 OR kon_val.GRUPP = 37  THEN DO:
         FILL-IN-NSKYLTANT:HIDDEN = FALSE.
         FILL-IN-NISKYLTANT:HIDDEN = FALSE.
      END.   
   END.
   IF kabkortvar = TRUE THEN DO:
      FBTN_NASTAKABEL:HIDDEN = FALSE.
      FILL-IN-ADR:TOOLTIP = "Tryck enter för nästa kabel.".    
      ASSIGN
      FILL-IN-GRUPPNR:TOOLTIP = FILL-IN-ADR:TOOLTIP
      FILL-IN-KABEL:TOOLTIP = FILL-IN-ADR:TOOLTIP  
      FILL-IN-METER:TOOLTIP = FILL-IN-ADR:TOOLTIP  
      FILL-IN-SAK:TOOLTIP = FILL-IN-ADR:TOOLTIP    
      FILL-IN-MAX:TOOLTIP = FILL-IN-ADR:TOOLTIP    
      FILL-IN-TYP:TOOLTIP = FILL-IN-ADR:TOOLTIP    
      FILL-IN-SADR:TOOLTIP = FILL-IN-ADR:TOOLTIP   
      FILL-IN-APPARAT:TOOLTIP = FILL-IN-ADR:TOOLTIP
      FILL-IN-AR:TOOLTIP = FILL-IN-ADR:TOOLTIP     
      FILL-IN-ANMARK:TOOLTIP = FILL-IN-ADR:TOOLTIP. 
      IF enval = TRUE AND  kon_val.GRUPP NE 0 THEN DO:  
         FILL-IN-KORT:SCREEN-VALUE = "Markstation".
      END.
      ELSE DO: 
         FILL-IN-KORT:SCREEN-VALUE = "Kabelskåpskort".
      END.      
      ASSIGN
      CMB_KORTVAL:HIDDEN  = FALSE
      x-multi =  WINDOW-3:WIDTH-PIXELS /  WINDOW-3:MIN-WIDTH-PIXELS. 
      y-multi =  WINDOW-3:HEIGHT-PIXELS /  WINDOW-3:MIN-HEIGHT-PIXELS.  
      ASSIGN       
      BRW_KAB:ROW = 4 * y-multi
      BRW_KAB:HEIGHT-CHARS = 13 * y-multi
      BRW_KAB:COLUMN = 1.5 * x-multi         
      BRW_KAB:WIDTH-CHARS = 109 * x-multi.       
   END.
   ELSE FILL-IN-KORT:SCREEN-VALUE = "Frikort".
   ASSIGN
   BRW_APP:HIDDEN  = TRUE.         
   IF kabkortvar = FALSE THEN DO:      
      FILL-IN-ADR:TOOLTIP = "".    
      ASSIGN
      FILL-IN-GRUPPNR:TOOLTIP = FILL-IN-ADR:TOOLTIP
      FILL-IN-KABEL:TOOLTIP = FILL-IN-ADR:TOOLTIP  
      FILL-IN-METER:TOOLTIP = FILL-IN-ADR:TOOLTIP  
      FILL-IN-SAK:TOOLTIP = FILL-IN-ADR:TOOLTIP    
      FILL-IN-MAX:TOOLTIP = FILL-IN-ADR:TOOLTIP    
      FILL-IN-TYP:TOOLTIP = FILL-IN-ADR:TOOLTIP    
      FILL-IN-SADR:TOOLTIP = FILL-IN-ADR:TOOLTIP   
      FILL-IN-APPARAT:TOOLTIP = FILL-IN-ADR:TOOLTIP
      FILL-IN-AR:TOOLTIP = FILL-IN-ADR:TOOLTIP     
      FILL-IN-ANMARK:TOOLTIP = FILL-IN-ADR:TOOLTIP. 
      ASSIGN      
      FBTN_NASTAKABEL:HIDDEN = TRUE
      FBTN_BORT:HIDDEN  = FALSE
      FBTN_SKAPA:HIDDEN  = FALSE
      FBTN_AND:HIDDEN  = FALSE
      BTN_UPP:HIDDEN  = FALSE
      BTN_NER:HIDDEN  = FALSE
      BRW_MTRL:HIDDEN  = FALSE      
      RAD_VAL:HIDDEN  = FALSE
      BTN_EXKSKO:HIDDEN = TRUE      
      BTN_MEXC:HIDDEN = TRUE      
      CMB_KORTVAL:HIDDEN  = TRUE     
      BRW_APP:HIDDEN  = TRUE      
      CMB_SKYLTART:HIDDEN = TRUE
      FILL-IN-SKYLTANT:HIDDEN = TRUE
      FILL-IN-NSKYLTANT:HIDDEN = TRUE
      FILL-IN-NISKYLTANT:HIDDEN = TRUE
      FILL-IN-SKYLTBEN:HIDDEN = TRUE
      BRW_KAB:COLUMN = mbrworgcol   
      BRW_KAB:WIDTH-CHARS = mbrworgwidth 
      BRW_KAB:HEIGHT-CHARS = mbrworghight  
      BRW_KAB:ROW        = mbrworgrow.  
      EMPTY TEMP-TABLE berskaptemp NO-ERROR.    
      RUN berskaphmt_UI IN frikortapph (OUTPUT TABLE berskaptemp).
      FIND FIRST kon_val WHERE ROWID(kon_val) = kon_rowid NO-LOCK NO-ERROR.
      FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM USE-INDEX NUM 
      NO-LOCK NO-ERROR.
      FIND FIRST bbenamntemp WHERE bbenamntemp.KONSKOD = kon_val.GRUPP USE-INDEX KOD
      NO-LOCK NO-ERROR.                  
      RUN setcolsortvar_UI IN brwproc[3] (INPUT " WHERE NUM = " + STRING(kon_id.NUM) ).
      RUN openbdynspec_UI IN brwproc[3].
      EMPTY TEMP-TABLE mtrl_tab NO-ERROR.    
      IF RAD_VAL:SCREEN-VALUE = "1" THEN DO:
         RUN mtrl_UI.
         RUN setcolsortvar_UI IN brwproc[4] (INPUT "").
         RUN openbdynspec_UI IN brwproc[4].      
      END.              
      ELSE DO:
         RUN setcolsortvar_UI IN brwproc[1] (INPUT "").
         RUN openbdynspec_UI IN brwproc[1].           
      END.
      APPLY "VALUE-CHANGED" TO BRW_KAB .  
   END.
   ELSE DO:
      RUN main2_UI.      
   END.
   IF Guru.Konstanter:varforetypval[34] = 1 THEN DO:
      FILL-IN-GRUPPNR:HIDDEN = FALSE. 
      frigrupph:VISIBLE = TRUE.
   END.   
   ELSE DO:
      FILL-IN-GRUPPNR:HIDDEN = TRUE.
      frigrupph:VISIBLE = FALSE.
   END.         
   TOG_SORT:HIDDEN = FILL-IN-GRUPPNR:HIDDEN.   
   FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(0).
   FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(0).
   IF Guru.Konstanter:globforetag = "gran" OR Guru.Konstanter:globforetag = "NAEK"  OR Guru.Konstanter:globforetag = "CPOMA" THEN DO:   
      IF kon_val.GRUPP = 35 THEN RUN nskylthmt_UI.
      ELSE DO:
         FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(0).
         FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(0).
      END.            
   END.
   IF Guru.Konstanter:globforetag = "FORS"  THEN DO:   
      IF kon_val.GRUPP = 33 OR kon_val.GRUPP = 37 THEN RUN nskylthmt_UI.
      ELSE DO:
         FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(0).
         FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(0).
      END.            
   END.
   Guru.GlobalaVariabler:collefth = ?.
   x-multi =  WINDOW-3:WIDTH-PIXELS /  WINDOW-3:MIN-WIDTH-PIXELS. 
   y-multi =  WINDOW-3:HEIGHT-PIXELS /  WINDOW-3:MIN-HEIGHT-PIXELS.  
   IF FBTN_VISA:HIDDEN = FALSE THEN DO:
      Guru.GlobalaVariabler:colrighth = FBTN_VISA:HANDLE.
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
   END.
   IF FBTN_SKRIV:HIDDEN = FALSE THEN DO:
      Guru.GlobalaVariabler:colrighth = FBTN_SKRIV:HANDLE.
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
   END.
   IF FBTN_PDF:HIDDEN = FALSE THEN DO:
      Guru.GlobalaVariabler:colrighth = FBTN_PDF:HANDLE.
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
   END.
   IF BTN_EXKSKO:HIDDEN = FALSE THEN DO:
         
      BTN_EXKSKO:ROW = CMB_KORTVAL:ROW + 1.
   END.
   IF BTN_EXSTOLP:HIDDEN = FALSE THEN DO:
      Guru.GlobalaVariabler:colrighth = BTN_EXSTOLP:HANDLE.
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
   END.
   IF BTN_EXMARK:HIDDEN = FALSE THEN DO:
      Guru.GlobalaVariabler:colrighth = BTN_EXMARK:HANDLE.
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
   END.
   IF BTN_MEXC:HIDDEN = FALSE THEN DO:
      Guru.GlobalaVariabler:colrighth = BTN_MEXC:HANDLE.
      RUN buttrow_UI IN framesizeh (INPUT Guru.GlobalaVariabler:collefth,INPUT Guru.GlobalaVariabler:colrighth,OUTPUT OPcollefth).       
   END.
   FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM USE-INDEX NUM
   NO-LOCK NO-ERROR.  
   RUN PlaceraKnapp_UI.
   {musarrow.i}    
END PROCEDURE.
 
PROCEDURE PlaceraKnapp_UI :
   Guru.Konstanter:LabelFlytt(FILL-IN-NSKYLTANT).
   Guru.Konstanter:LabelFlytt(FILL-IN-NISKYLTANT). 
   Guru.Konstanter:LabelFlytt(CMB_KORTVAL). 
   Guru.Konstanter:LabelFlytt(FILL-IN-TYP). 
   Guru.Konstanter:LabelFlytt(FILL-IN-SADR). 
   Guru.Konstanter:LabelFlytt(FILL-IN-KABEL).
   Guru.Konstanter:LabelFlytt(FILL-IN-METER). 
   Guru.Konstanter:LabelFlytt(FILL-IN-ADR). 
   Guru.Konstanter:LabelFlytt(CMB_TYP).  
   Guru.Konstanter:LabelFlytt(CMB_SKYLTART).
   Guru.Konstanter:LabelFlytt(FILL-IN-SKYLTANT). 
   Guru.Konstanter:LabelFlytt(FILL-IN-APPARAT). 
   Guru.Konstanter:LabelFlytt(FILL-IN-GRUPPNR). 
   Guru.Konstanter:LabelFlytt(FILL-IN-SKYLTBEN).
   Guru.Konstanter:LabelFlytt(FILL-IN-ABONNENT). 
   Guru.Konstanter:LabelFlytt(FILL-IN-AR). 
   Guru.Konstanter:LabelFlytt(FILL-IN-SAK).  
   Guru.Konstanter:LabelFlytt(FILL-IN-MAX).
   Guru.Konstanter:LabelFlytt(FILL-IN-ANMARK). 
     
END PROCEDURE.
PROCEDURE main2_UI :
   DEFINE VARIABLE kabelandben AS CHARACTER NO-UNDO.
   ASSIGN      
   FBTN_BORT:HIDDEN  = TRUE
   FBTN_SKAPA:HIDDEN  = TRUE
   FBTN_AND:HIDDEN  = TRUE
   BTN_UPP:HIDDEN  = TRUE
   BTN_NER:HIDDEN  = TRUE
   BRW_MTRL:HIDDEN  = TRUE
   BRW_APP:HIDDEN  = TRUE
   RAD_VAL:HIDDEN  = TRUE.   
   FIND FIRST kon_val WHERE ROWID(kon_val) = kon_rowid NO-LOCK NO-ERROR.
   FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM USE-INDEX NUM 
   NO-LOCK NO-ERROR.
   FIND FIRST bbenamntemp WHERE bbenamntemp.KONSKOD = kon_val.GRUPP USE-INDEX KOD
   NO-LOCK NO-ERROR.            
   {MARKKABVAL.I}   
   IF enval = TRUE AND  kon_val.GRUPP NE 0 THEN DO:            
      /*markstation*/
      ASSIGN
      FILL-IN-TYP:LABEL = "Stationstyp"
      FILL-IN-SADR:LABEL = "Stationsadress".                   
      FIND FIRST konsttemp WHERE konsttemp.KTYPKOD = kon_val.F1 NO-LOCK NO-ERROR.
      IF AVAILABLE konsttemp THEN DO:            
         FILL-IN-TYP:SCREEN-VALUE = konsttemp.BENAMNING.                                    
      END.
      OPEN QUERY kq FOR EACH konbuff WHERE konbuff.NUM = kon_val.NUM NO-LOCK.
      GET FIRST kq NO-LOCK.
      DO WHILE AVAILABLE(konbuff):         
         RUN sakr_UI (INPUT konbuff.F4, OUTPUT sakrstor ).
         FIND FIRST fri_temp WHERE fri_temp.NUM = konbuff.NUM AND
         fri_temp.KABNR = konbuff.SKAPNUM NO-LOCK NO-ERROR.
         IF AVAILABLE fri_temp THEN DO:
            IF fri_temp.VARSKAPAD = TRUE THEN DO:
               kabelandben = fri_temp.KABADR.
               DELETE fri_temp.
            END.
         END.      
         /*i kabeland ?*/
         IF AVAILABLE fri_temp THEN DO:                        
            IF konbuff.F5 NE "" THEN DO:               
               FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
               konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F5 AND
               konstvaltemp.BB = bbenamntemp.B5 AND konstvaltemp.KOPP = TRUE
               USE-INDEX KOPIA NO-LOCK NO-ERROR.  
               IF fri_temp.SAKR = 0 THEN fri_temp.SAKR = sakrstor.                     
               ASSIGN               
               fri_temp.KABNR = konbuff.SKAPNUM.
               FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
               konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F3 AND
               konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
               USE-INDEX KOPIA NO-LOCK NO-ERROR.
               IF AVAILABLE konstvaltemp THEN DO:
                  IF Guru.Konstanter:globforetag = "LULE" THEN DO:                           
                      FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.TYPBER = TRUE NO-LOCK NO-ERROR.
                      IF AVAILABLE list_mtrl THEN DO:
                         IF SUBSTRING(fri_temp.APPARAT,(LENGTH(fri_temp.APPARAT) - 1),2) = "K" + STRING(konbuff.TYP) THEN.
                         ELSE fri_temp.APPARAT = fri_temp.APPARAT +  " K" + STRING(konbuff.TYP).
                     END.
                  END.
               END.
               ELSE DO:
                  /*om importerad station inte är benämn likadant uteslut F1*/
                  FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
                  konstvaltemp.KVALKOD = konbuff.F3 AND
                  konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
                  USE-INDEX KOPIA NO-LOCK NO-ERROR.
                  IF AVAILABLE konstvaltemp THEN DO:
                     IF Guru.Konstanter:globforetag = "LULE" THEN DO:                           
                         FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.TYPBER = TRUE NO-LOCK NO-ERROR.
                         IF AVAILABLE list_mtrl THEN DO:
                            IF SUBSTRING(fri_temp.APPARAT,(LENGTH(fri_temp.APPARAT) - 1),2) = "K" + STRING(konbuff.TYP) THEN.
                            ELSE fri_temp.APPARAT = fri_temp.APPARAT +  " K" + STRING(konbuff.TYP).
                        END.
                     END.
                  END.
                     
               END.   
               /*kontrollera hsp lsp för redan upplagda kablar lena*/
               IF Guru.Konstanter:varforetypchar[5] = "32" OR Guru.Konstanter:varforetypchar[5] = "33" OR Guru.Konstanter:varforetypchar[5] = "35"  OR Guru.Konstanter:varforetypchar[5] = "33,37"
               OR Guru.Konstanter:varforetypchar[5] = "35,57" THEN DO:
                  /*omtolkning hsp lsp 20180122 Lena*/               
                                                
                  RUN kollahsplsp2_UI.
               END.
            END.                        
         END.
         ELSE DO:
            musz = FALSE.
            IF konbuff.SKAPNUM = 99 THEN DO:
               IF konbuff.F5 = " " THEN musz = TRUE.
               ELSE IF konbuff.F5 = "CONNECTIT" THEN musz = TRUE.
               ELSE musz = musz.
            END.
            ELSE IF konbuff.SKAPNUM = 98 THEN DO:
               IF konbuff.F5 = " " THEN musz = TRUE.
               ELSE IF konbuff.F5 = "CONNECTIT" THEN musz = TRUE.
               ELSE musz = musz.
            END.               
            IF musz = FALSE THEN DO:      
               /*onevatt*/         
               IF Guru.Konstanter:varforetypchar[5] = "12,30,33,37,38,45" OR Guru.Konstanter:varforetypchar[5] = "33,34,36,37" OR Guru.Konstanter:varforetypchar[5] = "35,57"  THEN DO:
                  /*onevatt*/
                  kollvatt = TRUE.                  
                  IF Guru.Konstanter:globforetag = "GRAN" THEN DO:
                     FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 35 AND
                     konsttemp.KTYPKOD =  LEFT-TRIM(konbuff.F1) NO-LOCK NO-ERROR.
                     IF AVAILABLE konsttemp THEN kollvatt = FALSE.
                  END.    
                  IF kollvatt = TRUE THEN DO:    
                     /*HSP VAST*/
                     IF konbuff.F2 NE "" THEN DO:                     
                        FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
                        konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F2 AND
                        konstvaltemp.BB = bbenamntemp.B2 AND konstvaltemp.KOPP = TRUE
                        USE-INDEX KOPIA NO-LOCK NO-ERROR. 
                        IF AVAILABLE konstvaltemp THEN DO:
                           FIND FIRST fribuff WHERE fribuff.NUM = konbuff.NUM NO-LOCK NO-ERROR.      
                           DEBUGGER:SET-BREAK().                  
                           CREATE fri_temp.
                           ASSIGN
                           fri_temp.KABADR = kabelandben
                           fri_temp.NUM = konbuff.num                           
                           fri_temp.KABNR = konbuff.SKAPNUM
                           fri_temp.ARTAL = YEAR(TODAY)
                           fri_temp.LSP = 2            
                           fri_temp.TYP = "hsp"
                           fri_temp.APPARAT = ""
                           CMB_TYP:SCREEN-VALUE = "hsp".
                           IF AVAILABLE konstvaltemp THEN DO:
                              fri_temp.BENAMNING = konstvaltemp.BENAMNING.
                              FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.LINKAB = TRUE NO-LOCK NO-ERROR.
                              IF AVAILABLE list_mtrl THEN DO:                              
                                 fri_temp.Meter = list_mtrl.ANTAL. 
                              END.                              
                           END.   
                           IF AVAILABLE fribuff THEN DO:
                              ASSIGN
                              fri_temp.SKAP = fribuff.SKAP
                              fri_temp.SKAPADR = fribuff.SKAPADR.
                           END.                        
                           fri_temp.SAKR = sakrstor.
                           IF Guru.Konstanter:varforetypval[44] = 1   THEN DO:                              
                              CREATE markgrupp.
                              ASSIGN                           
                              markgrupp.NUM = fri_temp.NUM
                              markgrupp.KABNR = fri_temp.KABNR.                           
                           END.                        
                        END.   
                     END.
                   END.  
               END.
               IF konbuff.F5 NE "" THEN DO:
                  IF konbuff.F5 = "CONNECTIT" THEN DO:
                     musz = musz.
                  END.
                  ELSE DO:                            
                     FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
                     konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F5 AND
                     konstvaltemp.BB = bbenamntemp.B5 AND konstvaltemp.KOPP = TRUE
                     USE-INDEX KOPIA NO-LOCK NO-ERROR. 
                     FIND FIRST fribuff WHERE fribuff.NUM = konbuff.NUM NO-LOCK NO-ERROR.
                     kabut = TRUE.                    
                     /*onevatt*/
                     IF Guru.Konstanter:varforetypchar[5] = "12,30,33,37,38,45" OR Guru.Konstanter:varforetypchar[5] = "33,34,36,37"   THEN DO:
                        /* om  kabeln finns med bland lågspänningskablar KONSKOD = 14. Högspänningskablar ska ej med i kortet*/
                        /*alla kablar ska ut  detta bör bara vara lsp ändå Lena 20210307*/
                        /*FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 14 AND
                        konsttemp.KTYPKOD =  LEFT-TRIM(konstvaltemp.KVALKOD) NO-LOCK NO-ERROR.
                        IF NOT AVAILABLE konsttemp THEN kabut = FALSE.*/
                     END.                    
                     IF kabut = TRUE THEN DO:     
                        DEBUGGER:SET-BREAK().                
                        CREATE fri_temp.
                        ASSIGN
                        fri_temp.KABADR = kabelandben
                        fri_temp.NUM = konbuff.num                           
                        fri_temp.KABNR = konbuff.SKAPNUM
                        fri_temp.ARTAL = YEAR(TODAY).                       
                        IF AVAILABLE konstvaltemp THEN DO:
                           fri_temp.BENAMNING = konstvaltemp.BENAMNING.
                           FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.LINKAB = TRUE NO-LOCK NO-ERROR.
                           IF AVAILABLE list_mtrl THEN DO:                              
                              fri_temp.Meter = list_mtrl.ANTAL. 
                           END.
                        END.   
                        IF AVAILABLE fribuff THEN DO:
                           ASSIGN
                           fri_temp.SKAP = fribuff.SKAP
                           fri_temp.SKAPADR = fribuff.SKAPADR.
                        END.                        
                        fri_temp.SAKR = sakrstor.
                        IF Guru.Konstanter:varforetypval[44] = 1   THEN DO:                                       
                           CREATE markgrupp.
                           ASSIGN                           
                           markgrupp.NUM = fri_temp.NUM
                           markgrupp.KABNR = fri_temp.KABNR.                           
                        END.                        
                        IF Guru.Konstanter:varforetypchar[5] = "32" OR Guru.Konstanter:varforetypchar[5] = "33" OR Guru.Konstanter:varforetypchar[5] = "35"  OR Guru.Konstanter:varforetypchar[5] = "33,37"
                        OR Guru.Konstanter:varforetypchar[5] = "35,57" THEN DO:  
                                                                       
                           RUN kollahsplsp_UI.
                        END.
                        ELSE DO:
                           FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
                           konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F3 AND
                           konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
                           USE-INDEX KOPIA NO-LOCK NO-ERROR.
                           IF AVAILABLE konstvaltemp THEN DO:                              
                              fri_temp.APPARAT = konstvaltemp.BENAMNING.
                              IF Guru.Konstanter:globforetag = "LULE" THEN DO:                           
                                  FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.TYPBER = TRUE NO-LOCK NO-ERROR.
                                  IF AVAILABLE list_mtrl THEN DO:
                                     IF SUBSTRING(fri_temp.APPARAT,(LENGTH(fri_temp.APPARAT) - 1),2) = "K" + STRING(konbuff.TYP) THEN.
                                     ELSE fri_temp.APPARAT = fri_temp.APPARAT +  " K" + STRING(konbuff.TYP).
                                 END.
                              END.                                 
                           END.
                           ELSE DO:
                              FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
                              konstvaltemp.KVALKOD = konbuff.F3 AND
                              konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
                              USE-INDEX KOPIA NO-LOCK NO-ERROR.
                              IF AVAILABLE konstvaltemp THEN DO:                              
                                 fri_temp.APPARAT = konstvaltemp.BENAMNING.
                                 IF Guru.Konstanter:globforetag = "LULE" THEN DO:                           
                                     FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.TYPBER = TRUE NO-LOCK NO-ERROR.
                                     IF AVAILABLE list_mtrl THEN DO:
                                        IF SUBSTRING(fri_temp.APPARAT,(LENGTH(fri_temp.APPARAT) - 1),2) = "K" + STRING(konbuff.TYP) THEN.
                                        ELSE fri_temp.APPARAT = fri_temp.APPARAT +  " K" + STRING(konbuff.TYP).
                                    END.
                                 END.
                              END.    
                           END.   
                        END.
                        
                     END.
                  END.
               END.
            END.
            ELSE musz = FALSE.               
         END.
         GET NEXT kq NO-LOCK.
      END.
      CLOSE QUERY kq.
   END.         
   ELSE DO:
      /*KABELSKÅP*/        
      ASSIGN
      FILL-IN-TYP:LABEL = "Skåptyp"
      FILL-IN-SADR:LABEL = "Skåpadress".                   
      OPEN QUERY kq FOR EACH konbuff WHERE konbuff.NUM = kon_val.NUM NO-LOCK.
      GET FIRST kq NO-LOCK.
      DO WHILE AVAILABLE(konbuff):
         RUN sakr_UI ( INPUT konbuff.F5, OUTPUT sakrstor ).                     
         FIND FIRST fri_temp WHERE fri_temp.NUM = konbuff.NUM AND
         fri_temp.KABNR = konbuff.SKAPNUM NO-LOCK NO-ERROR.
         IF AVAILABLE fri_temp THEN DO:
            IF fri_temp.VARSKAPAD = TRUE THEN DO:
               kabelandben = fri_temp.KABADR.
               DELETE fri_temp.
            END.
         END.
         /*i kabeland ?*/
         IF AVAILABLE fri_temp THEN DO:            
            IF fri_temp.SAKR = 0 THEN fri_temp.SAKR = sakrstor.                     
            IF konbuff.F2 NE "" THEN DO:               
               FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
               konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F2 AND
               konstvaltemp.BB = bbenamntemp.B2 AND konstvaltemp.KOPP = TRUE
               USE-INDEX KOPIA NO-LOCK NO-ERROR.                              
               ASSIGN               
               fri_temp.KABNR = konbuff.SKAPNUM.
               FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
               konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F3 AND
               konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
               USE-INDEX KOPIA NO-LOCK NO-ERROR.
               IF AVAILABLE konstvaltemp THEN DO:
                   fri_temp.APPARAT = konstvaltemp.BENAMNING.
                   IF Guru.Konstanter:globforetag = "LULE" THEN DO:                           
                      FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.TYPBER = TRUE NO-LOCK NO-ERROR.
                      IF AVAILABLE list_mtrl THEN DO:
                         IF SUBSTRING(fri_temp.APPARAT,(LENGTH(fri_temp.APPARAT) - 1),2) = "K" + STRING(konbuff.TYP) THEN.
                         ELSE fri_temp.APPARAT = fri_temp.APPARAT +  " K" + STRING(konbuff.TYP).
                     END.
                  END.
               END.
               ELSE DO:
                  FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
                  konstvaltemp.KVALKOD = konbuff.F3 AND
                  konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
                  USE-INDEX KOPIA NO-LOCK NO-ERROR.
                  IF AVAILABLE konstvaltemp THEN DO:
                      fri_temp.APPARAT = konstvaltemp.BENAMNING.
                      IF Guru.Konstanter:globforetag = "LULE" THEN DO:                           
                         FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.TYPBER = TRUE NO-LOCK NO-ERROR.
                         IF AVAILABLE list_mtrl THEN DO:
                            IF SUBSTRING(fri_temp.APPARAT,(LENGTH(fri_temp.APPARAT) - 1),2) = "K" + STRING(konbuff.TYP) THEN.
                            ELSE fri_temp.APPARAT = fri_temp.APPARAT +  " K" + STRING(konbuff.TYP).
                        END.
                     END.
                  END.   
               END.   
            END.            
         END.
         ELSE DO:
            /*kabelskåp*/
            musz = FALSE.
            IF konbuff.SKAPNUM = 99 THEN DO:
               IF konbuff.F2 = " " THEN musz = TRUE.
               ELSE IF konbuff.F2 = "CONNECTIT" THEN musz = TRUE.
               ELSE musz = musz.
            END.
            ELSE IF konbuff.SKAPNUM = 98 THEN DO:
               IF konbuff.F2 = " " THEN musz = TRUE.
               ELSE IF konbuff.F2 = "CONNECTIT" THEN musz = TRUE.
               ELSE musz = musz.
            END.               
            IF musz = FALSE THEN DO:            
               IF konbuff.F2 NE "" THEN DO:
                  IF konbuff.F2 = "CONNECTIT" THEN DO:
                     musz = musz.
                  END.
                  ELSE DO:       
                     FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
                     konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F2 AND
                     konstvaltemp.BB = bbenamntemp.B2 AND konstvaltemp.KOPP = TRUE
                     USE-INDEX KOPIA NO-LOCK NO-ERROR. 
                     FIND FIRST fribuff WHERE fribuff.NUM = konbuff.NUM NO-LOCK NO-ERROR.   
                     DEBUGGER:SET-BREAK().                     
                     CREATE fri_temp.
                     ASSIGN 
                     fri_temp.SKAP = ""
                     fri_temp.KABADR = kabelandben
                     fri_temp.NUM = konbuff.num
                     fri_temp.KABNR = konbuff.SKAPNUM
                     fri_temp.ARTAL = YEAR(TODAY).                                                                 
                     IF AVAILABLE konstvaltemp THEN DO:
                        fri_temp.BENAMNING = konstvaltemp.BENAMNING.
                        FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.LINKAB = TRUE NO-LOCK NO-ERROR.
                        IF AVAILABLE list_mtrl THEN DO:                              
                           fri_temp.Meter = list_mtrl.ANTAL. 
                        END.
                     END.   
                     IF AVAILABLE fribuff THEN DO:
                        ASSIGN
                        fri_temp.SKAP = fribuff.SKAP
                        fri_temp.SKAPADR = fribuff.SKAPADR.
                     END.                                         
                     fri_temp.SAKR = sakrstor.  
                                        
                     FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
                     konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F3 AND
                     konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
                     USE-INDEX KOPIA NO-LOCK NO-ERROR.
                     IF AVAILABLE konstvaltemp THEN DO:
                        fri_temp.APPARAT = konstvaltemp.BENAMNING.
                        IF Guru.Konstanter:globforetag = "LULE" THEN DO:                           
                            FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.TYPBER = TRUE NO-LOCK NO-ERROR.
                            IF AVAILABLE list_mtrl THEN DO:
                               IF SUBSTRING(fri_temp.APPARAT,(LENGTH(fri_temp.APPARAT) - 1),2) = "K" + STRING(konbuff.TYP) THEN.
                               ELSE fri_temp.APPARAT = fri_temp.APPARAT +  " K" + STRING(konbuff.TYP).
                           END.
                        END.      
                     END.
                     ELSE DO:
                        FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
                        /*konstvaltemp.KTYPKOD = konbuff.F1 AND*/ konstvaltemp.KVALKOD = konbuff.F3 AND
                        konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
                        USE-INDEX KOPIA NO-LOCK NO-ERROR.
                        IF AVAILABLE konstvaltemp THEN DO:
                           fri_temp.APPARAT = konstvaltemp.BENAMNING.
                           IF Guru.Konstanter:globforetag = "LULE" THEN DO:                           
                               FIND FIRST list_mtrl WHERE list_mtrl.NUM = konbuff.num AND list_mtrl.SKAPNUM = konbuff.SKAPNUM AND list_mtrl.TYPBER = TRUE NO-LOCK NO-ERROR.
                               IF AVAILABLE list_mtrl THEN DO:
                                  IF SUBSTRING(fri_temp.APPARAT,(LENGTH(fri_temp.APPARAT) - 1),2) = "K" + STRING(konbuff.TYP) THEN.
                                  ELSE fri_temp.APPARAT = fri_temp.APPARAT +  " K" + STRING(konbuff.TYP).
                              END.
                           END.      
                        END.   
                     END.
                         
                  END.
               END.
            END.
            ELSE DO:
               musz = FALSE.
            END.
         END.
         GET NEXT kq NO-LOCK.
      END.
      CLOSE QUERY kq.
   END.
   FOR EACH fri_temp WHERE fri_temp.NUM = kon_val.NUM :
      FIND FIRST markgrupp WHERE markgrupp.NUM = fri_temp.NUM AND markgrupp.KABNR = fri_temp.KABNR NO-ERROR.
      IF AVAILABLE markgrupp THEN DO: 
         ASSIGN
         fri_temp.GRUPPNR = markgrupp.GRUPP. 
         fri_temp.ARTNR = markgrupp.ARTNR. 
      END.
   END.          
   /*onevatt*/
   /*IF Guru.Konstanter:globforetag = "vast" OR Guru.Konstanter:globforetag = "REJI" OR Guru.Konstanter:globforetag = "ELPC" OR Guru.Konstanter:globforetag = "elpa" THEN DO:*/
   IF Guru.Konstanter:varforetypchar[5] = "12,30,33,37,38,45" OR Guru.Konstanter:varforetypchar[5] = "33,34,36,37" THEN DO:                    
      /*HSP VAST*/
      FOR EACH fri_temp WHERE fri_temp.NUM = kon_val.NUM AND fri_temp.TYP = "hsp":
         fri_temp.LSP = 2.               
      END.       
   END.
   RUN setcolsortvar_UI IN brwproc[3] (INPUT " WHERE NUM = " + STRING(kon_id.NUM) ).
   RUN openbdynspec_UI IN brwproc[3].
   RUN setcolindex_UI IN brwproc[3] (INPUT "").
   EMPTY TEMP-TABLE mtrl_tab NO-ERROR.       
   IF RAD_VAL:SCREEN-VALUE = "1" THEN DO:
      RUN mtrl_UI.
      RUN setcolsortvar_UI IN brwproc[4] (INPUT "").
      RUN openbdynspec_UI IN brwproc[4].      
   END.
   ELSE DO:
      RUN setcolsortvar_UI IN brwproc[1] (INPUT "").
      RUN openbdynspec_UI IN brwproc[1].           
   END.
   APPLY "VALUE-CHANGED" TO BRW_KAB .
END PROCEDURE.

PROCEDURE kollahsplsp_UI :
   /*markera lsp hsp för sej spara ktypkod dvs förkortning på kabeln*/      
   fri_temp.LSP = 1.
   /*initialt är alla kablar lsp. Pga gamla lspkablar som inte längre finns med i 14 FORS Lena 20180124 */
   FIND FIRST kon_val WHERE kon_val.NUM = fri_temp.NUM AND kon_val.SKAPNUM = fri_temp.KABNR NO-LOCK NO-ERROR.
   IF AVAILABLE kon_val  THEN DO:   
      FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 14 AND
      konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
      IF AVAILABLE konsttemp THEN DO:
         fri_temp.LSP = 1.
      END.          
      ELSE DO:                        
         FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 25 AND
         konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
         IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.            
         ELSE DO:
            FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 27 AND
            konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
            IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
            ELSE DO:
               IF Guru.Konstanter:globforetag = "fors" THEN DO:
                  FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 36 AND
                  konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                  IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                  ELSE DO:
                     FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 35 AND
                     konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                     IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                     ELSE DO:
                        FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 41 AND
                        konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                        IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                     END.
                  END.
                     
               END.
               IF Guru.Konstanter:globforetag = "GRAN" THEN DO:
                  FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 55 AND
                  konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                  IF AVAILABLE konsttemp THEN fri_temp.LSP = 1.
                  ELSE DO:
                     FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 54 AND
                     konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                     IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                     ELSE DO:
                        FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 56 AND
                        konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                        IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.                        
                        ELSE DO:
                           FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 58 AND
                           konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                           IF AVAILABLE konsttemp THEN fri_temp.LSP = 1.
                           ELSE DO:
                              FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 59 AND
                              konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                              IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                              ELSE DO:
                                 FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 60 AND
                                 konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                                 IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                              END.
                           END.
                        END.
                     END.
                  END.
               END.   
               IF Guru.Konstanter:globforetag = "KRIN" THEN DO:
                  IF LEFT-TRIM(kon_val.F5) BEGINS "MAG" THEN fri_temp.LSP = 2.
                  ELSE IF LEFT-TRIM(kon_val.F5) BEGINS "KAP" THEN fri_temp.LSP = 2.
                  ELSE IF LEFT-TRIM(kon_val.F5) BEGINS "SM" THEN fri_temp.LSP = 2.
               END.                     
            END.               
         END.
      END.
      IF NOT AVAILABLE konsttemp THEN DO:      
         IF LEFT-TRIM(kon_val.F5) BEGINS "12" OR LEFT-TRIM(kon_val.F5) BEGINS "24" THEN fri_temp.LSP = 2.
      END.      
      IF fri_temp.LSP = 1 THEN DO:               
         fri_temp.TYP = "lsp".
         FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = kon_val.GRUPP AND konstvaltemp.KTYPKOD = konbuff.F1 AND 
         konstvaltemp.KVALKOD = konbuff.F3 AND konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
         USE-INDEX KOPIA NO-LOCK NO-ERROR.
         IF AVAILABLE konstvaltemp THEN DO:
            fri_temp.APPARAT = konstvaltemp.BENAMNING.                         
         END.
         ELSE DO:
            /*fri_temp.APPARAT = "".*/ 
            FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = kon_val.GRUPP AND /*konstvaltemp.KTYPKOD = konbuff.F1 AND*/ 
            konstvaltemp.KVALKOD = konbuff.F3 AND konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE
            USE-INDEX KOPIA NO-LOCK NO-ERROR.
            IF AVAILABLE konstvaltemp THEN DO:
               fri_temp.APPARAT = konstvaltemp.BENAMNING.                         
            END.      
            ELSE DO:
               fri_temp.APPARAT = "".
            END.        
         END.
      END.
      IF fri_temp.LSP = 2 THEN DO: /* HSP */
         fri_temp.TYP = "hsp".
         FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
         konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F2 AND
         konstvaltemp.BB = bbenamntemp.B2 AND konstvaltemp.KOPP = TRUE
         USE-INDEX KOPIA NO-LOCK NO-ERROR.
         IF AVAILABLE konstvaltemp THEN DO:
            fri_temp.APPARAT = konstvaltemp.BENAMNING.                   
            CMB_TYP:SCREEN-VALUE = "hsp".
         END.
         ELSE DO:
            fri_temp.TYP = "hsp".
            FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
            konstvaltemp.KVALKOD = konbuff.F2 AND
            konstvaltemp.BB = bbenamntemp.B2 AND konstvaltemp.KOPP = TRUE
            USE-INDEX KOPIA NO-LOCK NO-ERROR.
            IF AVAILABLE konstvaltemp THEN DO:
               fri_temp.APPARAT = konstvaltemp.BENAMNING.                   
               CMB_TYP:SCREEN-VALUE = "hsp".
            END.
            ELSE DO:
               fri_temp.APPARAT = "".
            END.           
         END.
      END.
   END.         
END PROCEDURE.
PROCEDURE kollahsplsp2_UI :
   
   /*omtolkning hsp lsp 20180122 Lena*/
   fri_temp.LSP = 1.
   /*initialt är alla kablar lsp. Pga gamla lspkablar som inte längre finns med i 14 FORS Lena 20180124 */      
   FIND FIRST kon_val WHERE kon_val.NUM = fri_temp.NUM AND kon_val.SKAPNUM = fri_temp.KABNR NO-LOCK NO-ERROR.
   IF AVAILABLE kon_val  THEN DO:   
      FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 14 AND
      konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
      IF AVAILABLE konsttemp THEN DO:
         fri_temp.LSP = 1.
      END.          
      ELSE DO:                        
         FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 25 AND
         konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
         IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.            
         ELSE DO:
            FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 27 AND
            konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
            IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
            ELSE DO:
               IF Guru.Konstanter:globforetag = "fors" THEN DO:
                  FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 36 AND
                  konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                  IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                  ELSE DO:
                     FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 35 AND
                     konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                     IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                     ELSE DO:
                        FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 41 AND
                        konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                        IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.                     
                     END.                     
                  END.   
               END.
               IF Guru.Konstanter:globforetag = "krin" THEN DO:
                  IF LEFT-TRIM(kon_val.F5) BEGINS "MAG" THEN fri_temp.LSP = 2.
                  ELSE IF LEFT-TRIM(kon_val.F5) BEGINS "KAP" THEN fri_temp.LSP = 2.
                  ELSE IF LEFT-TRIM(kon_val.F5) BEGINS "SM" THEN fri_temp.LSP = 2.
               END.
               IF Guru.Konstanter:globforetag = "GRAN" THEN DO:
                  FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 55 AND
                  konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                  IF AVAILABLE konsttemp THEN fri_temp.LSP = 1.
                  ELSE DO:
                     FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 54 AND
                     konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                     IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                     ELSE DO:
                        FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 56 AND
                        konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                        IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                        ELSE DO:
                           FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 58 AND
                           konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                           IF AVAILABLE konsttemp THEN fri_temp.LSP = 1.
                           ELSE DO:
                              FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 59 AND
                              konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                              IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.
                              ELSE DO:
                                 FIND FIRST konsttemp WHERE konsttemp.KONSKOD = 60 AND
                                 konsttemp.KTYPKOD =  LEFT-TRIM(kon_val.F5) NO-LOCK NO-ERROR.
                                 IF AVAILABLE konsttemp THEN fri_temp.LSP = 2.                     
                              END.                     
                           END.                     
                        END.                     
                     END.                     
                  END.   
               END.                     
            END.               
         END.
      END.
      IF NOT AVAILABLE konsttemp THEN DO:      
         IF LEFT-TRIM(kon_val.F5) BEGINS "12" OR LEFT-TRIM(kon_val.F5) BEGINS "24" THEN fri_temp.LSP = 2.
      END.   
            
         
      IF fri_temp.LSP = 1 THEN DO:         
         IF fri_temp.TYP = "hsp" OR fri_temp.TYP = "" THEN DO:
            fri_temp.TYP = "lsp".
            FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = kon_val.GRUPP AND konstvaltemp.KTYPKOD = konbuff.F1 AND 
            konstvaltemp.KVALKOD = konbuff.F3 AND konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE USE-INDEX KOPIA NO-LOCK NO-ERROR.
            IF AVAILABLE konstvaltemp THEN DO:
               fri_temp.APPARAT = konstvaltemp.BENAMNING.                         
            END.
            ELSE DO:
               FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = kon_val.GRUPP AND /*konstvaltemp.KTYPKOD = konbuff.F1 AND*/ 
               konstvaltemp.KVALKOD = konbuff.F3 AND konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE USE-INDEX KOPIA NO-LOCK NO-ERROR.
               IF AVAILABLE konstvaltemp THEN DO:
                  fri_temp.APPARAT = konstvaltemp.BENAMNING.                         
               END.
               ELSE fri_temp.APPARAT = "".
            END.   
         END.
         ELSE IF fri_temp.TYP = "lsp" OR fri_temp.TYP = "Servis" THEN DO:
            /*om frikort är blankt på apparat - hämta igen*/
            IF fri_temp.APPARAT = "" AND  konbuff.F3 NE "" THEN DO:
               FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = kon_val.GRUPP AND konstvaltemp.KTYPKOD = konbuff.F1 AND 
               konstvaltemp.KVALKOD = konbuff.F3 AND konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE USE-INDEX KOPIA NO-LOCK NO-ERROR.
               IF AVAILABLE konstvaltemp THEN DO:
                  fri_temp.APPARAT = konstvaltemp.BENAMNING.                         
               END.
               ELSE DO:
                  FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = kon_val.GRUPP AND /*konstvaltemp.KTYPKOD = konbuff.F1 AND*/ 
                  konstvaltemp.KVALKOD = konbuff.F3 AND konstvaltemp.BB = bbenamntemp.B3 AND konstvaltemp.KOPP = TRUE USE-INDEX KOPIA NO-LOCK NO-ERROR.
                  IF AVAILABLE konstvaltemp THEN DO:
                     fri_temp.APPARAT = konstvaltemp.BENAMNING.                         
                  END.
                  ELSE fri_temp.APPARAT = "".
               END.   
            END.      
         END.                                                      
      END.
      IF fri_temp.LSP = 2 THEN DO: /* HSP */      
         IF fri_temp.TYP = "lsp" OR fri_temp.TYP = "In" OR fri_temp.TYP = "Ut" OR fri_temp.TYP = "Servis" THEN DO: 
            fri_temp.TYP = "hsp".
            FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
            konstvaltemp.KTYPKOD = konbuff.F1 AND konstvaltemp.KVALKOD = konbuff.F2 AND
            konstvaltemp.BB = bbenamntemp.B2 AND konstvaltemp.KOPP = TRUE     USE-INDEX KOPIA NO-LOCK NO-ERROR.
            IF AVAILABLE konstvaltemp THEN DO:
               fri_temp.APPARAT = konstvaltemp.BENAMNING.                   
               CMB_TYP:SCREEN-VALUE = "hsp".
            END.
            ELSE DO:
               FIND FIRST konstvaltemp WHERE konstvaltemp.KONSKOD = konbuff.GRUPP AND
               konstvaltemp.KVALKOD = konbuff.F2 AND
               konstvaltemp.BB = bbenamntemp.B2 AND konstvaltemp.KOPP = TRUE     USE-INDEX KOPIA NO-LOCK NO-ERROR.
               IF AVAILABLE konstvaltemp THEN DO:
                  fri_temp.APPARAT = konstvaltemp.BENAMNING.                   
                  CMB_TYP:SCREEN-VALUE = "hsp".
               END.
               ELSE fri_temp.APPARAT = "".
            END.   
         END.             
      END.
   END.         
END PROCEDURE.

PROCEDURE fritempupp_UI :
   IF AVAILABLE fri_temp THEN DO:
      ASSIGN
      fri_temp.SKAP = FILL-IN-TYP:SCREEN-VALUE
      fri_temp.SKAPADR = FILL-IN-SADR:SCREEN-VALUE
      fri_temp.BENAMNING = FILL-IN-KABEL:SCREEN-VALUE
      fri_temp.METER = INTEGER(FILL-IN-METER:SCREEN-VALUE)
      fri_temp.APPARAT = FILL-IN-APPARAT:SCREEN-VALUE
      fri_temp.KABADR = FILL-IN-ADR:SCREEN-VALUE
      fri_temp.ARTAL = INTEGER(FILL-IN-AR:SCREEN-VALUE)       
      fri_temp.ANMARK = FILL-IN-ANMARK:SCREEN-VALUE.
      IF fri_temp.TYP = "hsp" THEN.
      ELSE fri_temp.TYP = CMB_TYP:SCREEN-VALUE.                  
      IF Guru.Konstanter:varforetypval[44] = 1   THEN DO:         
         FIND FIRST markgrupp WHERE markgrupp.NUM = fri_temp.NUM AND markgrupp.KABNR = fri_temp.KABNR NO-ERROR.
         IF NOT AVAILABLE markgrupp THEN DO:
            CREATE markgrupp.
            ASSIGN            
            markgrupp.NUM = fri_temp.NUM
            markgrupp.KABNR = fri_temp.KABNR.                                  
         END.
         ASSIGN    
         markgrupp.GRUPP = FILL-IN-GRUPPNR:SCREEN-VALUE            
         fri_temp.GRUPPNR = FILL-IN-GRUPPNR:SCREEN-VALUE
         markgrupp.ARTNR = CMB_SKYLTART:SCREEN-VALUE            
         fri_temp.ARTNR = CMB_SKYLTART:SCREEN-VALUE
         markgrupp.ABONNENT = FILL-IN-ABONNENT:SCREEN-VALUE            
         fri_temp.ABONNENT = FILL-IN-ABONNENT:SCREEN-VALUE.
      END.            
      IF Guru.Konstanter:globforetag = "fors" THEN DO:
         IF CMB_SKYLTART:SCREEN-VALUE = "A204" AND FILL-IN-SKYLTANT:SCREEN-VALUE > STRING(0) THEN DO:      
            FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
            list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = "A202" AND list_mtrl.ANTAL > 0 AND
            list_mtrl.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
            IF AVAILABLE list_mtrl THEN DO:
               MESSAGE "A202 OCH A204 kan inte finnas upplagda med antal större än noll på samma kabel. Nolla A202 för att kunna lägga in A204" VIEW-AS ALERT-BOX TITLE "Meddelande".
               APPLY "ENTRY" TO CMB_SKYLTART.
               RETURN NO-APPLY.            
            END.         
         END.
         IF CMB_SKYLTART:SCREEN-VALUE = "A202" AND FILL-IN-SKYLTANT:SCREEN-VALUE > STRING(0) THEN DO:      
            FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
            list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = "A204" AND list_mtrl.ANTAL > 0 AND
            list_mtrl.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
            IF AVAILABLE list_mtrl THEN DO:
               MESSAGE "A202 OCH A204 kan inte finnas upplagda med antal större än noll på samma kabel. Nolla A204 för att kunna lägga in A202" VIEW-AS ALERT-BOX TITLE "Meddelande".
               APPLY "ENTRY" TO CMB_SKYLTART.
               RETURN NO-APPLY.            
            END.         
         END.
      END.
      ELSE DO:   
         IF CMB_SKYLTART:SCREEN-VALUE = "A105" AND FILL-IN-SKYLTANT:SCREEN-VALUE > STRING(0) THEN DO:      
            FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
            list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = "A104" AND list_mtrl.ANTAL > 0 AND
            list_mtrl.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
            IF AVAILABLE list_mtrl THEN DO:
               MESSAGE "A104 OCH A105 kan inte finnas upplagda med antal större än noll på samma kabel. Nolla A104 för att kunna lägga in A105" VIEW-AS ALERT-BOX TITLE "Meddelande".
               APPLY "ENTRY" TO CMB_SKYLTART.
               RETURN NO-APPLY.            
            END.         
         END.
         IF CMB_SKYLTART:SCREEN-VALUE = "A104" AND FILL-IN-SKYLTANT:SCREEN-VALUE > STRING(0) THEN DO:      
            FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
            list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = "A105" AND list_mtrl.ANTAL > 0 AND
            list_mtrl.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
            IF AVAILABLE list_mtrl THEN DO:
               MESSAGE "A104 OCH A105 kan inte finnas upplagda med antal större än noll på samma kabel. Nolla A105 för att kunna lägga in A104" VIEW-AS ALERT-BOX TITLE "Meddelande".
               APPLY "ENTRY" TO CMB_SKYLTART.
               RETURN NO-APPLY.            
            END.         
         END.
      END.   
      /* även lika med 0?*/
      IF FILL-IN-SKYLTANT:SCREEN-VALUE GE STRING(0) THEN DO:
         IF Guru.Konstanter:globforetag = "fors" THEN DO:
            FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
            list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = CMB_SKYLTART:SCREEN-VALUE AND 
            list_mtrl.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
         END.
         ELSE DO:         
            FIND FIRST list_mtrl WHERE list_mtrl.NUM = fri_temp.NUM AND 
            list_mtrl.SKAPNUM = fri_temp.KABNR AND list_mtrl.ENR = CMB_SKYLTART:SCREEN-VALUE AND 
            list_mtrl.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.         
         END.
         FIND FIRST del_val WHERE del_val.NUM = fri_temp.NUM
         NO-LOCK NO-ERROR.
         IF AVAILABLE del_val THEN DO:            
            IF AVAILABLE list_mtrl AND list_mtrl.ANTAL NE INTEGER(FILL-IN-SKYLTANT:SCREEN-VALUE)  THEN DO:
               MESSAGE "Ni kan inte ändra antal på skyltar på denna konstruktion då den valda konstruktionen är inköpt via delbeställning"
               VIEW-AS ALERT-BOX TITLE "Meddelande".
               IF AVAILABLE list_mtrl THEN DO:
                  FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(list_mtrl.ANTAL).         
               END.
               ELSE FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(0).
               APPLY "ENTRY" TO CMB_SKYLTART.
               RETURN NO-APPLY.
            END.
            IF NOT AVAILABLE list_mtrl THEN DO:
               MESSAGE "Ni kan inte ändra antal på skyltar på denna konstruktion då den valda konstruktionen är inköpt via delbeställning"
               VIEW-AS ALERT-BOX TITLE "Meddelande".
               FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(0).
               APPLY "ENTRY" TO CMB_SKYLTART.
               RETURN NO-APPLY.
            END.
         END.                   
         IF NOT AVAILABLE list_mtrl AND FILL-IN-SKYLTANT:SCREEN-VALUE > STRING(0) THEN DO:
            IF Guru.Konstanter:globforetag = "fors" THEN DO:
               FIND FIRST emtrltemp WHERE emtrltemp.ENR = CMB_SKYLTART:SCREEN-VALUE AND emtrltemp.LEVKOD = skyltlev NO-LOCK NO-ERROR.
            END.
            ELSE DO:    
               FIND FIRST emtrltemp WHERE emtrltemp.ENR = CMB_SKYLTART:SCREEN-VALUE AND emtrltemp.LEVKOD = skyltlev NO-LOCK NO-ERROR.
            END.   
            IF AVAILABLE emtrltemp THEN DO:
               ejskap = FALSE.
               IF Guru.Konstanter:globforetag = "fors" THEN DO:
                  IF fri_temp.TYP = "hsp" AND CMB_SKYLTART:SCREEN-VALUE = "A203" THEN ejskap = TRUE.
                  IF fri_temp.TYP NE "hsp" AND CMB_SKYLTART:SCREEN-VALUE = "A202" THEN ejskap = TRUE.
                  IF fri_temp.TYP NE "hsp" AND CMB_SKYLTART:SCREEN-VALUE = "A204" THEN ejskap = TRUE.
               END.
               ELSE DO:   
                  IF fri_temp.TYP = "hsp" AND CMB_SKYLTART:SCREEN-VALUE = "A107" THEN ejskap = TRUE.
                  IF fri_temp.TYP NE "hsp" AND CMB_SKYLTART:SCREEN-VALUE = "A104" THEN ejskap = TRUE.
                  IF fri_temp.TYP NE "hsp" AND CMB_SKYLTART:SCREEN-VALUE = "A105" THEN ejskap = TRUE.
               END.   
               IF ejskap = FALSE THEN DO:                              
                  CREATE list_mtrl.
                  ASSIGN
                  list_mtrl.NUM = fri_temp.NUM
                  list_mtrl.ENR = CMB_SKYLTART:SCREEN-VALUE
                  list_mtrl.BENAMNING = emtrltemp.BENAMNING            
                  list_mtrl.ENHET = LC(emtrltemp.ENHET)
                  list_mtrl.PRIS = emtrltemp.NPRIS            
                  list_mtrl.LINKAB = FALSE
                  list_mtrl.SKAPNUM = fri_temp.KABNR.
                  IF Guru.Konstanter:globforetag = "fors" THEN list_mtrl.LEVKOD = skyltlev. 
                  ELSE list_mtrl.LEVKOD = skyltlev.
               END.
               ELSE DO:            
                  MESSAGE CMB_SKYLTART:SCREEN-VALUE " skall ej användas på denna kabel" VIEW-AS ALERT-BOX TITLE "Meddelande".
                  APPLY "ENTRY" TO CMB_SKYLTART.
                  RETURN NO-APPLY.            
               END.
            END.
            ELSE DO:            
               MESSAGE CMB_SKYLTART:SCREEN-VALUE " finns inte upplagd kontakta administratör. " VIEW-AS ALERT-BOX TITLE "Meddelande".
               APPLY "ENTRY" TO CMB_SKYLTART.
               RETURN NO-APPLY.            
            END.
         END.
         IF AVAILABLE list_mtrl THEN DO:
            IF DECIMAL(FILL-IN-SKYLTANT:SCREEN-VALUE) > 99999 THEN DO:
               MESSAGE "Antalet är väldigt stort! " STRING(FILL-IN-SKYLTANT:SCREEN-VALUE) " Är det rätt? " VIEW-AS ALERT-BOX 
               QUESTION BUTTONS YES-NO UPDATE antval1 AS LOGICAL.       
               CASE antval1:
                  WHEN TRUE THEN DO:
                     antval1 = antval1.            
                  END.
                  WHEN FALSE THEN DO:
                     RETURN NO-APPLY.
                  END.   
               END CASE. 
            END.    
            RUN inkopkoll_UI (INPUT 6, OUTPUT musz, OUTPUT antalinkvar).
            IF musz = TRUE THEN DO:            
               musz = FALSE.
               IF DECIMAL(FILL-IN-SKYLTANT:SCREEN-VALUE) < antalinkvar THEN DO:
                  MESSAGE "Ni kan inte andra antalet till lägre än " antalinkvar "! Den är inköpt via inköpsrutinen!"
                  VIEW-AS ALERT-BOX TITLE "Meddelande". 
                  FILL-IN-SKYLTANT:SCREEN-VALUE = STRING(antalinkvar).          
                  RETURN NO-APPLY.
               END.   
            END.
            
            list_mtrl.ANTAL = INTEGER(FILL-IN-SKYLTANT:SCREEN-VALUE).         
         END.
      END.
            
      IF FILL-IN-NSKYLTANT:VISIBLE = TRUE THEN DO:      
         IF FILL-IN-NSKYLTANT:SCREEN-VALUE GE STRING(0) THEN DO:  
            IF Guru.Konstanter:globforetag = "FORS" THEN DO:
               FIND FIRST listbuff WHERE listbuff.NUM = fri_temp.NUM AND listbuff.ENR = "A200" AND 
               listbuff.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
            END.
            ELSE DO:       
               FIND FIRST listbuff WHERE listbuff.NUM = fri_temp.NUM AND listbuff.ENR = "A101" AND 
               listbuff.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
            END.    
            FIND FIRST del_val WHERE del_val.NUM = fri_temp.NUM
            NO-LOCK NO-ERROR.
            IF AVAILABLE del_val THEN DO:            
               IF AVAILABLE listbuff AND listbuff.ANTAL NE INTEGER(FILL-IN-NSKYLTANT:SCREEN-VALUE)  THEN DO:
                  MESSAGE "Ni kan inte ändra antal på skyltar på denna konstruktion då den valda konstruktionen är inköpt via delbeställning"
                  VIEW-AS ALERT-BOX TITLE "Meddelande".
                  IF AVAILABLE list_mtrl THEN DO:
                     FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(listbuff.ANTAL).         
                  END.
                  ELSE FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(0).               
                  APPLY "ENTRY" TO FILL-IN-NSKYLTANT.
                  RETURN NO-APPLY.
               END.
               IF NOT AVAILABLE listbuff THEN DO:
                  MESSAGE "Ni kan inte ändra antal på skyltar på denna konstruktion då den valda konstruktionen är inköpt via delbeställning"
                  VIEW-AS ALERT-BOX TITLE "Meddelande".
                  FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(0).
                  APPLY "ENTRY" TO FILL-IN-NSKYLTANT.
                  RETURN NO-APPLY.
               END.
            END.          
   
            IF NOT AVAILABLE listbuff AND FILL-IN-NSKYLTANT:SCREEN-VALUE > STRING(0) THEN DO:
               IF Guru.Konstanter:globforetag = "FORS" THEN DO:
                  FIND FIRST emtrltemp WHERE emtrltemp.ENR = "A200" AND emtrltemp.LEVKOD = skyltlev NO-LOCK NO-ERROR.
                  IF AVAILABLE emtrltemp THEN DO:
                     CREATE listbuff.
                     ASSIGN
                     listbuff.NUM = fri_temp.NUM
                     listbuff.ENR = "A200"
                     listbuff.BENAMNING = emtrltemp.BENAMNING            
                     listbuff.ENHET = LC(emtrltemp.ENHET)
                     listbuff.PRIS = emtrltemp.NPRIS            
                     listbuff.LINKAB = FALSE
                     listbuff.SKAPNUM = 0
                     listbuff.LEVKOD = skyltlev.
                  END.
                  ELSE DO:            
                     MESSAGE "A200 finns inte upplagd kontakta administratör." VIEW-AS ALERT-BOX TITLE "Meddelande".
                     FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(0).
                     RETURN NO-APPLY.            
                  END.
               END.
               ELSE DO:   
                  FIND FIRST emtrltemp WHERE emtrltemp.ENR = "A101" AND emtrltemp.LEVKOD = skyltlev NO-LOCK NO-ERROR.
                  IF AVAILABLE emtrltemp THEN DO:
                     CREATE listbuff.
                     ASSIGN
                     listbuff.NUM = fri_temp.NUM
                     listbuff.ENR = "A101"
                     listbuff.BENAMNING = emtrltemp.BENAMNING            
                     listbuff.ENHET = LC(emtrltemp.ENHET)
                     listbuff.PRIS = emtrltemp.NPRIS            
                     listbuff.LINKAB = FALSE
                     listbuff.SKAPNUM = 0
                     listbuff.LEVKOD = skyltlev.
                  END.
                  ELSE DO:            
                     MESSAGE "A101 finns inte upplagd kontakta administratör." VIEW-AS ALERT-BOX TITLE "Meddelande".
                     FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(0).
                     RETURN NO-APPLY.            
                  END.
               END.   
            END.
            IF AVAILABLE listbuff THEN DO:
               IF DECIMAL(FILL-IN-NSKYLTANT:SCREEN-VALUE) > 99999 THEN DO:
                  MESSAGE "Antalet är väldigt stort! " STRING(FILL-IN-NSKYLTANT:SCREEN-VALUE) " Är det rätt? " VIEW-AS ALERT-BOX 
                  QUESTION BUTTONS YES-NO UPDATE antval2 AS LOGICAL.       
                  CASE antval1:
                     WHEN TRUE THEN DO:
                        antval2 = antval2.            
                     END.
                     WHEN FALSE THEN DO:
                        RETURN NO-APPLY.
                     END.   
                  END CASE. 
               END.    
               EMPTY TEMP-TABLE elist_mtrl NO-ERROR. 
               CREATE elist_mtrl.
               BUFFER-COPY listbuff  TO elist_mtrl.
               RUN inkopkoll_UI (INPUT 7, OUTPUT musz, OUTPUT antalinkvar).
               IF musz = TRUE THEN DO:            
                  musz = FALSE.
                  IF DECIMAL(FILL-IN-NSKYLTANT:SCREEN-VALUE) < antalinkvar THEN DO:
                     MESSAGE "Ni kan inte andra antalet till lägre än " antalinkvar "! Den är inköpt via inköpsrutinen!"
                     VIEW-AS ALERT-BOX TITLE "Meddelande". 
                     FILL-IN-NSKYLTANT:SCREEN-VALUE = STRING(antalinkvar).          
                     RETURN NO-APPLY.
                  END.   
               END.
               listbuff.ANTAL = INTEGER(FILL-IN-NSKYLTANT:SCREEN-VALUE).
               EMPTY TEMP-TABLE elist_mtrl NO-ERROR. 
            END.            
         END.
      END.
      IF FILL-IN-NISKYLTANT:VISIBLE = TRUE THEN DO:      
         IF FILL-IN-NISKYLTANT:SCREEN-VALUE GE STRING(0) THEN DO:
            IF Guru.Konstanter:globforetag = "FORS" THEN DO:
               FIND FIRST listibuff WHERE listibuff.NUM = fri_temp.NUM AND listibuff.ENR = "A201" AND 
               listibuff.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
            END.
            ELSE DO:         
               FIND FIRST listibuff WHERE listibuff.NUM = fri_temp.NUM AND listibuff.ENR = "A102" AND 
               listibuff.LEVKOD = skyltlev EXCLUSIVE-LOCK NO-ERROR.
            END.   
            FIND FIRST del_val WHERE del_val.NUM = fri_temp.NUM
            NO-LOCK NO-ERROR.
            IF AVAILABLE del_val THEN DO:            
               IF AVAILABLE listibuff AND listibuff.ANTAL NE INTEGER(FILL-IN-NISKYLTANT:SCREEN-VALUE)  THEN DO:
                  MESSAGE "Ni kan inte ändra antal på skyltar på denna konstruktion då den valda konstruktionen är inköpt via delbeställning"
                  VIEW-AS ALERT-BOX TITLE "Meddelande".
                  IF AVAILABLE listibuff THEN DO:
                     FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(listibuff.ANTAL).         
                  END.
                  ELSE FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(0).               
                  APPLY "ENTRY" TO FILL-IN-NISKYLTANT.
                  RETURN NO-APPLY.
               END.
               IF NOT AVAILABLE listibuff  THEN DO:
                  MESSAGE "Ni kan inte ändra antal på skyltar på denna konstruktion då den valda konstruktionen är inköpt via delbeställning"
                  VIEW-AS ALERT-BOX TITLE "Meddelande".
                  FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(0).
                  APPLY "ENTRY" TO FILL-IN-NISKYLTANT.
                  RETURN NO-APPLY.
               END.
            END.             
            IF NOT AVAILABLE listibuff AND FILL-IN-NISKYLTANT:SCREEN-VALUE > STRING(0) THEN DO:
               IF Guru.Konstanter:globforetag = "FORS" THEN DO:
                  FIND FIRST emtrltemp WHERE emtrltemp.ENR = "A201" AND emtrltemp.LEVKOD = skyltlev NO-LOCK NO-ERROR.
                  IF AVAILABLE emtrltemp THEN DO:
                     CREATE listibuff.
                     ASSIGN
                     listibuff.NUM = fri_temp.NUM
                     listibuff.ENR = "A201"
                     listibuff.BENAMNING = emtrltemp.BENAMNING            
                     listibuff.ENHET = LC(emtrltemp.ENHET)
                     listibuff.PRIS = emtrltemp.NPRIS            
                     listibuff.LINKAB = FALSE
                     listibuff.SKAPNUM = 0
                     listibuff.LEVKOD = skyltlev.
                  END.
                  ELSE DO:            
                     MESSAGE "A201 finns inte upplagd kontakta administratör." VIEW-AS ALERT-BOX TITLE "Meddelande".
                     FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(0).
                     RETURN NO-APPLY.            
                  END.
               END.
               ELSE DO:   
                  FIND FIRST emtrltemp WHERE emtrltemp.ENR = "A102" AND emtrltemp.LEVKOD = skyltlev NO-LOCK NO-ERROR.
                  IF AVAILABLE emtrltemp THEN DO:
                     CREATE listibuff.
                     ASSIGN
                     listibuff.NUM = fri_temp.NUM
                     listibuff.ENR = "A102"
                     listibuff.BENAMNING = emtrltemp.BENAMNING            
                     listibuff.ENHET = LC(emtrltemp.ENHET)
                     listibuff.PRIS = emtrltemp.NPRIS            
                     listibuff.LINKAB = FALSE
                     listibuff.SKAPNUM = 0
                     listibuff.LEVKOD = skyltlev.
                  END.
                  ELSE DO:            
                     MESSAGE "A102 finns inte upplagd kontakta administratör." VIEW-AS ALERT-BOX TITLE "Meddelande".
                     FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(0).
                     RETURN NO-APPLY.            
                  END.
               END.
            END.   
            IF AVAILABLE listibuff THEN DO:
               IF DECIMAL(FILL-IN-NISKYLTANT:SCREEN-VALUE) > 99999 THEN DO:
               MESSAGE "Antalet är väldigt stort! " STRING(FILL-IN-NISKYLTANT:SCREEN-VALUE) " Är det rätt? " VIEW-AS ALERT-BOX 
               QUESTION BUTTONS YES-NO UPDATE antval3 AS LOGICAL.       
               CASE antval1:
                  WHEN TRUE THEN DO:
                     antval3 = antval3.            
                  END.
                  WHEN FALSE THEN DO:
                     RETURN NO-APPLY.
                  END.   
               END CASE. 
            END. 
               EMPTY TEMP-TABLE elist_mtrl NO-ERROR. 
               CREATE elist_mtrl.
               BUFFER-COPY listibuff  TO elist_mtrl.
               RUN inkopkoll_UI (INPUT 7, OUTPUT musz, OUTPUT antalinkvar).
               IF musz = TRUE THEN DO:            
                  musz = FALSE.
                  IF DECIMAL(FILL-IN-NISKYLTANT:SCREEN-VALUE) < antalinkvar THEN DO:
                     MESSAGE "Ni kan inte andra antalet till lägre än " antalinkvar "! Den är inköpt via inköpsrutinen!"
                     VIEW-AS ALERT-BOX TITLE "Meddelande". 
                     FILL-IN-NISKYLTANT:SCREEN-VALUE = STRING(antalinkvar).          
                     RETURN NO-APPLY.
                  END.   
               END.
               listibuff.ANTAL = INTEGER(FILL-IN-NISKYLTANT:SCREEN-VALUE).
               EMPTY TEMP-TABLE elist_mtrl NO-ERROR. 
            END.
            
         END.
      END.
      IF CMB_TYP:SCREEN-VALUE = "In" THEN DO:
         ASSIGN
         fri_temp.SAKR = ?
         fri_temp.MAXSAKR = ?.
      END.
      ELSE DO:
         ASSIGN
         fri_temp.SAKR = INTEGER(FILL-IN-SAK:SCREEN-VALUE)
         fri_temp.MAXSAKR = INTEGER(FILL-IN-MAX:SCREEN-VALUE).         
      END.
      RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(fri_temp)).
      FOR EACH fribuff WHERE fribuff.NUM = fri_temp.NUM USE-INDEX NUM:
         ASSIGN
         fribuff.SKAP = FILL-IN-TYP:SCREEN-VALUE
         fribuff.SKAPADR = FILL-IN-SADR:SCREEN-VALUE.
      END.   
      RUN refreshbrw_UI IN brwproc[3].
   END.    
END PROCEDURE.
PROCEDURE spara_UI :
   RUN selectfoc_UI (INPUT 3).
   gam_rec2 = ROWID(fri_temp).
   
   IF kabkortvar = TRUE THEN DO:   
      FIND fri_temp WHERE ROWID(fri_temp) = gam_rec NO-ERROR.       
      IF AVAILABLE fri_temp THEN DO:
         RUN fritempupp_UI.
      END. 
      FIND fri_temp WHERE ROWID(fri_temp) = gam_rec2 NO-LOCK NO-ERROR.
      IF AVAILABLE fri_temp THEN DO:
         RUN setlastrowid_UI IN brwproc[3] (INPUT ROWID(fri_temp)).
         RUN lastselectdyn_UI IN brwproc[3].
      END.    
   END.

END PROCEDURE.
PROCEDURE pselectfoc_UI :
   DEFINE INPUT PARAMETER brwvald AS INTEGER NO-UNDO.
   DEFINE VARIABLE brwrowid AS ROWID NO-UNDO.
   DEFINE VARIABLE brwrecid AS RECID NO-UNDO.
   IF NOT VALID-HANDLE(fri_temph) THEN  fri_temph = TEMP-TABLE fri_temp:DEFAULT-BUFFER-HANDLE.
   IF NOT VALID-HANDLE(apparattemph) THEN  apparattemph = TEMP-TABLE apparattemp:DEFAULT-BUFFER-HANDLE.
   IF NOT VALID-HANDLE(mtrl_tabh) THEN  mtrl_tabh = TEMP-TABLE mtrl_tab:DEFAULT-BUFFER-HANDLE.
   RUN pselectrowid_UI IN brwproc[brwvald] (OUTPUT brwrowid).
   IF brwvald = 1 THEN FIND FIRST apparattemp WHERE ROWID(apparattemp) = brwrowid NO-LOCK NO-ERROR.  
   IF brwvald = 3 THEN FIND FIRST fri_temp WHERE ROWID(fri_temp) = brwrowid NO-LOCK NO-ERROR.  
   IF brwvald = 4 THEN FIND FIRST mtrl_tab WHERE ROWID(mtrl_tab) = brwrowid NO-LOCK NO-ERROR.  
END PROCEDURE.
PROCEDURE nselectfoc_UI :
   DEFINE INPUT PARAMETER brwvald AS INTEGER NO-UNDO.
   DEFINE VARIABLE brwrowid AS ROWID NO-UNDO.
   DEFINE VARIABLE brwrecid AS RECID NO-UNDO.
   IF NOT VALID-HANDLE(fri_temph) THEN  fri_temph = TEMP-TABLE fri_temp:DEFAULT-BUFFER-HANDLE.
   IF NOT VALID-HANDLE(apparattemph) THEN  apparattemph = TEMP-TABLE apparattemp:DEFAULT-BUFFER-HANDLE.
   IF NOT VALID-HANDLE(mtrl_tabh) THEN  mtrl_tabh = TEMP-TABLE mtrl_tab:DEFAULT-BUFFER-HANDLE.
   RUN nselectrowid_UI IN brwproc[brwvald] (OUTPUT brwrowid).
   IF brwvald = 1 THEN FIND FIRST apparattemp WHERE ROWID(apparattemp) = brwrowid NO-LOCK NO-ERROR.  
   IF brwvald = 3 THEN FIND FIRST fri_temp WHERE ROWID(fri_temp) = brwrowid NO-LOCK NO-ERROR.  
   IF brwvald = 4 THEN FIND FIRST mtrl_tab WHERE ROWID(mtrl_tab) = brwrowid NO-LOCK NO-ERROR.  
END PROCEDURE.
PROCEDURE selectfoc_UI :
   DEFINE INPUT PARAMETER brwvald AS INTEGER NO-UNDO.
   DEFINE VARIABLE brwrowid AS ROWID NO-UNDO.      
   IF NOT VALID-HANDLE(fri_temph) THEN  fri_temph = TEMP-TABLE fri_temp:DEFAULT-BUFFER-HANDLE.
   IF NOT VALID-HANDLE(apparattemph) THEN  apparattemph = TEMP-TABLE apparattemp:DEFAULT-BUFFER-HANDLE.
   IF NOT VALID-HANDLE(mtrl_tabh) THEN  mtrl_tabh = TEMP-TABLE mtrl_tab:DEFAULT-BUFFER-HANDLE.
   RUN selectrowid_UI IN brwproc[brwvald] (OUTPUT brwrowid).
   IF brwvald = 1 THEN FIND FIRST apparattemp WHERE ROWID(apparattemp) = brwrowid NO-LOCK NO-ERROR.  
   IF brwvald = 3 THEN FIND FIRST fri_temp WHERE ROWID(fri_temp) = brwrowid NO-LOCK NO-ERROR.  
   IF brwvald = 4 THEN FIND FIRST mtrl_tab WHERE ROWID(mtrl_tab) = brwrowid NO-LOCK NO-ERROR.  
END PROCEDURE.

PROCEDURE allstartbrw_UI :
   IF NOT VALID-HANDLE(brwproc[1]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[1] (INPUT BRW_APP).   
   IF NOT VALID-HANDLE(brwproc[3]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[3] (INPUT BRW_KAB).
   IF NOT VALID-HANDLE(brwproc[4]) THEN RUN DYNBRW.P PERSISTENT SET brwproc[4] (INPUT BRW_MTRL).  
   RUN mouseselclick_UI IN brwproc[3] (INPUT FALSE).   
   RUN setcolindex_UI IN brwproc[3] (INPUT "NUM BY KABNR").     
   {OMSTARTAVGURUO.I}
   {OMSTARTAVGURUBER.I}
   IF NOT VALID-HANDLE(frikortapph) THEN DO:      
      IF Guru.Konstanter:appcon THEN DO:
         RUN FRIKORTAPP.P PERSISTENT SET frikortapph ON Guru.Konstanter:apphand TRANSACTION DISTINCT. 
      END.
      ELSE DO:
         RUN FRIKORTAPP.P PERSISTENT SET frikortapph.
      END. 
   END.
END PROCEDURE.

PROCEDURE btnok_UI :
   APPLY "VALUE-CHANGED" TO BRW_KAB.   
   FIND FIRST kon_val WHERE ROWID(kon_val) = kon_rowid NO-LOCK NO-ERROR.
   FIND FIRST kon_id WHERE kon_id.NUM = kon_val.NUM NO-LOCK NO-ERROR.
   lin_rowid = ROWID(kon_id).                  
   IF musz = TRUE THEN musz = FALSE.   
   ASSIGN    
   skrivut = FALSE.   
   MESSAGE "Vill du ha liggande format?" VIEW-AS ALERT-BOX
   QUESTION BUTTONS YES-NO TITLE "Liggande/Stående?" UPDATE liggande.            
   {AVBGOM2.I}
   RUN VFRIKORTU.W.
   {AVBFRAM2.I} 
   {musarrow.i}   
END PROCEDURE.

PROCEDURE mtrl2_UI :
   FIND FIRST mtrl_tab WHERE mtrl_tab.BENAMNING = list_mtrl.BENAMNING 
   NO-LOCK NO-ERROR.
   IF NOT AVAILABLE mtrl_tab THEN DO:
      CREATE mtrl_tab.
      ASSIGN
      mtrl_tab.BENAMNING = list_mtrl.BENAMNING.
   END.   
END PROCEDURE.

PROCEDURE mtrl_UI :
   FOR EACH berskaptemp WHERE berskaptemp.ENR = "" NO-LOCK:
      CREATE mtrl_tab.
      ASSIGN
      mtrl_tab.BENAMNING = berskaptemp.BENAMNING.
   END.

END PROCEDURE.

PROCEDURE inkopkoll_UI :
/* -----------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
-------------------------------------------------------------*/  
  {INKOLLFINNS.I}              
END PROCEDURE.

PROCEDURE sakr_UI :
   DEFINE INPUT PARAMETER skring AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER sakstor AS INTEGER NO-UNDO.
   /*sÄKRING*/
   IF TRIM(skring) BEGINS "00/25A" THEN sakstor = 25.
   ELSE IF TRIM(skring) BEGINS "00/10A" THEN sakstor = 10.
   ELSE IF TRIM(skring) BEGINS "000/35" THEN sakstor = 35.
   ELSE IF TRIM(skring) BEGINS "000/50A" THEN sakstor = 50.
   ELSE IF TRIM(skring) BEGINS "000/63A" THEN sakstor = 63.
   ELSE IF TRIM(skring) BEGINS "00/35" THEN sakstor = 35.
   ELSE IF TRIM(skring) BEGINS "00/50A" THEN sakstor = 50.
   ELSE IF TRIM(skring) BEGINS "00/63A" THEN sakstor = 63.
   ELSE IF TRIM(skring) BEGINS "00/80A" THEN sakstor = 80.
   ELSE IF TRIM(skring) BEGINS "00/100A" THEN sakstor = 100.
   ELSE IF TRIM(skring) BEGINS "00/125A" THEN sakstor = 125.
   ELSE IF TRIM(skring) BEGINS "00/160A" THEN sakstor = 160.
   
   ELSE IF TRIM(skring) BEGINS "0/ 50A" THEN sakstor = 50.
   ELSE IF TRIM(skring) BEGINS "0/ 63A" THEN sakstor = 63.
   ELSE IF TRIM(skring) BEGINS "0/ 80A" THEN sakstor = 80.
   ELSE IF TRIM(skring) BEGINS "0/100A" THEN sakstor = 100.
   ELSE IF TRIM(skring) BEGINS "0/125A" THEN sakstor = 125.
   ELSE IF TRIM(skring) BEGINS "0/160A" THEN sakstor = 160.
   ELSE IF TRIM(skring) BEGINS "0/200A" THEN sakstor = 200.
   ELSE IF TRIM(skring) BEGINS "0/250A" THEN sakstor	= 250.
   
   ELSE IF TRIM(skring) BEGINS "1/35A" THEN sakstor = 35.
   ELSE IF TRIM(skring) BEGINS "1/50A" THEN sakstor = 50.
   ELSE IF TRIM(skring) BEGINS "1/63A" THEN sakstor = 63.
   ELSE IF TRIM(skring) BEGINS "1/80A" THEN sakstor = 80.
   ELSE IF TRIM(skring) BEGINS "1/100A" THEN sakstor = 100.
   ELSE IF TRIM(skring) BEGINS "1/125A" THEN sakstor = 125.
   ELSE IF TRIM(skring) BEGINS "1/160A" THEN sakstor = 160.
   ELSE IF TRIM(skring) BEGINS "1/200A" THEN sakstor = 200.
   ELSE IF TRIM(skring) BEGINS "1/250A" THEN sakstor = 250.
   ELSE IF TRIM(skring) BEGINS "1/315A" THEN sakstor = 315.
   ELSE IF TRIM(skring) BEGINS "1/355A" THEN sakstor = 355.

   
   ELSE IF TRIM(skring) BEGINS "2/35" THEN sakstor = 35.	
   ELSE IF TRIM(skring) BEGINS "2/50" THEN sakstor = 50.	
   ELSE IF TRIM(skring) BEGINS "2/63" THEN sakstor = 63.	
   ELSE IF TRIM(skring) BEGINS "2/80" THEN sakstor = 80.
   ELSE IF TRIM(skring) BEGINS "2/100" THEN sakstor = 100.
   ELSE IF TRIM(skring) BEGINS "2/125" THEN sakstor = 125.
   ELSE IF TRIM(skring) BEGINS "2/160" THEN sakstor = 160.
   ELSE IF TRIM(skring) BEGINS "2/200" THEN sakstor = 200.
   ELSE IF TRIM(skring) BEGINS "2/224" THEN sakstor = 224.
   ELSE IF TRIM(skring) BEGINS "2/250" THEN sakstor = 250.
   ELSE IF TRIM(skring) BEGINS "2/300" THEN sakstor = 300.	
   ELSE IF TRIM(skring) BEGINS "2/315" THEN sakstor = 315.
   ELSE IF TRIM(skring) BEGINS "2/355" THEN sakstor = 355.
   ELSE IF TRIM(skring) BEGINS "2/400" THEN sakstor = 400.
   
   ELSE IF TRIM(skring) BEGINS "DII/16A" THEN sakstor = 16.
   ELSE IF TRIM(skring) BEGINS "DII/20A." THEN sakstor = 20.	
   ELSE IF TRIM(skring) BEGINS "DII/25A" THEN sakstor = 25.
   ELSE IF TRIM(skring) BEGINS "DII/35A" THEN sakstor = 35.
   ELSE IF TRIM(skring) BEGINS "DIII/35A" THEN sakstor = 35.
   ELSE IF TRIM(skring) BEGINS "DII/50A" THEN sakstor = 50.
   ELSE IF TRIM(skring) BEGINS "DII/63A" THEN sakstor = 63.
   ELSE IF TRIM(skring) BEGINS "DIII/50A" THEN sakstor = 50.
   ELSE IF TRIM(skring) BEGINS "DIII/63A" THEN sakstor = 63.   

   ELSE IF TRIM(skring) BEGINS "C 00/6A" THEN sakstor	= 6.
   ELSE IF TRIM(skring) BEGINS "C 00/10A" THEN sakstor = 10.	
   ELSE IF TRIM(skring) BEGINS "C 00/16A" THEN sakstor = 16.	
   ELSE IF TRIM(skring) BEGINS "C 00/20A" THEN sakstor = 20.	
   ELSE IF TRIM(skring) BEGINS "C 00/25A" THEN sakstor = 25.	
   ELSE IF TRIM(skring) BEGINS "C 00/32A" THEN sakstor = 32.	
   ELSE IF TRIM(skring) BEGINS "C 00/35A" THEN sakstor = 35.	
   ELSE IF TRIM(skring) BEGINS "C 00/40A" THEN sakstor = 40.	
   ELSE IF TRIM(skring) BEGINS "C 00/50A" THEN sakstor = 50.	
   ELSE IF TRIM(skring) BEGINS "C 00/63A" THEN sakstor = 63.	
   ELSE IF TRIM(skring) BEGINS "C 00/80A" THEN sakstor = 80.	
   ELSE IF TRIM(skring) BEGINS "C 00/100" THEN sakstor = 100.
   
   
   ELSE IF TRIM(skring) BEGINS "C00/10A" THEN sakstor = 10.   
   ELSE IF TRIM(skring) BEGINS "C00/16" THEN sakstor = 16.        
   ELSE IF TRIM(skring) BEGINS "C00/25" THEN sakstor = 25.   
   ELSE IF TRIM(skring) BEGINS "C00/35" THEN sakstor = 35.   
   ELSE IF TRIM(skring) BEGINS "C00/40" THEN sakstor = 40.   
   ELSE IF TRIM(skring) BEGINS "C00/50" THEN sakstor = 50.   
   ELSE IF TRIM(skring) BEGINS "C00/63" THEN sakstor = 63.   
   ELSE IF TRIM(skring) BEGINS "C00/80A" THEN sakstor = 80.   
   ELSE IF TRIM(skring) BEGINS "C00/100" THEN sakstor = 100. 	
END PROCEDURE.

PROCEDURE borthandE_UI :
   DEFINE VARIABLE i AS INTEGER NO-UNDO INITIAL 1.
   DO WHILE i LE 25:
      IF VALID-HANDLE(brwproc[i]) THEN DELETE PROCEDURE brwproc[i] NO-ERROR.
      brwproc[i] = ?.
      i = i + 1.
   END.
END PROCEDURE.
PROCEDURE borthand_UI :
   apparattemph:EMPTY-TEMP-TABLE() NO-ERROR.
   mtrl_tabh:EMPTY-TEMP-TABLE() NO-ERROR.
   fri_temph:EMPTY-TEMP-TABLE() NO-ERROR.
   IF VALID-HANDLE(mtrl_tabh) THEN   DELETE OBJECT mtrl_tabh  NO-ERROR.
   IF VALID-HANDLE(apparattemph) THEN   DELETE OBJECT apparattemph  NO-ERROR.
   IF VALID-HANDLE(fri_temph) THEN   DELETE OBJECT fri_temph  NO-ERROR.
   IF VALID-HANDLE(frikortapph) THEN DELETE PROCEDURE frikortapph.
   ASSIGN
   mtrl_tabh = ?
   apparattemph = ?
   fri_temph  = ?.     
   {BORTBRWPROC.I}   
   
END PROCEDURE.
