/*VIFAKAPP.P*/
&Scoped-define NEW NEW
{GLOBVAR2DEL1.I}

FIND FIRST FORETAG NO-LOCK NO-ERROR.
Guru.Konstanter:globforetag = FORETAG.FORETAG.
RUN STYRFORE.P (INPUT Guru.Konstanter:globforetag).
&Scoped-define NEW NEW                          
{FAKTTEMP.I}
{FAKTTYPDEF.I}
&Scoped-define NEW 
{FAKTTYPSKAP.I}
{FAKTBILAG.I}
{TIDUTTTNEW.I}

DEFINE INPUT PARAMETER infaktnr LIKE FAKTPLAN.FAKTNR NO-UNDO.
DEFINE INPUT PARAMETER vfknr LIKE FAKTURERAD.VFAKTNR NO-UNDO.
DEFINE INPUT PARAMETER skrivutalla AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER direkt AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER fakkredrec AS RECID NO-UNDO.
DEFINE INPUT PARAMETER TABLE FOR fakbilag.
DEFINE INPUT PARAMETER TABLE FOR sumtidtemp.
DEFINE OUTPUT PARAMETER TABLE FOR tidut.
DEFINE NEW SHARED VARIABLE musz AS LOGICAL NO-UNDO.
DEFINE NEW SHARED VARIABLE faktrec AS RECID NO-UNDO.
DEFINE VARIABLE betvar AS DECIMAL NO-UNDO.
DEFINE VARIABLE fnrvar AS CHARACTER NO-UNDO.
DEFINE VARIABLE vartyp AS INTEGER NO-UNDO.
DEFINE VARIABLE varcolon AS INTEGER NO-UNDO.
DEFINE VARIABLE str AS CHARACTER FORMAT "X(80)" NO-UNDO.   
DEFINE VARIABLE momsumma AS DECIMAL NO-UNDO.
DEFINE VARIABLE momshlpvar AS CHARACTER NO-UNDO.
DEFINE VARIABLE varfakturd AS DATE NO-UNDO.
DEFINE VARIABLE varforfalld AS DATE NO-UNDO.

{ANMARKD.I}
FIND FAKTPLAN WHERE FAKTPLAN.FAKTNR = infaktnr NO-LOCK NO-ERROR.
faktrec = RECID(FAKTPLAN).
IF skrivutalla = TRUE THEN DO:
   FIND FIRST FAKTKRED WHERE FAKTKRED.FAKTNR = FAKTPLAN.FAKTNR
   USE-INDEX FAKTNR NO-LOCK.            
END.    
ELSE DO:         
   FIND FAKTKRED WHERE RECID(FAKTKRED) = fakkredrec NO-LOCK NO-ERROR.      
   IF direkt = FALSE THEN DO:
      RUN tidhamt_UI.   
   END.
END.

{VIFAKAPPA.I}
