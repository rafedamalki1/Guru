/*DUMPBER3.P
PROGRAMMET DUMPAR UT EN VALD BEREDNING*/

DEFINE VARIABLE valaonr AS CHARACTER NO-UNDO.
DEFINE VARIABLE valomrade AS CHARACTER NO-UNDO.
DEFINE VARIABLE bloblog AS LOGICAL NO-UNDO.
DEFINE VARIABLE expimphdh AS HANDLE NO-UNDO.   
ASSIGN
valaonr = "1314"
valomrade = "TEmö".
{AMERICANEUROPEAN.I}
OUTPUT TO berednin.d convert target "iso8859-1" source "iso8859-1".   
OPEN QUERY bq FOR EACH BEREDNING WHERE BEREDNING.BERAONR = valaonr AND
BEREDNING.OMRADE = valomrade NO-LOCK.
GET FIRST bq NO-LOCK.
DO WHILE AVAILABLE(BEREDNING):
   EXPORT BEREDNING.
   GET NEXT bq NO-LOCK.
END.
CLOSE QUERY bq.
OUTPUT CLOSE.
   
OUTPUT TO berval.d convert target "iso8859-1" source "iso8859-1".   
OPEN QUERY kq FOR EACH BERVAL WHERE BERVAL.AONR = valaonr AND
BERVAL.OMRADE = valomrade NO-LOCK.
GET FIRST kq NO-LOCK.
DO WHILE AVAILABLE(BERVAL):
   EXPORT BERVAL.
   GET NEXT kq NO-LOCK.
END.
CLOSE QUERY kq.
OUTPUT CLOSE.
   
OUTPUT TO berord.d convert target "iso8859-1" source "iso8859-1".   
OPEN QUERY ordq FOR EACH BERORD WHERE BERORD.AONR = valaonr AND
BERORD.OMRADE = valomrade USE-INDEX ORD NO-LOCK.
GET FIRST ordq NO-LOCK.
DO WHILE AVAILABLE(BERORD):
   EXPORT BERORD.
   GET NEXT ordq NO-LOCK.
END.
CLOSE QUERY ordq.
OUTPUT CLOSE.

OUTPUT TO frikort.d convert target "iso8859-1" source "iso8859-1".
OPEN QUERY friq FOR EACH FRIKORT WHERE FRIKORT.AONR = valaonr AND
FRIKORT.OMRADE = valomrade USE-INDEX OMR NO-LOCK.
GET FIRST friq NO-LOCK.
DO WHILE AVAILABLE(FRIKORT):
   EXPORT FRIKORT.
   GET NEXT friq NO-LOCK.
END.
CLOSE QUERY friq.
OUTPUT CLOSE.

OUTPUT TO berid.d convert target "iso8859-1" source "iso8859-1".
OPEN QUERY berqid FOR EACH BERID WHERE BERID.AONR = valaonr AND
BERID.OMRADE = valomrade USE-INDEX OMR NO-LOCK.
GET FIRST berqid NO-LOCK.
DO WHILE AVAILABLE(BERID):
   EXPORT BERID.
   GET NEXT berqid NO-LOCK.
END.
CLOSE QUERY berqid.
OUTPUT CLOSE.
/*HD HÄR*/
OUTPUT TO berkalk.d convert target "iso8859-1" source "iso8859-1".  
OPEN QUERY berqkal FOR EACH BERKALK WHERE BERKALK.AONR = valaonr AND
BERKALK.OMRADE = valomrade USE-INDEX OMR NO-LOCK.
GET FIRST berqkal NO-LOCK.
DO WHILE AVAILABLE(BERKALK):
   EXPORT BERKALK.
   GET NEXT berqkal NO-LOCK.
END.
CLOSE QUERY berqkal.
OUTPUT CLOSE.
    
OUTPUT TO bermtrl.d convert target "iso8859-1" source "iso8859-1".  
OPEN QUERY berqmtrl FOR EACH BERMTRL WHERE BERMTRL.AONR = valaonr AND
BERMTRL.OMRADE = valomrade USE-INDEX OMR NO-LOCK.
GET FIRST berqmtrl NO-LOCK.
DO WHILE AVAILABLE(BERMTRL):
   EXPORT BERMTRL.      
   GET NEXT berqmtrl NO-LOCK.
END.
CLOSE QUERY berqmtrl. 
OUTPUT CLOSE.
   
OUTPUT TO berlink.d convert target "iso8859-1" source "iso8859-1".   
OPEN QUERY berqlin FOR EACH BERLINKAB WHERE BERLINKAB.AONR = valaonr AND
BERLINKAB.OMRADE = valomrade USE-INDEX OMR NO-LOCK.
GET FIRST berqlin NO-LOCK.
DO WHILE AVAILABLE(BERLINKAB):
   EXPORT BERLINKAB.
   GET NEXT berqlin NO-LOCK.
END.
CLOSE QUERY berqlin.
OUTPUT CLOSE.

OUTPUT TO kskydd.d convert target "iso8859-1" source "iso8859-1".
OPEN QUERY berqskydd FOR EACH KSKYDD WHERE KSKYDD.AONR = valaonr AND
KSKYDD.OMRADE = valomrade AND KSKYDD.BERED = TRUE
USE-INDEX OMR NO-LOCK.
GET FIRST berqskydd NO-LOCK.
DO WHILE AVAILABLE(KSKYDD):
   EXPORT KSKYDD.
   GET NEXT berqskydd NO-LOCK.
END.
CLOSE QUERY berqskydd.   
OUTPUT CLOSE.

OUTPUT TO berupp.d convert target "iso8859-1" source "iso8859-1".
OPEN QUERY uppq FOR EACH BERUPP WHERE BERUPP.AONR = valaonr AND
BERUPP.OMRADE = valomrade NO-LOCK.
GET FIRST uppq NO-LOCK.
DO WHILE AVAILABLE(BERUPP):
   EXPORT BERUPP.
   GET NEXT uppq NO-LOCK.
END.
CLOSE QUERY uppq.
OUTPUT CLOSE.
 
/*HD HÄR*/

RUN FINNSTABELL.P (INPUT "HDKALK", OUTPUT bloblog).
IF bloblog = TRUE THEN DO:
   RUN EXPIMPHD.P PERSISTENT SET expimphdh.
   RUN hddump_UI (INPUT INTEGER(valaonr), INPUT valomrade).
   IF VALID-HANDLE(expimphdh) THEN DELETE PROCEDURE expimphdh NO-ERROR.   
END. 
{EUROPEANAMERICAN.I}