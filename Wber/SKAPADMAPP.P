  /*SKAPADMAPP.P*/
{BERSKAP.I}

DEFINE QUERY sok FOR MTRL.
DEFINE QUERY skapq FOR BERSKAP.

DEFINE BUFFER skapbuff FOR BERSKAP.

PROCEDURE laddaberskapen_UI:
   DEFINE INPUT PARAMETER ktypkodvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER kodvar AS CHARACTER NO-UNDO.
   DEFINE OUTPUT PARAMETER TABLE FOR berskaptemp.
   EMPTY TEMP-TABLE berskaptemp NO-ERROR. 
   FOR EACH BERSKAP WHERE BERSKAP.KTYPKOD = ktypkodvar AND BERSKAP.KOD = kodvar NO-LOCK:
      CREATE berskaptemp.
      BUFFER-COPY BERSKAP TO berskaptemp.
      ASSIGN berskaptemp.BERSKAPROW = ROWID(BERSKAP).   
   END.
   RETURN.
END PROCEDURE.


PROCEDURE laddaberskap_UI:
   DEFINE OUTPUT PARAMETER TABLE FOR berskaptemp.
   EMPTY TEMP-TABLE berskaptemp NO-ERROR. 
   OPEN QUERY bq FOR EACH BERSKAP NO-LOCK.
   GET FIRST bq NO-LOCK.
   DO WHILE AVAILABLE(BERSKAP):
      CREATE berskaptemp.
      BUFFER-COPY BERSKAP TO berskaptemp.
      ASSIGN berskaptemp.BERSKAPROW = ROWID(BERSKAP).
      GET NEXT bq NO-LOCK.
   END.
   CLOSE QUERY bq.
   RETURN.
END PROCEDURE.

PROCEDURE bortber_UI :
   DEFINE INPUT PARAMETER enrvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER ktypkodvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER kodvar AS CHARACTER NO-UNDO.
   DEFINE INPUT PARAMETER skap_row AS ROWID NO-UNDO.
   OPEN QUERY bq FOR EACH skapbuff WHERE skapbuff.KTYPKOD = ktypkodvar AND
   skapbuff.KOD = kodvar AND skapbuff.ENR NE "" NO-LOCK.
   GET FIRST bq NO-LOCK.
   DO WHILE AVAILABLE(skapbuff):
      DO TRANSACTION:
         GET CURRENT bq EXCLUSIVE-LOCK.
         DELETE skapbuff.
      END.
      GET NEXT bq NO-LOCK.
   END.
   CLOSE QUERY bq.
   DO TRANSACTION:
      FIND FIRST BERSKAP WHERE ROWID(BERSKAP) = skap_row EXCLUSIVE-LOCK NO-ERROR.
      IF AVAILABLE BERSKAP THEN DO:
         DELETE BERSKAP.  
      END.
   END.
   RETURN.
END PROCEDURE.
