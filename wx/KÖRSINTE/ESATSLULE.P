OPEN QUERY mq FOR EACH MTRL WHERE MTRL.LEVKOD = "5" AND MTRL.KALKNR = 0 NO-LOCK.
DO  TRANSACTION:
   GET FIRST mq EXCLUSIVE-LOCK.   
   MTRL.ENR = SUBSTRING(MTRL.ENR,2).   
END.
REPEAT:
   DO TRANSACTION:
      GET NEXT mq EXCLUSIVE-LOCK.
      IF AVAILABLE MTRL THEN DO:         
         MTRL.ENR = SUBSTRING(MTRL.ENR,2).         
      END.
      ELSE LEAVE.
   END.
END.
CLOSE QUERY mq.

OPEN QUERY SQ FOR EACH SATS WHERE SATS.LEVKOD = "5"  NO-LOCK.
DO  TRANSACTION:
   GET FIRST SQ EXCLUSIVE-LOCK.
   SATS.KOD = SUBSTRING(SATS.KOD,2).
   SATS.ENR = SUBSTRING(SATS.ENR,2).
   SATS.ENR2 = SUBSTRING(SATS.ENR2,2).
END.
REPEAT:
   DO TRANSACTION:
      GET NEXT SQ EXCLUSIVE-LOCK.
      IF AVAILABLE SATS THEN DO:
         SATS.KOD = SUBSTRING(SATS.KOD,2).
         SATS.ENR = SUBSTRING(SATS.ENR,2).
         SATS.ENR2 = SUBSTRING(SATS.ENR2,2).
      END.
      ELSE LEAVE.
   END.
END.
CLOSE QUERY SQ.

