
/*------------------------------------------------------------------------
    File        : SWECOPICAB.P
    Purpose     : 

    Syntax      :

    Description : 

    Author(s)   : 
    Created     : Tue Jun 03 11:01:17 CEST 2014
    Notes       :
  ----------------------------------------------------------------------*/
DEFINE INPUT  PARAMETER vad AS INTEGER NO-UNDO.
IF vad = 1 THEN RUN ALLMANBYT.P (INPUT "OMRaDE", INPUT "GATUADR",INPUT "OMRADETAB").

/*BYT SEDAN MANUELLT PÅ OMRADETAB*/
/* ***************************  Definitions  ************************** */

{DYNTTDUMP.I}

DEFINE VARIABLE ttbuffh AS HANDLE NO-UNDO.
DEFINE VARIABLE tthandle AS HANDLE NO-UNDO.

   




/*tabeller aonr
AONRTABB
KOSTREG
KALKAONR
AONRKONTKOD
AONRTIDLAGE
AOTIDLKOPP
EXTRAKOPPLINGAR
"FBAONR" "INTAONR" AOTIDPERS AODAGBOK

*/

CREATE tabnamn.
tabnamn.NAMN = "AONRTAB".
CREATE tabnamn.
tabnamn.NAMN = "KOSTREG".
CREATE tabnamn.
tabnamn.NAMN = "KALKAONR".
CREATE tabnamn.
tabnamn.NAMN = "AONRKONTKOD".
CREATE tabnamn.
tabnamn.NAMN = "AONRTIDLAGE".
CREATE tabnamn.
tabnamn.NAMN = "AOTIDLKOPP".
/*tabeller tidlagen
TIDSLAGEN.IDTIDLAG BYGGLOV SÖKT, PROJEKT ÖVERLÄMNAT
*/
CREATE tabnamn.
tabnamn.NAMN = "TIDSLAGEN".                       
tabnamn.WHEREFRASE = "WHERE TIDSLAGEN.IDTIDLAG = 'Bygglov sökt'".
CREATE tabnamn.
tabnamn.NAMN = "TIDSLAGEN".
tabnamn.WHEREFRASE = "WHERE TIDSLAGEN.IDTIDLAG = 'PROJEKT ÖVERLÄMNAT'".
/*TABELLER BESTÄLLARE 
BESTTAB
KUNDBEF
KUNDREGLER
KUNDOVER
KUNDPRISLIST

*/


CREATE tabnamn.
tabnamn.NAMN = "BESTTAB".
tabnamn.WHEREFRASE = "WHERE BESTTAB.BESTID NE 'vattenfall'".
CREATE tabnamn.
tabnamn.NAMN = "KUNDBEF".

CREATE tabnamn.
tabnamn.NAMN = "KUNDREGLER".

CREATE tabnamn.
tabnamn.NAMN = "KUNDOVER".
CREATE tabnamn.
tabnamn.NAMN = "KUNDPRISLIST".

/*tabeller kalkyl
KALKSPEC 
KALKYL 
FASTSPEC 
FASTKALK 
FAKTOR 
KALKUPP 
KALKFOR 
KALKKUND 
KALKNATT
KALKBEF
KALKPASLAG

MTRL.KALKNR = KALKSPEC.KALKNR
MTRL.KALKNR = FASTSPEC.KALKNR

EXTRADATA
"FRIKALK2" "DOKALKYL"
*/
CREATE tabnamn.
tabnamn.NAMN = "KALKSPEC".
CREATE tabnamn.
tabnamn.NAMN = "KALKYL".
CREATE tabnamn.
tabnamn.NAMN = "FASTSPEC".
CREATE tabnamn.
tabnamn.NAMN = "FASTKALK".
CREATE tabnamn.
tabnamn.NAMN = "FAKTOR".
CREATE tabnamn.
tabnamn.NAMN = "KALKUPP".
CREATE tabnamn.
tabnamn.NAMN = "KALKFOR".
CREATE tabnamn.
tabnamn.NAMN = "KALKKUND".
CREATE tabnamn.
tabnamn.NAMN = "KALKNATT".
CREATE tabnamn.
tabnamn.NAMN = "KALKBEF".
CREATE tabnamn.
tabnamn.NAMN = "KALKPASLAG".
IF vad = 2 THEN DO:
   FOR EACH KALKSPEC WHERE NO-LOCK:
      CREATE tabnamn.
      tabnamn.NAMN = "MTRL".
      tabnamn.WHEREFRASE = "WHERE MTRL.KALKNR = " + STRING(KALKSPEC.KALKNR).
   END.
   FOR EACH FASTSPEC WHERE NO-LOCK:
      CREATE tabnamn.
      tabnamn.NAMN = "MTRL".
      tabnamn.WHEREFRASE = "WHERE MTRL.KALKNR = " + STRING(FASTSPEC.KALKNR).
   END.
END.
CREATE tabnamn.
tabnamn.NAMN = "EXTRADATA".
tabnamn.WHEREFRASE = "WHERE EXTRADATA.PROGRAM = 'FRIKALK2'".
CREATE tabnamn.
tabnamn.NAMN = "EXTRADATA".
tabnamn.WHEREFRASE = "WHERE EXTRADATA.PROGRAM = 'DOKALKYL'".
CREATE tabnamn.
tabnamn.NAMN = "EXTRADATA".
tabnamn.WHEREFRASE = "WHERE EXTRADATA.PROGRAM = 'BESTEPOST'".
CREATE tabnamn.
tabnamn.NAMN = "EXTRADATA".
tabnamn.WHEREFRASE = "WHERE EXTRADATA.PROGRAM = 'BESTEPOST2'".
CREATE tabnamn.
tabnamn.NAMN = "EXTRAKOPPLINGAR".
tabnamn.WHEREFRASE = "WHERE EXTRAKOPPLINGAR.PROGRAM = 'FBAONR'". 
CREATE tabnamn.
tabnamn.NAMN = "EXTRAKOPPLINGAR".
tabnamn.WHEREFRASE = "WHERE EXTRAKOPPLINGAR.PROGRAM = 'INTAONR'".

CREATE tabnamn.
tabnamn.NAMN = "EXTRAKOPPLINGAR".
tabnamn.WHEREFRASE = "WHERE EXTRAKOPPLINGAR.PROGRAM = 'AOTIDPERS'".

CREATE tabnamn.
tabnamn.NAMN = "EXTRAKOPPLINGAR".
tabnamn.WHEREFRASE = "WHERE EXTRAKOPPLINGAR.PROGRAM = 'AODAGBOK'".
/*tabeller beredning
BEREDNING
BERVAL
BERORD
FRIKORT
BERID
BERID2
BERKALK
BERMTRL
BERLINKAB
KSKYDD
BERUPP
inextrakopptemp.PROGRAM = "AOBERSING"
inextrakopptemp.PROGRAM = "MARKSTN" 
inextrakopptemp.PROGRAM = "KALKBER"
HDPUNKT
HDSCHAKTFOR
HDSCHAKT
HDKABELLINJE
HDFORLKAB
HDFORLSAM
HDPROTKOPPBER
HDSCHAKTKALKSPEC
HDSCHAKTPROT
HDSCHAKTPROTHAND
KALKBEFB
HDKALK
INKADRESS
INKBER
INKMTRL
*/
CREATE tabnamn.
tabnamn.NAMN = "BEREDNING".

CREATE tabnamn.
tabnamn.NAMN = "BERVAL".

CREATE tabnamn.
tabnamn.NAMN = "BERORD".

CREATE tabnamn.
tabnamn.NAMN = "FRIKORT".

CREATE tabnamn.
tabnamn.NAMN = "BERID".

CREATE tabnamn.
tabnamn.NAMN = "BERID2".

CREATE tabnamn.
tabnamn.NAMN = "BERKALK".

CREATE tabnamn.
tabnamn.NAMN = "BERMTRL".

CREATE tabnamn.
tabnamn.NAMN = "BERLINKAB".

CREATE tabnamn.
tabnamn.NAMN = "KSKYDD".

CREATE tabnamn.
tabnamn.NAMN = "BERUPP".

CREATE tabnamn.
tabnamn.NAMN = "EXTRAKOPPLINGAR".
tabnamn.WHEREFRASE = "WHERE EXTRAKOPPLINGAR.PROGRAM = 'AOBERSING'".
CREATE tabnamn.
tabnamn.NAMN = "EXTRAKOPPLINGAR".
tabnamn.WHEREFRASE = "WHERE EXTRAKOPPLINGAR.PROGRAM = 'MARKSTN'".
CREATE tabnamn.
tabnamn.NAMN = "EXTRAKOPPLINGAR".
tabnamn.WHEREFRASE = "WHERE EXTRAKOPPLINGAR.PROGRAM = 'KALKBER'".


CREATE tabnamn.
tabnamn.NAMN = "HDPUNKT".

CREATE tabnamn.
tabnamn.NAMN = "HDSCHAKTFOR".

CREATE tabnamn.
tabnamn.NAMN = "HDSCHAKT".

CREATE tabnamn.
tabnamn.NAMN = "HDKABELLINJE".

CREATE tabnamn.
tabnamn.NAMN = "HDFORLKAB".

CREATE tabnamn.
tabnamn.NAMN = "HDFORLSAM".

CREATE tabnamn.
tabnamn.NAMN = "HDPROTKOPPBER".

CREATE tabnamn.
tabnamn.NAMN = "HDSCHAKTKALKSPEC".

CREATE tabnamn.
tabnamn.NAMN = "HDSCHAKTPROT".

CREATE tabnamn.
tabnamn.NAMN = "HDSCHAKTPROTHAND".

CREATE tabnamn.
tabnamn.NAMN = "KALKBEFB".

CREATE tabnamn.
tabnamn.NAMN = "HDKALK".

CREATE tabnamn.
tabnamn.NAMN = "INKADRESS".

CREATE tabnamn.
tabnamn.NAMN = "INKBER".

CREATE tabnamn.
tabnamn.NAMN = "INKMTRL".

/*TABELLER BER UPPLÄGG
KONSTGRUPP
BBENAMNING
EDIGRUPP
KONSTRUKTION
KONSTVAL
MTRLBER
BERSTOLP
BERSKAP
FORLAGG   
YTBELAGG
SAMFORLAGG
HDHANDELSE
HDKKOPP
   
*/
/*
CREATE tabnamn.
tabnamn.NAMN = "KONSTGRUPP".
tabnamn.WHEREFRASE = "WHERE KONSTGRUPP.KONSKOD = " + STRING(28).
CREATE tabnamn.
tabnamn.NAMN = "KONSTGRUPP".
tabnamn.WHEREFRASE = "WHERE KONSTGRUPP.KONSKOD = " + STRING(33).  
CREATE tabnamn.
tabnamn.NAMN = "BBENAMNING".
tabnamn.WHEREFRASE = "WHERE BBENAMNING.KONSKOD = " + STRING(28). 
CREATE tabnamn.
tabnamn.NAMN = "BBENAMNING".
tabnamn.WHEREFRASE = "WHERE BBENAMNING.KONSKOD = " + STRING(33).
CREATE tabnamn.
tabnamn.NAMN = "EDIGRUPP".
tabnamn.WHEREFRASE = "WHERE EDIGRUPP.KONSKOD = " + STRING(28). 
CREATE tabnamn.
tabnamn.NAMN = "EDIGRUPP".
tabnamn.WHEREFRASE = "WHERE EDIGRUPP.KONSKOD = " + STRING(33).

CREATE tabnamn.
tabnamn.NAMN = "KONSTRUKTION".
tabnamn.WHEREFRASE = "WHERE KONSTRUKTION.KONSKOD = " + STRING(28). 
CREATE tabnamn.
tabnamn.NAMN = "KONSTRUKTION".
tabnamn.WHEREFRASE = "WHERE KONSTRUKTION.KONSKOD = " + STRING(33).

CREATE tabnamn.
tabnamn.NAMN = "KONSTVAL".
tabnamn.WHEREFRASE = "WHERE KONSTVAL.KONSKOD = " + STRING(28). 
CREATE tabnamn.
tabnamn.NAMN = "KONSTVAL".
tabnamn.WHEREFRASE = "WHERE KONSTVAL.KONSKOD = " + STRING(33).
     
FOR EACH KONSTRUKTION WHERE KONSTVAL.KONSKOD = 28 NO-LOCK,
EACH MTRLBER WHERE MTRLBER.KTYPKOD = KONSTRUKTION.KTYPKOD NO-LOCK.
   CREATE tabnamn.
   tabnamn.NAMN = "MTRLBER".
   tabnamn.WHEREFRASE = "WHERE MTRLBER.KTYPKOD = '" + KONSTRUKTION.KTYPKOD + "'".      
END.
FOR EACH KONSTRUKTION WHERE KONSTVAL.KONSKOD = 33 NO-LOCK,
EACH MTRLBER WHERE MTRLBER.KTYPKOD = KONSTRUKTION.KTYPKOD NO-LOCK.
   CREATE tabnamn.
   tabnamn.NAMN = "MTRLBER".
   tabnamn.WHEREFRASE = "WHERE MTRLBER.KTYPKOD = '" + KONSTRUKTION.KTYPKOD + "'".      
END.      
   
*/

IF vad = 2 THEN RUN XDUMPDYNTT.P (INPUT TABLE tabnamn).



FOR EACH tabnamn WHERE tabnamn.NAMN = "MTRL" NO-LOCK:
   DELETE tabnamn.
END.
CREATE tabnamn.
tabnamn.NAMN = "MTRL".
FOR EACH tabnamn WHERE tabnamn.NAMN = "EXTRADATA" NO-LOCK:
   DELETE tabnamn.
END.
CREATE tabnamn.
tabnamn.NAMN = "EXTRADATA".
FOR EACH tabnamn WHERE tabnamn.NAMN = "EXTRAKOPPLINGAR" NO-LOCK:
   DELETE tabnamn.
END.
CREATE tabnamn.
tabnamn.NAMN = "EXTRAKOPPLINGAR".
FOR EACH tabnamn WHERE tabnamn.NAMN = "TIDSLAGEN" NO-LOCK:
   DELETE tabnamn.
END.
FOR EACH tabnamn WHERE tabnamn.NAMN = "TIDSLAGEN" NO-LOCK:
   DELETE tabnamn.
END.
CREATE tabnamn.
tabnamn.NAMN = "TIDSLAGEN ".

IF vad = 3 THEN  RUN xdynload.p (INPUT TABLE tabnamn).





/* ********************  Preprocessor Definitions  ******************** */


/* ***************************  Main Block  *************************** */
