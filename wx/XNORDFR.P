/*XNORDFR.P FRèNVARO*/
DEFINE TEMP-TABLE fvaro
  FIELD PNUMMER LIKE PERSONALTAB.PERSONNUMMER
  FIELD FNAMN LIKE PERSONALTAB.FORNAMN
  FIELD ENAMN LIKE PERSONALTAB.EFTERNAMN
  FIELD PKOD LIKE TIDREGITAB.PERSONALKOD
  FIELD AONR LIKE TIDREGITAB.AONR
  FIELD DATUM LIKE TIDREGITAB.DATUM
  FIELD START LIKE TIDREGITAB.START
  FIELD SLUT LIKE TIDREGITAB.SLUT
  INDEX PNUMMER IS PRIMARY PNUMMER ASCENDING.
REPEAT:
   FIND NEXT TIDREGITAB WHERE TIDREGITAB.VECKOKORD = "" USE-INDEX PKOD NO-LOCK NO-ERROR.
   IF NOT AVAILABLE TIDREGITAB THEN LEAVE.              
   IF TIDREGITAB.GODKAND = "" THEN NEXT.
   IF TIDREGITAB.TIDLOG = FALSE THEN NEXT.
   IF TIDREGITAB.PERSONALKOD = "" THEN NEXT.
   IF TIDREGITAB.AONR BEGINS "9109" THEN DO: 
      FIND FIRST PERSONALTAB WHERE PERSONALTAB.PERSONALKOD = TIDREGITAB.PERSONALKOD
      USE-INDEX PERSONALKOD NO-LOCK NO-ERROR.
      IF AVAILABLE PERSONALTAB THEN DO TRANSACTION:
         CREATE fvaro.
         ASSIGN  fvaro.PNUMMER = PERSONALTAB.PERSONNUMMER
         fvaro.FNAMN = PERSONALTAB.FORNAMN
         fvaro.ENAMN = PERSONALTAB.EFTERNAMN
         fvaro.PKOD = TIDREGITAB.PERSONALKOD 
         fvaro.AONR = TIDREGITAB.AONR
         fvaro.DATUM = TIDREGITAB.DATUM
         fvaro.START = TIDREGITAB.START 
         fvaro.SLUT = TIDREGITAB.SLUT.  
      END.
   END.      
END.
FIND FIRST FORETAG NO-LOCK NO-ERROR.                      
IF FORETAG.FORETAG = "NORD" THEN DO:
   OUTPUT TO F:\data\progress\fvaro.
END.
ELSE DO:
   OUTPUT TO C:\GURU\FVARO.
END.      
FOR EACH fvaro BY fvaro.PNUMMER BY fvaro.DATUM:
   EXPORT fvaro.
END.     