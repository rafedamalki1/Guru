/*XSIGANST.P*/
DEFINE BUFFER persbuff FOR PERSONALTAB.
DEFINE VARIABLE varanst LIKE PERSONALTAB.ANSTNR NO-UNDO.
OPEN QUERY pq FOR EACH PERSONALTAB USE-INDEX PERSONALKOD NO-LOCK.
DO TRANSACTION:
   GET FIRST pq EXCLUSIVE-LOCK.
   IF AVAILABLE PERSONALTAB THEN DO: 
      IF LENGTH(PERSONALTAB.EFTERNAMN) = 0 THEN RUN pers0_UI.
      ELSE RUN pers_UI.                          
   END.
END.
REPEAT:
   DO TRANSACTION:
      GET NEXT pq EXCLUSIVE-LOCK.
      IF AVAILABLE PERSONALTAB THEN DO: 
         IF LENGTH(PERSONALTAB.EFTERNAMN) = 0 THEN RUN pers0_UI.
          ELSE RUN pers_UI.           
      END.
      ELSE LEAVE.
   END.   
END.    

PROCEDURE pers_UI.  
   IF INDEX(PERSONALTAB.FORNAMN,"-") = 0 AND INDEX(PERSONALTAB.FORNAMN," ") = 0 THEN DO:                      
      varanst = CAPS(SUBSTRING(PERSONALTAB.FORNAMN,1,1)).       
      varanst = varanst + CAPS(SUBSTRING(PERSONALTAB.EFTERNAMN,1,1)) + 
      CAPS(SUBSTRING(PERSONALTAB.EFTERNAMN,LENGTH(PERSONALTAB.EFTERNAMN),1)).      
   END.    
   ELSE DO:   
      IF INDEX(PERSONALTAB.FORNAMN,"-") > 0 THEN DO:      
         varanst = CAPS(SUBSTRING(PERSONALTAB.FORNAMN,1,1)) + 
         CAPS(SUBSTRING(PERSONALTAB.FORNAMN,INDEX(PERSONALTAB.FORNAMN,"-") + 1,1)). 
         varanst = varanst + CAPS(SUBSTRING(PERSONALTAB.EFTERNAMN,1,1)) + 
         CAPS(SUBSTRING(PERSONALTAB.EFTERNAMN,LENGTH(PERSONALTAB.EFTERNAMN),1)).      
      END.
      IF INDEX(PERSONALTAB.FORNAMN," ") > 0 THEN DO:      
         varanst = CAPS(SUBSTRING(PERSONALTAB.FORNAMN,1,1)) + 
         CAPS(SUBSTRING(PERSONALTAB.FORNAMN,INDEX(PERSONALTAB.FORNAMN," ") + 1,1)). 
         varanst = varanst + CAPS(SUBSTRING(PERSONALTAB.EFTERNAMN,1,1)) + 
         CAPS(SUBSTRING(PERSONALTAB.EFTERNAMN,LENGTH(PERSONALTAB.EFTERNAMN),1)).      
      END.
   END.                 
   FIND FIRST persbuff WHERE persbuff.ANSTNR = varanst NO-LOCK NO-ERROR.
   IF AVAILABLE persbuff THEN DO:       
      IF RECID(persbuff) NE RECID(PERSONALTAB) THEN DO: 
         varanst = CAPS(SUBSTRING(PERSONALTAB.FORNAMN,1,2)).       
         varanst = varanst + CAPS(SUBSTRING(PERSONALTAB.EFTERNAMN,1,1)) + 
         CAPS(SUBSTRING(PERSONALTAB.EFTERNAMN,LENGTH(PERSONALTAB.EFTERNAMN),1)).
         FIND FIRST persbuff WHERE persbuff.ANSTNR = varanst NO-LOCK NO-ERROR.
         IF AVAILABLE persbuff THEN DO:
            IF RECID(persbuff) NE RECID(PERSONALTAB) THEN DO:      
               DISPLAY PERSONALTAB.PERSONALKOD varanst WITH FRAME CC DOWN.
               DOWN 1 WITH FRAME CC.
               RETURN.
            END.
         END.            
      END.
   END.
   PERSONALTAB.ANSTNR = varanst.
   RUN SUCCPNY.P (INPUT PERSONALTAB.PERSONALKOD,PERSONALTAB.ANSTNR, "AND").   
END PROCEDURE.
PROCEDURE pers0_UI.         
   varanst = CAPS(SUBSTRING(PERSONALTAB.FORNAMN,1,1)) + 
   CAPS(SUBSTRING(PERSONALTAB.FORNAMN,LENGTH(PERSONALTAB.FORNAMN),1)). 
   FIND FIRST persbuff WHERE persbuff.ANSTNR = varanst NO-LOCK NO-ERROR.
   IF AVAILABLE persbuff THEN DO:       
      IF RECID(persbuff) NE RECID(PERSONALTAB) THEN DO:                 
         varanst = CAPS(SUBSTRING(PERSONALTAB.FORNAMN,1,2)) + 
         CAPS(SUBSTRING(PERSONALTAB.FORNAMN,LENGTH(PERSONALTAB.FORNAMN),1)).
         FIND FIRST persbuff WHERE persbuff.ANSTNR = varanst NO-LOCK NO-ERROR.
         IF AVAILABLE persbuff THEN DO:
            IF RECID(persbuff) NE RECID(PERSONALTAB) THEN DO:      
               DISPLAY PERSONALTAB.PERSONALKOD varanst WITH FRAME CC DOWN.
               DOWN 1 WITH FRAME CC.
               RETURN.
            END.
         END.            
      END.
   END.
   PERSONALTAB.ANSTNR = varanst.
   RUN SUCCPNY.P (INPUT PERSONALTAB.PERSONALKOD,PERSONALTAB.ANSTNR, "AND").   
END PROCEDURE.