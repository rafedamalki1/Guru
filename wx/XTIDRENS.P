/*XTIDRENS.P*/
  
DEFINE QUERY tidq FOR TIDREGITAB.
DEFINE VARIABLE TABORT AS LOGICAL NO-UNDO.
  


OPEN QUERY tidq FOR EACH TIDREGITAB WHERE TIDREGITAB.DATUM = 12/30/96 OR 
TIDREGITAB.DATUM = 12/31/96 NO-LOCK BY PERSONALKOD BY DATUM.    
DO TRANSACTION:   
   GET FIRST tidq EXCLUSIVE-LOCK.    
   IF AVAILABLE TIDREGITAB THEN DO:  
      DISPLAY TIDREGITAB.PERSONALKOD DATUM WITH FRAME CC DOWN.
      UPDATE TABORT WITH FRAME CC DOWN .  
      DOWN 1 WITH FRAME CC.
      IF TABORT = TRUE THEN 
      DELETE TIDREGITAB.
   END. 
END.             
REPEAT TRANSACTION:                    
   GET NEXT tidq EXCLUSIVE-LOCK.          
   IF NOT AVAILABLE TIDREGITAB THEN LEAVE.   
   IF AVAILABLE TIDREGITAB THEN DO:  
      DISPLAY TIDREGITAB.PERSONALKOD DATUM WITH FRAME CC DOWN .
      UPDATE TABORT WITH FRAME CC DOWN . 
      DOWN 1 WITH FRAME CC.
      IF TABORT = TRUE THEN 
      DELETE TIDREGITAB.
   END.                 
END.  
CLOSE QUERY tidq. 