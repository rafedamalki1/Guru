OPEN QUERY KK FOR EACH KALKNATT NO-LOCK.
GET FIRST KK NO-LOCK.
DO WHILE AVAILABLE(KALKNATT):
   MESSAGE KALKNATT.AONR.
   FIND FIRST FASTSPEC WHERE FASTSPEC.KALKNR = KALKNATT.DELNR  
   NO-LOCK NO-ERROR.
   IF AVAILABLE FASTSPEC THEN DO TRANSACTION:
      IF FASTSPEC.TYP NE KALKNATT.TYP THEN DO:
         FIND FIRST KALKAONR WHERE KALKAONR.AONR = FASTSPEC.AONR AND
         KALKAONR.DELNR = FASTSPEC.DELNR AND KALKAONR.TYP = KALKNATT.TYP NO-LOCK NO-ERROR.
         IF AVAILABLE KALKAONR THEN DO:      
           GET CURRENT KK EXCLUSIVE-LOCK.
           ASSIGN
           KALKNATT.AONR = "" 
           KALKNATT.DELNR = KALKAONR.KALKNR.
        END.
     END.
   END.
   
   GET NEXT KK NO-LOCK.
END.
