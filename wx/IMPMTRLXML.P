/*IMPMTRLXML.P INLÄSNING AV SEMIKOLONFIL FÖR IMPORT AV KONSTRUKTION*/       
DEFINE NEW SHARED VARIABLE quotervar AS CHARACTER FORMAT "X(256)" NO-UNDO.





DEFINE VARIABLE musz AS LOGICAL NO-UNDO.

DEFINE VARIABLE rad AS INTEGER NO-UNDO.
DEFINE VARIABLE prognamn AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE prognamndat AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE prognamnque AS CHARACTER FORMAT "X(20)" NO-UNDO.                
DEFINE VARIABLE words AS CHARACTER FORMAT "X(132)" NO-UNDO.
DEFINE VARIABLE kommando AS CHARACTER FORMAT "X(132)" NO-UNDO.
DEFINE VARIABLE kommandoprog AS CHARACTER FORMAT "X(20)" NO-UNDO.
DEFINE VARIABLE satsvar AS CHARACTER FORMAT "X(11)" NO-UNDO.
DEFINE VARIABLE enrvar AS CHARACTER FORMAT "X(11)" NO-UNDO.
DEFINE VARIABLE melvar AS INTEGER NO-UNDO.
DEFINE VARIABLE melvar2 AS INTEGER NO-UNDO.
DEFINE VARIABLE langd AS INTEGER NO-UNDO.
DEFINE VARIABLE pos1 AS INTEGER NO-UNDO. 
DEFINE VARIABLE svar AS LOGICAL NO-UNDO.
DEFINE VARIABLE var2 AS CHARACTER NO-UNDO.
DEFINE VARIABLE dynxml AS HANDLE NO-UNDO.

DEFINE VARIABLE mtrlxapph AS HANDLE NO-UNDO.

DEFINE TEMP-TABLE tempnamn NO-UNDO
      FIELD NAMNH AS HANDLE
      FIELD TORGTH AS HANDLE
      FIELD NODTAB AS CHARACTER.


DEFINE TEMP-TABLE Frekventa NO-UNDO
   FIELD Enummer  AS CHARACTER
   FIELD Benamning AS CHARACTER
   FIELD Material-grupp  AS CHARACTER
   FIELD Pris AS DECIMAL
   FIELD Enhet     AS CHARACTER
   FIELD Leveransenhet     AS CHARACTER
   FIELD Fabrikat    AS CHARACTER
   FIELD AlternativtEnummer  AS CHARACTER.

   /*FIELD LEVKOD    AS CHARACTER
   FIELD KUND      AS LOGICAL  netto
   FIELD KPRIS     AS DECIMAL  katalog
   FIELD BPRIS     AS DECIMAL
   FIELD KALKNR    AS INTEGER*/

   


DEFINE TEMP-TABLE felmex   
   FIELD ENR                AS CHARACTER 
   FIELD BENAMNING          AS CHARACTER 
   FIELD ENHET              AS CHARACTER
   FIELD BPRIS              AS DECIMAL
   FIELD NPRIS              AS DECIMAL
   INDEX ENR IS PRIMARY ENR.   

/*DEFINE TEMP-TABLE infil
   FIELD PROGNAMN AS CHARACTER FORMAT "X(78)" 
   INDEX PRO IS PRIMARY PROGNAMN.
DEFINE TEMP-TABLE intid
   FIELD TIN AS CHARACTER FORMAT "X(78)" .*/
   
DEFINE INPUT PARAMETER filnamnuppxml AS CHARACTER NO-UNDO.   
DEFINE INPUT PARAMETER leverant AS CHARACTER NO-UNDO.   
DEFINE INPUT PARAMETER svar6 AS LOGICAL NO-UNDO.
DEFINE INPUT PARAMETER mkat AS INTEGER NO-UNDO.
DEFINE INPUT PARAMETER netto AS INTEGER NO-UNDO.
DEFINE OUTPUT PARAMETER TABLE FOR felmex.

{muswait.i}      
   
   
   

   /*filnamnuppxml = fildir + "mtrl.xml".*/
   RUN UTXMLDYN.P PERSISTENT SET dynxml (INPUT TRUE).
   
   IF Guru.Konstanter:appcon THEN DO:      
      RUN IMPMXMLAPP.P PERSISTENT SET mtrlxapph ON Guru.Konstanter:apphand TRANSACTION DISTINCT.      
   END.
   ELSE DO:      
      RUN IMPMXMLAPP.P PERSISTENT SET mtrlxapph. 
   END.

   EMPTY TEMP-TABLE felmex NO-ERROR. 

   INPUT FROM VALUE(filnamnuppxml) NO-ECHO.
   EMPTY TEMP-TABLE tempnamn NO-ERROR. 
   CREATE tempnamn.        
   tempnamn.NAMNH = BUFFER Frekventa:HANDLE.       
   tempnamn.TORGTH = TEMP-TABLE Frekventa:HANDLE.
   tempnamn.NODTAB = tempnamn.NAMNH:NAME.

   RUN xmlinstart_UI IN dynxml (INPUT TABLE tempnamn,INPUT filnamnuppxml).
   RUN xmlslut_UI IN dynxml.
   RUN mkatxml_UI IN mtrlxapph (INPUT TABLE Frekventa,INPUT leverant, INPUT svar6,INPUT netto,OUTPUT TABLE felmex ).             
   
   

                
