/*FAKOSAPPA.P*/
&Scoped-define NEW NEW                          
{FAKTTEMP.I}
DEFINE INPUT PARAMETER fnr LIKE FAKTPLAN.FAKTNR NO-UNDO.
DEFINE INPUT PARAMETER fdelnrvar              AS INTEGER NO-UNDO.
DEFINE INPUT PARAMETER aonrvar AS CHARACTER NO-UNDO.
DEFINE INPUT PARAMETER delnrvar AS INTEGER NO-UNDO.
DEFINE INPUT PARAMETER FILL-IN-TOMDAT AS DATE NO-UNDO.
DEFINE INPUT-OUTPUT PARAMETER FILL-IN_INKOMST AS DECIMAL NO-UNDO.
DEFINE OUTPUT PARAMETER TABLE FOR kosttemp.   

 {FAKOSAPP.I}
/*ALLA SPARADE KOSTREG*/
FOR EACH kosttemp NO-LOCK, 
EACH FAKTKOST WHERE FAKTKOST.FAKTNR = fnr AND
FAKTKOST.VFAKTNR = 0 AND FAKTKOST.AONR = kosttemp.AONR AND
FAKTKOST.DELNR = kosttemp.DELNR AND FAKTKOST.RADNR = kosttemp.RADNR NO-LOCK:
   ASSIGN
   kosttemp.FAKTNR = FAKTKOST.VERNR    
   kosttemp.RADNR = FAKTKOST.RADNR
   kosttemp.MED = FAKTKOST.MED 
   kosttemp.MASKKOST = FAKTKOST.MASKKOST 
   kosttemp.PERSKOST = FAKTKOST.PERSKOST
   kosttemp.TRAKTKOST = FAKTKOST.TRAKTKOST
   kosttemp.MTRL = FAKTKOST.MTRL
   kosttemp.OVRKR = FAKTKOST.OVRKR                                      
   kosttemp.BENAMNING = FAKTKOST.BENAMNING
   kosttemp.MOMSEXTERNT = FAKTKOST.MOMSEXTERNT
   kosttemp.MOMSID = FAKTKOST.MOMSID
   kosttemp.FRTJPAKR = FAKTKOST.MASKKOST * FAKTKOST.FRTJPA / 100
   kosttemp.MTRLPAKR = FAKTKOST.MTRL * FAKTKOST.MTRLPA / 100.         
END.    
IF kontber = TRUE THEN DO:
   FOR EACH FAKTKOST WHERE FAKTKOST.FAKTNR = fnr AND
   FAKTKOST.VFAKTNR = 0 NO-LOCK:
      FIND FIRST kosttemp WHERE
      kosttemp.AONR = FAKTKOST.AONR AND
      kosttemp.DELNR = FAKTKOST.DELNR AND kosttemp.RADNR  = FAKTKOST.RADNR NO-LOCK NO-ERROR.
      IF NOT AVAILABLE kosttemp THEN DO:
         CREATE kosttemp.
         ASSIGN
         kosttemp.AONR = FAKTKOST.AONR 
         kosttemp.DELNR = FAKTKOST.DELNR 
         kosttemp.FAKTNR = FAKTKOST.VERNR    
         kosttemp.RADNR = FAKTKOST.RADNR
         kosttemp.MED = FAKTKOST.MED 
         kosttemp.MASKKOST = FAKTKOST.MASKKOST 
         kosttemp.PERSKOST = FAKTKOST.PERSKOST
         kosttemp.TRAKTKOST = FAKTKOST.TRAKTKOST
         kosttemp.MTRL = FAKTKOST.MTRL
         kosttemp.OVRKR = FAKTKOST.OVRKR                                      
         kosttemp.BENAMNING = FAKTKOST.BENAMNING
         kosttemp.MOMSEXTERNT = FAKTKOST.MOMSEXTERNT
         kosttemp.MOMSID = FAKTKOST.MOMSID
         kosttemp.FRTJPAKR = FAKTKOST.MASKKOST * FAKTKOST.FRTJPA / 100
         kosttemp.MTRLPAKR = FAKTKOST.MTRL * FAKTKOST.MTRLPA / 100.         
      END.
   END.
END.
FOR EACH MOMSTAB NO-LOCK,
EACH kosttemp WHERE kosttemp.MOMSID = MOMSTAB.MOMSID:
   kosttemp.MOMSKOD = MOMSTAB.MOMSKOD.
END. 


