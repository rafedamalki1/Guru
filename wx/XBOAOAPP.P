/*XBOAOAPP.P  */
DEFINE INPUT PARAMETER aonrrec AS RECID NO-UNDO.
DEFINE OUTPUT PARAMETER musz AS LOGICAL NO-UNDO.                  
FIND AONRTAB WHERE RECID(AONRTAB) = aonrrec NO-LOCK NO-ERROR.
OPEN QUERY aonrkq FOR EACH AONRKONTKOD WHERE AONRKONTKOD.AONR = AONRTAB.AONR AND
AONRKONTKOD.DELNR = AONRTAB.DELNR NO-LOCK.
GET FIRST aonrkq NO-LOCK.
DO WHILE AVAILABLE(AONRKONTKOD):
   DO TRANSACTION:       
      GET CURRENT aonrkq EXCLUSIVE-LOCK.
      DELETE AONRKONTKOD.    
   END.
   GET NEXT aonrkq NO-LOCK.
END.                              
/*
OPEN QUERY succq FOR EACH SUCCAONR WHERE SUCCAONR.AONR = AONRTAB.AONR AND
SUCCAONR.DELNR = SUCCAONR.DELNR NO-LOCK.
GET FIRST succq NO-LOCK.
DO WHILE AVAILABLE(SUCCAONR):
   DO TRANSACTION:       
      GET CURRENT succq EXCLUSIVE-LOCK.
      DELETE SUCCAONR.    
   END.
   GET NEXT succq NO-LOCK.
END.
*/
OPEN QUERY kostq FOR EACH KOSTREG WHERE KOSTREG.AONR = AONRTAB.AONR AND
KOSTREG.DELNR = AONRTAB.DELNR USE-INDEX KOST NO-LOCK.
DO TRANSACTION:       
   GET FIRST kostq EXCLUSIVE-LOCK.
   IF AVAILABLE KOSTREG THEN DELETE KOSTREG.    
END.
REPEAT:  
   DO TRANSACTION:
      GET NEXT kostq EXCLUSIVE-LOCK.
      IF AVAILABLE KOSTREG THEN DELETE KOSTREG.    
      ELSE LEAVE.      
   END.         
END.
OPEN QUERY tidq FOR EACH AONRTIDLAGE WHERE AONRTIDLAGE.AONR = AONRTAB.AONR AND
AONRTIDLAGE.DELNR = AONRTAB.DELNR NO-LOCK.
GET FIRST tidq NO-LOCK.
DO WHILE AVAILABLE(AONRTIDLAGE):
   DO TRANSACTION:       
      GET CURRENT tidq EXCLUSIVE-LOCK.
      DELETE AONRTIDLAGE.    
   END.
   GET NEXT tidq NO-LOCK.
END.


DO TRANSACTION:
   FIND AONRTAB WHERE RECID(AONRTAB) = aonrrec EXCLUSIVE-LOCK NO-ERROR.
   DELETE AONRTAB.  
END.
