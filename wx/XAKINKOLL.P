DEFINE TEMP-TABLE sumaotemp   
   FIELD AONR LIKE TIDREGITAB.AONR
   FIELD DELNR LIKE TIDREGITAB.DELNR   
   FIELD FAKTKOST AS DECIMAL
   FIELD KONTO AS CHARACTER
   INDEX KK IS PRIMARY KONTO AONR DELNR.
DEFINE TEMP-TABLE sumaotempK   
   FIELD AONR LIKE TIDREGITAB.AONR
   FIELD DELNR LIKE TIDREGITAB.DELNR   
   FIELD FAKTKOST AS DECIMAL
   FIELD KONTO AS CHARACTER
   INDEX KK IS PRIMARY KONTO AONR DELNR.

DEFINE VARIABLE fbelopp AS DECIMAL NO-UNDO.
DEFINE VARIABLE fbelopp2 AS DECIMAL NO-UNDO.
DEFINE VARIABLE fbeloppK AS DECIMAL NO-UNDO.
DEFINE VARIABLE fbeloppK2 AS DECIMAL NO-UNDO.
FOR EACH FAKTURERAD WHERE FAKTURERAD.BOKDATUM >= 12/01/2002 AND FAKTURERAD.BOKDATUM <= 12/31/2002 NO-LOCK,
EACH FAKTINTAKTKONT WHERE FAKTINTAKTKONT.VFAKTNR = FAKTURERAD.VFAKTNR NO-LOCK,
EACH FAKTAONRKONTO WHERE FAKTAONRKONTO.FAKTNR = FAKTURERAD.FAKTNR AND 
   FAKTAONRKONTO.VFAKTNR = FAKTURERAD.VFAKTNR AND
   FAKTAONRKONTO.AONR = FAKTINTAKTKONT.AONR AND 
   FAKTAONRKONTO.DELNR = FAKTINTAKTKONT.DELNR AND 
   FAKTAONRKONTO.K2 = "3220"
   NO-LOCK.
   fbelopp = fbelopp + FAKTINTAKTKONT.BELOPP * FAKTAONRKONTO.SATS% / 100.
   RUN KOLL_ui (INPUT FAKTAONRKONTO.K2).  
END.
FOR EACH FAKTURERAD WHERE FAKTURERAD.BOKDATUM >= 12/01/2002 AND FAKTURERAD.BOKDATUM <= 12/31/2002 NO-LOCK,
EACH FAKTINTAKTKONT WHERE FAKTINTAKTKONT.VFAKTNR = FAKTURERAD.VFAKTNR NO-LOCK,
EACH FAKTAONRKONTO WHERE FAKTAONRKONTO.FAKTNR = FAKTURERAD.FAKTNR AND 
   FAKTAONRKONTO.VFAKTNR = FAKTURERAD.VFAKTNR AND
   FAKTAONRKONTO.AONR = FAKTINTAKTKONT.AONR AND 
   FAKTAONRKONTO.DELNR = FAKTINTAKTKONT.DELNR AND 
   FAKTAONRKONTO.K2 = "3320"
   NO-LOCK.
   fbelopp2 = fbelopp2 + FAKTINTAKTKONT.BELOPP * FAKTAONRKONTO.SATS% / 100.
   RUN KOLL_ui (INPUT FAKTAONRKONTO.K2).   
END.
FOR EACH FAKTKRED WHERE FAKTKRED.BOKDATUM >= 12/01/2002 AND FAKTKRED.BOKDATUM <= 12/31/2002 NO-LOCK,
EACH FAKTINTAKTKONTKRED WHERE FAKTINTAKTKONTKRED.VKREDIT = FAKTKRED.VKREDIT NO-LOCK,
EACH FAKTAONRKONTOKRED WHERE FAKTAONRKONTOKRED.FAKTNR = FAKTKRED.FAKTNR AND 
   FAKTAONRKONTOKRED.VKREDIT = FAKTKRED.VKREDIT AND
   FAKTAONRKONTOKRED.AONR = FAKTINTAKTKONTKRED.AONR AND 
   FAKTAONRKONTOKRED.DELNR = FAKTINTAKTKONTKRED.DELNR AND 
   FAKTAONRKONTOKRED.K2 = "3220"
   NO-LOCK.
   fbeloppK = fbeloppK + FAKTINTAKTKONTKRED.BELOPP * FAKTAONRKONTOKRED.SATS% / 100.
   RUN KOLLK_ui (INPUT FAKTAONRKONTOKRED.K2).   
END.
FOR EACH FAKTKRED WHERE FAKTKRED.BOKDATUM >= 12/01/2002 AND FAKTKRED.BOKDATUM <= 12/31/2002 NO-LOCK,
EACH FAKTINTAKTKONTKRED WHERE FAKTINTAKTKONTKRED.VKREDIT = FAKTKRED.VKREDIT NO-LOCK,
EACH FAKTAONRKONTOKRED WHERE FAKTAONRKONTOKRED.FAKTNR = FAKTKRED.FAKTNR AND 
   FAKTAONRKONTOKRED.VKREDIT = FAKTKRED.VKREDIT AND
   FAKTAONRKONTOKRED.AONR = FAKTINTAKTKONTKRED.AONR AND 
   FAKTAONRKONTOKRED.DELNR = FAKTINTAKTKONTKRED.DELNR AND 
   FAKTAONRKONTOKRED.K2 = "3320"
   NO-LOCK.
   fbeloppK2 = fbeloppK2 + FAKTINTAKTKONTKRED.BELOPP * FAKTAONRKONTOKRED.SATS% / 100.
   RUN KOLLK_ui (INPUT FAKTAONRKONTOKRED.K2).   
END.
FOR EACH sumaotemp:
   DISP sumaotemp.
END.
FOR EACH sumaotempK:
   DISP sumaotempK.
END.
MESSAGE  fbelopp fbelopp2 fbeloppK fbeloppK2 VIEW-AS ALERT-BOX.
PROCEDURE koll_Ui:
   DEFINE INPUT PARAMETER kkonto AS CHARACTER NO-UNDO.
   FIND FIRST sumaotemp WHERE sumaotemp.AONR = FAKTAONRKONTO.AONR AND 
   sumaotemp.DELNR = FAKTAONRKONTO.DELNR AND sumaotemp.KONTO = kkonto
   NO-ERROR. 
   IF NOT AVAILABLE sumaotemp THEN CREATE sumaotemp.
   ASSIGN
   sumaotemp.AONR = FAKTINTAKTKONT.AONR
   sumaotemp.DELNR = FAKTINTAKTKONT.DELNR         
   sumaotemp.KONTO = kkonto
   sumaotemp.FAKTKOST = sumaotemp.FAKTKOST +  FAKTINTAKTKONT.BELOPP * FAKTAONRKONTO.SATS% / 100.
END PROCEDURE.
PROCEDURE kollK_Ui:
   DEFINE INPUT PARAMETER kkonto AS CHARACTER NO-UNDO.
   FIND FIRST sumaotempK WHERE sumaotempK.AONR = FAKTAONRKONTOKRED.AONR AND 
   sumaotempK.DELNR = FAKTAONRKONTOKRED.DELNR AND sumaotempK.KONTO = kkonto
   NO-ERROR. 
   IF NOT AVAILABLE sumaotempK THEN CREATE sumaotempK.
   ASSIGN
   sumaotempK.AONR = FAKTINTAKTKONTKRED.AONR
   sumaotempK.DELNR = FAKTINTAKTKONTKRED.DELNR         
   sumaotempK.KONTO = kkonto
   sumaotempK.FAKTKOST = sumaotempK.FAKTKOST +  FAKTINTAKTKONTKRED.BELOPP * FAKTAONRKONTOKRED.SATS% / 100.
END PROCEDURE.

